(self.webpackChunkshell=self.webpackChunkshell||[]).push([[2],{2002:(y,g,i)=>{i.r(g),i.d(g,{API_CONFIG:()=>d,MfeLoaderService:()=>p,ProductCategory:()=>E,RoleService:()=>A,SalesStatus:()=>M,UserRole:()=>o,authInterceptor:()=>L,hasRequiredRole:()=>f});var m=i(5883),o=function(t){return t.SUPER_ADMIN="super-admin",t.ORG_ADMIN="org-admin",t.TEAM_LEAD="team-lead",t.SALES_EXECUTIVE="sales-executive",t}(o||{});function f(t,c){const e={[o.SUPER_ADMIN]:4,[o.ORG_ADMIN]:3,[o.TEAM_LEAD]:2,[o.SALES_EXECUTIVE]:1};return e[t]>=e[c]}var S=i(4304);let A=(()=>{class t{constructor(){this.currentUserSubject=new m.BehaviorSubject(null),this.currentUser$=this.currentUserSubject.asObservable(),console.log("[RoleService] Service initialized"),this.loadInitialUser()}setUserFromAuth(e){console.log("[RoleService] Setting user from Auth0 auth:",e);const r=this.mapUserInfoToUser(e);console.log("[RoleService] Mapped user with role:",r),this.setCurrentUser(r)}mapUserInfoToUser(e){const r=this.extractRoleFromToken(e);return{id:e.sub,name:e.name||e.email||"User",email:e.email||"",role:r}}extractRoleFromToken(e){if(e.role)return this.mapStringToUserRole(e.role);if(e.org_and_roles){const n=this.extractRoleFromOrgAndRoles(e.org_and_roles);if(n)return console.log("[RoleService] Extracted role from org_and_roles:",n),n}const s=Object.keys(e).filter(n=>n.startsWith("http://")||n.startsWith("https://")).find(n=>n.toLowerCase().includes("role"));if(s&&e[s]){const n=e[s],l=Array.isArray(n)?n[0]:n;return this.mapStringToUserRole(l)}return console.warn("[RoleService] No role found in token, falling back to email pattern"),this.determineRoleFromEmail(e.email||"")}extractRoleFromOrgAndRoles(e){if(!e||"object"!=typeof e)return null;const r=[];for(const n in e){const l=e[n];Array.isArray(l)&&l.forEach(a=>{const u=this.mapStringToUserRole(a);r.push(u)})}if(0===r.length)return null;const s=[o.SUPER_ADMIN,o.ORG_ADMIN,o.TEAM_LEAD,o.SALES_EXECUTIVE];for(const n of s)if(r.includes(n))return console.log("[RoleService] Selected highest privilege role:",n),n;return r[0]}mapStringToUserRole(e){const r=e.toLowerCase().replace(/[-_\s]/g,"");return{superadmin:o.SUPER_ADMIN,super:o.SUPER_ADMIN,admin:o.SUPER_ADMIN,orgadmin:o.ORG_ADMIN,organizationadmin:o.ORG_ADMIN,manager:o.ORG_ADMIN,teamlead:o.TEAM_LEAD,lead:o.TEAM_LEAD,salesexecutive:o.SALES_EXECUTIVE,sales:o.SALES_EXECUTIVE,executive:o.SALES_EXECUTIVE}[r]||o.SALES_EXECUTIVE}determineRoleFromEmail(e){const r=e.toLowerCase();return[{patterns:["admin","super"],role:o.SUPER_ADMIN},{patterns:["manager","org"],role:o.ORG_ADMIN},{patterns:["lead","team"],role:o.TEAM_LEAD}].find(({patterns:l})=>l.some(a=>r.includes(a)))?.role??o.SALES_EXECUTIVE}loadInitialUser(){const e=this.getDevMimicUser();if(e)return console.log("[RoleService] Using dev mimic user:",e),void this.currentUserSubject.next(e)}getDevMimicUser(){try{const e=localStorage.getItem("dev_mimic_user");if(e){const r=JSON.parse(e);if(r.id&&r.name&&r.role)return r}}catch(e){console.error("[RoleService] Error parsing dev mimic user:",e)}return null}setDevMimicUser(e){e?(localStorage.setItem("dev_mimic_user",JSON.stringify(e)),this.currentUserSubject.next(e),console.log("[RoleService] Dev mimic user set:",e)):(localStorage.removeItem("dev_mimic_user"),this.loadDummyUser(),console.log("[RoleService] Dev mimic user cleared"))}loadDummyUser(){console.log("[RoleService] Loading user from session storage");const e=sessionStorage.getItem("current_user");if(e){const r=JSON.parse(e);console.log("[RoleService] User loaded from session:",r),this.currentUserSubject.next(r)}else{const r={id:"user-1",name:"John Admin",email:"john.admin@company.com",role:o.ORG_ADMIN};console.log("[RoleService] No saved user found, using default:",r),this.setCurrentUser(r)}}setCurrentUser(e){console.log("[RoleService] Setting current user:",e),this.currentUserSubject.next(e),e?(sessionStorage.setItem("current_user",JSON.stringify(e)),console.log("[RoleService] User saved to session storage")):(sessionStorage.removeItem("current_user"),console.log("[RoleService] User removed from session storage"))}getCurrentUser(){const e=this.currentUserSubject.value;return console.log("[RoleService] getCurrentUser() called, returning:",e),e}getCurrentUserRole(){const e=this.currentUserSubject.value?.role||null;return console.log("[RoleService] getCurrentUserRole() called, returning:",e),e}hasRole(e){const r=this.getCurrentUserRole();if(!r)return console.log("[RoleService] hasRole() - No current role, access denied"),!1;const s=f(r,e);return console.log(`[RoleService] hasRole() - Checking if ${r} has ${e}:`,s),s}canViewOthersData(){const e=this.getCurrentUserRole(),r=e===o.SUPER_ADMIN||e===o.ORG_ADMIN||e===o.TEAM_LEAD;return console.log(`[RoleService] canViewOthersData() - Role: ${e}, Can view:`,r),r}getViewableUsers(){const e=this.getCurrentUser();if(!e)return[];const r=this.getAllUsers();return this.isTeamLeadOrHigher()?r.filter(s=>s.role===o.SALES_EXECUTIVE||s.id===e.id):r.filter(s=>s.id===e.id)}hasAnyRole(e){const r=this.getCurrentUser();return!!r&&e.includes(r.role)}isAdmin(){return this.hasAnyRole([o.SUPER_ADMIN,o.ORG_ADMIN])}isTeamLeadOrHigher(){return this.hasAnyRole([o.SUPER_ADMIN,o.ORG_ADMIN,o.TEAM_LEAD])}getAllUsers(){return[{id:"user-1",name:"John Admin",email:"john.admin@company.com",role:o.SUPER_ADMIN},{id:"user-2",name:"Sarah Manager",email:"sarah.manager@company.com",role:o.ORG_ADMIN},{id:"user-3",name:"Mike Lead",email:"mike.lead@company.com",role:o.TEAM_LEAD,teamId:"team-1"},{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",role:o.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-5",name:"Bob Sales",email:"bob.sales@company.com",role:o.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-6",name:"Carol Sales",email:"carol.sales@company.com",role:o.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"}]}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=S.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var h=i(467),R=i(1913);let p=(()=>{class t{constructor(){this.mfeConfigs=[],this.loadedMfesSubject=new m.BehaviorSubject(new Set),this.loadedMfes$=this.loadedMfesSubject.asObservable(),this.loadingMfesSubject=new m.BehaviorSubject(new Set),this.loadingMfes$=this.loadingMfesSubject.asObservable(),console.log("[MfeLoaderService] Service initialized")}setConfigs(e){console.log("[MfeLoaderService] setConfigs() called with",e.length,"configurations"),this.mfeConfigs=e.sort((r,s)=>s.priority-r.priority),console.log("[MfeLoaderService] Configurations sorted by priority:",this.mfeConfigs.map(r=>({name:r.name,priority:r.priority})))}getConfigs(){return console.log("[MfeLoaderService] getConfigs() called, returning",this.mfeConfigs.length,"configurations"),this.mfeConfigs}getConfigsForRole(e){console.log("[MfeLoaderService] getConfigsForRole() called for role:",e);const r=this.mfeConfigs.filter(s=>s.allowedRoles.includes(e));return console.log("[MfeLoaderService] Found",r.length,"configurations for role:",e,r.map(s=>s.name)),r}getConfigByName(e){console.log("[MfeLoaderService] getConfigByName() called for:",e);const r=this.mfeConfigs.find(s=>s.name===e);return r?console.log("[MfeLoaderService] Found configuration for:",e):console.warn("[MfeLoaderService] Configuration not found for:",e),r}preloadPriorityMfes(e){var r=this;return(0,h.A)(function*(){console.log("[MfeLoaderService] preloadPriorityMfes() called for role:",e);const n=r.getConfigsForRole(e).filter(a=>a.priority>=5);console.log("[MfeLoaderService] Preloading",n.length,"priority MFEs:",n.map(a=>({name:a.name,priority:a.priority})));const l=n.map(a=>r.loadMfe(a));yield Promise.all(l),console.log("[MfeLoaderService] Preloading complete")})()}loadMfe(e){var r=this;return(0,h.A)(function*(){const s=r.loadingMfesSubject.value,n=r.loadedMfesSubject.value;if(n.has(e.name))console.log(`[MfeLoaderService] MFE ${e.name} already loaded`);else if(s.has(e.name))console.log(`[MfeLoaderService] MFE ${e.name} is already loading`);else try{const l=new Set(s);l.add(e.name),r.loadingMfesSubject.next(l),console.log(`[MfeLoaderService] Loading MFE ${e.name} (priority: ${e.priority})`),console.log("[MfeLoaderService] MFE config:",{name:e.name,url:e.url,exposedModule:e.exposedModule,remoteName:e.remoteName});const a=yield(0,R.loadRemoteModule)({type:"module",remoteEntry:e.url,exposedModule:e.exposedModule}),u=new Set(n);u.add(e.name),r.loadedMfesSubject.next(u);const v=new Set(r.loadingMfesSubject.value);return v.delete(e.name),r.loadingMfesSubject.next(v),console.log(`[MfeLoaderService] Successfully loaded MFE ${e.name}`),console.log("[MfeLoaderService] Currently loaded MFEs:",Array.from(r.loadedMfesSubject.value)),a}catch(l){console.error(`[MfeLoaderService] Error loading MFE ${e.name}:`,l),console.error("[MfeLoaderService] Failed config:",{name:e.name,url:e.url,exposedModule:e.exposedModule});const a=new Set(r.loadingMfesSubject.value);throw a.delete(e.name),r.loadingMfesSubject.next(a),l}})()}isMfeLoaded(e){const r=this.loadedMfesSubject.value.has(e);return console.log(`[MfeLoaderService] isMfeLoaded(${e}):`,r),r}isMfeLoading(e){const r=this.loadingMfesSubject.value.has(e);return console.log(`[MfeLoaderService] isMfeLoading(${e}):`,r),r}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=S.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var U=i(7544);const d={baseUrl:"https://tmzuktmjy7.execute-api.us-east-1.amazonaws.com"},L=(t,c)=>{const r=(0,S.inject)(U.AuthService).getTokenSync();return!r||C(t.url)?c(t):c(t.clone({setHeaders:{Authorization:`Bearer ${r}`}}))},C=t=>{try{if(d&&"object"==typeof d&&d.baseUrl&&t.startsWith(d.baseUrl))return!1}catch(e){console.warn("[authInterceptor] API_CONFIG not available, using pattern-based auth endpoint detection",e)}return["/oauth","auth0.com","/authorize","/token"].some(e=>t.includes(e))};var M=function(t){return t.COMPLETED="completed",t.PENDING="pending",t.CANCELLED="cancelled",t}(M||{}),E=function(t){return t.ELECTRONICS="Electronics",t.SOFTWARE="Software",t.SERVICES="Services",t.HARDWARE="Hardware",t}(E||{})}}]);