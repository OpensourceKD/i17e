(self.webpackChunkshell=self.webpackChunkshell||[]).push([[379],{1633:(_,x,s)=>{s.d(x,{n:()=>A});var P=s(467),d=s(5565),R=s(7412),j=s(1913),I=s(5315);const M=["container"];let A=(()=>{class y{constructor(){this.name=""}ngAfterViewInit(){var S=this;return(0,P.A)(function*(){const f=R.A.map(({remoteName:b,exposedModule:w})=>({remoteName:b,exposedModule:w})).find(({remoteName:b})=>b===S.name);if(!f)return;const E=yield(0,j.loadRemoteModule)(f);S.remoteContainer.createComponent(E.AppComponent)})()}static{this.\u0275fac=function(f){return new(f||y)}}static{this.\u0275cmp=d.\u0275\u0275defineComponent({type:y,selectors:[["app-mfe-wrapper"]],viewQuery:function(f,E){if(1&f&&d.\u0275\u0275viewQuery(M,7,d.ViewContainerRef),2&f){let b;d.\u0275\u0275queryRefresh(b=d.\u0275\u0275loadQuery())&&(E.remoteContainer=b.first)}},inputs:{name:"name"},standalone:!0,features:[d.\u0275\u0275StandaloneFeature],decls:4,vars:0,consts:[["container",""]],template:function(f,E){1&f&&(d.\u0275\u0275elementStart(0,"p"),d.\u0275\u0275text(1,"mfe-wrapper works!"),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementContainer(2,null,0))},dependencies:[I.CommonModule],changeDetection:0})}}return y})()},6379:(_,x,s)=>{s.r(x),s.d(x,{bootstrap:()=>$});var P=s(1194),d=s(467),v=s(3319),R=s(5315),j=s(3793),g=s(2485),I=s(7412),r=s(5565),M=s(1663);let A=(()=>{class n{constructor(e){this.http=e}login(){window.location.href="http://localhost:4000/auth/login"}logout(){window.location.href="http://localhost:4000/auth/logout"}getUserProfile(){return this.http.get("http://localhost:4000/auth/me",{withCredentials:!0})}static{this.\u0275fac=function(t){return new(t||n)(r.\u0275\u0275inject(M.HttpClient))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var y=s(8662),h=s(9903);let S=(()=>{class n{constructor(){this.currentUserSubject=new g.BehaviorSubject(null),this.currentUser$=this.currentUserSubject.asObservable(),this.loadDummyUser()}loadDummyUser(){const e=sessionStorage.getItem("current_user");e?this.currentUserSubject.next(JSON.parse(e)):this.setCurrentUser({id:"1",name:"John Doe",email:"john.doe@example.com",role:h.g.SALES_EXECUTIVE})}setCurrentUser(e){this.currentUserSubject.next(e),e?sessionStorage.setItem("current_user",JSON.stringify(e)):sessionStorage.removeItem("current_user")}getCurrentUser(){return this.currentUserSubject.value}getCurrentUserRole(){return this.currentUserSubject.value?.role||null}hasRole(e){const t=this.getCurrentUserRole();return!!t&&(0,h.W)(t,e)}canViewOthersData(){const e=this.getCurrentUserRole();return e===h.g.SUPER_ADMIN||e===h.g.ORG_ADMIN||e===h.g.TEAM_LEAD}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),f=(()=>{class n{constructor(){this.salesExecutivesSubject=new g.BehaviorSubject(this.generateSalesExecutives()),this.salesExecutives$=this.salesExecutivesSubject.asObservable(),this.salesRecordsSubject=new g.BehaviorSubject(this.generateSalesRecords()),this.salesRecords$=this.salesRecordsSubject.asObservable(),this.incentiveRulesSubject=new g.BehaviorSubject(this.generateIncentiveRules()),this.incentiveRules$=this.incentiveRulesSubject.asObservable(),this.incentivesEarnedSubject=new g.BehaviorSubject(this.generateIncentivesEarned()),this.incentivesEarned$=this.incentivesEarnedSubject.asObservable()}generateSalesExecutives(){return[{id:"1",name:"John Doe",email:"john.doe@example.com",teamId:"team1"},{id:"2",name:"Jane Smith",email:"jane.smith@example.com",teamId:"team1"},{id:"3",name:"Bob Johnson",email:"bob.johnson@example.com",teamId:"team2"},{id:"4",name:"Alice Williams",email:"alice.williams@example.com",teamId:"team2"},{id:"5",name:"Charlie Brown",email:"charlie.brown@example.com",teamId:"team1"}]}generateSalesRecords(){const e=[],t=this.generateSalesExecutives(),c=["Product A","Product B","Product C","Product D"],l=["completed","pending","cancelled"];for(let o=0;o<50;o++){const i=t[o%t.length],m=Math.floor(o/10),a=new Date;a.setMonth(a.getMonth()-m),e.push({id:`sale-${o+1}`,salesExecutiveId:i.id,salesExecutiveName:i.name,date:a,productName:c[o%c.length],amount:Math.floor(5e4*Math.random())+1e4,quantity:Math.floor(10*Math.random())+1,status:l[o%3]})}return e}generateIncentiveRules(){return[{id:"rule-1",name:"Basic Sales Incentive",description:"5% incentive on all sales",type:"percentage",value:5,isActive:!0,createdBy:"admin",createdAt:new Date("2024-01-01")},{id:"rule-2",name:"High Value Sales Bonus",description:"10% incentive on sales above $50,000",type:"percentage",value:10,minSalesAmount:5e4,isActive:!0,createdBy:"admin",createdAt:new Date("2024-02-01")},{id:"rule-3",name:"Product A Special",description:"Fixed $500 bonus for Product A sales",type:"fixed",value:500,productCategory:"Product A",isActive:!0,createdBy:"team-lead-1",createdAt:new Date("2024-03-01")},{id:"rule-4",name:"Tiered Volume Incentive",description:"15% incentive on sales above $100,000",type:"tiered",value:15,minSalesAmount:1e5,isActive:!1,createdBy:"admin",createdAt:new Date("2024-04-01")}]}generateIncentivesEarned(){const e=[],t=this.generateSalesExecutives(),c=this.generateIncentiveRules(),l=["pending","approved","paid"];for(let o=0;o<30;o++){const i=t[o%t.length],m=c[o%c.length],a=Math.floor(o/10),u=new Date;u.setMonth(u.getMonth()-a),e.push({id:`incentive-${o+1}`,salesExecutiveId:i.id,salesExecutiveName:i.name,ruleId:m.id,ruleName:m.name,salesRecordId:`sale-${o+1}`,amount:Math.floor(5e3*Math.random())+500,earnedDate:u,status:l[o%3]})}return e}getSalesRecordsForExecutive(e){return this.salesRecordsSubject.value.filter(t=>t.salesExecutiveId===e)}getIncentivesForExecutive(e){return this.incentivesEarnedSubject.value.filter(t=>t.salesExecutiveId===e)}getReportDataForExecutive(e){const t=this.salesExecutivesSubject.value.find(a=>a.id===e),c=this.getSalesRecordsForExecutive(e),l=this.getIncentivesForExecutive(e),o=c.filter(a=>"completed"===a.status).reduce((a,u)=>a+u.amount,0),i=l.filter(a=>"pending"!==a.status).reduce((a,u)=>a+u.amount,0),m=[];for(let a=5;a>=0;a--){const u=new Date;u.setMonth(u.getMonth()-a);const C=u.toISOString().substring(0,7),N=c.filter(p=>p.date.toISOString().substring(0,7)===C&&"completed"===p.status).reduce((p,D)=>p+D.amount,0),W=l.filter(p=>p.earnedDate.toISOString().substring(0,7)===C&&"pending"!==p.status).reduce((p,D)=>p+D.amount,0);m.push({month:C,sales:N,incentives:W})}return{salesExecutiveId:e,salesExecutiveName:t?.name||"Unknown",totalSales:o,totalIncentives:i,period:"Last 6 months",breakdown:m}}getSalesExecutives(){return this.salesExecutivesSubject.value}getIncentiveRules(){return this.incentiveRulesSubject.value}addIncentiveRule(e){this.incentiveRulesSubject.next([...this.incentiveRulesSubject.value,e])}updateIncentiveRule(e,t){const l=this.incentiveRulesSubject.value.map(o=>o.id===e?{...o,...t}:o);this.incentiveRulesSubject.next(l)}deleteIncentiveRule(e){const c=this.incentiveRulesSubject.value.filter(l=>l.id!==e);this.incentiveRulesSubject.next(c)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var E=s(1913);let b=(()=>{class n{constructor(){this.mfeConfigs=[],this.loadedMfesSubject=new g.BehaviorSubject(new Set),this.loadedMfes$=this.loadedMfesSubject.asObservable(),this.loadingMfesSubject=new g.BehaviorSubject(new Set),this.loadingMfes$=this.loadingMfesSubject.asObservable()}setConfigs(e){this.mfeConfigs=e.sort((t,c)=>c.priority-t.priority)}getConfigs(){return this.mfeConfigs}getConfigsForRole(e){return this.mfeConfigs.filter(t=>t.allowedRoles.includes(e))}getConfigByName(e){return this.mfeConfigs.find(t=>t.name===e)}preloadPriorityMfes(e){var t=this;return(0,d.A)(function*(){const o=t.getConfigsForRole(e).filter(i=>i.priority>=5).map(i=>t.loadMfe(i));yield Promise.all(o)})()}loadMfe(e){var t=this;return(0,d.A)(function*(){const c=t.loadingMfesSubject.value,l=t.loadedMfesSubject.value;if(l.has(e.name))console.log(`[MfeLoaderService] MFE ${e.name} already loaded`);else if(c.has(e.name))console.log(`[MfeLoaderService] MFE ${e.name} is already loading`);else try{const o=new Set(c);o.add(e.name),t.loadingMfesSubject.next(o),console.log(`[MfeLoaderService] Loading MFE ${e.name} (priority: ${e.priority})`);const i=yield(0,E.loadRemoteModule)({type:"module",remoteEntry:e.url,exposedModule:e.exposedModule}),m=new Set(l);m.add(e.name),t.loadedMfesSubject.next(m);const a=new Set(t.loadingMfesSubject.value);return a.delete(e.name),t.loadingMfesSubject.next(a),console.log(`[MfeLoaderService] Successfully loaded MFE ${e.name}`),i}catch(o){console.error(`[MfeLoaderService] Error loading MFE ${e.name}:`,o);const i=new Set(t.loadingMfesSubject.value);throw i.delete(e.name),t.loadingMfesSubject.next(i),o}})()}isMfeLoaded(e){return this.loadedMfesSubject.value.has(e)}isMfeLoading(e){return this.loadingMfesSubject.value.has(e)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function w(n,O){1&n&&(r.\u0275\u0275elementStart(0,"nav",3)(1,"a",4),r.\u0275\u0275text(2,"Report"),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementStart(3,"a",5),r.\u0275\u0275text(4,"Multi-MFE Demo"),r.\u0275\u0275elementEnd()())}let k=(()=>{class n{constructor(e,t,c,l,o,i,m){this.auth2=e,this.auth=t,this.route=c,this.router=l,this.roleService=o,this.dummyDataService=i,this.mfeLoader=m,this.title="Incentive Management System",this.currentUser=null,this.availableMfes=[],this.salesExecutives=[],this.selectedSalesExecutiveId="",this.canViewOthers=!1,this.user=null,this.mfe1="pokemon",this.isAuthenticated=!1,this.userInfo=null,this.message="Processing authentication...",this.isProcessing=!0,this.mfeLoader.setConfigs(I.R)}ngOnInit(){var e=this;return(0,d.A)(function*(){e.roleService.currentUser$.subscribe(i=>{e.currentUser=i,i&&(e.selectedSalesExecutiveId=i.id,e.canViewOthers=e.roleService.canViewOthersData(),e.updateAvailableMfes(),e.loadSalesExecutives(),e.preloadMfes())});let t=null,c=null,l=null;const o=yield(0,g.firstValueFrom)(e.route.queryParams);if(o&&Object.keys(o).length>0)t=o.code??null,c=o.state??null,l=o.error??null;else{const i=new URLSearchParams(window.location.search);t=i.get("code"),c=i.get("state"),l=i.get("error")}})()}updateAvailableMfes(){this.availableMfes=this.currentUser?this.mfeLoader.getConfigsForRole(this.currentUser.role):[]}loadSalesExecutives(){this.canViewOthers&&(this.salesExecutives=this.dummyDataService.getSalesExecutives())}preloadMfes(){var e=this;return(0,d.A)(function*(){if(e.currentUser)try{yield e.mfeLoader.preloadPriorityMfes(e.currentUser.role)}catch(t){console.error("[AppComponent] Error preloading MFEs:",t)}})()}onSalesExecutiveChange(){sessionStorage.setItem("selected_sales_executive_id",this.selectedSalesExecutiveId),window.dispatchEvent(new CustomEvent("salesExecutiveChanged",{detail:{salesExecutiveId:this.selectedSalesExecutiveId}}))}login(){this.auth.login()}logout(){this.auth.logout(),this.roleService.setCurrentUser(null)}fetchUser(){}static{this.\u0275fac=function(t){return new(t||n)(r.\u0275\u0275directiveInject(A),r.\u0275\u0275directiveInject(y.AuthService),r.\u0275\u0275directiveInject(v.ActivatedRoute),r.\u0275\u0275directiveInject(v.Router),r.\u0275\u0275directiveInject(S),r.\u0275\u0275directiveInject(f),r.\u0275\u0275directiveInject(b))}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:n,selectors:[["app-root"]],standalone:!0,features:[r.\u0275\u0275StandaloneFeature],decls:4,vars:1,consts:[[1,"app-container"],["class","app-nav",4,"ngIf"],[1,"app-content"],[1,"app-nav"],["routerLink","/report","routerLinkActive","active",1,"nav-link"],["routerLink","/multi-mfe-demo","routerLinkActive","active",1,"nav-link"]],template:function(t,c){1&t&&(r.\u0275\u0275elementStart(0,"div",0),r.\u0275\u0275template(1,w,5,0,"nav",1),r.\u0275\u0275elementStart(2,"main",2),r.\u0275\u0275element(3,"router-outlet"),r.\u0275\u0275elementEnd()()),2&t&&(r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",c.currentUser))},dependencies:[v.RouterOutlet,R.CommonModule,R.NgIf,v.RouterLink,v.RouterLinkActive,j.FormsModule],styles:['[_nghost-%COMP%]{--bright-blue: oklch(51.01% .274 263.83);--electric-violet: oklch(53.18% .28 296.97);--french-violet: oklch(47.66% .246 305.88);--vivid-pink: oklch(69.02% .277 332.77);--hot-red: oklch(61.42% .238 15.34);--orange-red: oklch(63.32% .24 31.68);--gray-900: oklch(19.37% .006 300.98);--gray-700: oklch(36.98% .014 302.71);--gray-400: oklch(70.9% .015 304.04);--red-to-pink-to-purple-vertical-gradient: linear-gradient( 180deg, var(--orange-red) 0%, var(--vivid-pink) 50%, var(--electric-violet) 100% );--red-to-pink-to-purple-horizontal-gradient: linear-gradient( 90deg, var(--orange-red) 0%, var(--vivid-pink) 50%, var(--electric-violet) 100% );--pill-accent: var(--bright-blue);font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol;box-sizing:border-box;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.app-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100vh}.app-header[_ngcontent-%COMP%]{background:#fff;padding:1rem 2rem;border-bottom:2px solid var(--gray-400);display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 8px #0000001a}.header-left[_ngcontent-%COMP%]{flex:1}.app-title[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;color:var(--gray-900);font-weight:600}.header-center[_ngcontent-%COMP%]{flex:2;display:flex;justify-content:center}.user-selector[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.user-selector[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;color:var(--gray-700);font-weight:500}.user-selector[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:.5rem 1rem;border:1px solid var(--gray-400);border-radius:.375rem;font-size:.875rem;background:#fff;cursor:pointer;min-width:200px}.header-right[_ngcontent-%COMP%]{flex:1;display:flex;justify-content:flex-end;align-items:center;gap:1rem}.user-info[_ngcontent-%COMP%]{color:var(--gray-700);font-size:.875rem;font-weight:500}.btn-logout[_ngcontent-%COMP%]{background:var(--hot-red);color:#fff;border:none;padding:.5rem 1.5rem;border-radius:.375rem;font-size:.875rem;font-weight:500;cursor:pointer;transition:background .2s ease}.btn-logout[_ngcontent-%COMP%]:hover{background:var(--orange-red)}.app-nav[_ngcontent-%COMP%]{background:var(--gray-900);padding:0;display:flex;gap:0}.nav-link[_ngcontent-%COMP%]{color:#fff;text-decoration:none;padding:1rem 1.5rem;font-size:.875rem;font-weight:500;transition:background .2s ease;border-bottom:3px solid transparent}.nav-link[_ngcontent-%COMP%]:hover{background:var(--gray-700)}.nav-link.active[_ngcontent-%COMP%]{background:var(--bright-blue);border-bottom-color:var(--electric-violet)}.app-content[_ngcontent-%COMP%]{flex:1;padding:2rem;background:#f5f5f5}.auth-header[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;background:#fff;padding:1rem 2rem;border-bottom:1px solid var(--gray-400);display:flex;justify-content:space-between;align-items:center;z-index:1000;box-shadow:0 2px 4px #0000001a}.auth-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.user-name[_ngcontent-%COMP%]{color:var(--gray-900);font-weight:500}.auth-button[_ngcontent-%COMP%]{background:var(--bright-blue);color:#fff;border:none;padding:.5rem 1.5rem;border-radius:.5rem;font-size:.875rem;font-weight:500;cursor:pointer;transition:background .3s ease}.auth-button[_ngcontent-%COMP%]:hover{background:var(--electric-violet)}.logout-button[_ngcontent-%COMP%]{background:var(--hot-red)}.logout-button[_ngcontent-%COMP%]:hover{background:var(--orange-red)}']})}}return n})();function U(n){return()=>{const O=(0,r.inject)(S),e=(0,r.inject)(v.Router),t=O.getCurrentUser();return t?!!n.includes(t.role)||(console.warn(`[RoleGuard] User role ${t.role} not allowed, redirecting to home`),e.navigate(["/"]),!1):(console.warn("[RoleGuard] No user found, redirecting to home"),e.navigate(["/"]),!1)}}U([h.g.SUPER_ADMIN,h.g.ORG_ADMIN,h.g.TEAM_LEAD]),U([h.g.SUPER_ADMIN,h.g.ORG_ADMIN]);const L=U([h.g.SUPER_ADMIN,h.g.ORG_ADMIN,h.g.TEAM_LEAD,h.g.SALES_EXECUTIVE]);var F=s(1633);const T=[{path:"report",component:(()=>{class n{constructor(){this.mfe1="myReport"}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:n,selectors:[["report-component"]],standalone:!0,features:[r.\u0275\u0275StandaloneFeature],decls:6,vars:1,consts:[[1,"demo-container"],[3,"name"]],template:function(t,c){1&t&&(r.\u0275\u0275elementStart(0,"div",0)(1,"h2"),r.\u0275\u0275text(2,"Multiple MFE Demo"),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementStart(3,"p"),r.\u0275\u0275text(4,"This page demonstrates loading multiple MFEs with lazy loading enabled."),r.\u0275\u0275elementEnd(),r.\u0275\u0275element(5,"app-mfe-wrapper",1),r.\u0275\u0275elementEnd()),2&t&&(r.\u0275\u0275advance(5),r.\u0275\u0275property("name",c.mfe1))},dependencies:[F.n],styles:[".demo-container[_ngcontent-%COMP%]{padding:2rem}.demo-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:.5rem;color:#333}.demo-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:2rem;color:#666}"]})}}return n})()},{path:"sales",loadChildren:()=>s.e(654).then(s.bind(s,2654)).then(n=>n.MY_SALES_ROUTES),canActivate:[L]},{path:"reports",loadChildren:()=>s.e(654).then(s.bind(s,2654)).then(n=>n.MY_REPORT_ROUTES),canActivate:[L]},{path:"**",redirectTo:"",pathMatch:"full"}],B=(n,O)=>new g.Observable(e=>{let t;return(0,d.A)(function*(){const{urlWithParams:l}=n,i=yield caches.open("http"),m=yield i.match(l);if(m){let a;console.log("Serve from Cache for",l);try{a=yield m.clone().json()}catch{a=yield m.clone().text()}return e.next(new M.HttpResponse({body:a,status:m.status||200,url:n.urlWithParams})),void e.complete()}var a;t=O(n).subscribe({next:(a=(0,d.A)(function*(u){if(console.log("Cache miss for ",l),e.next(u),u instanceof M.HttpResponse&&u.ok){const C=new Response(JSON.stringify(u.body),{headers:{"Content-Type":"application/json"},status:u.status,statusText:u.statusText});yield i.put(n.urlWithParams,C)}}),function(C){return a.apply(this,arguments)}),error:a=>e.error(a),complete:()=>e.complete()})})(),()=>t?.unsubscribe()});function $(){return(0,P.bootstrapApplication)(k,{providers:[(0,v.provideRouter)(T),(0,M.provideHttpClient)((0,M.withFetch)(),(0,M.withInterceptors)([B]))]})}}}]);