(self.webpackChunkshell=self.webpackChunkshell||[]).push([[730],{5730:(B,I,d)=>{d.r(I),d.d(I,{API_CONFIG:()=>h,AUTH0_CONFIG:()=>_,DummyDataService:()=>C,MfeLoaderService:()=>j,ProductCategory:()=>p,RoleService:()=>b,STORAGE_CONFIG:()=>G,STORAGE_KEYS:()=>$,SalesStatus:()=>E,UserProfileService:()=>x,UserRole:()=>s,authInterceptor:()=>P,getStorage:()=>R,getStorageItem:()=>k,hasRequiredRole:()=>y,removeStorageItem:()=>H,setStorageItem:()=>V});var g=d(4412),s=function(o){return o.SUPER_ADMIN="super-admin",o.ORG_ADMIN="org-admin",o.TEAM_LEAD="team-lead",o.SALES_EXECUTIVE="sales-executive",o}(s||{});function y(o,c){const e={[s.SUPER_ADMIN]:4,[s.ORG_ADMIN]:3,[s.TEAM_LEAD]:2,[s.SALES_EXECUTIVE]:1};return e[o]>=e[c]}var f=d(4438);let b=(()=>{class o{constructor(){this.currentUserSubject=new g.t(null),this.currentUser$=this.currentUserSubject.asObservable(),console.log("[RoleService] Service initialized"),this.loadInitialUser()}setUserFromProfile(e){console.log("[RoleService] Setting user from API profile:",e);const t=this.mapApiRoleToUserRole(e.roles),r={id:e.userId,name:e.name||e.email||"User",email:e.email||"",role:t};console.log("[RoleService] Mapped user with role from API:",r),this.setCurrentUser(r)}mapApiRoleToUserRole(e){return e&&0!==e.length?this.mapStringToUserRole(e[0].name):(console.warn("[RoleService] No roles found in API response, defaulting to SALES_EXECUTIVE"),s.SALES_EXECUTIVE)}setUserFromAuth(e){console.log("[RoleService] Setting user from Auth0 auth:",e);const t=this.mapUserInfoToUser(e);console.log("[RoleService] Mapped user with role:",t),this.setCurrentUser(t)}mapUserInfoToUser(e){const t=this.extractRoleFromToken(e);return{id:e.sub,name:e.name||e.email||"User",email:e.email||"",role:t}}extractRoleFromToken(e){if(e.role)return this.mapStringToUserRole(e.role);if(e.org_and_roles){const a=this.extractRoleFromOrgAndRoles(e.org_and_roles);if(a)return console.log("[RoleService] Extracted role from org_and_roles:",a),a}const r=Object.keys(e).filter(a=>a.startsWith("http://")||a.startsWith("https://")).find(a=>a.toLowerCase().includes("role"));if(r&&e[r]){const a=e[r],n=Array.isArray(a)?a[0]:a;return this.mapStringToUserRole(n)}return console.warn("[RoleService] No role found in token, falling back to email pattern"),this.determineRoleFromEmail(e.email||"")}extractRoleFromOrgAndRoles(e){if(!e||"object"!=typeof e)return null;const t=[];for(const a in e){const n=e[a];Array.isArray(n)&&n.forEach(i=>{const u=this.mapStringToUserRole(i);t.push(u)})}if(0===t.length)return null;const r=[s.SUPER_ADMIN,s.ORG_ADMIN,s.TEAM_LEAD,s.SALES_EXECUTIVE];for(const a of r)if(t.includes(a))return console.log("[RoleService] Selected highest privilege role:",a),a;return t[0]}mapStringToUserRole(e){const t=e.toLowerCase().replace(/[-_\s]/g,"");return{superadmin:s.SUPER_ADMIN,super:s.SUPER_ADMIN,admin:s.SUPER_ADMIN,orgadmin:s.ORG_ADMIN,organizationadmin:s.ORG_ADMIN,manager:s.ORG_ADMIN,teamlead:s.TEAM_LEAD,lead:s.TEAM_LEAD,salesexecutive:s.SALES_EXECUTIVE,sales:s.SALES_EXECUTIVE,executive:s.SALES_EXECUTIVE}[t]||s.SALES_EXECUTIVE}determineRoleFromEmail(e){const t=e.toLowerCase();return[{patterns:["admin","super"],role:s.SUPER_ADMIN},{patterns:["manager","org"],role:s.ORG_ADMIN},{patterns:["lead","team"],role:s.TEAM_LEAD}].find(({patterns:n})=>n.some(i=>t.includes(i)))?.role??s.SALES_EXECUTIVE}loadInitialUser(){const e=this.getDevMimicUser();if(e)return console.log("[RoleService] Using dev mimic user:",e),void this.currentUserSubject.next(e)}getDevMimicUser(){try{const e=localStorage.getItem("dev_mimic_user");if(e){const t=JSON.parse(e);if(t.id&&t.name&&t.role)return t}}catch(e){console.error("[RoleService] Error parsing dev mimic user:",e)}return null}setDevMimicUser(e){e?(localStorage.setItem("dev_mimic_user",JSON.stringify(e)),this.currentUserSubject.next(e),console.log("[RoleService] Dev mimic user set:",e)):(localStorage.removeItem("dev_mimic_user"),this.loadDummyUser(),console.log("[RoleService] Dev mimic user cleared"))}loadDummyUser(){console.log("[RoleService] Loading user from session storage");const e=sessionStorage.getItem("current_user");if(e){const t=JSON.parse(e);console.log("[RoleService] User loaded from session:",t),this.currentUserSubject.next(t)}else{const t={id:"user-1",name:"John Admin",email:"john.admin@company.com",role:s.ORG_ADMIN};console.log("[RoleService] No saved user found, using default:",t),this.setCurrentUser(t)}}setCurrentUser(e){console.log("[RoleService] Setting current user:",e),this.currentUserSubject.next(e),e?(sessionStorage.setItem("current_user",JSON.stringify(e)),console.log("[RoleService] User saved to session storage")):(sessionStorage.removeItem("current_user"),console.log("[RoleService] User removed from session storage"))}getCurrentUser(){const e=this.currentUserSubject.value;return console.log("[RoleService] getCurrentUser() called, returning:",e),e}getCurrentUserRole(){const e=this.currentUserSubject.value?.role||null;return console.log("[RoleService] getCurrentUserRole() called, returning:",e),e}hasRole(e){const t=this.getCurrentUserRole();if(!t)return console.log("[RoleService] hasRole() - No current role, access denied"),!1;const r=y(t,e);return console.log(`[RoleService] hasRole() - Checking if ${t} has ${e}:`,r),r}canViewOthersData(){const e=this.getCurrentUserRole(),t=e===s.SUPER_ADMIN||e===s.ORG_ADMIN||e===s.TEAM_LEAD;return console.log(`[RoleService] canViewOthersData() - Role: ${e}, Can view:`,t),t}getViewableUsers(){const e=this.getCurrentUser();if(!e)return[];const t=this.getAllUsers();return this.isTeamLeadOrHigher()?t.filter(r=>r.role===s.SALES_EXECUTIVE||r.id===e.id):t.filter(r=>r.id===e.id)}hasAnyRole(e){const t=this.getCurrentUser();return!!t&&e.includes(t.role)}isAdmin(){return this.hasAnyRole([s.SUPER_ADMIN,s.ORG_ADMIN])}isTeamLeadOrHigher(){return this.hasAnyRole([s.SUPER_ADMIN,s.ORG_ADMIN,s.TEAM_LEAD])}getAllUsers(){return[{id:"user-1",name:"John Admin",email:"john.admin@company.com",role:s.SUPER_ADMIN},{id:"user-2",name:"Sarah Manager",email:"sarah.manager@company.com",role:s.ORG_ADMIN},{id:"user-3",name:"Mike Lead",email:"mike.lead@company.com",role:s.TEAM_LEAD,teamId:"team-1"},{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",role:s.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-5",name:"Bob Sales",email:"bob.sales@company.com",role:s.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-6",name:"Carol Sales",email:"carol.sales@company.com",role:s.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"}]}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=f.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var E=function(o){return o.COMPLETED="completed",o.PENDING="pending",o.CANCELLED="cancelled",o}(E||{}),p=function(o){return o.ELECTRONICS="Electronics",o.SOFTWARE="Software",o.SERVICES="Services",o.HARDWARE="Hardware",o}(p||{});let C=(()=>{class o{constructor(){this.salesExecutivesSubject=new g.t(this.generateSalesExecutives()),this.salesExecutives$=this.salesExecutivesSubject.asObservable(),this.salesRecordsSubject=new g.t(this.generateSalesRecords()),this.salesRecords$=this.salesRecordsSubject.asObservable(),this.incentiveRulesSubject=new g.t(this.generateIncentiveRules()),this.incentiveRules$=this.incentiveRulesSubject.asObservable(),this.incentivesEarnedSubject=new g.t(this.generateIncentivesEarned()),this.incentivesEarned$=this.incentivesEarnedSubject.asObservable(),console.log("[DummyDataService] Service initialized"),console.log("[DummyDataService] Generated data:",{salesExecutives:this.salesExecutivesSubject.value.length,salesRecords:this.salesRecordsSubject.value.length,incentiveRules:this.incentiveRulesSubject.value.length,incentivesEarned:this.incentivesEarnedSubject.value.length})}generateSalesExecutives(){return console.log("[DummyDataService] Generating sales executives"),[{id:"user-1",name:"John Admin",email:"john.admin@company.com",teamId:"team-1"},{id:"user-2",name:"Sarah Manager",email:"sarah.manager@company.com",teamId:"team-1"},{id:"user-3",name:"Mike Lead",email:"mike.lead@company.com",teamId:"team-1"},{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",teamId:"team-1"},{id:"user-5",name:"Bob Sales",email:"bob.sales@company.com",teamId:"team-1"},{id:"user-6",name:"Carol Sales",email:"carol.sales@company.com",teamId:"team-1"}]}generateSalesRecords(){console.log("[DummyDataService] Generating sales records");const e=[],t=this.generateSalesExecutives(),r=["Product A","Product B","Product C","Product D"],a=[E.COMPLETED,E.PENDING,E.CANCELLED];for(let n=0;n<50;n++){const i=t[n%t.length],u=Math.floor(n/10),m=new Date;m.setMonth(m.getMonth()-u),e.push({id:`sale-${n+1}`,salesExecutiveId:i.id,salesExecutiveName:i.name,date:m,productName:r[n%r.length],productCategory:p.SOFTWARE,amount:Math.floor(5e4*Math.random())+1e4,commission:Math.floor(5e3*Math.random()),quantity:Math.floor(10*Math.random())+1,status:a[n%a.length],clientName:`Client ${n+1}`,region:["North","South","East","West"][n%4]})}return e}generateIncentiveRules(){return console.log("[DummyDataService] Generating incentive rules"),[{id:"rule-1",name:"Basic Sales Incentive",description:"5% incentive on all sales",type:"percentage",value:5,isActive:!0,createdBy:"admin",createdAt:new Date("2024-01-01")},{id:"rule-2",name:"High Value Sales Bonus",description:"10% incentive on sales above $50,000",type:"percentage",value:10,minSalesAmount:5e4,isActive:!0,createdBy:"admin",createdAt:new Date("2024-02-01")},{id:"rule-3",name:"Product A Special",description:"Fixed $500 bonus for Product A sales",type:"fixed",value:500,productCategory:"Product A",isActive:!0,createdBy:"team-lead-1",createdAt:new Date("2024-03-01")},{id:"rule-4",name:"Tiered Volume Incentive",description:"15% incentive on sales above $100,000",type:"tiered",value:15,minSalesAmount:1e5,isActive:!1,createdBy:"admin",createdAt:new Date("2024-04-01")}]}generateIncentivesEarned(){console.log("[DummyDataService] Generating incentives earned");const e=[],t=this.generateSalesExecutives(),r=this.generateIncentiveRules(),a=["pending","approved","paid"];for(let n=0;n<30;n++){const i=t[n%t.length],u=r[n%r.length],m=Math.floor(n/10),l=new Date;l.setMonth(l.getMonth()-m),e.push({id:`incentive-${n+1}`,salesExecutiveId:i.id,salesExecutiveName:i.name,ruleId:u.id,ruleName:u.name,salesRecordId:`sale-${n+1}`,amount:Math.floor(5e3*Math.random())+500,earnedDate:l,status:a[n%3]})}return e}getSalesRecordsForExecutive(e){console.log("[DummyDataService] getSalesRecordsForExecutive() called for:",e);const t=this.salesRecordsSubject.value.filter(r=>r.salesExecutiveId===e);return console.log("[DummyDataService] Found",t.length,"sales records for executive:",e),t}getIncentivesForExecutive(e){console.log("[DummyDataService] getIncentivesForExecutive() called for:",e);const t=this.incentivesEarnedSubject.value.filter(r=>r.salesExecutiveId===e);return console.log("[DummyDataService] Found",t.length,"incentives for executive:",e),t}getReportDataForExecutive(e){console.log("[DummyDataService] getReportDataForExecutive() called for:",e);const t=this.salesExecutivesSubject.value.find(l=>l.id===e),r=this.getSalesRecordsForExecutive(e),a=this.getIncentivesForExecutive(e),n=r.filter(l=>"completed"===l.status).reduce((l,v)=>l+v.amount,0),i=a.filter(l=>"pending"!==l.status).reduce((l,v)=>l+v.amount,0),u=[];for(let l=5;l>=0;l--){const v=new Date;v.setMonth(v.getMonth()-l);const M=v.toISOString().substring(0,7),X=r.filter(S=>S.date.toISOString().substring(0,7)===M&&"completed"===S.status).reduce((S,A)=>S+A.amount,0),z=a.filter(S=>S.earnedDate.toISOString().substring(0,7)===M&&"pending"!==S.status).reduce((S,A)=>S+A.amount,0);u.push({month:M,sales:X,incentives:z})}const m={salesExecutiveId:e,salesExecutiveName:t?.name||"Unknown",totalSales:n,totalIncentives:i,period:"Last 6 months",breakdown:u};return console.log("[DummyDataService] Report data generated:",m),m}getSalesExecutives(){const e=this.salesExecutivesSubject.value;return console.log("[DummyDataService] getSalesExecutives() called, returning",e.length,"executives"),e}getIncentiveRules(){const e=this.incentiveRulesSubject.value;return console.log("[DummyDataService] getIncentiveRules() called, returning",e.length,"rules"),e}addIncentiveRule(e){console.log("[DummyDataService] addIncentiveRule() called with:",e),this.incentiveRulesSubject.next([...this.incentiveRulesSubject.value,e]),console.log("[DummyDataService] Rule added successfully, total rules:",this.incentiveRulesSubject.value.length)}updateIncentiveRule(e,t){console.log("[DummyDataService] updateIncentiveRule() called for rule:",e,"with updates:",t);const a=this.incentiveRulesSubject.value.map(n=>n.id===e?{...n,...t}:n);this.incentiveRulesSubject.next(a),console.log("[DummyDataService] Rule updated successfully")}deleteIncentiveRule(e){console.log("[DummyDataService] deleteIncentiveRule() called for rule:",e);const r=this.incentiveRulesSubject.value.filter(a=>a.id!==e);this.incentiveRulesSubject.next(r),console.log("[DummyDataService] Rule deleted successfully, remaining rules:",this.incentiveRulesSubject.value.length)}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=f.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var D=d(467),L=d(1913);let j=(()=>{class o{constructor(){this.mfeConfigs=[],this.loadedMfesSubject=new g.t(new Set),this.loadedMfes$=this.loadedMfesSubject.asObservable(),this.loadingMfesSubject=new g.t(new Set),this.loadingMfes$=this.loadingMfesSubject.asObservable(),console.log("[MfeLoaderService] Service initialized")}setConfigs(e){console.log("[MfeLoaderService] setConfigs() called with",e.length,"configurations"),this.mfeConfigs=e.sort((t,r)=>r.priority-t.priority),console.log("[MfeLoaderService] Configurations sorted by priority:",this.mfeConfigs.map(t=>({name:t.name,priority:t.priority})))}getConfigs(){return console.log("[MfeLoaderService] getConfigs() called, returning",this.mfeConfigs.length,"configurations"),this.mfeConfigs}getConfigsForRole(e){console.log("[MfeLoaderService] getConfigsForRole() called for role:",e);const t=this.mfeConfigs.filter(r=>r.allowedRoles.includes(e));return console.log("[MfeLoaderService] Found",t.length,"configurations for role:",e,t.map(r=>r.name)),t}getConfigByName(e){console.log("[MfeLoaderService] getConfigByName() called for:",e);const t=this.mfeConfigs.find(r=>r.name===e);return t?console.log("[MfeLoaderService] Found configuration for:",e):console.warn("[MfeLoaderService] Configuration not found for:",e),t}preloadPriorityMfes(e){var t=this;return(0,D.A)(function*(){console.log("[MfeLoaderService] preloadPriorityMfes() called for role:",e);const a=t.getConfigsForRole(e).filter(i=>i.priority>=5);console.log("[MfeLoaderService] Preloading",a.length,"priority MFEs:",a.map(i=>({name:i.name,priority:i.priority})));const n=a.map(i=>t.loadMfe(i));yield Promise.all(n),console.log("[MfeLoaderService] Preloading complete")})()}loadMfe(e){var t=this;return(0,D.A)(function*(){const r=t.loadingMfesSubject.value,a=t.loadedMfesSubject.value;if(a.has(e.name))console.log(`[MfeLoaderService] MFE ${e.name} already loaded`);else if(r.has(e.name))console.log(`[MfeLoaderService] MFE ${e.name} is already loading`);else try{const n=new Set(r);n.add(e.name),t.loadingMfesSubject.next(n),console.log(`[MfeLoaderService] Loading MFE ${e.name} (priority: ${e.priority})`),console.log("[MfeLoaderService] MFE config:",{name:e.name,url:e.url,exposedModule:e.exposedModule,remoteName:e.remoteName});const i=yield(0,L.loadRemoteModule)({type:"module",remoteEntry:e.url,exposedModule:e.exposedModule}),u=new Set(a);u.add(e.name),t.loadedMfesSubject.next(u);const m=new Set(t.loadingMfesSubject.value);return m.delete(e.name),t.loadingMfesSubject.next(m),console.log(`[MfeLoaderService] Successfully loaded MFE ${e.name}`),console.log("[MfeLoaderService] Currently loaded MFEs:",Array.from(t.loadedMfesSubject.value)),i}catch(n){console.error(`[MfeLoaderService] Error loading MFE ${e.name}:`,n),console.error("[MfeLoaderService] Failed config:",{name:e.name,url:e.url,exposedModule:e.exposedModule});const i=new Set(t.loadingMfesSubject.value);throw i.delete(e.name),t.loadingMfesSubject.next(i),n}})()}isMfeLoaded(e){const t=this.loadedMfesSubject.value.has(e);return console.log(`[MfeLoaderService] isMfeLoaded(${e}):`,t),t}isMfeLoading(e){const t=this.loadingMfesSubject.value.has(e);return console.log(`[MfeLoaderService] isMfeLoading(${e}):`,t),t}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=f.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var U=d(7673),N=d(6354),O=d(9437);const h={baseUrl:"https://tmzuktmjy7.execute-api.us-east-1.amazonaws.com"};var T=d(1626);let x=(()=>{class o{constructor(e){this.http=e,this.profileSubject=new g.t(null),this.profile$=this.profileSubject.asObservable(),console.log("[UserProfileService] Service initialized")}fetchUserProfile(){return console.log("[UserProfileService] Fetching user profile from API"),h&&h.baseUrl?this.http.get(`${h.baseUrl}/auth/me`).pipe((0,N.T)(e=>e.success&&e.data?(console.log("[UserProfileService] Profile loaded successfully"),this.profileSubject.next(e.data),e.data):null),(0,O.W)(e=>(console.error("[UserProfileService] Error fetching profile:",e),this.profileSubject.next(null),(0,U.of)(null)))):(console.error("[UserProfileService] API_CONFIG or baseUrl is not defined"),(0,U.of)(null))}getCurrentProfile(){return this.profileSubject.value}getPrimaryOrganization(){return this.profileSubject.value?.organizations?.[0]||null}getPrimaryRole(){return this.profileSubject.value?.roles?.[0]||null}getRoleName(){return this.getPrimaryRole()?.name||null}getOrganizationDisplayName(){return this.getPrimaryOrganization()?.displayName||null}clearProfile(){this.profileSubject.next(null)}static{this.\u0275fac=function(t){return new(t||o)(f.KVO(T.Qq))}}static{this.\u0275prov=f.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var F=d(7544);const P=(o,c)=>{const t=(0,f.WQX)(F.AuthService).getTokenSync();return!t||w(o.url)?c(o):c(o.clone({setHeaders:{Authorization:`Bearer ${t}`}}))},w=o=>{try{if(h&&"object"==typeof h&&h.baseUrl&&o.startsWith(h.baseUrl))return!1}catch(e){console.warn("[authInterceptor] API_CONFIG not available, using pattern-based auth endpoint detection",e)}return["/oauth","auth0.com","/authorize","/token"].some(e=>o.includes(e))},_={domain:"dev-26sow24tone5na8a.us.auth0.com",clientId:"EdkPy5co65jESIAT8T9SBy5X4cmeolhl",redirectUri:"https://opensourcekd.github.io/i17e/auth-callback",logoutUri:"https://opensourcekd.github.io/i17e",scope:"openid profile email",audience:"https://something"},G={TOKEN_STORAGE:"sessionStorage",USER_INFO_STORAGE:"sessionStorage",AUTH_STATE_STORAGE:"sessionStorage",PREFERENCES_STORAGE:"localStorage"},$={ACCESS_TOKEN:"auth0_access_token",ID_TOKEN:"auth0_id_token",REFRESH_TOKEN:"auth0_refresh_token",USER_INFO:"auth0_user_info",OAUTH_STATE:"oauth_state",CODE_VERIFIER:"code_verifier",CURRENT_USER:"current_user",DEV_MIMIC_USER:"dev_mimic_user"};function R(o){return"sessionStorage"===o?sessionStorage:localStorage}function V(o,c,e="sessionStorage"){R(e).setItem(o,c)}function k(o,c="sessionStorage"){return R(c).getItem(o)}function H(o,c="sessionStorage"){R(c).removeItem(o)}}}]);