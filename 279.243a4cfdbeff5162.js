(self.webpackChunkshell=self.webpackChunkshell||[]).push([[279],{9279:(w,A,m)=>{m.r(A),m.d(A,{DummyDataService:()=>U,MfeLoaderService:()=>j,ProductCategory:()=>p,RoleService:()=>I,SalesStatus:()=>E,UserProfileService:()=>P,UserRole:()=>s,authInterceptor:()=>N,hasRequiredRole:()=>y});var d=m(5883),s=function(r){return r.SUPER_ADMIN="super-admin",r.ORG_ADMIN="org-admin",r.TEAM_LEAD="team-lead",r.SALES_EXECUTIVE="sales-executive",r}(s||{});function y(r,f){const e={[s.SUPER_ADMIN]:4,[s.ORG_ADMIN]:3,[s.TEAM_LEAD]:2,[s.SALES_EXECUTIVE]:1};return e[r]>=e[f]}var h=m(4304);let I=(()=>{class r{constructor(){this.currentUserSubject=new d.BehaviorSubject(null),this.currentUser$=this.currentUserSubject.asObservable(),console.log("[RoleService] Service initialized"),this.loadInitialUser()}setUserFromProfile(e){console.log("[RoleService] Setting user from API profile:",e);const t=this.mapApiRoleToUserRole(e.roles),o={id:e.userId,name:e.name||e.email||"User",email:e.email||"",role:t};console.log("[RoleService] Mapped user with role from API:",o),this.setCurrentUser(o)}mapApiRoleToUserRole(e){return e&&0!==e.length?this.mapStringToUserRole(e[0].name):(console.warn("[RoleService] No roles found in API response, defaulting to SALES_EXECUTIVE"),s.SALES_EXECUTIVE)}setUserFromAuth(e){console.log("[RoleService] Setting user from Auth0 auth:",e);const t=this.mapUserInfoToUser(e);console.log("[RoleService] Mapped user with role:",t),this.setCurrentUser(t)}mapUserInfoToUser(e){const t=this.extractRoleFromToken(e);return{id:e.sub,name:e.name||e.email||"User",email:e.email||"",role:t}}extractRoleFromToken(e){if(e.role)return this.mapStringToUserRole(e.role);if(e.org_and_roles){const i=this.extractRoleFromOrgAndRoles(e.org_and_roles);if(i)return console.log("[RoleService] Extracted role from org_and_roles:",i),i}const o=Object.keys(e).filter(i=>i.startsWith("http://")||i.startsWith("https://")).find(i=>i.toLowerCase().includes("role"));if(o&&e[o]){const i=e[o],n=Array.isArray(i)?i[0]:i;return this.mapStringToUserRole(n)}return console.warn("[RoleService] No role found in token, falling back to email pattern"),this.determineRoleFromEmail(e.email||"")}extractRoleFromOrgAndRoles(e){if(!e||"object"!=typeof e)return null;const t=[];for(const i in e){const n=e[i];Array.isArray(n)&&n.forEach(a=>{const c=this.mapStringToUserRole(a);t.push(c)})}if(0===t.length)return null;const o=[s.SUPER_ADMIN,s.ORG_ADMIN,s.TEAM_LEAD,s.SALES_EXECUTIVE];for(const i of o)if(t.includes(i))return console.log("[RoleService] Selected highest privilege role:",i),i;return t[0]}mapStringToUserRole(e){const t=e.toLowerCase().replace(/[-_\s]/g,"");return{superadmin:s.SUPER_ADMIN,super:s.SUPER_ADMIN,admin:s.SUPER_ADMIN,orgadmin:s.ORG_ADMIN,organizationadmin:s.ORG_ADMIN,manager:s.ORG_ADMIN,teamlead:s.TEAM_LEAD,lead:s.TEAM_LEAD,salesexecutive:s.SALES_EXECUTIVE,sales:s.SALES_EXECUTIVE,executive:s.SALES_EXECUTIVE}[t]||s.SALES_EXECUTIVE}determineRoleFromEmail(e){const t=e.toLowerCase();return[{patterns:["admin","super"],role:s.SUPER_ADMIN},{patterns:["manager","org"],role:s.ORG_ADMIN},{patterns:["lead","team"],role:s.TEAM_LEAD}].find(({patterns:n})=>n.some(a=>t.includes(a)))?.role??s.SALES_EXECUTIVE}loadInitialUser(){const e=this.getDevMimicUser();if(e)return console.log("[RoleService] Using dev mimic user:",e),void this.currentUserSubject.next(e)}getDevMimicUser(){try{const e=localStorage.getItem("dev_mimic_user");if(e){const t=JSON.parse(e);if(t.id&&t.name&&t.role)return t}}catch(e){console.error("[RoleService] Error parsing dev mimic user:",e)}return null}setDevMimicUser(e){e?(localStorage.setItem("dev_mimic_user",JSON.stringify(e)),this.currentUserSubject.next(e),console.log("[RoleService] Dev mimic user set:",e)):(localStorage.removeItem("dev_mimic_user"),this.loadDummyUser(),console.log("[RoleService] Dev mimic user cleared"))}loadDummyUser(){console.log("[RoleService] Loading user from session storage");const e=sessionStorage.getItem("current_user");if(e){const t=JSON.parse(e);console.log("[RoleService] User loaded from session:",t),this.currentUserSubject.next(t)}else{const t={id:"user-1",name:"John Admin",email:"john.admin@company.com",role:s.ORG_ADMIN};console.log("[RoleService] No saved user found, using default:",t),this.setCurrentUser(t)}}setCurrentUser(e){console.log("[RoleService] Setting current user:",e),this.currentUserSubject.next(e),e?(sessionStorage.setItem("current_user",JSON.stringify(e)),console.log("[RoleService] User saved to session storage")):(sessionStorage.removeItem("current_user"),console.log("[RoleService] User removed from session storage"))}getCurrentUser(){const e=this.currentUserSubject.value;return console.log("[RoleService] getCurrentUser() called, returning:",e),e}getCurrentUserRole(){const e=this.currentUserSubject.value?.role||null;return console.log("[RoleService] getCurrentUserRole() called, returning:",e),e}hasRole(e){const t=this.getCurrentUserRole();if(!t)return console.log("[RoleService] hasRole() - No current role, access denied"),!1;const o=y(t,e);return console.log(`[RoleService] hasRole() - Checking if ${t} has ${e}:`,o),o}canViewOthersData(){const e=this.getCurrentUserRole(),t=e===s.SUPER_ADMIN||e===s.ORG_ADMIN||e===s.TEAM_LEAD;return console.log(`[RoleService] canViewOthersData() - Role: ${e}, Can view:`,t),t}getViewableUsers(){const e=this.getCurrentUser();if(!e)return[];const t=this.getAllUsers();return this.isTeamLeadOrHigher()?t.filter(o=>o.role===s.SALES_EXECUTIVE||o.id===e.id):t.filter(o=>o.id===e.id)}hasAnyRole(e){const t=this.getCurrentUser();return!!t&&e.includes(t.role)}isAdmin(){return this.hasAnyRole([s.SUPER_ADMIN,s.ORG_ADMIN])}isTeamLeadOrHigher(){return this.hasAnyRole([s.SUPER_ADMIN,s.ORG_ADMIN,s.TEAM_LEAD])}getAllUsers(){return[{id:"user-1",name:"John Admin",email:"john.admin@company.com",role:s.SUPER_ADMIN},{id:"user-2",name:"Sarah Manager",email:"sarah.manager@company.com",role:s.ORG_ADMIN},{id:"user-3",name:"Mike Lead",email:"mike.lead@company.com",role:s.TEAM_LEAD,teamId:"team-1"},{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",role:s.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-5",name:"Bob Sales",email:"bob.sales@company.com",role:s.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-6",name:"Carol Sales",email:"carol.sales@company.com",role:s.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"}]}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=h.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var E=function(r){return r.COMPLETED="completed",r.PENDING="pending",r.CANCELLED="cancelled",r}(E||{}),p=function(r){return r.ELECTRONICS="Electronics",r.SOFTWARE="Software",r.SERVICES="Services",r.HARDWARE="Hardware",r}(p||{});let U=(()=>{class r{constructor(){this.salesExecutivesSubject=new d.BehaviorSubject(this.generateSalesExecutives()),this.salesExecutives$=this.salesExecutivesSubject.asObservable(),this.salesRecordsSubject=new d.BehaviorSubject(this.generateSalesRecords()),this.salesRecords$=this.salesRecordsSubject.asObservable(),this.incentiveRulesSubject=new d.BehaviorSubject(this.generateIncentiveRules()),this.incentiveRules$=this.incentiveRulesSubject.asObservable(),this.incentivesEarnedSubject=new d.BehaviorSubject(this.generateIncentivesEarned()),this.incentivesEarned$=this.incentivesEarnedSubject.asObservable(),console.log("[DummyDataService] Service initialized"),console.log("[DummyDataService] Generated data:",{salesExecutives:this.salesExecutivesSubject.value.length,salesRecords:this.salesRecordsSubject.value.length,incentiveRules:this.incentiveRulesSubject.value.length,incentivesEarned:this.incentivesEarnedSubject.value.length})}generateSalesExecutives(){return console.log("[DummyDataService] Generating sales executives"),[{id:"user-1",name:"John Admin",email:"john.admin@company.com",teamId:"team-1"},{id:"user-2",name:"Sarah Manager",email:"sarah.manager@company.com",teamId:"team-1"},{id:"user-3",name:"Mike Lead",email:"mike.lead@company.com",teamId:"team-1"},{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",teamId:"team-1"},{id:"user-5",name:"Bob Sales",email:"bob.sales@company.com",teamId:"team-1"},{id:"user-6",name:"Carol Sales",email:"carol.sales@company.com",teamId:"team-1"}]}generateSalesRecords(){console.log("[DummyDataService] Generating sales records");const e=[],t=this.generateSalesExecutives(),o=["Product A","Product B","Product C","Product D"],i=[E.COMPLETED,E.PENDING,E.CANCELLED];for(let n=0;n<50;n++){const a=t[n%t.length],c=Math.floor(n/10),u=new Date;u.setMonth(u.getMonth()-c),e.push({id:`sale-${n+1}`,salesExecutiveId:a.id,salesExecutiveName:a.name,date:u,productName:o[n%o.length],productCategory:p.SOFTWARE,amount:Math.floor(5e4*Math.random())+1e4,commission:Math.floor(5e3*Math.random()),quantity:Math.floor(10*Math.random())+1,status:i[n%i.length],clientName:`Client ${n+1}`,region:["North","South","East","West"][n%4]})}return e}generateIncentiveRules(){return console.log("[DummyDataService] Generating incentive rules"),[{id:"rule-1",name:"Basic Sales Incentive",description:"5% incentive on all sales",type:"percentage",value:5,isActive:!0,createdBy:"admin",createdAt:new Date("2024-01-01")},{id:"rule-2",name:"High Value Sales Bonus",description:"10% incentive on sales above $50,000",type:"percentage",value:10,minSalesAmount:5e4,isActive:!0,createdBy:"admin",createdAt:new Date("2024-02-01")},{id:"rule-3",name:"Product A Special",description:"Fixed $500 bonus for Product A sales",type:"fixed",value:500,productCategory:"Product A",isActive:!0,createdBy:"team-lead-1",createdAt:new Date("2024-03-01")},{id:"rule-4",name:"Tiered Volume Incentive",description:"15% incentive on sales above $100,000",type:"tiered",value:15,minSalesAmount:1e5,isActive:!1,createdBy:"admin",createdAt:new Date("2024-04-01")}]}generateIncentivesEarned(){console.log("[DummyDataService] Generating incentives earned");const e=[],t=this.generateSalesExecutives(),o=this.generateIncentiveRules(),i=["pending","approved","paid"];for(let n=0;n<30;n++){const a=t[n%t.length],c=o[n%o.length],u=Math.floor(n/10),l=new Date;l.setMonth(l.getMonth()-u),e.push({id:`incentive-${n+1}`,salesExecutiveId:a.id,salesExecutiveName:a.name,ruleId:c.id,ruleName:c.name,salesRecordId:`sale-${n+1}`,amount:Math.floor(5e3*Math.random())+500,earnedDate:l,status:i[n%3]})}return e}getSalesRecordsForExecutive(e){console.log("[DummyDataService] getSalesRecordsForExecutive() called for:",e);const t=this.salesRecordsSubject.value.filter(o=>o.salesExecutiveId===e);return console.log("[DummyDataService] Found",t.length,"sales records for executive:",e),t}getIncentivesForExecutive(e){console.log("[DummyDataService] getIncentivesForExecutive() called for:",e);const t=this.incentivesEarnedSubject.value.filter(o=>o.salesExecutiveId===e);return console.log("[DummyDataService] Found",t.length,"incentives for executive:",e),t}getReportDataForExecutive(e){console.log("[DummyDataService] getReportDataForExecutive() called for:",e);const t=this.salesExecutivesSubject.value.find(l=>l.id===e),o=this.getSalesRecordsForExecutive(e),i=this.getIncentivesForExecutive(e),n=o.filter(l=>"completed"===l.status).reduce((l,S)=>l+S.amount,0),a=i.filter(l=>"pending"!==l.status).reduce((l,S)=>l+S.amount,0),c=[];for(let l=5;l>=0;l--){const S=new Date;S.setMonth(S.getMonth()-l);const R=S.toISOString().substring(0,7),O=o.filter(v=>v.date.toISOString().substring(0,7)===R&&"completed"===v.status).reduce((v,M)=>v+M.amount,0),F=i.filter(v=>v.earnedDate.toISOString().substring(0,7)===R&&"pending"!==v.status).reduce((v,M)=>v+M.amount,0);c.push({month:R,sales:O,incentives:F})}const u={salesExecutiveId:e,salesExecutiveName:t?.name||"Unknown",totalSales:n,totalIncentives:a,period:"Last 6 months",breakdown:c};return console.log("[DummyDataService] Report data generated:",u),u}getSalesExecutives(){const e=this.salesExecutivesSubject.value;return console.log("[DummyDataService] getSalesExecutives() called, returning",e.length,"executives"),e}getIncentiveRules(){const e=this.incentiveRulesSubject.value;return console.log("[DummyDataService] getIncentiveRules() called, returning",e.length,"rules"),e}addIncentiveRule(e){console.log("[DummyDataService] addIncentiveRule() called with:",e),this.incentiveRulesSubject.next([...this.incentiveRulesSubject.value,e]),console.log("[DummyDataService] Rule added successfully, total rules:",this.incentiveRulesSubject.value.length)}updateIncentiveRule(e,t){console.log("[DummyDataService] updateIncentiveRule() called for rule:",e,"with updates:",t);const i=this.incentiveRulesSubject.value.map(n=>n.id===e?{...n,...t}:n);this.incentiveRulesSubject.next(i),console.log("[DummyDataService] Rule updated successfully")}deleteIncentiveRule(e){console.log("[DummyDataService] deleteIncentiveRule() called for rule:",e);const o=this.incentiveRulesSubject.value.filter(i=>i.id!==e);this.incentiveRulesSubject.next(o),console.log("[DummyDataService] Rule deleted successfully, remaining rules:",this.incentiveRulesSubject.value.length)}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=h.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var D=m(467),C=m(1913);let j=(()=>{class r{constructor(){this.mfeConfigs=[],this.loadedMfesSubject=new d.BehaviorSubject(new Set),this.loadedMfes$=this.loadedMfesSubject.asObservable(),this.loadingMfesSubject=new d.BehaviorSubject(new Set),this.loadingMfes$=this.loadingMfesSubject.asObservable(),console.log("[MfeLoaderService] Service initialized")}setConfigs(e){console.log("[MfeLoaderService] setConfigs() called with",e.length,"configurations"),this.mfeConfigs=e.sort((t,o)=>o.priority-t.priority),console.log("[MfeLoaderService] Configurations sorted by priority:",this.mfeConfigs.map(t=>({name:t.name,priority:t.priority})))}getConfigs(){return console.log("[MfeLoaderService] getConfigs() called, returning",this.mfeConfigs.length,"configurations"),this.mfeConfigs}getConfigsForRole(e){console.log("[MfeLoaderService] getConfigsForRole() called for role:",e);const t=this.mfeConfigs.filter(o=>o.allowedRoles.includes(e));return console.log("[MfeLoaderService] Found",t.length,"configurations for role:",e,t.map(o=>o.name)),t}getConfigByName(e){console.log("[MfeLoaderService] getConfigByName() called for:",e);const t=this.mfeConfigs.find(o=>o.name===e);return t?console.log("[MfeLoaderService] Found configuration for:",e):console.warn("[MfeLoaderService] Configuration not found for:",e),t}preloadPriorityMfes(e){var t=this;return(0,D.A)(function*(){console.log("[MfeLoaderService] preloadPriorityMfes() called for role:",e);const i=t.getConfigsForRole(e).filter(a=>a.priority>=5);console.log("[MfeLoaderService] Preloading",i.length,"priority MFEs:",i.map(a=>({name:a.name,priority:a.priority})));const n=i.map(a=>t.loadMfe(a));yield Promise.all(n),console.log("[MfeLoaderService] Preloading complete")})()}loadMfe(e){var t=this;return(0,D.A)(function*(){const o=t.loadingMfesSubject.value,i=t.loadedMfesSubject.value;if(i.has(e.name))console.log(`[MfeLoaderService] MFE ${e.name} already loaded`);else if(o.has(e.name))console.log(`[MfeLoaderService] MFE ${e.name} is already loading`);else try{const n=new Set(o);n.add(e.name),t.loadingMfesSubject.next(n),console.log(`[MfeLoaderService] Loading MFE ${e.name} (priority: ${e.priority})`),console.log("[MfeLoaderService] MFE config:",{name:e.name,url:e.url,exposedModule:e.exposedModule,remoteName:e.remoteName});const a=yield(0,C.loadRemoteModule)({type:"module",remoteEntry:e.url,exposedModule:e.exposedModule}),c=new Set(i);c.add(e.name),t.loadedMfesSubject.next(c);const u=new Set(t.loadingMfesSubject.value);return u.delete(e.name),t.loadingMfesSubject.next(u),console.log(`[MfeLoaderService] Successfully loaded MFE ${e.name}`),console.log("[MfeLoaderService] Currently loaded MFEs:",Array.from(t.loadedMfesSubject.value)),a}catch(n){console.error(`[MfeLoaderService] Error loading MFE ${e.name}:`,n),console.error("[MfeLoaderService] Failed config:",{name:e.name,url:e.url,exposedModule:e.exposedModule});const a=new Set(t.loadingMfesSubject.value);throw a.delete(e.name),t.loadingMfesSubject.next(a),n}})()}isMfeLoaded(e){const t=this.loadedMfesSubject.value.has(e);return console.log(`[MfeLoaderService] isMfeLoaded(${e}):`,t),t}isMfeLoading(e){const t=this.loadingMfesSubject.value.has(e);return console.log(`[MfeLoaderService] isMfeLoading(${e}):`,t),t}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=h.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var b=m(6883),g=m(7544),L=m(8072);let P=(()=>{class r{constructor(e){this.http=e,this.profileSubject=new d.BehaviorSubject(null),this.profile$=this.profileSubject.asObservable(),console.log("[UserProfileService] Service initialized")}fetchUserProfile(){return console.log("[UserProfileService] Fetching user profile from API"),g.APP_CONFIG&&g.APP_CONFIG.apiUrl?this.http.get(`${g.APP_CONFIG.apiUrl}/auth/me`).pipe((0,b.map)(e=>e.success&&e.data?(console.log("[UserProfileService] Profile loaded successfully"),this.profileSubject.next(e.data),e.data):null),(0,b.catchError)(e=>(console.error("[UserProfileService] Error fetching profile:",e),this.profileSubject.next(null),(0,d.of)(null)))):(console.error("[UserProfileService] APP_CONFIG or apiUrl is not defined"),(0,d.of)(null))}getCurrentProfile(){return this.profileSubject.value}getPrimaryOrganization(){return this.profileSubject.value?.organizations?.[0]||null}getPrimaryRole(){return this.profileSubject.value?.roles?.[0]||null}getRoleName(){return this.getPrimaryRole()?.name||null}getOrganizationDisplayName(){return this.getPrimaryOrganization()?.displayName||null}clearProfile(){this.profileSubject.next(null)}static{this.\u0275fac=function(t){return new(t||r)(h.\u0275\u0275inject(L.HttpClient))}}static{this.\u0275prov=h.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();const N=(r,f)=>{const t=(0,h.inject)(g.AuthService).getTokenSync();return!t||x(r.url)?f(r):f(r.clone({setHeaders:{Authorization:`Bearer ${t}`}}))},x=r=>{try{if(g.APP_CONFIG&&"object"==typeof g.APP_CONFIG&&g.APP_CONFIG.apiUrl&&r.startsWith(g.APP_CONFIG.apiUrl))return!1}catch(e){console.warn("[authInterceptor] APP_CONFIG not available, using pattern-based auth endpoint detection",e)}return["/oauth","auth0.com","/authorize","/token"].some(e=>r.includes(e))}}}]);