(self.webpackChunkshell=self.webpackChunkshell||[]).push([[988,607],{988:(We,B,J)=>{J.r(B),J.d(B,{Auth0Client:()=>Le,AuthenticationError:()=>L,CacheKey:()=>I,ConnectError:()=>q,GenericError:()=>_,InMemoryCache:()=>ge,LocalStorageCache:()=>Ce,MfaRequiredError:()=>te,MissingRefreshTokenError:()=>X,MyAccountApiError:()=>$,PopupCancelledError:()=>ee,PopupTimeoutError:()=>Q,ResponseType:()=>C,TimeoutError:()=>Z,UseDpopNonceError:()=>V,User:()=>ht,createAuth0Client:()=>_t});var f=J(467);function x(i,e){var t={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(null!=i&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(i);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(i,n[o])&&(t[n[o]]=i[n[o]])}return t}"function"==typeof SuppressedError&&SuppressedError;var T=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function j(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function K(i,e){return i(e={exports:{}},e.exports),e.exports}var A=K(function(i,e){Object.defineProperty(e,"__esModule",{value:!0});var t=function(){function n(){var o=this;this.locked=new Map,this.addToLocked=function(r,s){var c=o.locked.get(r);void 0===c?o.locked.set(r,void 0===s?[]:[s]):void 0!==s&&(c.unshift(s),o.locked.set(r,c))},this.isLocked=function(r){return o.locked.has(r)},this.lock=function(r){return new Promise(function(s,c){o.isLocked(r)?o.addToLocked(r,s):(o.addToLocked(r),s())})},this.unlock=function(r){var s=o.locked.get(r);if(void 0!==s&&0!==s.length){var c=s.pop();o.locked.set(r,s),void 0!==c&&setTimeout(c,0)}else o.locked.delete(r)}}return n.getInstance=function(){return void 0===n.instance&&(n.instance=new n),n.instance},n}();e.default=function(){return t.getInstance()}});j(A);var D=j(K(function(i,e){var t=T&&T.__awaiter||function(a,u,l,h){return new(l||(l=Promise))(function(p,v){function y(w){try{k(h.next(w))}catch(g){v(g)}}function b(w){try{k(h.throw(w))}catch(g){v(g)}}function k(w){w.done?p(w.value):new l(function(g){g(w.value)}).then(y,b)}k((h=h.apply(a,u||[])).next())})},n=T&&T.__generator||function(a,u){var l,h,p,v,y={label:0,sent:function(){if(1&p[0])throw p[1];return p[1]},trys:[],ops:[]};return v={next:b(0),throw:b(1),return:b(2)},"function"==typeof Symbol&&(v[Symbol.iterator]=function(){return this}),v;function b(k){return function(w){return function(g){if(l)throw new TypeError("Generator is already executing.");for(;y;)try{if(l=1,h&&(p=2&g[0]?h.return:g[0]?h.throw||((p=h.return)&&p.call(h),0):h.next)&&!(p=p.call(h,g[1])).done)return p;switch(h=0,p&&(g=[2&g[0],p.value]),g[0]){case 0:case 1:p=g;break;case 4:return y.label++,{value:g[1],done:!1};case 5:y.label++,h=g[1],g=[0];continue;case 7:g=y.ops.pop(),y.trys.pop();continue;default:if(!((p=(p=y.trys).length>0&&p[p.length-1])||6!==g[0]&&2!==g[0])){y=0;continue}if(3===g[0]&&(!p||g[1]>p[0]&&g[1]<p[3])){y.label=g[1];break}if(6===g[0]&&y.label<p[1]){y.label=p[1],p=g;break}if(p&&y.label<p[2]){y.label=p[2],y.ops.push(g);break}p[2]&&y.ops.pop(),y.trys.pop();continue}g=u.call(a,y)}catch(S){g=[6,S],h=0}finally{l=p=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}([k,w])}}},o=T;Object.defineProperty(e,"__esModule",{value:!0});var r="browser-tabs-lock-key",s={key:function(a){return t(o,void 0,void 0,function(){return n(this,function(u){throw new Error("Unsupported")})})},getItem:function(a){return t(o,void 0,void 0,function(){return n(this,function(u){throw new Error("Unsupported")})})},clear:function(){return t(o,void 0,void 0,function(){return n(this,function(a){return[2,window.localStorage.clear()]})})},removeItem:function(a){return t(o,void 0,void 0,function(){return n(this,function(u){throw new Error("Unsupported")})})},setItem:function(a,u){return t(o,void 0,void 0,function(){return n(this,function(l){throw new Error("Unsupported")})})},keySync:function(a){return window.localStorage.key(a)},getItemSync:function(a){return window.localStorage.getItem(a)},clearSync:function(){return window.localStorage.clear()},removeItemSync:function(a){return window.localStorage.removeItem(a)},setItemSync:function(a,u){return window.localStorage.setItem(a,u)}};function c(a){return new Promise(function(u){return setTimeout(u,a)})}function d(a){for(var l="",h=0;h<a;h++)l+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz"[Math.floor(61*Math.random())];return l}var m=function(){function a(u){this.acquiredIatSet=new Set,this.storageHandler=void 0,this.id=Date.now().toString()+d(15),this.acquireLock=this.acquireLock.bind(this),this.releaseLock=this.releaseLock.bind(this),this.releaseLock__private__=this.releaseLock__private__.bind(this),this.waitForSomethingToChange=this.waitForSomethingToChange.bind(this),this.refreshLockWhileAcquired=this.refreshLockWhileAcquired.bind(this),this.storageHandler=u,void 0===a.waiters&&(a.waiters=[])}return a.prototype.acquireLock=function(u,l){return void 0===l&&(l=5e3),t(this,void 0,void 0,function(){var h,p,v,y,b,k,w;return n(this,function(g){switch(g.label){case 0:h=Date.now()+d(4),p=Date.now()+l,v=r+"-"+u,y=void 0===this.storageHandler?s:this.storageHandler,g.label=1;case 1:return Date.now()<p?[4,c(30)]:[3,8];case 2:return g.sent(),null!==y.getItemSync(v)?[3,5]:(b=this.id+"-"+u+"-"+h,[4,c(Math.floor(25*Math.random()))]);case 3:return g.sent(),y.setItemSync(v,JSON.stringify({id:this.id,iat:h,timeoutKey:b,timeAcquired:Date.now(),timeRefreshed:Date.now()})),[4,c(30)];case 4:return g.sent(),null!==(k=y.getItemSync(v))&&(w=JSON.parse(k)).id===this.id&&w.iat===h?(this.acquiredIatSet.add(h),this.refreshLockWhileAcquired(v,h),[2,!0]):[3,7];case 5:return a.lockCorrector(void 0===this.storageHandler?s:this.storageHandler),[4,this.waitForSomethingToChange(p)];case 6:g.sent(),g.label=7;case 7:return h=Date.now()+d(4),[3,1];case 8:return[2,!1]}})})},a.prototype.refreshLockWhileAcquired=function(u,l){return t(this,void 0,void 0,function(){var h=this;return n(this,function(p){return setTimeout(function(){return t(h,void 0,void 0,function(){var v,y,b;return n(this,function(k){switch(k.label){case 0:return[4,A.default().lock(l)];case 1:return k.sent(),this.acquiredIatSet.has(l)?null===(y=(v=void 0===this.storageHandler?s:this.storageHandler).getItemSync(u))?(A.default().unlock(l),[2]):((b=JSON.parse(y)).timeRefreshed=Date.now(),v.setItemSync(u,JSON.stringify(b)),A.default().unlock(l),this.refreshLockWhileAcquired(u,l),[2]):(A.default().unlock(l),[2])}})})},1e3),[2]})})},a.prototype.waitForSomethingToChange=function(u){return t(this,void 0,void 0,function(){return n(this,function(l){switch(l.label){case 0:return[4,new Promise(function(h){var p=!1,v=Date.now(),y=!1;function b(){if(y||(window.removeEventListener("storage",b),a.removeFromWaiting(b),clearTimeout(k),y=!0),!p){p=!0;var w=50-(Date.now()-v);w>0?setTimeout(h,w):h(null)}}window.addEventListener("storage",b),a.addToWaiting(b);var k=setTimeout(b,Math.max(0,u-Date.now()))})];case 1:return l.sent(),[2]}})})},a.addToWaiting=function(u){this.removeFromWaiting(u),void 0!==a.waiters&&a.waiters.push(u)},a.removeFromWaiting=function(u){void 0!==a.waiters&&(a.waiters=a.waiters.filter(function(l){return l!==u}))},a.notifyWaiters=function(){void 0!==a.waiters&&a.waiters.slice().forEach(function(u){return u()})},a.prototype.releaseLock=function(u){return t(this,void 0,void 0,function(){return n(this,function(l){switch(l.label){case 0:return[4,this.releaseLock__private__(u)];case 1:return[2,l.sent()]}})})},a.prototype.releaseLock__private__=function(u){return t(this,void 0,void 0,function(){var l,h,p,v;return n(this,function(y){switch(y.label){case 0:return null===(p=(l=void 0===this.storageHandler?s:this.storageHandler).getItemSync(h=r+"-"+u))?[2]:(v=JSON.parse(p)).id!==this.id?[3,2]:[4,A.default().lock(v.iat)];case 1:y.sent(),this.acquiredIatSet.delete(v.iat),l.removeItemSync(h),A.default().unlock(v.iat),a.notifyWaiters(),y.label=2;case 2:return[2]}})})},a.lockCorrector=function(u){for(var l=Date.now()-5e3,h=u,p=[],v=0;;){var y=h.keySync(v);if(null===y)break;p.push(y),v++}for(var b=!1,k=0;k<p.length;k++){var w=p[k];if(w.includes(r)){var g=h.getItemSync(w);if(null!==g){var S=JSON.parse(g);(void 0===S.timeRefreshed&&S.timeAcquired<l||void 0!==S.timeRefreshed&&S.timeRefreshed<l)&&(h.removeItemSync(w),b=!0)}}}b&&a.notifyWaiters()},a.waiters=void 0,a}();e.default=m}));const U={timeoutInSeconds:60},P={name:"auth0-spa-js",version:"2.8.0"},O=()=>Date.now();class _ extends Error{constructor(e,t){super(t),this.error=e,this.error_description=t,Object.setPrototypeOf(this,_.prototype)}static fromPayload({error:e,error_description:t}){return new _(e,t)}}class L extends _{constructor(e,t,n,o=null){super(e,t),this.state=n,this.appState=o,Object.setPrototypeOf(this,L.prototype)}}class q extends _{constructor(e,t,n,o,r=null){super(e,t),this.connection=n,this.state=o,this.appState=r,Object.setPrototypeOf(this,q.prototype)}}class Z extends _{constructor(){super("timeout","Timeout"),Object.setPrototypeOf(this,Z.prototype)}}class Q extends Z{constructor(e){super(),this.popup=e,Object.setPrototypeOf(this,Q.prototype)}}class ee extends _{constructor(e){super("cancelled","Popup closed"),this.popup=e,Object.setPrototypeOf(this,ee.prototype)}}class te extends _{constructor(e,t,n){super(e,t),this.mfa_token=n,Object.setPrototypeOf(this,te.prototype)}}class X extends _{constructor(e,t){super("missing_refresh_token",`Missing Refresh Token (audience: '${ne(e,["default"])}', scope: '${ne(t)}')`),this.audience=e,this.scope=t,Object.setPrototypeOf(this,X.prototype)}}class ce extends _{constructor(e,t){super("missing_scopes",`Missing requested scopes after refresh (audience: '${ne(e,["default"])}', missing scope: '${ne(t)}')`),this.audience=e,this.scope=t,Object.setPrototypeOf(this,ce.prototype)}}class V extends _{constructor(e){super("use_dpop_nonce","Server rejected DPoP proof: wrong nonce"),this.newDpopNonce=e,Object.setPrototypeOf(this,V.prototype)}}function ne(i,e=[]){return i&&!e.includes(i)?i:""}const oe=()=>window.crypto,G=()=>{let e="";return Array.from(oe().getRandomValues(new Uint8Array(43))).forEach(t=>e+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_~."[t%66]),e},ue=i=>btoa(i),He=[{key:"name",type:["string"]},{key:"version",type:["string","number"]},{key:"env",type:["object"]}],Je=i=>Object.keys(i).reduce((e,t)=>{const n=He.find(o=>o.key===t);return n&&n.type.includes(typeof i[t])&&(e[t]=i[t]),e},{}),de=i=>{var n,{clientId:e}=i,t=x(i,["clientId"]);return new URLSearchParams((n=Object.assign({client_id:e},t),Object.keys(n).filter(o=>void 0!==n[o]).reduce((o,r)=>Object.assign(Object.assign({},o),{[r]:n[r]}),{}))).toString()},ke=function(){var i=(0,f.A)(function*(e){return yield oe().subtle.digest({name:"SHA-256"},(new TextEncoder).encode(e))});return function(t){return i.apply(this,arguments)}}(),Se=i=>{return e=i.replace(/_/g,"/").replace(/-/g,"+"),decodeURIComponent(atob(e).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""));var e},Ie=i=>{const e=new Uint8Array(i);return(t=>{const n={"+":"-","/":"_","=":""};return t.replace(/[+/=]/g,o=>n[o])})(window.btoa(String.fromCharCode(...Array.from(e))))},Xe=new TextEncoder,Ve=new TextDecoder;function F(i){return"string"==typeof i?Xe.encode(i):Ve.decode(i)}function xe(i){if("number"!=typeof i.modulusLength||i.modulusLength<2048)throw new Fe(`${i.name} modulusLength must be at least 2048 bits`)}function le(){return(le=(0,f.A)(function*(i,e,t){if(!1===t.usages.includes("sign"))throw new TypeError('private CryptoKey instances used for signing assertions must include "sign" in their "usages"');const n=`${M(F(JSON.stringify(i)))}.${M(F(JSON.stringify(e)))}`;return`${n}.${M(yield crypto.subtle.sign(function(o){switch(o.algorithm.name){case"ECDSA":return{name:o.algorithm.name,hash:"SHA-256"};case"RSA-PSS":return xe(o.algorithm),{name:o.algorithm.name,saltLength:32};case"RSASSA-PKCS1-v1_5":return xe(o.algorithm),{name:o.algorithm.name};case"Ed25519":return{name:o.algorithm.name}}throw new E}(t),t,F(n)))}`})).apply(this,arguments)}let he;function M(i){return he(i)}he=Uint8Array.prototype.toBase64?i=>(i instanceof ArrayBuffer&&(i=new Uint8Array(i)),i.toBase64({alphabet:"base64url",omitPadding:!0})):e=>{e instanceof ArrayBuffer&&(e=new Uint8Array(e));const t=[];for(let n=0;n<e.byteLength;n+=32768)t.push(String.fromCharCode.apply(null,e.subarray(n,n+32768)));return btoa(t.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")};class E extends Error{constructor(e){var t;super(e??"operation not supported"),this.name=this.constructor.name,null===(t=Error.captureStackTrace)||void 0===t||t.call(Error,this,this.constructor)}}class Fe extends Error{constructor(e){var t;super(e),this.name=this.constructor.name,null===(t=Error.captureStackTrace)||void 0===t||t.call(Error,this,this.constructor)}}function Me(i){switch(i.algorithm.name){case"RSA-PSS":return function(e){if("SHA-256"===e.algorithm.hash.name)return"PS256";throw new E("unsupported RsaHashedKeyAlgorithm hash name")}(i);case"RSASSA-PKCS1-v1_5":return function(e){if("SHA-256"===e.algorithm.hash.name)return"RS256";throw new E("unsupported RsaHashedKeyAlgorithm hash name")}(i);case"ECDSA":return function(e){if("P-256"===e.algorithm.namedCurve)return"ES256";throw new E("unsupported EcKeyAlgorithm namedCurve")}(i);case"Ed25519":return"Ed25519";default:throw new E("unsupported CryptoKey algorithm name")}}function Ae(i){return i instanceof CryptoKey}function Te(i){return Ae(i)&&"public"===i.type}function pe(){return pe=(0,f.A)(function*(i,e,t,n,o,r){const s=i?.privateKey,c=i?.publicKey;if(!Ae(d=s)||"private"!==d.type)throw new TypeError('"keypair.privateKey" must be a private CryptoKey');var d;if(!Te(c))throw new TypeError('"keypair.publicKey" must be a public CryptoKey');if(!0!==c.extractable)throw new TypeError('"keypair.publicKey.extractable" must be true');if("string"!=typeof e)throw new TypeError('"htu" must be a string');if("string"!=typeof t)throw new TypeError('"htm" must be a string');if(void 0!==n&&"string"!=typeof n)throw new TypeError('"nonce" must be a string or undefined');if(void 0!==o&&"string"!=typeof o)throw new TypeError('"accessToken" must be a string or undefined');if(void 0!==r&&("object"!=typeof r||null===r||Array.isArray(r)))throw new TypeError('"additional" must be an object');return function Ge(i,e,t){return le.apply(this,arguments)}({alg:Me(s),typ:"dpop+jwt",jwk:yield Pe(c)},Object.assign(Object.assign({},r),{iat:Math.floor(Date.now()/1e3),jti:crypto.randomUUID(),htm:t,nonce:n,htu:e,ath:o?M(yield crypto.subtle.digest("SHA-256",F(o))):void 0}),s)}),pe.apply(this,arguments)}function Pe(i){return me.apply(this,arguments)}function me(){return(me=(0,f.A)(function*(i){const{kty:e,e:t,n,x:o,y:r,crv:s}=yield crypto.subtle.exportKey("jwk",i);return{kty:e,crv:s,e:t,n,x:o,y:r}})).apply(this,arguments)}const $e=["authorization_code","refresh_token","urn:ietf:params:oauth:grant-type:token-exchange"];const et=function(){var i=(0,f.A)(function*(e,t){const n=yield fetch(e,t);return{ok:n.ok,json:yield n.json(),headers:(o=n.headers,[...o].reduce((r,[s,c])=>(r[s]=c,r),{}))};var o});return function(t,n){return i.apply(this,arguments)}}(),tt=function(){var i=(0,f.A)(function*(e,t,n){const o=new AbortController;let r;return t.signal=o.signal,Promise.race([et(e,t),new Promise((s,c)=>{r=setTimeout(()=>{o.abort(),c(new Error("Timeout when executing 'fetch'"))},n)})]).finally(()=>{clearTimeout(r)})});return function(t,n,o){return i.apply(this,arguments)}}(),nt=function(){var i=(0,f.A)(function*(e,t,n,o,r,s,c,d){return m={auth:{audience:t,scope:n},timeout:r,fetchUrl:e,fetchOptions:o,useFormData:c,useMrrt:d},a=s,new Promise(function(u,l){const h=new MessageChannel;h.port1.onmessage=function(p){p.data.error?l(new Error(p.data.error)):u(p.data),h.port1.close()},a.postMessage(m,[h.port2])});var m,a});return function(t,n,o,r,s,c,d,m){return i.apply(this,arguments)}}(),ot=function(){var i=(0,f.A)(function*(e,t,n,o,r,s,c=1e4,d){return r?nt(e,t,n,o,c,r,s,d):tt(e,o,c)});return function(t,n,o,r,s,c){return i.apply(this,arguments)}}();function Oe(i,e,t,n,o,r,s,c,d,m){return fe.apply(this,arguments)}function fe(){return(fe=(0,f.A)(function*(i,e,t,n,o,r,s,c,d,m){if(d){const w=yield d.generateProof({url:i,method:o.method||"GET",nonce:yield d.getNonce()});o.headers=Object.assign(Object.assign({},o.headers),{dpop:w})}let a,u=null;for(let w=0;w<3;w++)try{a=yield ot(i,t,n,o,r,s,e,c),u=null;break}catch(g){u=g}if(u)throw u;const l=a.json,{error:h,error_description:p}=l,v=x(l,["error","error_description"]),{headers:y,ok:b}=a;let k;if(d&&(k=y["dpop-nonce"],k&&(yield d.setNonce(k))),!b){const w=p||`HTTP error. Unable to fetch ${i}`;if("mfa_required"===h)throw new te(h,w,v.mfa_token);if("missing_refresh_token"===h)throw new X(t,n);if("use_dpop_nonce"===h){if(!d||!k||m)throw new V(k);return Oe(i,e,t,n,o,r,s,c,d,!0)}throw new _(h||"request_error",w)}return v})).apply(this,arguments)}function ye(){return(ye=(0,f.A)(function*(i,e){var{baseUrl:t,timeout:n,audience:o,scope:r,auth0Client:s,useFormData:c,useMrrt:d,dpop:m}=i,a=x(i,["baseUrl","timeout","audience","scope","auth0Client","useFormData","useMrrt","dpop"]);const u="urn:ietf:params:oauth:grant-type:token-exchange"===a.grant_type,l="refresh_token"===a.grant_type&&d,h=Object.assign(Object.assign(Object.assign(Object.assign({},a),u&&o&&{audience:o}),u&&r&&{scope:r}),l&&{audience:o,scope:r}),p=c?de(h):JSON.stringify(h),v=$e.includes(a.grant_type);return yield Oe(`${t}/oauth/token`,n,o||"default",r,{method:"POST",body:p,headers:{"Content-Type":c?"application/x-www-form-urlencoded":"application/json","Auth0-Client":btoa(JSON.stringify(Je(s||P)))}},e,c,d,v?m:void 0)})).apply(this,arguments)}const re=(...i)=>{return(e=i.filter(Boolean).join(" ").trim().split(/\s+/),Array.from(new Set(e))).join(" ");var e},ie=(i,e,t)=>{let n;return t&&(n=i[t]),n||(n=i.default),re(n,e)};class I{constructor(e,t="@@auth0spajs@@",n){this.prefix=t,this.suffix=n,this.clientId=e.clientId,this.scope=e.scope,this.audience=e.audience}toKey(){return[this.prefix,this.clientId,this.audience,this.scope,this.suffix].filter(Boolean).join("::")}static fromKey(e){const[t,n,o,r]=e.split("::");return new I({clientId:n,scope:r,audience:o},t)}static fromCacheEntry(e){const{scope:t,audience:n,client_id:o}=e;return new I({scope:t,audience:n,clientId:o})}}class Ce{set(e,t){localStorage.setItem(e,JSON.stringify(t))}get(e){const t=window.localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch{return}}remove(e){localStorage.removeItem(e)}allKeys(){return Object.keys(window.localStorage).filter(e=>e.startsWith("@@auth0spajs@@"))}}class ge{constructor(){this.enclosedCache=function(){let e={};return{set(t,n){e[t]=n},get(t){const n=e[t];if(n)return n},remove(t){delete e[t]},allKeys:()=>Object.keys(e)}}()}}class it{constructor(e,t,n){this.cache=e,this.keyManifest=t,this.nowProvider=n||O}setIdToken(e,t,n){var o=this;return(0,f.A)(function*(){var r;const s=o.getIdTokenCacheKey(e);yield o.cache.set(s,{id_token:t,decodedToken:n}),yield null===(r=o.keyManifest)||void 0===r?void 0:r.add(s)})()}getIdToken(e){var t=this;return(0,f.A)(function*(){const n=yield t.cache.get(t.getIdTokenCacheKey(e.clientId));if(!n&&e.scope&&e.audience){const o=yield t.get(e);return o&&o.id_token&&o.decodedToken?{id_token:o.id_token,decodedToken:o.decodedToken}:void 0}if(n)return{id_token:n.id_token,decodedToken:n.decodedToken}})()}get(e){var t=this;return(0,f.A)(function*(n,o=0,r=!1,s){var c;let d=yield t.cache.get(n.toKey());if(!d){const u=yield t.getCacheKeys();if(!u)return;const l=t.matchExistingCacheKey(n,u);if(l&&(d=yield t.cache.get(l)),!l&&r&&"cache-only"!==s)return t.getEntryWithRefreshToken(n,u)}if(!d)return;const m=yield t.nowProvider(),a=Math.floor(m/1e3);return d.expiresAt-o<a?d.body.refresh_token?t.modifiedCachedEntry(d,n):(yield t.cache.remove(n.toKey()),void(yield null===(c=t.keyManifest)||void 0===c?void 0:c.remove(n.toKey()))):d.body}).apply(this,arguments)}modifiedCachedEntry(e,t){var n=this;return(0,f.A)(function*(){return e.body={refresh_token:e.body.refresh_token,audience:e.body.audience,scope:e.body.scope},yield n.cache.set(t.toKey(),e),{refresh_token:e.body.refresh_token,audience:e.body.audience,scope:e.body.scope}})()}set(e){var t=this;return(0,f.A)(function*(){var n;const o=new I({clientId:e.client_id,scope:e.scope,audience:e.audience}),r=yield t.wrapCacheEntry(e);yield t.cache.set(o.toKey(),r),yield null===(n=t.keyManifest)||void 0===n?void 0:n.add(o.toKey())})()}remove(e,t,n){var o=this;return(0,f.A)(function*(){const r=new I({clientId:e,scope:n,audience:t});yield o.cache.remove(r.toKey())})()}clear(e){var t=this;return(0,f.A)(function*(){var n;const o=yield t.getCacheKeys();o&&(yield o.filter(r=>!e||r.includes(e)).reduce(function(){var r=(0,f.A)(function*(s,c){yield s,yield t.cache.remove(c)});return function(s,c){return r.apply(this,arguments)}}(),Promise.resolve()),yield null===(n=t.keyManifest)||void 0===n?void 0:n.clear())})()}wrapCacheEntry(e){var t=this;return(0,f.A)(function*(){const n=yield t.nowProvider();return{body:e,expiresAt:Math.floor(n/1e3)+e.expires_in}})()}getCacheKeys(){var e=this;return(0,f.A)(function*(){var t;return e.keyManifest?null===(t=yield e.keyManifest.get())||void 0===t?void 0:t.keys:e.cache.allKeys?e.cache.allKeys():void 0})()}getIdTokenCacheKey(e){return new I({clientId:e},"@@auth0spajs@@","@@user@@").toKey()}matchExistingCacheKey(e,t){return t.filter(n=>{var o;const r=I.fromKey(n),s=new Set(r.scope&&r.scope.split(" ")),c=(null===(o=e.scope)||void 0===o?void 0:o.split(" "))||[],d=r.scope&&c.reduce((m,a)=>m&&s.has(a),!0);return"@@auth0spajs@@"===r.prefix&&r.clientId===e.clientId&&r.audience===e.audience&&d})[0]}getEntryWithRefreshToken(e,t){var n=this;return(0,f.A)(function*(){var o;for(const r of t){const s=I.fromKey(r);if("@@auth0spajs@@"===s.prefix&&s.clientId===e.clientId){const c=yield n.cache.get(r);if(null!==(o=c?.body)&&void 0!==o&&o.refresh_token)return n.modifiedCachedEntry(c,e)}}})()}updateEntry(e,t){var n=this;return(0,f.A)(function*(){var o;const r=yield n.getCacheKeys();if(r)for(const s of r){const c=yield n.cache.get(s);if((null===(o=c?.body)||void 0===o?void 0:o.refresh_token)===e){const d=Object.assign(Object.assign({},c.body),{refresh_token:t});yield n.set(d)}}})()}}class st{constructor(e,t,n){this.storage=e,this.clientId=t,this.cookieDomain=n,this.storageKey=`a0.spajs.txs.${this.clientId}`}create(e){this.storage.save(this.storageKey,e,{daysUntilExpire:1,cookieDomain:this.cookieDomain})}get(){return this.storage.get(this.storageKey)}remove(){this.storage.remove(this.storageKey,{cookieDomain:this.cookieDomain})}}const Y=i=>"number"==typeof i,at=["iss","aud","exp","nbf","iat","jti","azp","nonce","auth_time","at_hash","c_hash","acr","amr","sub_jwk","cnf","sip_from_tag","sip_date","sip_callid","sip_cseq_num","sip_via_branch","orig","dest","mky","events","toe","txn","rph","sid","vot","vtm"];var z=K(function(i,e){var t=T&&T.__assign||function(){return t=Object.assign||function(d){for(var m,a=1,u=arguments.length;a<u;a++)for(var l in m=arguments[a])Object.prototype.hasOwnProperty.call(m,l)&&(d[l]=m[l]);return d},t.apply(this,arguments)};function n(d,m){if(!m)return"";var a="; "+d;return!0===m?a:a+"="+m}function o(d,m,a){return encodeURIComponent(d).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/\(/g,"%28").replace(/\)/g,"%29")+"="+encodeURIComponent(m).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent)+function(u){if("number"==typeof u.expires){var l=new Date;l.setMilliseconds(l.getMilliseconds()+864e5*u.expires),u.expires=l}return n("Expires",u.expires?u.expires.toUTCString():"")+n("Domain",u.domain)+n("Path",u.path)+n("Secure",u.secure)+n("SameSite",u.sameSite)}(a)}function r(d){for(var m={},a=d?d.split("; "):[],u=/(%[\dA-F]{2})+/gi,l=0;l<a.length;l++){var h=a[l].split("="),p=h.slice(1).join("=");'"'===p.charAt(0)&&(p=p.slice(1,-1));try{m[h[0].replace(u,decodeURIComponent)]=p.replace(u,decodeURIComponent)}catch{}}return m}function s(){return r(document.cookie)}function c(d,m,a){document.cookie=o(d,m,t({path:"/"},a))}e.__esModule=!0,e.encode=o,e.parse=r,e.getAll=s,e.get=function(d){return s()[d]},e.set=c,e.remove=function(d,m){c(d,"",t(t({},m),{expires:-1}))}});j(z);var ut=z.get,je=z.set,Ke=z.remove;const W={get(i){const e=ut(i);if(void 0!==e)return JSON.parse(e)},save(i,e,t){let n={};"https:"===window.location.protocol&&(n={secure:!0,sameSite:"none"}),t?.daysUntilExpire&&(n.expires=t.daysUntilExpire),t?.cookieDomain&&(n.domain=t.cookieDomain),je(i,JSON.stringify(e),n)},remove(i,e){let t={};e?.cookieDomain&&(t.domain=e.cookieDomain),Ke(i,t)}},dt={get:i=>W.get(i)||W.get(`_legacy_${i}`),save(i,e,t){let n={};"https:"===window.location.protocol&&(n={secure:!0}),t?.daysUntilExpire&&(n.expires=t.daysUntilExpire),t?.cookieDomain&&(n.domain=t.cookieDomain),je(`_legacy_${i}`,JSON.stringify(e),n),W.save(i,e,t)},remove(i,e){let t={};e?.cookieDomain&&(t.domain=e.cookieDomain),Ke(i,t),W.remove(i,e),W.remove(`_legacy_${i}`,e)}},lt={get(i){if(typeof sessionStorage>"u")return;const e=sessionStorage.getItem(i);return null!=e?JSON.parse(e):void 0},save(i,e){sessionStorage.setItem(i,JSON.stringify(e))},remove(i){sessionStorage.removeItem(i)}};var C,i;(i=C||(C={})).Code="code",i.ConnectCode="connect_code";class ht{}var ve,mt=function(i){return ve=ve||function pt(i,e,t){var n=void 0===e?null:e,o=function(d,m){var a=atob(d);if(m){for(var u=new Uint8Array(a.length),l=0,h=a.length;l<h;++l)u[l]=a.charCodeAt(l);return String.fromCharCode.apply(null,new Uint16Array(u.buffer))}return a}(i,void 0!==t&&t),r=o.indexOf("\n",10)+1,s=o.substring(r)+(n?"//# sourceMappingURL="+n:""),c=new Blob([s],{type:"application/javascript"});return URL.createObjectURL(c)}("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7Y2xhc3MgZSBleHRlbmRzIEVycm9ye2NvbnN0cnVjdG9yKHQscil7c3VwZXIociksdGhpcy5lcnJvcj10LHRoaXMuZXJyb3JfZGVzY3JpcHRpb249cixPYmplY3Quc2V0UHJvdG90eXBlT2YodGhpcyxlLnByb3RvdHlwZSl9c3RhdGljIGZyb21QYXlsb2FkKHtlcnJvcjp0LGVycm9yX2Rlc2NyaXB0aW9uOnJ9KXtyZXR1cm4gbmV3IGUodCxyKX19Y2xhc3MgdCBleHRlbmRzIGV7Y29uc3RydWN0b3IoZSxzKXtzdXBlcigibWlzc2luZ19yZWZyZXNoX3Rva2VuIixgTWlzc2luZyBSZWZyZXNoIFRva2VuIChhdWRpZW5jZTogJyR7cihlLFsiZGVmYXVsdCJdKX0nLCBzY29wZTogJyR7cihzKX0nKWApLHRoaXMuYXVkaWVuY2U9ZSx0aGlzLnNjb3BlPXMsT2JqZWN0LnNldFByb3RvdHlwZU9mKHRoaXMsdC5wcm90b3R5cGUpfX1mdW5jdGlvbiByKGUsdD1bXSl7cmV0dXJuIGUmJiF0LmluY2x1ZGVzKGUpP2U6IiJ9ImZ1bmN0aW9uIj09dHlwZW9mIFN1cHByZXNzZWRFcnJvciYmU3VwcHJlc3NlZEVycm9yO2NvbnN0IHM9ZT0+e3ZhcntjbGllbnRJZDp0fT1lLHI9ZnVuY3Rpb24oZSx0KXt2YXIgcj17fTtmb3IodmFyIHMgaW4gZSlPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSxzKSYmdC5pbmRleE9mKHMpPDAmJihyW3NdPWVbc10pO2lmKG51bGwhPWUmJiJmdW5jdGlvbiI9PXR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKXt2YXIgbz0wO2ZvcihzPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7bzxzLmxlbmd0aDtvKyspdC5pbmRleE9mKHNbb10pPDAmJk9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChlLHNbb10pJiYocltzW29dXT1lW3Nbb11dKX1yZXR1cm4gcn0oZSxbImNsaWVudElkIl0pO3JldHVybiBuZXcgVVJMU2VhcmNoUGFyYW1zKChlPT5PYmplY3Qua2V5cyhlKS5maWx0ZXIoKHQ9PnZvaWQgMCE9PWVbdF0pKS5yZWR1Y2UoKCh0LHIpPT5PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sdCkse1tyXTplW3JdfSkpLHt9KSkoT2JqZWN0LmFzc2lnbih7Y2xpZW50X2lkOnR9LHIpKSkudG9TdHJpbmcoKX07bGV0IG89e307Y29uc3Qgbj0oZSx0KT0+YCR7ZX18JHt0fWA7YWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsKGFzeW5jKHtkYXRhOnt0aW1lb3V0OmUsYXV0aDpyLGZldGNoVXJsOmksZmV0Y2hPcHRpb25zOmMsdXNlRm9ybURhdGE6YSx1c2VNcnJ0OmZ9LHBvcnRzOltwXX0pPT57bGV0IGgsdSxsPXt9O2NvbnN0e2F1ZGllbmNlOmQsc2NvcGU6eX09cnx8e307dHJ5e2NvbnN0IHI9YT8oZT0+e2NvbnN0IHQ9bmV3IFVSTFNlYXJjaFBhcmFtcyhlKSxyPXt9O3JldHVybiB0LmZvckVhY2goKChlLHQpPT57clt0XT1lfSkpLHJ9KShjLmJvZHkpOkpTT04ucGFyc2UoYy5ib2R5KTtpZighci5yZWZyZXNoX3Rva2VuJiYicmVmcmVzaF90b2tlbiI9PT1yLmdyYW50X3R5cGUpe2lmKHU9KChlLHQpPT5vW24oZSx0KV0pKGQseSksIXUmJmYpe2NvbnN0IGU9by5sYXRlc3RfcmVmcmVzaF90b2tlbix0PSgoZSx0KT0+e2NvbnN0IHI9T2JqZWN0LmtleXMobykuZmluZCgocj0+e2lmKCJsYXRlc3RfcmVmcmVzaF90b2tlbiIhPT1yKXtjb25zdCBzPSgoZSx0KT0+dC5zdGFydHNXaXRoKGAke2V9fGApKSh0LHIpLG89ci5zcGxpdCgifCIpWzFdLnNwbGl0KCIgIiksbj1lLnNwbGl0KCIgIikuZXZlcnkoKGU9Pm8uaW5jbHVkZXMoZSkpKTtyZXR1cm4gcyYmbn19KSk7cmV0dXJuISFyfSkoeSxkKTtlJiYhdCYmKHU9ZSl9aWYoIXUpdGhyb3cgbmV3IHQoZCx5KTtjLmJvZHk9YT9zKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxyKSx7cmVmcmVzaF90b2tlbjp1fSkpOkpTT04uc3RyaW5naWZ5KE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxyKSx7cmVmcmVzaF90b2tlbjp1fSkpfWxldCBqLGs7ImZ1bmN0aW9uIj09dHlwZW9mIEFib3J0Q29udHJvbGxlciYmKGo9bmV3IEFib3J0Q29udHJvbGxlcixjLnNpZ25hbD1qLnNpZ25hbCk7dHJ5e2s9YXdhaXQgUHJvbWlzZS5yYWNlKFsoXz1lLG5ldyBQcm9taXNlKChlPT5zZXRUaW1lb3V0KGUsXykpKSksZmV0Y2goaSxPYmplY3QuYXNzaWduKHt9LGMpKV0pfWNhdGNoKGUpe3JldHVybiB2b2lkIHAucG9zdE1lc3NhZ2Uoe2Vycm9yOmUubWVzc2FnZX0pfWlmKCFrKXJldHVybiBqJiZqLmFib3J0KCksdm9pZCBwLnBvc3RNZXNzYWdlKHtlcnJvcjoiVGltZW91dCB3aGVuIGV4ZWN1dGluZyAnZmV0Y2gnIn0pO2c9ay5oZWFkZXJzLGw9Wy4uLmddLnJlZHVjZSgoKGUsW3Qscl0pPT4oZVt0XT1yLGUpKSx7fSksaD1hd2FpdCBrLmpzb24oKSxoLnJlZnJlc2hfdG9rZW4/KGYmJihvLmxhdGVzdF9yZWZyZXNoX3Rva2VuPWgucmVmcmVzaF90b2tlbixPPXUsYj1oLnJlZnJlc2hfdG9rZW4sT2JqZWN0LmVudHJpZXMobykuZm9yRWFjaCgoKFtlLHRdKT0+e3Q9PT1PJiYob1tlXT1iKX0pKSksKChlLHQscik9PntvW24odCxyKV09ZX0pKGgucmVmcmVzaF90b2tlbixkLHkpLGRlbGV0ZSBoLnJlZnJlc2hfdG9rZW4pOigoZSx0KT0+e2RlbGV0ZSBvW24oZSx0KV19KShkLHkpLHAucG9zdE1lc3NhZ2Uoe29rOmsub2ssanNvbjpoLGhlYWRlcnM6bH0pfWNhdGNoKGUpe3AucG9zdE1lc3NhZ2Uoe29rOiExLGpzb246e2Vycm9yOmUuZXJyb3IsZXJyb3JfZGVzY3JpcHRpb246ZS5tZXNzYWdlfSxoZWFkZXJzOmx9KX12YXIgTyxiLGcsX30pKX0oKTsKCg==",null,!1),new Worker(ve,i)};const we={};class ft{constructor(e,t){this.cache=e,this.clientId=t,this.manifestKey=this.createManifestKeyFrom(this.clientId)}add(e){var t=this;return(0,f.A)(function*(){var n;const o=new Set((null===(n=yield t.cache.get(t.manifestKey))||void 0===n?void 0:n.keys)||[]);o.add(e),yield t.cache.set(t.manifestKey,{keys:[...o]})})()}remove(e){var t=this;return(0,f.A)(function*(){const n=yield t.cache.get(t.manifestKey);if(n){const o=new Set(n.keys);return o.delete(e),o.size>0?yield t.cache.set(t.manifestKey,{keys:[...o]}):yield t.cache.remove(t.manifestKey)}})()}get(){return this.cache.get(this.manifestKey)}clear(){return this.cache.remove(this.manifestKey)}createManifestKeyFrom(e){return`@@auth0spajs@@::${e}`}}const yt={memory:()=>(new ge).enclosedCache,localstorage:()=>new Ce},Re=i=>yt[i],De=i=>{const{openUrl:e,onRedirect:t}=i,n=x(i,["openUrl","onRedirect"]);return Object.assign(Object.assign({},n),{openUrl:!1===e||e?e:t})},Ue=(i,e)=>{const t=e?.split(" ")||[];return(i?.split(" ")||[]).every(n=>t.includes(n))},N={NONCE:"nonce",KEYPAIR:"keypair"};class gt{constructor(e){this.clientId=e}getVersion(){return 1}createDbHandle(){const e=window.indexedDB.open("auth0-spa-js",this.getVersion());return new Promise((t,n)=>{e.onupgradeneeded=()=>Object.values(N).forEach(o=>e.result.createObjectStore(o)),e.onerror=()=>n(e.error),e.onsuccess=()=>t(e.result)})}getDbHandle(){var e=this;return(0,f.A)(function*(){return e.dbHandle||(e.dbHandle=yield e.createDbHandle()),e.dbHandle})()}executeDbRequest(e,t,n){var o=this;return(0,f.A)(function*(){const r=n((yield o.getDbHandle()).transaction(e,t).objectStore(e));return new Promise((s,c)=>{r.onsuccess=()=>s(r.result),r.onerror=()=>c(r.error)})})()}buildKey(e){return`${this.clientId}::${e?`_${e}`:"auth0"}`}setNonce(e,t){return this.save(N.NONCE,this.buildKey(t),e)}setKeyPair(e){return this.save(N.KEYPAIR,this.buildKey(),e)}save(e,t,n){var o=this;return(0,f.A)(function*(){yield o.executeDbRequest(e,"readwrite",r=>r.put(n,t))})()}findNonce(e){return this.find(N.NONCE,this.buildKey(e))}findKeyPair(){return this.find(N.KEYPAIR,this.buildKey())}find(e,t){return this.executeDbRequest(e,"readonly",n=>n.get(t))}deleteBy(e,t){var n=this;return(0,f.A)(function*(){const o=yield n.executeDbRequest(e,"readonly",r=>r.getAllKeys());o?.filter(t).map(r=>n.executeDbRequest(e,"readwrite",s=>s.delete(r)))})()}deleteByClientId(e,t){return this.deleteBy(e,n=>"string"==typeof n&&n.startsWith(`${t}::`))}clearNonces(){return this.deleteByClientId(N.NONCE,this.clientId)}clearKeyPairs(){return this.deleteByClientId(N.KEYPAIR,this.clientId)}}class vt{constructor(e){this.storage=new gt(e)}getNonce(e){return this.storage.findNonce(e)}setNonce(e,t){return this.storage.setNonce(e,t)}getOrGenerateKeyPair(){var e=this;return(0,f.A)(function*(){let t=yield e.storage.findKeyPair();return t||(t=yield function Be(){return(i=(0,f.A)(function*(e,t){var n;let o;if("string"!=typeof e||0===e.length)throw new TypeError('"alg" must be a non-empty string');switch(e){case"PS256":o={name:"RSA-PSS",hash:"SHA-256",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])};break;case"RS256":o={name:"RSASSA-PKCS1-v1_5",hash:"SHA-256",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])};break;case"ES256":o={name:"ECDSA",namedCurve:"P-256"};break;case"Ed25519":o={name:"Ed25519"};break;default:throw new E}return crypto.subtle.generateKey(o,null!==(n=t?.extractable)&&void 0!==n&&n,["sign","verify"])}),function(e,t){return i.apply(this,arguments)})("ES256",{extractable:!1});var i}(),yield e.storage.setKeyPair(t)),t})()}generateProof(e){var t=this;return(0,f.A)(function*(){const n=yield t.getOrGenerateKeyPair();return function Qe({keyPair:i,url:e,method:t,nonce:n,accessToken:o}){return function Ye(i,e,t,n,o,r){return pe.apply(this,arguments)}(i,function(s){const c=new URL(s);return c.search="",c.hash="",c.href}(e),t,n,o)}(Object.assign({keyPair:n},e))})()}calculateThumbprint(){var e=this;return(0,f.A)(function*(){return function qe(i){return(e=(0,f.A)(function*(t){if(!Te(t))throw new TypeError('"publicKey" must be a public CryptoKey');if(!0!==t.extractable)throw new TypeError('"publicKey.extractable" must be true');const n=yield Pe(t);let o;switch(n.kty){case"EC":o={crv:n.crv,kty:n.kty,x:n.x,y:n.y};break;case"OKP":o={crv:n.crv,kty:n.kty,x:n.x};break;case"RSA":o={e:n.e,kty:n.kty,n:n.n};break;default:throw new E("unsupported JWK kty")}return M(yield crypto.subtle.digest({name:"SHA-256"},F(JSON.stringify(o))))}),function(t){return e.apply(this,arguments)})(i.publicKey);var e}(yield e.getOrGenerateKeyPair())})()}clear(){var e=this;return(0,f.A)(function*(){yield Promise.all([e.storage.clearNonces(),e.storage.clearKeyPairs()])})()}}var H;!function(i){i.Bearer="Bearer",i.DPoP="DPoP"}(H||(H={}));class wt{constructor(e,t){this.hooks=t,this.config=Object.assign(Object.assign({},e),{fetch:e.fetch||(typeof window>"u"?fetch:window.fetch.bind(window))})}isAbsoluteUrl(e){return/^(https?:)?\/\//i.test(e)}buildUrl(e,t){if(t){if(this.isAbsoluteUrl(t))return t;if(e)return`${e.replace(/\/?\/$/,"")}/${t.replace(/^\/+/,"")}`}throw new TypeError("`url` must be absolute or `baseUrl` non-empty.")}getAccessToken(e){return this.config.getAccessToken?this.config.getAccessToken(e):this.hooks.getAccessToken(e)}extractUrl(e){return"string"==typeof e?e:e instanceof URL?e.href:e.url}buildBaseRequest(e,t){if(!this.config.baseUrl)return new Request(e,t);const n=this.buildUrl(this.config.baseUrl,this.extractUrl(e)),o=e instanceof Request?new Request(n,e):n;return new Request(o,t)}setAuthorizationHeader(e,t,n=H.Bearer){e.headers.set("authorization",`${n} ${t}`)}setDpopProofHeader(e,t){var n=this;return(0,f.A)(function*(){if(!n.config.dpopNonceId)return;const o=yield n.hooks.getDpopNonce(),r=yield n.hooks.generateDpopProof({accessToken:t,method:e.method,nonce:o,url:e.url});e.headers.set("dpop",r)})()}prepareRequest(e,t){var n=this;return(0,f.A)(function*(){const o=yield n.getAccessToken(t);let r,s;"string"==typeof o?(r=n.config.dpopNonceId?H.DPoP:H.Bearer,s=o):(r=o.token_type,s=o.access_token),n.setAuthorizationHeader(e,s,r),r===H.DPoP&&(yield n.setDpopProofHeader(e,s))})()}getHeader(e,t){return Array.isArray(e)?new Headers(e).get(t)||"":"function"==typeof e.get?e.get(t)||"":e[t]||""}hasUseDpopNonceError(e){if(401!==e.status)return!1;const t=this.getHeader(e.headers,"www-authenticate");return t.includes("invalid_dpop_nonce")||t.includes("use_dpop_nonce")}handleResponse(e,t){var n=this;return(0,f.A)(function*(){const o=n.getHeader(e.headers,"dpop-nonce");if(o&&(yield n.hooks.setDpopNonce(o)),!n.hasUseDpopNonceError(e))return e;if(!o||!t.onUseDpopNonceError)throw new V(o);return t.onUseDpopNonceError()})()}internalFetchWithAuth(e,t,n,o){var r=this;return(0,f.A)(function*(){const s=r.buildBaseRequest(e,t);yield r.prepareRequest(s,o);const c=yield r.config.fetch(s);return r.handleResponse(c,n)})()}fetchWithAuth(e,t,n){const o={onUseDpopNonceError:()=>this.internalFetchWithAuth(e,t,Object.assign(Object.assign({},o),{onUseDpopNonceError:void 0}),n)};return this.internalFetchWithAuth(e,t,o,n)}}class bt{constructor(e,t){this.myAccountFetcher=e,this.apiBase=t}connectAccount(e){var t=this;return(0,f.A)(function*(){const n=yield t.myAccountFetcher.fetchWithAuth(`${t.apiBase}v1/connected-accounts/connect`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return t._handleResponse(n)})()}completeAccount(e){var t=this;return(0,f.A)(function*(){const n=yield t.myAccountFetcher.fetchWithAuth(`${t.apiBase}v1/connected-accounts/complete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return t._handleResponse(n)})()}_handleResponse(e){return(0,f.A)(function*(){let t;try{t=yield e.text(),t=JSON.parse(t)}catch(n){throw new $({type:"invalid_json",status:e.status,title:"Invalid JSON response",detail:t||String(n)})}if(e.ok)return t;throw new $(t)})()}}class $ extends Error{constructor({type:e,status:t,title:n,detail:o,validation_errors:r}){super(o),this.name="MyAccountApiError",this.type=e,this.status=t,this.title=n,this.detail=o,this.validation_errors=r,Object.setPrototypeOf(this,$.prototype)}}const be=new D;class Le{constructor(e){var t=this;let n,o;if(this.userCache=(new ge).enclosedCache,this.activeLockKeys=new Set,this.defaultOptions={authorizationParams:{scope:"openid profile email"},useRefreshTokensFallback:!1,useFormData:!0},this._releaseLockOnPageHide=(0,f.A)(function*(){const m=Array.from(t.activeLockKeys);for(const a of m)yield be.releaseLock(a);t.activeLockKeys.clear(),window.removeEventListener("pagehide",t._releaseLockOnPageHide)}),this.options=Object.assign(Object.assign(Object.assign({},this.defaultOptions),e),{authorizationParams:Object.assign(Object.assign({},this.defaultOptions.authorizationParams),e.authorizationParams)}),typeof window<"u"&&(()=>{if(!oe())throw new Error("For security reasons, `window.crypto` is required to run `auth0-spa-js`.");if(void 0===oe().subtle)throw new Error("\n      auth0-spa-js must run on a secure origin. See https://github.com/auth0/auth0-spa-js/blob/main/FAQ.md#why-do-i-get-auth0-spa-js-must-run-on-a-secure-origin for more information.\n    ")})(),e.cache&&e.cacheLocation&&console.warn("Both `cache` and `cacheLocation` options have been specified in the Auth0Client configuration; ignoring `cacheLocation` and using `cache`."),e.cache)o=e.cache;else{if(n=e.cacheLocation||"memory",!Re(n))throw new Error(`Invalid cache location "${n}"`);o=Re(n)()}this.httpTimeoutMs=e.httpTimeoutInSeconds?1e3*e.httpTimeoutInSeconds:1e4,this.cookieStorage=!1===e.legacySameSiteCookie?W:dt,this.orgHintCookieName=`auth0.${this.options.clientId}.organization_hint`,this.isAuthenticatedCookieName=(()=>`auth0.${this.options.clientId}.is.authenticated`)(),this.sessionCheckExpiryDays=e.sessionCheckExpiryDays||1;const r=e.useCookiesForTransactions?this.cookieStorage:lt;var s,m,a;this.scope=((m,a,...u)=>{if("object"!=typeof m)return{default:re(a,m,...u)};let l={default:re(a,...u)};return Object.keys(m).forEach(h=>{l[h]=re(a,m[h],...u)}),l})(this.options.authorizationParams.scope,"openid",this.options.useRefreshTokens?"offline_access":""),this.transactionManager=new st(r,this.options.clientId,this.options.cookieDomain),this.nowProvider=this.options.nowProvider||O,this.cacheManager=new it(o,o.allKeys?void 0:new ft(o,this.options.clientId),this.nowProvider),this.dpop=this.options.useDpop?new vt(this.options.clientId):void 0,this.domainUrl=/^https?:\/\//.test(s=this.options.domain)?s:`https://${s}`,this.tokenIssuer=(a=this.domainUrl,(m=this.options.issuer)?m.startsWith("https://")?m:`https://${m}/`:`${a}/`);const c=`${this.domainUrl}/me/`,d=this.createFetcher(Object.assign(Object.assign({},this.options.useDpop&&{dpopNonceId:"__auth0_my_account_api__"}),{getAccessToken:()=>this.getTokenSilently({authorizationParams:{scope:"create:me:connected_accounts",audience:c},detailedResponse:!0})}));this.myAccountApi=new bt(d,c),typeof window<"u"&&window.Worker&&this.options.useRefreshTokens&&"memory"===n&&(this.worker=this.options.workerUrl?new Worker(this.options.workerUrl):new mt)}_url(e){const t=encodeURIComponent(btoa(JSON.stringify(this.options.auth0Client||P)));return`${this.domainUrl}${e}&auth0Client=${t}`}_authorizeUrl(e){return this._url(`/authorize?${de(e)}`)}_verifyIdToken(e,t,n){var o=this;return(0,f.A)(function*(){const r=yield o.nowProvider();return(i=>{if(!i.id_token)throw new Error("ID token is required but missing");const e=(r=>{const s=r.split("."),[c,d,m]=s;if(3!==s.length||!c||!d||!m)throw new Error("ID token could not be decoded");const a=JSON.parse(Se(d)),u={__raw:r},l={};return Object.keys(a).forEach(h=>{u[h]=a[h],at.includes(h)||(l[h]=a[h])}),{encoded:{header:c,payload:d,signature:m},header:JSON.parse(Se(c)),claims:u,user:l}})(i.id_token);if(!e.claims.iss)throw new Error("Issuer (iss) claim must be a string present in the ID token");if(e.claims.iss!==i.iss)throw new Error(`Issuer (iss) claim mismatch in the ID token; expected "${i.iss}", found "${e.claims.iss}"`);if(!e.user.sub)throw new Error("Subject (sub) claim must be a string present in the ID token");if("RS256"!==e.header.alg)throw new Error(`Signature algorithm of "${e.header.alg}" is not supported. Expected the ID token to be signed with "RS256".`);if(!e.claims.aud||"string"!=typeof e.claims.aud&&!Array.isArray(e.claims.aud))throw new Error("Audience (aud) claim must be a string or array of strings present in the ID token");if(Array.isArray(e.claims.aud)){if(!e.claims.aud.includes(i.aud))throw new Error(`Audience (aud) claim mismatch in the ID token; expected "${i.aud}" but was not one of "${e.claims.aud.join(", ")}"`);if(e.claims.aud.length>1){if(!e.claims.azp)throw new Error("Authorized Party (azp) claim must be a string present in the ID token when Audience (aud) claim has multiple values");if(e.claims.azp!==i.aud)throw new Error(`Authorized Party (azp) claim mismatch in the ID token; expected "${i.aud}", found "${e.claims.azp}"`)}}else if(e.claims.aud!==i.aud)throw new Error(`Audience (aud) claim mismatch in the ID token; expected "${i.aud}" but found "${e.claims.aud}"`);if(i.nonce){if(!e.claims.nonce)throw new Error("Nonce (nonce) claim must be a string present in the ID token");if(e.claims.nonce!==i.nonce)throw new Error(`Nonce (nonce) claim mismatch in the ID token; expected "${i.nonce}", found "${e.claims.nonce}"`)}if(i.max_age&&!Y(e.claims.auth_time))throw new Error("Authentication Time (auth_time) claim must be a number present in the ID token when Max Age (max_age) is specified");if(null==e.claims.exp||!Y(e.claims.exp))throw new Error("Expiration Time (exp) claim must be a number present in the ID token");if(!Y(e.claims.iat))throw new Error("Issued At (iat) claim must be a number present in the ID token");const t=i.leeway||60,n=new Date(i.now||Date.now()),o=new Date(0);if(o.setUTCSeconds(e.claims.exp+t),n>o)throw new Error(`Expiration Time (exp) claim error in the ID token; current time (${n}) is after expiration time (${o})`);if(null!=e.claims.nbf&&Y(e.claims.nbf)){const r=new Date(0);if(r.setUTCSeconds(e.claims.nbf-t),n<r)throw new Error(`Not Before time (nbf) claim in the ID token indicates that this token can't be used just yet. Current time (${n}) is before ${r}`)}if(null!=e.claims.auth_time&&Y(e.claims.auth_time)){const r=new Date(0);if(r.setUTCSeconds(parseInt(e.claims.auth_time)+i.max_age+t),n>r)throw new Error(`Authentication Time (auth_time) claim in the ID token indicates that too much time has passed since the last end-user authentication. Current time (${n}) is after last auth at ${r}`)}if(i.organization){const r=i.organization.trim();if(r.startsWith("org_")){const s=r;if(!e.claims.org_id)throw new Error("Organization ID (org_id) claim must be a string present in the ID token");if(s!==e.claims.org_id)throw new Error(`Organization ID (org_id) claim mismatch in the ID token; expected "${s}", found "${e.claims.org_id}"`)}else{const s=r.toLowerCase();if(!e.claims.org_name)throw new Error("Organization Name (org_name) claim must be a string present in the ID token");if(s!==e.claims.org_name)throw new Error(`Organization Name (org_name) claim mismatch in the ID token; expected "${s}", found "${e.claims.org_name}"`)}}return e})({iss:o.tokenIssuer,aud:o.options.clientId,id_token:e,nonce:t,organization:n,leeway:o.options.leeway,max_age:(s=o.options.authorizationParams.max_age,"string"!=typeof s?s:parseInt(s,10)||void 0),now:r});var s})()}_processOrgHint(e){e?this.cookieStorage.save(this.orgHintCookieName,e,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}):this.cookieStorage.remove(this.orgHintCookieName,{cookieDomain:this.options.cookieDomain})}_prepareAuthorizeUrl(e,t,n){var o=this;return(0,f.A)(function*(){var r;const s=ue(G()),c=ue(G()),d=G(),m=yield ke(d),a=Ie(m),u=yield null===(r=o.dpop)||void 0===r?void 0:r.calculateThumbprint(),l=(p=o.options,v=o.scope,y=e,b=s,k=c,w=a,g=e.redirect_uri||o.options.authorizationParams.redirect_uri||n,S=t?.response_mode,se=u,Object.assign(Object.assign(Object.assign({client_id:p.clientId},p.authorizationParams),y),{scope:ie(v,y.scope,y.audience),response_type:"code",response_mode:S||"query",state:b,nonce:k,redirect_uri:g||p.authorizationParams.redirect_uri,code_challenge:w,code_challenge_method:"S256",dpop_jkt:se})),h=o._authorizeUrl(l);var p,v,y,b,k,w,g,S,se;return{nonce:c,code_verifier:d,scope:l.scope,audience:l.audience||"default",redirect_uri:l.redirect_uri,state:s,url:h}})()}loginWithPopup(e,t){var n=this;return(0,f.A)(function*(){var o;if(e=e||{},!(t=t||{}).popup&&(t.popup=(()=>{const m=window.screenX+(window.innerWidth-400)/2,a=window.screenY+(window.innerHeight-600)/2;return window.open("","auth0:authorize:popup",`left=${m},top=${a},width=400,height=600,resizable,scrollbars=yes,status=1`)})(),!t.popup))throw new Error("Unable to open a popup for loginWithPopup - window.open returned `null`");const r=yield n._prepareAuthorizeUrl(e.authorizationParams||{},{response_mode:"web_message"},window.location.origin);t.popup.location.href=r.url;const s=yield(d=Object.assign(Object.assign({},t),{timeoutInSeconds:t.timeoutInSeconds||n.options.authorizeTimeoutInSeconds||60}),new Promise((m,a)=>{let u;const l=setInterval(()=>{d.popup&&d.popup.closed&&(clearInterval(l),clearTimeout(h),window.removeEventListener("message",u,!1),a(new ee(d.popup)))},1e3),h=setTimeout(()=>{clearInterval(l),a(new Q(d.popup)),window.removeEventListener("message",u,!1)},1e3*(d.timeoutInSeconds||60));u=function(p){if(p.data&&"authorization_response"===p.data.type){if(clearTimeout(h),clearInterval(l),window.removeEventListener("message",u,!1),d.popup.close(),p.data.response.error)return a(_.fromPayload(p.data.response));m(p.data.response)}},window.addEventListener("message",u)}));var d;if(r.state!==s.state)throw new _("state_mismatch","Invalid state");const c=(null===(o=e.authorizationParams)||void 0===o?void 0:o.organization)||n.options.authorizationParams.organization;yield n._requestToken({audience:r.audience,scope:r.scope,code_verifier:r.code_verifier,grant_type:"authorization_code",code:s.code,redirect_uri:r.redirect_uri},{nonceIn:r.nonce,organization:c})})()}getUser(){var e=this;return(0,f.A)(function*(){var t;const n=yield e._getIdTokenFromCache();return null===(t=n?.decodedToken)||void 0===t?void 0:t.user})()}getIdTokenClaims(){var e=this;return(0,f.A)(function*(){var t;const n=yield e._getIdTokenFromCache();return null===(t=n?.decodedToken)||void 0===t?void 0:t.claims})()}loginWithRedirect(){var e=this;return(0,f.A)(function*(t={}){var n;const o=De(t),{openUrl:r,fragment:s,appState:c}=o,d=x(o,["openUrl","fragment","appState"]),m=(null===(n=d.authorizationParams)||void 0===n?void 0:n.organization)||e.options.authorizationParams.organization,a=yield e._prepareAuthorizeUrl(d.authorizationParams||{}),{url:u}=a,l=x(a,["url"]);e.transactionManager.create(Object.assign(Object.assign(Object.assign({},l),{appState:c,response_type:C.Code}),m&&{organization:m}));const h=s?`${u}#${s}`:u;r?yield r(h):window.location.assign(h)}).apply(this,arguments)}handleRedirectCallback(){var e=this;return(0,f.A)(function*(t=window.location.href){const n=t.split("?").slice(1);if(0===n.length)throw new Error("There are no query params available for parsing.");const o=e.transactionManager.get();if(!o)throw new _("missing_transaction","Invalid state");e.transactionManager.remove();const r=(s=>{s.indexOf("#")>-1&&(s=s.substring(0,s.indexOf("#")));const c=new URLSearchParams(s);return{state:c.get("state"),code:c.get("code")||void 0,connect_code:c.get("connect_code")||void 0,error:c.get("error")||void 0,error_description:c.get("error_description")||void 0}})(n.join(""));return o.response_type===C.ConnectCode?e._handleConnectAccountRedirectCallback(r,o):e._handleLoginRedirectCallback(r,o)}).apply(this,arguments)}_handleLoginRedirectCallback(e,t){var n=this;return(0,f.A)(function*(){const{code:o,state:r,error:s,error_description:c}=e;if(s)throw new L(s,c||s,r,t.appState);if(!t.code_verifier||t.state&&t.state!==r)throw new _("state_mismatch","Invalid state");const d=t.organization,m=t.nonce,a=t.redirect_uri;return yield n._requestToken(Object.assign({audience:t.audience,scope:t.scope,code_verifier:t.code_verifier,grant_type:"authorization_code",code:o},a?{redirect_uri:a}:{}),{nonceIn:m,organization:d}),{appState:t.appState,response_type:C.Code}})()}_handleConnectAccountRedirectCallback(e,t){var n=this;return(0,f.A)(function*(){const{connect_code:o,state:r,error:s,error_description:c}=e;if(s)throw new q(s,c||s,t.connection,r,t.appState);if(!o)throw new _("missing_connect_code","Missing connect code");if(!(t.code_verifier&&t.state&&t.auth_session&&t.redirect_uri&&t.state===r))throw new _("state_mismatch","Invalid state");const d=yield n.myAccountApi.completeAccount({auth_session:t.auth_session,connect_code:o,redirect_uri:t.redirect_uri,code_verifier:t.code_verifier});return Object.assign(Object.assign({},d),{appState:t.appState,response_type:C.ConnectCode})})()}checkSession(e){var t=this;return(0,f.A)(function*(){if(!t.cookieStorage.get(t.isAuthenticatedCookieName)){if(!t.cookieStorage.get("auth0.is.authenticated"))return;t.cookieStorage.save(t.isAuthenticatedCookieName,!0,{daysUntilExpire:t.sessionCheckExpiryDays,cookieDomain:t.options.cookieDomain}),t.cookieStorage.remove("auth0.is.authenticated")}try{yield t.getTokenSilently(e)}catch{}})()}getTokenSilently(){var e=this;return(0,f.A)(function*(t={}){var n,o;const r=Object.assign(Object.assign({cacheMode:"on"},t),{authorizationParams:Object.assign(Object.assign(Object.assign({},e.options.authorizationParams),t.authorizationParams),{scope:ie(e.scope,null===(n=t.authorizationParams)||void 0===n?void 0:n.scope,(null===(o=t.authorizationParams)||void 0===o?void 0:o.audience)||e.options.authorizationParams.audience)})}),s=yield((c,d)=>{let m=we[d];return m||(m=e._getTokenSilently(r).finally(()=>{delete we[d],m=null}),we[d]=m),m})(0,`${e.options.clientId}::${r.authorizationParams.audience}::${r.authorizationParams.scope}`);return t.detailedResponse?s:s?.access_token}).apply(this,arguments)}_getTokenSilently(e){var t=this;return(0,f.A)(function*(){const{cacheMode:n}=e,o=x(e,["cacheMode"]);if("off"!==n){const d=yield t._getEntryFromCache({scope:o.authorizationParams.scope,audience:o.authorizationParams.audience||"default",clientId:t.options.clientId,cacheMode:n});if(d)return d}if("cache-only"===n)return;const r=`auth0.lock.getTokenSilently.${t.options.clientId}.${o.authorizationParams.audience||"default"}`;var d;if(!(yield(d=(0,f.A)(function*(m,a=3){for(let u=0;u<a;u++)if(yield m())return!0;return!1}),function(m){return d.apply(this,arguments)})(()=>be.acquireLock(r,5e3),10)))throw new Z;t.activeLockKeys.add(r),1===t.activeLockKeys.size&&window.addEventListener("pagehide",t._releaseLockOnPageHide);try{if("off"!==n){const p=yield t._getEntryFromCache({scope:o.authorizationParams.scope,audience:o.authorizationParams.audience||"default",clientId:t.options.clientId});if(p)return p}const d=t.options.useRefreshTokens?yield t._getTokenUsingRefreshToken(o):yield t._getTokenFromIFrame(o),{id_token:m,token_type:a,access_token:u,oauthTokenScope:l,expires_in:h}=d;return Object.assign(Object.assign({id_token:m,token_type:a,access_token:u},l?{scope:l}:null),{expires_in:h})}finally{yield be.releaseLock(r),t.activeLockKeys.delete(r),0===t.activeLockKeys.size&&window.removeEventListener("pagehide",t._releaseLockOnPageHide)}})()}getTokenWithPopup(){var e=this;return(0,f.A)(function*(t={},n={}){var o,r;const s=Object.assign(Object.assign({},t),{authorizationParams:Object.assign(Object.assign(Object.assign({},e.options.authorizationParams),t.authorizationParams),{scope:ie(e.scope,null===(o=t.authorizationParams)||void 0===o?void 0:o.scope,(null===(r=t.authorizationParams)||void 0===r?void 0:r.audience)||e.options.authorizationParams.audience)})});return n=Object.assign(Object.assign({},U),n),yield e.loginWithPopup(s,n),(yield e.cacheManager.get(new I({scope:s.authorizationParams.scope,audience:s.authorizationParams.audience||"default",clientId:e.options.clientId}),void 0,e.options.useMrrt)).access_token}).apply(this,arguments)}isAuthenticated(){var e=this;return(0,f.A)(function*(){return!!(yield e.getUser())})()}_buildLogoutUrl(e){null!==e.clientId?e.clientId=e.clientId||this.options.clientId:delete e.clientId;const t=e.logoutParams||{},{federated:n}=t,o=x(t,["federated"]),r=n?"&federated":"";return this._url(`/v2/logout?${de(Object.assign({clientId:e.clientId},o))}`)+r}logout(){var e=this;return(0,f.A)(function*(t={}){var n;const o=De(t),{openUrl:r}=o,s=x(o,["openUrl"]);null===t.clientId?yield e.cacheManager.clear():yield e.cacheManager.clear(t.clientId||e.options.clientId),e.cookieStorage.remove(e.orgHintCookieName,{cookieDomain:e.options.cookieDomain}),e.cookieStorage.remove(e.isAuthenticatedCookieName,{cookieDomain:e.options.cookieDomain}),e.userCache.remove("@@user@@"),yield null===(n=e.dpop)||void 0===n?void 0:n.clear();const c=e._buildLogoutUrl(s);r?yield r(c):!1!==r&&window.location.assign(c)}).apply(this,arguments)}_getTokenFromIFrame(e){var t=this;return(0,f.A)(function*(){const n=Object.assign(Object.assign({},e.authorizationParams),{prompt:"none"}),o=t.cookieStorage.get(t.orgHintCookieName);o&&!n.organization&&(n.organization=o);const{url:r,state:s,nonce:c,code_verifier:d,redirect_uri:m,scope:a,audience:u}=yield t._prepareAuthorizeUrl(n,{response_mode:"web_message"},window.location.origin);try{if(window.crossOriginIsolated)throw new _("login_required","The application is running in a Cross-Origin Isolated context, silently retrieving a token without refresh token is not possible.");const l=e.timeoutInSeconds||t.options.authorizeTimeoutInSeconds;let h;try{h=new URL(t.domainUrl).origin}catch{h=t.domainUrl}const p=yield((y,b,k=60)=>new Promise((w,g)=>{const S=window.document.createElement("iframe");S.setAttribute("width","0"),S.setAttribute("height","0"),S.style.display="none";const se=()=>{window.document.body.contains(S)&&(window.document.body.removeChild(S),window.removeEventListener("message",ae,!1))};let ae;const kt=setTimeout(()=>{g(new Z),se()},1e3*k);ae=function(R){if(R.origin!=b||!R.data||"authorization_response"!==R.data.type)return;const Ze=R.source;Ze&&Ze.close(),R.data.response.error?g(_.fromPayload(R.data.response)):w(R.data.response),clearTimeout(kt),window.removeEventListener("message",ae,!1),setTimeout(se,2e3)},window.addEventListener("message",ae,!1),window.document.body.appendChild(S),S.setAttribute("src",y)}))(r,h,l);if(s!==p.state)throw new _("state_mismatch","Invalid state");const v=yield t._requestToken(Object.assign(Object.assign({},e.authorizationParams),{code_verifier:d,code:p.code,grant_type:"authorization_code",redirect_uri:m,timeout:e.authorizationParams.timeout||t.httpTimeoutMs}),{nonceIn:c,organization:n.organization});return Object.assign(Object.assign({},v),{scope:a,oauthTokenScope:v.scope,audience:u})}catch(l){throw"login_required"===l.error&&t.logout({openUrl:!1}),l}})()}_getTokenUsingRefreshToken(e){var t=this;return(0,f.A)(function*(){const n=yield t.cacheManager.get(new I({scope:e.authorizationParams.scope,audience:e.authorizationParams.audience||"default",clientId:t.options.clientId}),void 0,t.options.useMrrt);if(!(n&&n.refresh_token||t.worker)){if(t.options.useRefreshTokensFallback)return yield t._getTokenFromIFrame(e);throw new X(e.authorizationParams.audience||"default",e.authorizationParams.scope)}const o=e.authorizationParams.redirect_uri||t.options.authorizationParams.redirect_uri||window.location.origin,r="number"==typeof e.timeoutInSeconds?1e3*e.timeoutInSeconds:null,s=((u,l,h,p)=>{var v;if(u&&h&&p){if(l.audience!==h)return l.scope;const y=p.split(" "),b=(null===(v=l.scope)||void 0===v?void 0:v.split(" "))||[],k=b.every(w=>y.includes(w));return y.length>=b.length&&k?p:l.scope}return l.scope})(t.options.useMrrt,e.authorizationParams,n?.audience,n?.scope);try{const u=yield t._requestToken(Object.assign(Object.assign(Object.assign({},e.authorizationParams),{grant_type:"refresh_token",refresh_token:n&&n.refresh_token,redirect_uri:o}),r&&{timeout:r}),{scopesToRequest:s});if(u.refresh_token&&t.options.useMrrt&&n?.refresh_token&&(yield t.cacheManager.updateEntry(n.refresh_token,u.refresh_token)),t.options.useMrrt&&(c=n?.audience,d=n?.scope,!(c===e.authorizationParams.audience&&Ue(e.authorizationParams.scope,d)||Ue(s,u.scope)))){if(t.options.useRefreshTokensFallback)return yield t._getTokenFromIFrame(e);yield t.cacheManager.remove(t.options.clientId,e.authorizationParams.audience,e.authorizationParams.scope);const l=((h,p)=>{const v=h?.split(" ")||[],y=p?.split(" ")||[];return v.filter(b=>-1==y.indexOf(b)).join(",")})(s,u.scope);throw new ce(e.authorizationParams.audience||"default",l)}return Object.assign(Object.assign({},u),{scope:e.authorizationParams.scope,oauthTokenScope:u.scope,audience:e.authorizationParams.audience||"default"})}catch(u){if((u.message.indexOf("Missing Refresh Token")>-1||u.message&&u.message.indexOf("invalid refresh token")>-1)&&t.options.useRefreshTokensFallback)return yield t._getTokenFromIFrame(e);throw u}var c,d})()}_saveEntryInCache(e){var t=this;return(0,f.A)(function*(){const{id_token:n,decodedToken:o}=e,r=x(e,["id_token","decodedToken"]);t.userCache.set("@@user@@",{id_token:n,decodedToken:o}),yield t.cacheManager.setIdToken(t.options.clientId,e.id_token,e.decodedToken),yield t.cacheManager.set(r)})()}_getIdTokenFromCache(){var e=this;return(0,f.A)(function*(){const t=e.options.authorizationParams.audience||"default",n=e.scope[t],o=yield e.cacheManager.getIdToken(new I({clientId:e.options.clientId,audience:t,scope:n})),r=e.userCache.get("@@user@@");return o&&o.id_token===r?.id_token?r:(e.userCache.set("@@user@@",o),o)})()}_getEntryFromCache(e){var t=this;return(0,f.A)(function*({scope:n,audience:o,clientId:r,cacheMode:s}){const c=yield t.cacheManager.get(new I({scope:n,audience:o,clientId:r}),60,t.options.useMrrt,s);if(c&&c.access_token){const{token_type:d,access_token:m,oauthTokenScope:a,expires_in:u}=c,l=yield t._getIdTokenFromCache();return l&&Object.assign(Object.assign({id_token:l.id_token,token_type:d||"Bearer",access_token:m},a?{scope:a}:null),{expires_in:u})}}).apply(this,arguments)}_requestToken(e,t){var n=this;return(0,f.A)(function*(){const{nonceIn:o,organization:r,scopesToRequest:s}=t||{},c=yield function rt(i,e){return ye.apply(this,arguments)}(Object.assign(Object.assign({baseUrl:n.domainUrl,client_id:n.options.clientId,auth0Client:n.options.auth0Client,useFormData:n.options.useFormData,timeout:n.httpTimeoutMs,useMrrt:n.options.useMrrt,dpop:n.dpop},e),{scope:s||e.scope}),n.worker),d=yield n._verifyIdToken(c.id_token,o,r);return yield n._saveEntryInCache(Object.assign(Object.assign(Object.assign(Object.assign({},c),{decodedToken:d,scope:e.scope,audience:e.audience||"default"}),c.scope?{oauthTokenScope:c.scope}:null),{client_id:n.options.clientId})),n.cookieStorage.save(n.isAuthenticatedCookieName,!0,{daysUntilExpire:n.sessionCheckExpiryDays,cookieDomain:n.options.cookieDomain}),n._processOrgHint(r||d.claims.org_id),Object.assign(Object.assign({},c),{decodedToken:d})})()}exchangeToken(e){var t=this;return(0,f.A)(function*(){return t._requestToken({grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:e.subject_token,subject_token_type:e.subject_token_type,scope:ie(t.scope,e.scope,e.audience||t.options.authorizationParams.audience),audience:e.audience||t.options.authorizationParams.audience})})()}_assertDpop(e){if(!e)throw new Error("`useDpop` option must be enabled before using DPoP.")}getDpopNonce(e){return this._assertDpop(this.dpop),this.dpop.getNonce(e)}setDpopNonce(e,t){return this._assertDpop(this.dpop),this.dpop.setNonce(e,t)}generateDpopProof(e){return this._assertDpop(this.dpop),this.dpop.generateProof(e)}createFetcher(e={}){return new wt(e,{isDpopEnabled:()=>!!this.options.useDpop,getAccessToken:t=>{var n;return this.getTokenSilently({authorizationParams:{scope:null===(n=t?.scope)||void 0===n?void 0:n.join(" "),audience:t?.audience},detailedResponse:!0})},getDpopNonce:()=>this.getDpopNonce(e.dpopNonceId),setDpopNonce:t=>this.setDpopNonce(t,e.dpopNonceId),generateDpopProof:t=>this.generateDpopProof(t)})}connectAccountWithRedirect(e){var t=this;return(0,f.A)(function*(){const{openUrl:n,appState:o,connection:r,authorization_params:s,redirectUri:c=t.options.authorizationParams.redirect_uri||window.location.origin}=e;if(!r)throw new Error("connection is required");const d=ue(G()),m=G(),a=yield ke(m),u=Ie(a),{connect_uri:l,connect_params:h,auth_session:p}=yield t.myAccountApi.connectAccount({connection:r,redirect_uri:c,state:d,code_challenge:u,code_challenge_method:"S256",authorization_params:s});t.transactionManager.create({state:d,code_verifier:m,auth_session:p,redirect_uri:c,appState:o,connection:r,response_type:C.ConnectCode});const v=new URL(l);v.searchParams.set("ticket",h.ticket),n?yield n(v.toString()):window.location.assign(v)})()}}function _t(i){return _e.apply(this,arguments)}function _e(){return _e=(0,f.A)(function*(i){const e=new Le(i);return yield e.checkSession(),e}),_e.apply(this,arguments)}},467:(We,B,J)=>{function f(T,j,K,A,D,U,P){try{var O=T[U](P),_=O.value}catch(L){return void K(L)}O.done?j(_):Promise.resolve(_).then(A,D)}function x(T){return function(){var j=this,K=arguments;return new Promise(function(A,D){var U=T.apply(j,K);function P(_){f(U,A,D,P,O,"next",_)}function O(_){f(U,A,D,P,O,"throw",_)}P(void 0)})}}J.d(B,{A:()=>x})}}]);