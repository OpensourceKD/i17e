(self.webpackChunkshell=self.webpackChunkshell||[]).push([[883],{883:(Z,M,s)=>{s.r(M),s.d(M,{bootstrap:()=>K});var O=s(4077),m=s(467),d=s(2130),p=s(5070),u=s(2176),f=s(5883),_=s(7412),e=s(4304),i=s(3532),v=s(7753);function w(r,c){if(1&r&&(e.\u0275\u0275elementStart(0,"span",10),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&r){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t.getOrganizationName()," ")}}function A(r,c){if(1&r&&(e.\u0275\u0275elementStart(0,"option",16),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&r){const t=c.$implicit;e.\u0275\u0275property("value",t.id),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t.name)}}function I(r,c){if(1&r){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",11)(1,"div",12)(2,"label",13),e.\u0275\u0275text(3,"View data for:"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"span",14),e.\u0275\u0275text(5," Selecting a user will display their incentive data. "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"select",15),e.\u0275\u0275twoWayListener("ngModelChange",function(o){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275twoWayBindingSet(a.selectedSalesExecutiveId,o)||(a.selectedSalesExecutiveId=o),e.\u0275\u0275resetView(o)}),e.\u0275\u0275listener("change",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.onSalesExecutiveChange())}),e.\u0275\u0275elementStart(7,"option",16),e.\u0275\u0275text(8,"My Data"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(9,A,2,2,"option",17),e.\u0275\u0275elementEnd()()()}if(2&r){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(6),e.\u0275\u0275twoWayProperty("ngModel",t.selectedSalesExecutiveId),e.\u0275\u0275advance(),e.\u0275\u0275property("value",t.currentUser.id),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",t.salesExecutives)}}function k(r,c){if(1&r&&(e.\u0275\u0275elementStart(0,"span",18),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&r){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate2(" ",t.currentUser.name," (",t.currentUser.role,") ")}}function U(r,c){if(1&r){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",19),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.logout())}),e.\u0275\u0275text(1,"Logout"),e.\u0275\u0275elementEnd()}}function F(r,c){if(1&r){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",20),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.login())}),e.\u0275\u0275text(1,"Login"),e.\u0275\u0275elementEnd()}}function R(r,c){if(1&r&&(e.\u0275\u0275elementStart(0,"a",23),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&r){const t=c.$implicit;e.\u0275\u0275property("routerLink","/"+t.route),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t.displayName," ")}}function j(r,c){if(1&r&&(e.\u0275\u0275elementStart(0,"nav",21),e.\u0275\u0275template(1,R,2,2,"a",22),e.\u0275\u0275elementEnd()),2&r){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",t.availableMfes)}}let T=(()=>{class r{constructor(t,n,o,a,l,g){this.roleService=t,this.dummyDataService=n,this.mfeLoader=o,this.auth=a,this.userProfileService=l,this.router=g,this.currentUser=null,this.userProfile=null,this.availableMfes=[],this.salesExecutives=[],this.selectedSalesExecutiveId="",this.canViewOthers=!1,this.subscriptions=new f.Subscription}ngOnInit(){this.syncAuthenticatedUser(),this.subscribeToUserChanges(),this.subscribeToProfileChanges()}ngOnDestroy(){this.subscriptions.unsubscribe()}syncAuthenticatedUser(){const t=this.auth.isAuthenticatedSync(),n=this.auth.getUser(),o=this.roleService.getCurrentUser();t&&n&&this.shouldUpdateUser(o,n)&&this.roleService.setUserFromAuth(n),t&&this.fetchUserProfile()}fetchUserProfile(){const t=this.userProfileService.fetchUserProfile().subscribe({next:n=>{n&&this.roleService.setUserFromProfile(n)},error:n=>{console.error("[HeaderComponent] Error fetching user profile:",n)}});this.subscriptions.add(t)}shouldUpdateUser(t,n){return!t||t.id!==n.sub}subscribeToUserChanges(){const t=this.roleService.currentUser$.subscribe(n=>{this.currentUser=n,this.updateComponentState(n)});this.subscriptions.add(t)}subscribeToProfileChanges(){const t=this.userProfileService.profile$.subscribe(n=>{this.userProfile=n});this.subscriptions.add(t)}updateComponentState(t){t?(this.selectedSalesExecutiveId=t.id,this.canViewOthers=this.roleService.canViewOthersData(),this.updateAvailableMfes(),this.loadSalesExecutives()):this.resetComponentState()}resetComponentState(){this.availableMfes=[],this.salesExecutives=[],this.canViewOthers=!1,this.userProfile=null}updateAvailableMfes(){this.availableMfes=this.currentUser?this.mfeLoader.getConfigsForRole(this.currentUser.role):[]}loadSalesExecutives(){this.salesExecutives=this.canViewOthers?this.dummyDataService.getSalesExecutives():[]}onSalesExecutiveChange(){this.persistSelectedExecutive(this.selectedSalesExecutiveId),this.notifyExecutiveChange(this.selectedSalesExecutiveId)}persistSelectedExecutive(t){sessionStorage.setItem("selected_sales_executive_id",t)}notifyExecutiveChange(t){window.dispatchEvent(new CustomEvent("salesExecutiveChanged",{detail:{salesExecutiveId:t}}))}logout(){this.auth.logout(),this.roleService.setCurrentUser(null),this.userProfileService.clearProfile()}login(){const n=this.router.parseUrl(this.router.url).queryParams,o=n.invitation,a=n.organization;o&&a?this.auth.login(void 0,{invitation:o,organization:a}):this.auth.login()}getOrganizationName(){return this.userProfile?.organizations?.length?this.userProfile.organizations[0].displayName:""}static{this.\u0275fac=function(n){return new(n||r)(e.\u0275\u0275directiveInject(i.RoleService),e.\u0275\u0275directiveInject(i.DummyDataService),e.\u0275\u0275directiveInject(i.MfeLoaderService),e.\u0275\u0275directiveInject(v.AuthService),e.\u0275\u0275directiveInject(i.UserProfileService),e.\u0275\u0275directiveInject(d.Router))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["app-header"]],standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:11,vars:6,consts:[[1,"app-header"],[1,"header-left"],[1,"app-title"],["class","org-display",4,"ngIf"],["class","header-center",4,"ngIf"],[1,"header-right"],["class","user-info",4,"ngIf"],["class","btn-logout",3,"click",4,"ngIf"],["class","btn-login",3,"click",4,"ngIf"],["class","app-nav",4,"ngIf"],[1,"org-display"],[1,"header-center"],[1,"user-selector"],["for","salesExecSelect"],["id","salesExecSelectDesc",1,"visually-hidden"],["id","salesExecSelect","aria-describedby","salesExecSelectDesc",3,"ngModelChange","change","ngModel"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"user-info"],[1,"btn-logout",3,"click"],[1,"btn-login",3,"click"],[1,"app-nav"],["routerLinkActive","active","class","nav-link",3,"routerLink",4,"ngFor","ngForOf"],["routerLinkActive","active",1,"nav-link",3,"routerLink"]],template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"header",0)(1,"div",1)(2,"h1",2),e.\u0275\u0275text(3,"Incentive Management System"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(4,w,2,1,"span",3),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(5,I,10,3,"div",4),e.\u0275\u0275elementStart(6,"div",5),e.\u0275\u0275template(7,k,2,2,"span",6)(8,U,2,0,"button",7)(9,F,2,0,"button",8),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(10,j,2,1,"nav",9)),2&n&&(e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",o.currentUser&&o.getOrganizationName()),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.currentUser&&o.canViewOthers),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",o.currentUser),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.currentUser),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!o.currentUser),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.currentUser))},dependencies:[p.CommonModule,p.NgForOf,p.NgIf,u.FormsModule,u.NgSelectOption,u.\u0275NgSelectMultipleOption,u.SelectControlValueAccessor,u.NgControlStatus,u.NgModel,d.RouterLink,d.RouterLinkActive],styles:[".app-header[_ngcontent-%COMP%]{background:#fff;padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 8px #0000001a}.header-left[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:.25rem}.app-title[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;color:var(--gray-900);font-weight:600}.org-display[_ngcontent-%COMP%]{font-size:.875rem;color:var(--bright-blue);font-weight:600;text-transform:uppercase}.header-center[_ngcontent-%COMP%]{flex:2;display:flex;justify-content:center}.user-selector[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.user-selector[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;color:var(--gray-700);font-weight:500}.user-selector[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:.5rem 1rem;border:1px solid var(--gray-400);border-radius:.375rem;font-size:.875rem;background:#fff;cursor:pointer;min-width:200px}.visually-hidden[_ngcontent-%COMP%]{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.header-right[_ngcontent-%COMP%]{flex:1;display:flex;justify-content:flex-end;align-items:center;gap:1rem}.user-info[_ngcontent-%COMP%]{color:var(--gray-700);font-size:.875rem;font-weight:500}.btn-logout[_ngcontent-%COMP%], .btn-login[_ngcontent-%COMP%]{background:var(--hot-red);color:#fff;border:none;padding:.5rem 1.5rem;border-radius:.375rem;font-size:.875rem;font-weight:500;cursor:pointer;transition:background .2s ease}.btn-logout[_ngcontent-%COMP%]:hover, .btn-login[_ngcontent-%COMP%]:hover{background:var(--orange-red)}.btn-login[_ngcontent-%COMP%]{background:var(--bright-blue)}.btn-login[_ngcontent-%COMP%]:hover{background:var(--electric-violet)}.app-nav[_ngcontent-%COMP%]{background:var(--gray-900);padding:0;display:flex;gap:0}.nav-link[_ngcontent-%COMP%]{color:#fff;text-decoration:none;padding:1rem 1.5rem;font-size:.875rem;font-weight:500;transition:background .2s ease;border-bottom:3px solid transparent}.nav-link[_ngcontent-%COMP%]:hover{background:var(--gray-700)}.nav-link.active[_ngcontent-%COMP%]{background:var(--bright-blue);border-bottom-color:var(--electric-violet)}"]})}}return r})(),z=(()=>{class r{constructor(){this.currentYear=(new Date).getFullYear()}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["app-footer"]],standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:3,vars:1,consts:[[1,"app-footer"],[1,"copyright"]],template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"footer",0)(1,"p",1),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()()),2&n&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("\xa9 ",o.currentYear," Incentive Management System. All rights reserved."))},styles:[".app-footer[_ngcontent-%COMP%]{background:var(--gray-900);color:#fff;padding:1rem 2rem;margin-top:auto;text-align:center}.app-footer[_ngcontent-%COMP%]   .copyright[_ngcontent-%COMP%]{margin:0;font-size:.875rem}"]})}}return r})(),D=(()=>{class r{constructor(t,n,o,a,l){this.auth=t,this.roleService=n,this.mfeLoader=o,this.router=a,this.route=l,this.title="Incentive Management System",this.subscriptions=new f.Subscription,this.mfeLoader.setConfigs(_.RG)}ngOnInit(){var t=this;return(0,m.A)(function*(){yield t.handleOrganizationInvitation(),yield t.syncAuthenticatedUser()})()}ngOnDestroy(){this.subscriptions.unsubscribe()}syncAuthenticatedUser(){var t=this;return(0,m.A)(function*(){const n=yield t.auth.isAuthenticated(),o=t.auth.getUser(),a=t.roleService.getCurrentUser();n&&o&&t.shouldUpdateUser(a,o)&&(console.log("[AppComponent] Syncing authenticated user to role service"),t.roleService.setUserFromAuth(o))})()}shouldUpdateUser(t,n){return!t||t.id!==n.sub}handleOrganizationInvitation(){var t=this;return(0,m.A)(function*(){console.log("[AppComponent] handleOrganizationInvitation() called");const n=t.route.snapshot.queryParams;console.log("[AppComponent] Route snapshot queryParams:",n),console.log("[AppComponent] Router state queryParams:",t.router.routerState.root.snapshot.queryParams);const a=new URLSearchParams(window.location.search),l=a.get("invitation"),g=a.get("organization"),x=a.get("organization_name");console.log("[AppComponent] Window location search:",window.location.search),console.log("[AppComponent] URLSearchParams - invitation:",l,"organization:",g);const b=l||n.invitation,S=g||n.organization;b&&S?(console.log("[AppComponent] Organization invitation detected"),console.log("  Invitation:",b),console.log("  Organization:",S),console.log("  Organization Name:",x||n.organization_name||"Not specified"),console.log("[AppComponent] Automatically initiating login with invitation parameters..."),yield t.auth.login(void 0,{invitation:b,organization:S})):console.log("[AppComponent] No invitation parameters found")})()}static{this.\u0275fac=function(n){return new(n||r)(e.\u0275\u0275directiveInject(v.AuthService),e.\u0275\u0275directiveInject(i.RoleService),e.\u0275\u0275directiveInject(i.MfeLoaderService),e.\u0275\u0275directiveInject(d.Router),e.\u0275\u0275directiveInject(d.ActivatedRoute))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["app-root"]],standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:5,vars:0,consts:[[1,"app-container"],[1,"app-content"]],template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275element(1,"app-header"),e.\u0275\u0275elementStart(2,"main",1),e.\u0275\u0275element(3,"router-outlet"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"app-footer"),e.\u0275\u0275elementEnd())},dependencies:[d.RouterOutlet,p.CommonModule,u.FormsModule,T,z],styles:['[_nghost-%COMP%]{--bright-blue: oklch(51.01% .274 263.83);--electric-violet: oklch(53.18% .28 296.97);--french-violet: oklch(47.66% .246 305.88);--vivid-pink: oklch(69.02% .277 332.77);--hot-red: oklch(61.42% .238 15.34);--orange-red: oklch(63.32% .24 31.68);--gray-900: oklch(19.37% .006 300.98);--gray-700: oklch(36.98% .014 302.71);--gray-400: oklch(70.9% .015 304.04);--red-to-pink-to-purple-vertical-gradient: linear-gradient( 180deg, var(--orange-red) 0%, var(--vivid-pink) 50%, var(--electric-violet) 100% );--red-to-pink-to-purple-horizontal-gradient: linear-gradient( 90deg, var(--orange-red) 0%, var(--vivid-pink) 50%, var(--electric-violet) 100% );--pill-accent: var(--bright-blue);font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol;box-sizing:border-box;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.app-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100vh}.app-content[_ngcontent-%COMP%]{flex:1;padding:2rem;background:#f5f5f5}']})}}return r})();var C=s(8072);function y(r){return()=>{const c=(0,e.inject)(i.RoleService),t=(0,e.inject)(d.Router);console.log("[RoleGuard] Checking access for allowed roles:",r);const n=c.getCurrentUser();return n?(console.log("[RoleGuard] Current user:",n.name,"Role:",n.role),r.includes(n.role)?(console.log("[RoleGuard] Access granted for user:",n.name),!0):(console.warn(`[RoleGuard] User role ${n.role} not allowed, redirecting to home`),console.warn("[RoleGuard] Allowed roles:",r),t.navigate(["/"]),!1)):(console.warn("[RoleGuard] No user found, redirecting to home"),t.navigate(["/"]),!1)}}const P=y([i.UserRole.SUPER_ADMIN,i.UserRole.ORG_ADMIN,i.UserRole.TEAM_LEAD]),E=(y([i.UserRole.SUPER_ADMIN,i.UserRole.ORG_ADMIN]),y([i.UserRole.SUPER_ADMIN,i.UserRole.ORG_ADMIN,i.UserRole.TEAM_LEAD,i.UserRole.SALES_EXECUTIVE]));var L=s(1913);const N=["container"];function H(r,c){if(1&r&&(e.\u0275\u0275elementStart(0,"div",2),e.\u0275\u0275element(1,"div",4),e.\u0275\u0275elementStart(2,"p"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd()()),2&r){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("Loading ",t.name,"...")}}function V(r,c){if(1&r){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",3)(1,"div",5),e.\u0275\u0275text(2,"\u26a0\ufe0f"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"h3"),e.\u0275\u0275text(4,"Failed to Load Component"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"p",6),e.\u0275\u0275text(6),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"button",7),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.retryLoad())}),e.\u0275\u0275text(8,"Retry"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"details",8)(10,"summary"),e.\u0275\u0275text(11,"Technical Details"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"pre"),e.\u0275\u0275text(13),e.\u0275\u0275pipe(14,"json"),e.\u0275\u0275elementEnd()()()}if(2&r){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(t.errorMessage()),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(14,2,t.errorDetails()))}}let h=(()=>{class r{constructor(t,n){this.environmentInjector=t,this.cdr=n,this.name="",this.isLoading=(0,e.signal)(!0),this.hasError=(0,e.signal)(!1),this.errorMessage=(0,e.signal)(""),this.errorDetails=(0,e.signal)(null)}ngAfterViewInit(){var t=this;return(0,m.A)(function*(){yield t.loadMfe()})()}loadMfe(){var t=this;return(0,m.A)(function*(){const n=_.Ay.find(({remoteName:o})=>o===t.name);if(!n){const o=`MFE configuration not found for: ${t.name}`;return console.error(`[MfeWrapperComponent] ${o}`),void t.handleError(o,{name:t.name,options:null})}try{console.log(`[MfeWrapperComponent] Loading MFE: ${t.name}`,n);const o=yield(0,L.loadRemoteModule)(n);if(!o||!o.AppComponent){const l=`MFE module or AppComponent not found for: ${t.name}`;return console.error(`[MfeWrapperComponent] ${l}`),void t.handleError(l,{name:t.name,remote:o})}console.log(`[MfeWrapperComponent] Creating component for MFE: ${t.name}`);const a=(0,e.createComponent)(o.AppComponent,{environmentInjector:t.environmentInjector,elementInjector:t.remoteContainer.injector});t.remoteContainer.insert(a.hostView),console.log(`[MfeWrapperComponent] MFE loaded successfully: ${t.name}`),t.isLoading.set(!1),t.cdr.markForCheck()}catch(o){console.error(`[MfeWrapperComponent] Error loading MFE ${t.name}:`,o),t.handleError(`Failed to load MFE: ${t.name}`,o)}})()}handleError(t,n){this.hasError.set(!0),this.isLoading.set(!1),this.errorMessage.set(t),this.errorDetails.set(n),console.error("[MfeWrapperComponent] Error Details:",{message:t,details:n,timestamp:(new Date).toISOString()}),this.cdr.markForCheck()}retryLoad(){this.hasError.set(!1),this.isLoading.set(!0),this.errorMessage.set(""),this.errorDetails.set(null),this.cdr.markForCheck(),this.remoteContainer.clear(),this.loadMfe()}static{this.\u0275fac=function(n){return new(n||r)(e.\u0275\u0275directiveInject(e.EnvironmentInjector),e.\u0275\u0275directiveInject(e.ChangeDetectorRef))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["app-mfe-wrapper"]],viewQuery:function(n,o){if(1&n&&e.\u0275\u0275viewQuery(N,7,e.ViewContainerRef),2&n){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.remoteContainer=a.first)}},inputs:{name:"name"},standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:5,vars:1,consts:[["container",""],[1,"mfe-wrapper"],[1,"mfe-loading"],[1,"mfe-error"],[1,"loading-spinner"],[1,"error-icon"],[1,"error-message"],[1,"retry-button",3,"click"],[1,"error-details"]],template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"div",1),e.\u0275\u0275template(1,H,4,1,"div",2)(2,V,15,4,"div",3),e.\u0275\u0275elementContainer(3,null,0),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275advance(),e.\u0275\u0275conditional(o.isLoading()?1:o.hasError()?2:-1))},dependencies:[p.CommonModule,p.JsonPipe],styles:[".mfe-wrapper[_ngcontent-%COMP%]{min-height:200px;position:relative}.mfe-loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:300px;padding:2rem}.mfe-loading[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid #1976d2;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:1rem}.mfe-loading[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#1976d2;font-size:1rem;font-weight:500;margin:0}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.mfe-error[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:300px;padding:2rem;background:#fff3f3;border:2px dashed #d32f2f;border-radius:8px;margin:1rem}.mfe-error[_ngcontent-%COMP%]   .error-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem}.mfe-error[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#d32f2f;font-size:1.5rem;font-weight:600;margin:0 0 1rem}.mfe-error[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{color:#666;font-size:1rem;margin:0 0 1.5rem;text-align:center;max-width:500px}.mfe-error[_ngcontent-%COMP%]   .retry-button[_ngcontent-%COMP%]{background:#1976d2;color:#fff;border:none;padding:.75rem 2rem;font-size:1rem;font-weight:500;border-radius:4px;cursor:pointer;transition:background .2s ease}.mfe-error[_ngcontent-%COMP%]   .retry-button[_ngcontent-%COMP%]:hover{background:#1565c0}.mfe-error[_ngcontent-%COMP%]   .retry-button[_ngcontent-%COMP%]:active{background:#0d47a1}.mfe-error[_ngcontent-%COMP%]   .error-details[_ngcontent-%COMP%]{margin-top:1.5rem;width:100%;max-width:600px}.mfe-error[_ngcontent-%COMP%]   .error-details[_ngcontent-%COMP%]   summary[_ngcontent-%COMP%]{cursor:pointer;color:#666;font-size:.875rem;padding:.5rem;background:#f5f5f5;border-radius:4px;-webkit-user-select:none;user-select:none}.mfe-error[_ngcontent-%COMP%]   .error-details[_ngcontent-%COMP%]   summary[_ngcontent-%COMP%]:hover{background:#eee}.mfe-error[_ngcontent-%COMP%]   .error-details[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{margin-top:.5rem;padding:1rem;background:#f5f5f5;border:1px solid #e0e0e0;border-radius:4px;overflow-x:auto;font-size:.75rem;color:#333;max-height:300px;overflow-y:auto}"],changeDetection:0})}}return r})(),G=(()=>{class r{static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["app-home-page"]],standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:6,vars:1,consts:[[1,"home-container"],[1,"welcome-text"],[3,"name"]],template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"div",0)(1,"h1"),e.\u0275\u0275text(2,"Incentive Management System"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"p",1),e.\u0275\u0275text(4,"Welcome to the Incentive Management System. Use the navigation menu to access the available modules based on your role."),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"app-mfe-wrapper",2),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275advance(5),e.\u0275\u0275property("name","usersCrud"))},dependencies:[p.CommonModule,h],styles:[".home-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:2rem}.home-container[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#333;margin-bottom:.5rem;font-size:2rem}.home-container[_ngcontent-%COMP%]   .welcome-text[_ngcontent-%COMP%]{color:#666;font-size:1.1rem;margin-bottom:2rem}"]})}}return r})(),W=(()=>{class r{constructor(){this.mfeName="crudRules"}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["app-rules-page"]],standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:2,vars:1,consts:[[1,"page-container"],[3,"name"]],template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275element(1,"app-mfe-wrapper",1),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275advance(),e.\u0275\u0275property("name",o.mfeName))},dependencies:[h],styles:[".page-container[_ngcontent-%COMP%]{padding:2rem}"]})}}return r})(),$=(()=>{class r{constructor(){this.mfeName="mySales"}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["app-sales-page"]],standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:2,vars:1,consts:[[1,"page-container"],[3,"name"]],template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275element(1,"app-mfe-wrapper",1),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275advance(),e.\u0275\u0275property("name",o.mfeName))},dependencies:[h],styles:[".page-container[_ngcontent-%COMP%]{padding:2rem}"]})}}return r})(),B=(()=>{class r{constructor(){this.mfeName="myReport"}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["app-reports-page"]],standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:2,vars:1,consts:[[1,"page-container"],[3,"name"]],template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275element(1,"app-mfe-wrapper",1),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275advance(),e.\u0275\u0275property("name",o.mfeName))},dependencies:[h],styles:[".page-container[_ngcontent-%COMP%]{padding:2rem}"]})}}return r})(),J=(()=>{class r{constructor(){this.mfeName="usersCrud"}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["app-users-page"]],standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:2,vars:1,consts:[[1,"page-container"],[3,"name"]],template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275element(1,"app-mfe-wrapper",1),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275advance(),e.\u0275\u0275property("name",o.mfeName))},dependencies:[h],styles:[".page-container[_ngcontent-%COMP%]{padding:2rem}"]})}}return r})();function Q(r,c){1&r&&(e.\u0275\u0275elementStart(0,"p"),e.\u0275\u0275text(1,"Processing authentication..."),e.\u0275\u0275elementEnd())}const Y=[{path:"",component:G},{path:"auth-callback",component:(()=>{class r{constructor(t,n,o,a,l){this.route=t,this.router=n,this.authService=o,this.roleService=a,this.userProfileService=l,this.message="Processing authentication...",this.isProcessing=!0,this.destroy$=new f.Subject}ngOnInit(){var t=this;return(0,m.A)(function*(){yield t.processAuthCallback()})()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}processAuthCallback(){var t=this;return(0,m.A)(function*(){try{const n=yield t.authService.handleCallback(),o=n.success?t.handleAuthSuccess(n.appState):t.createFailureState();t.applyAuthState(o),t.scheduleRedirect(o.redirectDelayMs,n.appState)}catch(n){console.error("[AuthCallbackComponent] Error processing callback:",n);const o=t.createExceptionState();t.applyAuthState(o),t.scheduleRedirect(o.redirectDelayMs)}})()}handleAuthSuccess(t){const n=this.authService.getUser();if(n){console.log("[AuthCallbackComponent] \u{1f389} Authentication successful! User info retrieved:"),console.log("  User ID:",n.sub),console.log("  Name:",n.name),console.log("  Email:",n.email);const o=Object.keys(n).filter(a=>a.startsWith("http://")||a.startsWith("https://"));o.length>0&&(console.log("  Custom claims count:",o.length),console.log("  For full details, check AuthService logs above")),this.roleService.setUserFromAuth(n),this.userProfileService.fetchUserProfile().pipe((0,f.takeUntil)(this.destroy$)).subscribe({next:a=>{a&&(console.log("[AuthCallbackComponent] User profile loaded from API"),this.roleService.setUserFromProfile(a))},error:a=>{console.error("[AuthCallbackComponent] Error fetching user profile:",a)}})}return{message:"Authentication successful! Redirecting...",isProcessing:!1,redirectDelayMs:1500}}createFailureState(){return{message:"Authentication failed. Redirecting...",isProcessing:!1,redirectDelayMs:3e3}}createExceptionState(){return{message:"Authentication failed (exception). Redirecting...",isProcessing:!1,redirectDelayMs:3e3}}applyAuthState(t){this.message=t.message,this.isProcessing=t.isProcessing}scheduleRedirect(t,n){setTimeout(()=>{n?.returnTo?(console.log("[AuthCallbackComponent] Restoring original URL parameters:",n.returnTo),this.router.navigateByUrl("/"+n.returnTo)):this.router.navigate(["/"])},t)}static{this.\u0275fac=function(n){return new(n||r)(e.\u0275\u0275directiveInject(d.ActivatedRoute),e.\u0275\u0275directiveInject(d.Router),e.\u0275\u0275directiveInject(v.AuthService),e.\u0275\u0275directiveInject(i.RoleService),e.\u0275\u0275directiveInject(i.UserProfileService))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["app-auth-callback"]],standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:5,vars:2,consts:[[2,"display","flex","justify-content","center","align-items","center","height","100vh"],[2,"text-align","center"],[4,"ngIf"]],template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"h2"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(4,Q,2,0,"p",2),e.\u0275\u0275elementEnd()()),2&n&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(o.message),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.isProcessing))},dependencies:[p.CommonModule,p.NgIf],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100vh}"]})}}return r})()},{path:"rules",component:W,canActivate:[P]},{path:"sales",component:$,canActivate:[E]},{path:"reports",component:B,canActivate:[E]},{path:"users",component:J,canActivate:[P]},{path:"**",redirectTo:""}];let X=(()=>{class r{handleError(t){const l=/Loading chunk [\d]+ failed/.test(t?.message||""),g=/JIT compiler unavailable/.test(t?.message||""),x=/Error loading MFE/.test(t?.message||"");l?(console.error("[GlobalErrorHandler] Chunk loading failed. This is likely a network issue or the chunk was not found.",t),this.notifyUser("Failed to load a component. Please refresh the page or check your internet connection.")):g?(console.error("[GlobalErrorHandler] JIT compiler error detected. This usually means a component is trying to compile at runtime.",t),console.error("[GlobalErrorHandler] Error details:",{message:t?.message,stack:t?.stack,name:t?.name}),this.notifyUser("A component failed to load properly. The page may not work as expected.")):x?console.error("[GlobalErrorHandler] MFE loading error:",t):(console.error("[GlobalErrorHandler] Unhandled error:",t),console.error("[GlobalErrorHandler] Error details:",{message:t?.message,stack:t?.stack,name:t?.name}))}notifyUser(t){console.warn("[GlobalErrorHandler] User notification:",t),console.warn("[User Notification]",t)}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac})}}return r})();function K(){return(0,O.bootstrapApplication)(D,{providers:[(0,d.provideRouter)(Y),(0,C.provideHttpClient)((0,C.withFetch)(),(0,C.withInterceptors)([i.authInterceptor])),{provide:e.ErrorHandler,useClass:X}]})}}}]);