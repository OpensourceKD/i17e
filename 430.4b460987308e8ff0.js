(self.webpackChunkshell=self.webpackChunkshell||[]).push([[430,662],{8430:(L,f,s)=>{s.r(f),s.d(f,{bootstrap:()=>D});var y=s(1194),v=s(467),l=s(3319),d=s(5315),u=s(3793),x=s(4866),C=s(7412),e=s(5565),a=s(8662);function b(r,c){if(1&r&&(e.\u0275\u0275elementStart(0,"option",14),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&r){const t=c.$implicit;e.\u0275\u0275property("value",t.id),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(t.name)}}function A(r,c){if(1&r){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",9)(1,"div",10)(2,"label",11),e.\u0275\u0275text(3,"View data for:"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"span",12),e.\u0275\u0275text(5," Selecting a user will display their incentive data. "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"select",13),e.\u0275\u0275twoWayListener("ngModelChange",function(o){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext();return e.\u0275\u0275twoWayBindingSet(i.selectedSalesExecutiveId,o)||(i.selectedSalesExecutiveId=o),e.\u0275\u0275resetView(o)}),e.\u0275\u0275listener("change",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.onSalesExecutiveChange())}),e.\u0275\u0275elementStart(7,"option",14),e.\u0275\u0275text(8,"My Data"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(9,b,2,2,"option",15),e.\u0275\u0275elementEnd()()()}if(2&r){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(6),e.\u0275\u0275twoWayProperty("ngModel",t.selectedSalesExecutiveId),e.\u0275\u0275advance(),e.\u0275\u0275property("value",t.currentUser.id),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",t.salesExecutives)}}function M(r,c){if(1&r&&(e.\u0275\u0275elementStart(0,"span",16),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&r){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate2(" ",t.currentUser.name," (",t.currentUser.role,") ")}}function _(r,c){if(1&r){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",17),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.logout())}),e.\u0275\u0275text(1,"Logout"),e.\u0275\u0275elementEnd()}}function w(r,c){if(1&r){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",18),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.login())}),e.\u0275\u0275text(1,"Login"),e.\u0275\u0275elementEnd()}}function E(r,c){if(1&r&&(e.\u0275\u0275elementStart(0,"a",21),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&r){const t=c.$implicit;e.\u0275\u0275property("routerLink","/"+t.route),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",t.displayName," ")}}function U(r,c){if(1&r&&(e.\u0275\u0275elementStart(0,"nav",19),e.\u0275\u0275template(1,E,2,2,"a",20),e.\u0275\u0275elementEnd()),2&r){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",t.availableMfes)}}let I=(()=>{class r{constructor(t,n,o,i){this.roleService=t,this.dummyDataService=n,this.mfeLoader=o,this.auth=i,this.currentUser=null,this.availableMfes=[],this.salesExecutives=[],this.selectedSalesExecutiveId="",this.canViewOthers=!1}ngOnInit(){this.syncAuthenticatedUser(),this.subscribeToUserChanges()}syncAuthenticatedUser(){const t=this.auth.isAuthenticated(),n=this.auth.getUser(),o=this.roleService.getCurrentUser();t&&n&&this.shouldUpdateUser(o,n)&&this.roleService.setUserFromAuth(n)}shouldUpdateUser(t,n){return!t||t.id!==n.sub}subscribeToUserChanges(){this.roleService.currentUser$.subscribe(t=>{this.currentUser=t,this.updateComponentState(t)})}updateComponentState(t){t?(this.selectedSalesExecutiveId=t.id,this.canViewOthers=this.roleService.canViewOthersData(),this.updateAvailableMfes(),this.loadSalesExecutives()):this.resetComponentState()}resetComponentState(){this.availableMfes=[],this.salesExecutives=[],this.canViewOthers=!1}updateAvailableMfes(){this.availableMfes=this.currentUser?this.mfeLoader.getConfigsForRole(this.currentUser.role):[]}loadSalesExecutives(){this.salesExecutives=this.canViewOthers?this.dummyDataService.getSalesExecutives():[]}onSalesExecutiveChange(){this.persistSelectedExecutive(this.selectedSalesExecutiveId),this.notifyExecutiveChange(this.selectedSalesExecutiveId)}persistSelectedExecutive(t){sessionStorage.setItem("selected_sales_executive_id",t)}notifyExecutiveChange(t){window.dispatchEvent(new CustomEvent("salesExecutiveChanged",{detail:{salesExecutiveId:t}}))}logout(){this.auth.logout(),this.roleService.setCurrentUser(null)}login(){this.auth.login()}static{this.\u0275fac=function(n){return new(n||r)(e.\u0275\u0275directiveInject(a.RoleService),e.\u0275\u0275directiveInject(a.DummyDataService),e.\u0275\u0275directiveInject(a.MfeLoaderService),e.\u0275\u0275directiveInject(a.AuthService))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["app-header"]],standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:10,vars:5,consts:[[1,"app-header"],[1,"header-left"],[1,"app-title"],["class","header-center",4,"ngIf"],[1,"header-right"],["class","user-info",4,"ngIf"],["class","btn-logout",3,"click",4,"ngIf"],["class","btn-login",3,"click",4,"ngIf"],["class","app-nav",4,"ngIf"],[1,"header-center"],[1,"user-selector"],["for","salesExecSelect"],["id","salesExecSelectDesc",1,"visually-hidden"],["id","salesExecSelect","aria-describedby","salesExecSelectDesc",3,"ngModelChange","change","ngModel"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"user-info"],[1,"btn-logout",3,"click"],[1,"btn-login",3,"click"],[1,"app-nav"],["routerLinkActive","active","class","nav-link",3,"routerLink",4,"ngFor","ngForOf"],["routerLinkActive","active",1,"nav-link",3,"routerLink"]],template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"header",0)(1,"div",1)(2,"h1",2),e.\u0275\u0275text(3,"Incentive Management System"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(4,A,10,3,"div",3),e.\u0275\u0275elementStart(5,"div",4),e.\u0275\u0275template(6,M,2,2,"span",5)(7,_,2,0,"button",6)(8,w,2,0,"button",7),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(9,U,2,1,"nav",8)),2&n&&(e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",o.currentUser&&o.canViewOthers),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",o.currentUser),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.currentUser),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!o.currentUser),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.currentUser))},dependencies:[d.CommonModule,d.NgForOf,d.NgIf,u.FormsModule,u.NgSelectOption,u.\u0275NgSelectMultipleOption,u.SelectControlValueAccessor,u.NgControlStatus,u.NgModel,l.RouterLink,l.RouterLinkActive],styles:[".app-header[_ngcontent-%COMP%]{background:#fff;padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 8px #0000001a}.header-left[_ngcontent-%COMP%]{flex:1}.app-title[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;color:var(--gray-900);font-weight:600}.header-center[_ngcontent-%COMP%]{flex:2;display:flex;justify-content:center}.user-selector[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.user-selector[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;color:var(--gray-700);font-weight:500}.user-selector[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:.5rem 1rem;border:1px solid var(--gray-400);border-radius:.375rem;font-size:.875rem;background:#fff;cursor:pointer;min-width:200px}.visually-hidden[_ngcontent-%COMP%]{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.header-right[_ngcontent-%COMP%]{flex:1;display:flex;justify-content:flex-end;align-items:center;gap:1rem}.user-info[_ngcontent-%COMP%]{color:var(--gray-700);font-size:.875rem;font-weight:500}.btn-logout[_ngcontent-%COMP%], .btn-login[_ngcontent-%COMP%]{background:var(--hot-red);color:#fff;border:none;padding:.5rem 1.5rem;border-radius:.375rem;font-size:.875rem;font-weight:500;cursor:pointer;transition:background .2s ease}.btn-logout[_ngcontent-%COMP%]:hover, .btn-login[_ngcontent-%COMP%]:hover{background:var(--orange-red)}.btn-login[_ngcontent-%COMP%]{background:var(--bright-blue)}.btn-login[_ngcontent-%COMP%]:hover{background:var(--electric-violet)}.app-nav[_ngcontent-%COMP%]{background:var(--gray-900);padding:0;display:flex;gap:0}.nav-link[_ngcontent-%COMP%]{color:#fff;text-decoration:none;padding:1rem 1.5rem;font-size:.875rem;font-weight:500;transition:background .2s ease;border-bottom:3px solid transparent}.nav-link[_ngcontent-%COMP%]:hover{background:var(--gray-700)}.nav-link.active[_ngcontent-%COMP%]{background:var(--bright-blue);border-bottom-color:var(--electric-violet)}"]})}}return r})(),P=(()=>{class r{constructor(){this.currentYear=(new Date).getFullYear()}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["app-footer"]],standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:3,vars:1,consts:[[1,"app-footer"]],template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"footer",0)(1,"p"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()()),2&n&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("\xa9 ",o.currentYear," Incentive Management System. All rights reserved."))},styles:[".app-footer[_ngcontent-%COMP%]{background:var(--gray-900);color:#fff;padding:1rem 2rem;text-align:center;font-size:.875rem;margin-top:auto}.app-footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}"]})}}return r})();var p=s(1663);let k=(()=>{class r{constructor(t){this.http=t,console.log("[AuthenticationService] Service initialized")}login(){console.log("[AuthenticationService] login() called, redirecting to backend login endpoint"),window.location.href="http://localhost:4000/auth/login"}logout(){console.log("[AuthenticationService] logout() called, redirecting to backend logout endpoint"),window.location.href="http://localhost:4000/auth/logout"}getUserProfile(){return console.log("[AuthenticationService] getUserProfile() called, fetching from backend"),this.http.get("http://localhost:4000/auth/me",{withCredentials:!0})}static{this.\u0275fac=function(n){return new(n||r)(e.\u0275\u0275inject(p.HttpClient))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),O=(()=>{class r{constructor(t,n,o,i,g,V){this.auth2=t,this.auth=n,this.route=o,this.router=i,this.roleService=g,this.mfeLoader=V,this.title="Incentive Management System",this.subscriptions=new x.Subscription,this.mfeLoader.setConfigs(C.RG)}ngOnInit(){this.syncAuthenticatedUser(),this.subscribeToAuthCallback()}ngOnDestroy(){this.subscriptions.unsubscribe()}syncAuthenticatedUser(){const t=this.auth.isAuthenticated(),n=this.auth.getUser(),o=this.roleService.getCurrentUser();t&&n&&this.shouldUpdateUser(o,n)&&this.roleService.setUserFromAuth(n)}shouldUpdateUser(t,n){return!t||t.id!==n.sub}subscribeToAuthCallback(){const t=this.route.queryParams.subscribe(n=>{const o=this.extractAuthParams(n);this.handleAuthCallback(o)});this.subscriptions.add(t)}extractAuthParams(t){return t&&Object.keys(t).length>0?this.extractFromRouteParams(t):this.extractFromUrlParams()}extractFromRouteParams(t){return{code:t.code??null,state:t.state??null,error:t.error??null}}extractFromUrlParams(){const t=new URLSearchParams(window.location.search);return{code:t.get("code"),state:t.get("state"),error:t.get("error")}}handleAuthCallback(t){t.error?this.handleAuthError(t.error):t.code&&t.state&&this.processAuthCode(t.code,t.state)}handleAuthError(t){console.error("Authentication failed:",t),this.navigateWithDelay("/",3e3)}processAuthCode(t,n){var o=this;return(0,v.A)(function*(){try{(yield o.auth.handleCallback(t,n))?o.handleAuthSuccess():o.handleAuthFailure()}catch(i){o.handleAuthException(i)}})()}handleAuthSuccess(){console.log("Authentication successful");const t=this.auth.getUser();t&&this.roleService.setUserFromAuth(t),this.navigateWithDelay("/",1500)}handleAuthFailure(){console.error("Authentication failed"),this.navigateWithDelay("/",3e3)}handleAuthException(t){console.error("Authentication failed (exception):",t),this.navigateWithDelay("/",3e3)}navigateWithDelay(t,n){setTimeout(()=>this.router.navigate([t]),n)}static{this.\u0275fac=function(n){return new(n||r)(e.\u0275\u0275directiveInject(k),e.\u0275\u0275directiveInject(a.AuthService),e.\u0275\u0275directiveInject(l.ActivatedRoute),e.\u0275\u0275directiveInject(l.Router),e.\u0275\u0275directiveInject(a.RoleService),e.\u0275\u0275directiveInject(a.MfeLoaderService))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["app-root"]],standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:5,vars:0,consts:[[1,"app-container"],[1,"app-content"]],template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275element(1,"app-header"),e.\u0275\u0275elementStart(2,"main",1),e.\u0275\u0275element(3,"router-outlet"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"app-footer"),e.\u0275\u0275elementEnd())},dependencies:[l.RouterOutlet,d.CommonModule,u.FormsModule,I,P],styles:['[_nghost-%COMP%]{--bright-blue: oklch(51.01% .274 263.83);--electric-violet: oklch(53.18% .28 296.97);--french-violet: oklch(47.66% .246 305.88);--vivid-pink: oklch(69.02% .277 332.77);--hot-red: oklch(61.42% .238 15.34);--orange-red: oklch(63.32% .24 31.68);--gray-900: oklch(19.37% .006 300.98);--gray-700: oklch(36.98% .014 302.71);--gray-400: oklch(70.9% .015 304.04);--red-to-pink-to-purple-vertical-gradient: linear-gradient( 180deg, var(--orange-red) 0%, var(--vivid-pink) 50%, var(--electric-violet) 100% );--red-to-pink-to-purple-horizontal-gradient: linear-gradient( 90deg, var(--orange-red) 0%, var(--vivid-pink) 50%, var(--electric-violet) 100% );--pill-accent: var(--bright-blue);font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol;box-sizing:border-box;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.app-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100vh}.app-content[_ngcontent-%COMP%]{flex:1;padding:2rem;background:#f5f5f5}']})}}return r})();function h(r){return()=>{const c=(0,e.inject)(a.RoleService),t=(0,e.inject)(l.Router);console.log("[RoleGuard] Checking access for allowed roles:",r);const n=c.getCurrentUser();return n?(console.log("[RoleGuard] Current user:",n.name,"Role:",n.role),r.includes(n.role)?(console.log("[RoleGuard] Access granted for user:",n.name),!0):(console.warn(`[RoleGuard] User role ${n.role} not allowed, redirecting to home`),console.warn("[RoleGuard] Allowed roles:",r),t.navigate(["/"]),!1)):(console.warn("[RoleGuard] No user found, redirecting to home"),t.navigate(["/"]),!1)}}const R=h([a.UserRole.SUPER_ADMIN,a.UserRole.ORG_ADMIN,a.UserRole.TEAM_LEAD]),S=(h([a.UserRole.SUPER_ADMIN,a.UserRole.ORG_ADMIN]),h([a.UserRole.SUPER_ADMIN,a.UserRole.ORG_ADMIN,a.UserRole.TEAM_LEAD,a.UserRole.SALES_EXECUTIVE]));var F=s(1913);const T=["container"];let m=(()=>{class r{constructor(){this.name=""}ngAfterViewInit(){var t=this;return(0,v.A)(function*(){const n=C.Ay.map(({remoteName:i,exposedModule:g})=>({remoteName:i,exposedModule:g})).find(({remoteName:i})=>i===t.name);if(!n)return;const o=yield(0,F.loadRemoteModule)(n);t.remoteContainer.createComponent(o.AppComponent)})()}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["app-mfe-wrapper"]],viewQuery:function(n,o){if(1&n&&e.\u0275\u0275viewQuery(T,7,e.ViewContainerRef),2&n){let i;e.\u0275\u0275queryRefresh(i=e.\u0275\u0275loadQuery())&&(o.remoteContainer=i.first)}},inputs:{name:"name"},standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:4,vars:0,consts:[["container",""]],template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"p"),e.\u0275\u0275text(1,"mfe-wrapper works!"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainer(2,null,0))},dependencies:[d.CommonModule],changeDetection:0})}}return r})();const j=[{path:"rules",component:(()=>{class r{constructor(){this.mfeName="crudRules"}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["app-rules-page"]],standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:2,vars:1,consts:[[1,"page-container"],[3,"name"]],template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275element(1,"app-mfe-wrapper",1),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275advance(),e.\u0275\u0275property("name",o.mfeName))},dependencies:[m],styles:[".page-container[_ngcontent-%COMP%]{padding:2rem}"]})}}return r})(),canActivate:[R]},{path:"sales",component:(()=>{class r{constructor(){this.mfeName="mySales"}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["app-sales-page"]],standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:2,vars:1,consts:[[1,"page-container"],[3,"name"]],template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275element(1,"app-mfe-wrapper",1),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275advance(),e.\u0275\u0275property("name",o.mfeName))},dependencies:[m],styles:[".page-container[_ngcontent-%COMP%]{padding:2rem}"]})}}return r})(),canActivate:[S]},{path:"reports",component:(()=>{class r{constructor(){this.mfeName="myReport"}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["app-reports-page"]],standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:2,vars:1,consts:[[1,"page-container"],[3,"name"]],template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275element(1,"app-mfe-wrapper",1),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275advance(),e.\u0275\u0275property("name",o.mfeName))},dependencies:[m],styles:[".page-container[_ngcontent-%COMP%]{padding:2rem}"]})}}return r})(),canActivate:[S]},{path:"**",redirectTo:"",pathMatch:"full"}];function D(){return(0,y.bootstrapApplication)(O,{providers:[(0,l.provideRouter)(j),(0,p.provideHttpClient)((0,p.withFetch)(),(0,p.withInterceptors)([a.cacheInterceptor]))]})}}}]);