(self.webpackChunkshell=self.webpackChunkshell||[]).push([[915],{7915:(Q,T,g)=>{g.r(T),g.d(T,{API_CONFIG:()=>A,AUTH0_CONFIG:()=>d,AuthService:()=>L,CoreServicesComponent:()=>G,CoreServicesService:()=>F,DummyDataService:()=>$,EventBusService:()=>j,MfeLoaderService:()=>V,ProductCategory:()=>U,RoleService:()=>z,STORAGE_CONFIG:()=>v,STORAGE_KEYS:()=>f,SalesStatus:()=>C,SseControlService:()=>H,SseFromEventService:()=>K,UserProfileService:()=>J,UserRole:()=>s,authInterceptor:()=>X,getStorage:()=>I,getStorageItem:()=>y,hasRequiredRole:()=>w,removeStorageItem:()=>M,setStorageItem:()=>b});var c=g(9219);let F=(()=>{class r{constructor(){}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var E=g(467),h=g(3217),x=g(2943);const d={domain:"dev-26sow24tone5na8a.us.auth0.com",clientId:"EdkPy5co65jESIAT8T9SBy5X4cmeolhl",redirectUri:"https://opensourcekd.github.io/i17e/auth-callback",logoutUri:"https://opensourcekd.github.io/i17e",scope:"openid profile email",audience:"https://something"},v={TOKEN_STORAGE:"sessionStorage",USER_INFO_STORAGE:"sessionStorage",AUTH_STATE_STORAGE:"sessionStorage",PREFERENCES_STORAGE:"localStorage"},f={ACCESS_TOKEN:"auth0_access_token",ID_TOKEN:"auth0_id_token",REFRESH_TOKEN:"auth0_refresh_token",USER_INFO:"auth0_user_info",OAUTH_STATE:"oauth_state",CODE_VERIFIER:"code_verifier",CURRENT_USER:"current_user",DEV_MIMIC_USER:"dev_mimic_user"};function I(r){return"sessionStorage"===r?sessionStorage:localStorage}function b(r,S,e="sessionStorage"){I(e).setItem(r,S)}function y(r,S="sessionStorage"){return I(S).getItem(r)}function M(r,S="sessionStorage"){I(S).removeItem(r)}var _=g(5771),P=g(7555),k=g.n(P);let j=(()=>{class r{constructor(){this.emitter=k()(),console.log("[EventBusService] Service initialized");const e=new Event("EventBusServiceCreated");this.onePlusNEvents=new h.ReplaySubject(100),this.onePlusNEvents.next(e.type),this.emitter.on("*",t=>{console.log("[EventBusService] Event received and forwarded to ReplaySubject:",t),this.onePlusNEvents.next(t)}),console.log("[EventBusService] Event listener registered for all events")}sendEvent(e){console.log("[EventBusService] sendEvent() called with:",e),this.emitter.emit(e),console.log("[EventBusService] Event emitted successfully")}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),L=(()=>{class r{constructor(e,t){this.http=e,this.eventBus=t,this.id="auth of pokemon",this.STANDARD_JWT_CLAIMS=["sub","name","email","email_verified","preferred_username","given_name","family_name","nickname","locale","picture","phone","phone_verified","updated_at","iss","aud","exp","iat","auth_time","nonce","acr","amr","azp","at_hash","c_hash"],this.auth0Client=null,this.userSubject=new h.BehaviorSubject(this.getUserInfoFromStorage()),this.user$=this.userSubject.asObservable(),console.log("[AuthService] Initializing Auth0 authentication service from the SHELL"),this.initializationPromise=this.initializeAuth0()}initializeAuth0(){var e=this;return(0,E.A)(function*(){try{if(console.log("[AuthService] Starting Auth0 client initialization..."),!d||"object"!=typeof d)throw new Error("[AuthService] AUTH0_CONFIG is not defined or invalid");if(!d.domain||!d.clientId)throw new Error("[AuthService] AUTH0_CONFIG is missing required fields (domain, clientId)");e.auth0Client=yield(0,x.createAuth0Client)({domain:d.domain,clientId:d.clientId,authorizationParams:{redirect_uri:d.redirectUri,scope:d.scope,...d.audience&&{audience:d.audience}},cacheLocation:"memory",useRefreshTokens:!0}),console.log("[AuthService] Auth0 client initialized successfully from SHELL")}catch(t){throw console.error("[AuthService] Failed to initialize Auth0 client:",t),t}})()}ensureInitialized(){var e=this;return(0,E.A)(function*(){if(yield e.initializationPromise,!e.auth0Client)throw new Error("[AuthService] Auth0 client failed to initialize")})()}login(e,t){var o=this;return(0,E.A)(function*(){e&&console.log(`[AuthService] Logging in: ${e}`);try{let a;if(yield o.ensureInitialized(),!window.location.pathname.includes("auth-callback")&&window.location.search){const u=window.location.search;a={returnTo:u},console.log("[AuthService] Preserving URL parameters through auth flow:",u)}const l={redirect_uri:d.redirectUri,scope:d.scope,...d.audience&&{audience:d.audience},...d.connection&&{connection:d.connection}};t?.invitation&&(l.invitation=t.invitation,console.log("[AuthService] Including invitation parameter:",t.invitation)),t?.organization&&(l.organization=t.organization,console.log("[AuthService] Including organization parameter:",t.organization)),console.log("[AuthService] Starting Auth0 login redirect..."),yield o.auth0Client.loginWithRedirect({authorizationParams:l,...a&&{appState:a}})}catch(n){throw console.error("[AuthService] Login failed:",n),n}})()}handleCallback(){var e=this;return(0,E.A)(function*(){try{console.log("[AuthService] Processing Auth0 callback..."),yield e.ensureInitialized();const t=yield e.auth0Client.handleRedirectCallback();console.log("[AuthService] Callback processed successfully"),t.appState?console.log("[AuthService] Restored appState from auth flow:",JSON.stringify(t.appState)):console.log("[AuthService] No appState restored (user may not have started from invitation link)");const o=yield e.auth0Client.getUser();if(!o)return console.warn("[AuthService] No user info returned from Auth0"),{success:!1};e.logUserClaims(o),e.setUserInfo(o);const n=yield e.auth0Client.getTokenSilently();return e.setToken(n),console.log("[AuthService] Authentication successful"),{success:!0,appState:t.appState}}catch(t){return console.error("[AuthService] Error processing callback:",t),console.error("[AuthService] Error details:",JSON.stringify(t,null,2)),{success:!1}}})()}logUserClaims(e){console.log("=".repeat(80)),console.log("[AuthService] \u{1f50d} AUTH0 ID TOKEN - ALL CLAIMS:"),console.log("=".repeat(80)),this.logStandardClaims(e);const t=this.getCustomClaims(e);this.logClaims("\n\u{1f511} Custom Claims (Auth0):",t,e);const o=this.getAdditionalClaims(e);this.logClaims("\n\u{1f527} Additional Claims:",o,e),console.log("\n\u{1f4e6} Complete User Object (JSON):"),console.log(JSON.stringify(e,null,2)),console.log("=".repeat(80))}logStandardClaims(e){console.log("\n\u{1f4cb} Standard OIDC Claims:"),["sub","name","email","email_verified","preferred_username","given_name","family_name","nickname","locale","picture","phone","phone_verified","updated_at"].forEach(o=>{console.log(`  \u2022 ${"sub"===o?`${o} (Subject/User ID)`:o}:`,e[o])})}logClaims(e,t,o){console.log(e),0!==t.length?t.forEach(n=>{const i=o[n],a="object"==typeof i?JSON.stringify(i,null,2):i;console.log(`  \u2022 ${n}:`,a)}):console.log("  No custom claims found")}getCustomClaims(e){return Object.keys(e).filter(t=>!this.STANDARD_JWT_CLAIMS.includes(t)&&this.isNamespacedClaim(t))}getAdditionalClaims(e){return Object.keys(e).filter(t=>!this.STANDARD_JWT_CLAIMS.includes(t)&&!this.isNamespacedClaim(t))}isNamespacedClaim(e){return e.startsWith("http://")||e.startsWith("https://")}logout(){var e=this;return(0,E.A)(function*(){M(f.ACCESS_TOKEN,v.TOKEN_STORAGE),M(f.USER_INFO,v.USER_INFO_STORAGE),e.userSubject.next(null),e.emitAuthEvent("logout",null),console.log("[AuthService] User logged out, clearing Auth0 session");try{yield e.ensureInitialized(),yield e.auth0Client.logout({logoutParams:{returnTo:d.logoutUri}})}catch(t){console.error("[AuthService] Error during Auth0 logout:",t)}})()}getToken(){var e=this;return(0,E.A)(function*(){const t=y(f.ACCESS_TOKEN,v.TOKEN_STORAGE);if(t)return t;try{yield e.ensureInitialized();const o=yield e.auth0Client.getTokenSilently();return e.setToken(o),o}catch(o){return console.error("[AuthService] Error getting token from Auth0:",o),null}})()}getTokenSync(){return y(f.ACCESS_TOKEN,v.TOKEN_STORAGE)}setToken(e){b(f.ACCESS_TOKEN,e,v.TOKEN_STORAGE),this.emitAuthEvent("token_updated",{token:e})}isAuthenticated(){var e=this;return(0,E.A)(function*(){try{return yield e.ensureInitialized(),yield e.auth0Client.isAuthenticated()}catch(t){return console.error("[AuthService] Error checking authentication status:",t),!!y(f.ACCESS_TOKEN,v.TOKEN_STORAGE)}})()}isAuthenticatedSync(){return!!y(f.ACCESS_TOKEN,v.TOKEN_STORAGE)}getUser(){return this.userSubject.value}getUserData(){const e=this.getUser();if(!e)return null;const t=this.extractClaimValue(e,"role","user"),o=this.extractClaimValue(e,["org","organization"],"default");return{id:e.sub,name:e.name||e.email||"User",email:e.email||"",role:t,org:o}}extractClaimValue(e,t,o){const n=Array.isArray(t)?t:[t];for(const a of n){const l=e[a];if(l)return l}const i=this.getCustomClaims(e);for(const a of n){const l=i.find(u=>u.toLowerCase().includes(a.toLowerCase()));if(l&&e[l]){const u=e[l];return Array.isArray(u)?u[0]:u}}return o}getUserInfoFromStorage(){const e=y(f.USER_INFO,v.USER_INFO_STORAGE);return e?JSON.parse(e):null}setUserInfo(e){b(f.USER_INFO,JSON.stringify(e),v.USER_INFO_STORAGE),this.userSubject.next(e),console.log("[AuthService] \u{1f4be} User info stored in sessionStorage:"),console.log("  Standard claims:",{sub:e.sub,name:e.name,email:e.email,email_verified:e.email_verified});const t=this.getCustomClaims(e);t.length>0&&(console.log("  Custom claims stored:"),t.forEach(o=>{console.log(`    \u2022 ${o}:`,e[o])})),this.emitAuthEvent("user_info_updated",e)}emitAuthEvent(e,t){const o={type:`auth:${e}`,payload:t,timestamp:(new Date).toISOString()};this.eventBus.sendEvent(JSON.stringify(o)),console.log("[AuthService] Auth event emitted:",o.type)}static{this.\u0275fac=function(t){return new(t||r)(c.\u0275\u0275inject(_.HttpClient),c.\u0275\u0275inject(j))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),G=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275cmp=c.\u0275\u0275defineComponent({type:r,selectors:[["org-core-services"]],standalone:!0,features:[c.\u0275\u0275StandaloneFeature],decls:2,vars:0,template:function(t,o){1&t&&(c.\u0275\u0275elementStart(0,"p"),c.\u0275\u0275text(1," core-services works! "),c.\u0275\u0275elementEnd())}})}}return r})();var s=function(r){return r.SUPER_ADMIN="super-admin",r.ORG_ADMIN="org-admin",r.TEAM_LEAD="team-lead",r.SALES_EXECUTIVE="sales-executive",r}(s||{});function w(r,S){const e={[s.SUPER_ADMIN]:4,[s.ORG_ADMIN]:3,[s.TEAM_LEAD]:2,[s.SALES_EXECUTIVE]:1};return e[r]>=e[S]}let z=(()=>{class r{constructor(){this.currentUserSubject=new h.BehaviorSubject(null),this.currentUser$=this.currentUserSubject.asObservable(),console.log("[RoleService] Service initialized"),this.loadInitialUser()}setUserFromProfile(e){console.log("[RoleService] Setting user from API profile:",e);const t=this.mapApiRoleToUserRole(e.roles),o={id:e.userId,name:e.name||e.email||"User",email:e.email||"",role:t};console.log("[RoleService] Mapped user with role from API:",o),this.setCurrentUser(o)}mapApiRoleToUserRole(e){return e&&0!==e.length?this.mapStringToUserRole(e[0].name):(console.warn("[RoleService] No roles found in API response, defaulting to SALES_EXECUTIVE"),s.SALES_EXECUTIVE)}setUserFromAuth(e){console.log("[RoleService] Setting user from Auth0 auth:",e);const t=this.mapUserInfoToUser(e);console.log("[RoleService] Mapped user with role:",t),this.setCurrentUser(t)}mapUserInfoToUser(e){const t=this.extractRoleFromToken(e);return{id:e.sub,name:e.name||e.email||"User",email:e.email||"",role:t}}extractRoleFromToken(e){if(e.role)return this.mapStringToUserRole(e.role);if(e.org_and_roles){const n=this.extractRoleFromOrgAndRoles(e.org_and_roles);if(n)return console.log("[RoleService] Extracted role from org_and_roles:",n),n}const o=Object.keys(e).filter(n=>n.startsWith("http://")||n.startsWith("https://")).find(n=>n.toLowerCase().includes("role"));if(o&&e[o]){const n=e[o],i=Array.isArray(n)?n[0]:n;return this.mapStringToUserRole(i)}return console.warn("[RoleService] No role found in token, falling back to email pattern"),this.determineRoleFromEmail(e.email||"")}extractRoleFromOrgAndRoles(e){if(!e||"object"!=typeof e)return null;const t=[];for(const n in e){const i=e[n];Array.isArray(i)&&i.forEach(a=>{const l=this.mapStringToUserRole(a);t.push(l)})}if(0===t.length)return null;const o=[s.SUPER_ADMIN,s.ORG_ADMIN,s.TEAM_LEAD,s.SALES_EXECUTIVE];for(const n of o)if(t.includes(n))return console.log("[RoleService] Selected highest privilege role:",n),n;return t[0]}mapStringToUserRole(e){const t=e.toLowerCase().replace(/[-_\s]/g,"");return{superadmin:s.SUPER_ADMIN,super:s.SUPER_ADMIN,admin:s.SUPER_ADMIN,orgadmin:s.ORG_ADMIN,organizationadmin:s.ORG_ADMIN,manager:s.ORG_ADMIN,teamlead:s.TEAM_LEAD,lead:s.TEAM_LEAD,salesexecutive:s.SALES_EXECUTIVE,sales:s.SALES_EXECUTIVE,executive:s.SALES_EXECUTIVE}[t]||s.SALES_EXECUTIVE}determineRoleFromEmail(e){const t=e.toLowerCase();return[{patterns:["admin","super"],role:s.SUPER_ADMIN},{patterns:["manager","org"],role:s.ORG_ADMIN},{patterns:["lead","team"],role:s.TEAM_LEAD}].find(({patterns:i})=>i.some(a=>t.includes(a)))?.role??s.SALES_EXECUTIVE}loadInitialUser(){const e=this.getDevMimicUser();if(e)return console.log("[RoleService] Using dev mimic user:",e),void this.currentUserSubject.next(e)}getDevMimicUser(){try{const e=localStorage.getItem("dev_mimic_user");if(e){const t=JSON.parse(e);if(t.id&&t.name&&t.role)return t}}catch(e){console.error("[RoleService] Error parsing dev mimic user:",e)}return null}setDevMimicUser(e){e?(localStorage.setItem("dev_mimic_user",JSON.stringify(e)),this.currentUserSubject.next(e),console.log("[RoleService] Dev mimic user set:",e)):(localStorage.removeItem("dev_mimic_user"),this.loadDummyUser(),console.log("[RoleService] Dev mimic user cleared"))}loadDummyUser(){console.log("[RoleService] Loading user from session storage");const e=sessionStorage.getItem("current_user");if(e){const t=JSON.parse(e);console.log("[RoleService] User loaded from session:",t),this.currentUserSubject.next(t)}else{const t={id:"user-1",name:"John Admin",email:"john.admin@company.com",role:s.ORG_ADMIN};console.log("[RoleService] No saved user found, using default:",t),this.setCurrentUser(t)}}setCurrentUser(e){console.log("[RoleService] Setting current user:",e),this.currentUserSubject.next(e),e?(sessionStorage.setItem("current_user",JSON.stringify(e)),console.log("[RoleService] User saved to session storage")):(sessionStorage.removeItem("current_user"),console.log("[RoleService] User removed from session storage"))}getCurrentUser(){const e=this.currentUserSubject.value;return console.log("[RoleService] getCurrentUser() called, returning:",e),e}getCurrentUserRole(){const e=this.currentUserSubject.value?.role||null;return console.log("[RoleService] getCurrentUserRole() called, returning:",e),e}hasRole(e){const t=this.getCurrentUserRole();if(!t)return console.log("[RoleService] hasRole() - No current role, access denied"),!1;const o=w(t,e);return console.log(`[RoleService] hasRole() - Checking if ${t} has ${e}:`,o),o}canViewOthersData(){const e=this.getCurrentUserRole(),t=e===s.SUPER_ADMIN||e===s.ORG_ADMIN||e===s.TEAM_LEAD;return console.log(`[RoleService] canViewOthersData() - Role: ${e}, Can view:`,t),t}getViewableUsers(){const e=this.getCurrentUser();if(!e)return[];const t=this.getAllUsers();return this.isTeamLeadOrHigher()?t.filter(o=>o.role===s.SALES_EXECUTIVE||o.id===e.id):t.filter(o=>o.id===e.id)}hasAnyRole(e){const t=this.getCurrentUser();return!!t&&e.includes(t.role)}isAdmin(){return this.hasAnyRole([s.SUPER_ADMIN,s.ORG_ADMIN])}isTeamLeadOrHigher(){return this.hasAnyRole([s.SUPER_ADMIN,s.ORG_ADMIN,s.TEAM_LEAD])}getAllUsers(){return[{id:"user-1",name:"John Admin",email:"john.admin@company.com",role:s.SUPER_ADMIN},{id:"user-2",name:"Sarah Manager",email:"sarah.manager@company.com",role:s.ORG_ADMIN},{id:"user-3",name:"Mike Lead",email:"mike.lead@company.com",role:s.TEAM_LEAD,teamId:"team-1"},{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",role:s.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-5",name:"Bob Sales",email:"bob.sales@company.com",role:s.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-6",name:"Carol Sales",email:"carol.sales@company.com",role:s.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"}]}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var C=function(r){return r.COMPLETED="completed",r.PENDING="pending",r.CANCELLED="cancelled",r}(C||{}),U=function(r){return r.ELECTRONICS="Electronics",r.SOFTWARE="Software",r.SERVICES="Services",r.HARDWARE="Hardware",r}(U||{});let $=(()=>{class r{constructor(){this.salesExecutivesSubject=new h.BehaviorSubject(this.generateSalesExecutives()),this.salesExecutives$=this.salesExecutivesSubject.asObservable(),this.salesRecordsSubject=new h.BehaviorSubject(this.generateSalesRecords()),this.salesRecords$=this.salesRecordsSubject.asObservable(),this.incentiveRulesSubject=new h.BehaviorSubject(this.generateIncentiveRules()),this.incentiveRules$=this.incentiveRulesSubject.asObservable(),this.incentivesEarnedSubject=new h.BehaviorSubject(this.generateIncentivesEarned()),this.incentivesEarned$=this.incentivesEarnedSubject.asObservable(),console.log("[DummyDataService] Service initialized"),console.log("[DummyDataService] Generated data:",{salesExecutives:this.salesExecutivesSubject.value.length,salesRecords:this.salesRecordsSubject.value.length,incentiveRules:this.incentiveRulesSubject.value.length,incentivesEarned:this.incentivesEarnedSubject.value.length})}generateSalesExecutives(){return console.log("[DummyDataService] Generating sales executives"),[{id:"user-1",name:"John Admin",email:"john.admin@company.com",teamId:"team-1"},{id:"user-2",name:"Sarah Manager",email:"sarah.manager@company.com",teamId:"team-1"},{id:"user-3",name:"Mike Lead",email:"mike.lead@company.com",teamId:"team-1"},{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",teamId:"team-1"},{id:"user-5",name:"Bob Sales",email:"bob.sales@company.com",teamId:"team-1"},{id:"user-6",name:"Carol Sales",email:"carol.sales@company.com",teamId:"team-1"}]}generateSalesRecords(){console.log("[DummyDataService] Generating sales records");const e=[],t=this.generateSalesExecutives(),o=["Product A","Product B","Product C","Product D"],n=[C.COMPLETED,C.PENDING,C.CANCELLED];for(let i=0;i<50;i++){const a=t[i%t.length],l=Math.floor(i/10),u=new Date;u.setMonth(u.getMonth()-l),e.push({id:`sale-${i+1}`,salesExecutiveId:a.id,salesExecutiveName:a.name,date:u,productName:o[i%o.length],productCategory:U.SOFTWARE,amount:Math.floor(5e4*Math.random())+1e4,commission:Math.floor(5e3*Math.random()),quantity:Math.floor(10*Math.random())+1,status:n[i%n.length],clientName:`Client ${i+1}`,region:["North","South","East","West"][i%4]})}return e}generateIncentiveRules(){return console.log("[DummyDataService] Generating incentive rules"),[{id:"rule-1",name:"Basic Sales Incentive",description:"5% incentive on all sales",type:"percentage",value:5,isActive:!0,createdBy:"admin",createdAt:new Date("2024-01-01")},{id:"rule-2",name:"High Value Sales Bonus",description:"10% incentive on sales above $50,000",type:"percentage",value:10,minSalesAmount:5e4,isActive:!0,createdBy:"admin",createdAt:new Date("2024-02-01")},{id:"rule-3",name:"Product A Special",description:"Fixed $500 bonus for Product A sales",type:"fixed",value:500,productCategory:"Product A",isActive:!0,createdBy:"team-lead-1",createdAt:new Date("2024-03-01")},{id:"rule-4",name:"Tiered Volume Incentive",description:"15% incentive on sales above $100,000",type:"tiered",value:15,minSalesAmount:1e5,isActive:!1,createdBy:"admin",createdAt:new Date("2024-04-01")}]}generateIncentivesEarned(){console.log("[DummyDataService] Generating incentives earned");const e=[],t=this.generateSalesExecutives(),o=this.generateIncentiveRules(),n=["pending","approved","paid"];for(let i=0;i<30;i++){const a=t[i%t.length],l=o[i%o.length],u=Math.floor(i/10),m=new Date;m.setMonth(m.getMonth()-u),e.push({id:`incentive-${i+1}`,salesExecutiveId:a.id,salesExecutiveName:a.name,ruleId:l.id,ruleName:l.name,salesRecordId:`sale-${i+1}`,amount:Math.floor(5e3*Math.random())+500,earnedDate:m,status:n[i%3]})}return e}getSalesRecordsForExecutive(e){console.log("[DummyDataService] getSalesRecordsForExecutive() called for:",e);const t=this.salesRecordsSubject.value.filter(o=>o.salesExecutiveId===e);return console.log("[DummyDataService] Found",t.length,"sales records for executive:",e),t}getIncentivesForExecutive(e){console.log("[DummyDataService] getIncentivesForExecutive() called for:",e);const t=this.incentivesEarnedSubject.value.filter(o=>o.salesExecutiveId===e);return console.log("[DummyDataService] Found",t.length,"incentives for executive:",e),t}getReportDataForExecutive(e){console.log("[DummyDataService] getReportDataForExecutive() called for:",e);const t=this.salesExecutivesSubject.value.find(m=>m.id===e),o=this.getSalesRecordsForExecutive(e),n=this.getIncentivesForExecutive(e),i=o.filter(m=>"completed"===m.status).reduce((m,R)=>m+R.amount,0),a=n.filter(m=>"pending"!==m.status).reduce((m,R)=>m+R.amount,0),l=[];for(let m=5;m>=0;m--){const R=new Date;R.setMonth(R.getMonth()-m);const O=R.toISOString().substring(0,7),Y=o.filter(p=>p.date.toISOString().substring(0,7)===O&&"completed"===p.status).reduce((p,N)=>p+N.amount,0),Z=n.filter(p=>p.earnedDate.toISOString().substring(0,7)===O&&"pending"!==p.status).reduce((p,N)=>p+N.amount,0);l.push({month:O,sales:Y,incentives:Z})}const u={salesExecutiveId:e,salesExecutiveName:t?.name||"Unknown",totalSales:i,totalIncentives:a,period:"Last 6 months",breakdown:l};return console.log("[DummyDataService] Report data generated:",u),u}getSalesExecutives(){const e=this.salesExecutivesSubject.value;return console.log("[DummyDataService] getSalesExecutives() called, returning",e.length,"executives"),e}getIncentiveRules(){const e=this.incentiveRulesSubject.value;return console.log("[DummyDataService] getIncentiveRules() called, returning",e.length,"rules"),e}addIncentiveRule(e){console.log("[DummyDataService] addIncentiveRule() called with:",e),this.incentiveRulesSubject.next([...this.incentiveRulesSubject.value,e]),console.log("[DummyDataService] Rule added successfully, total rules:",this.incentiveRulesSubject.value.length)}updateIncentiveRule(e,t){console.log("[DummyDataService] updateIncentiveRule() called for rule:",e,"with updates:",t);const n=this.incentiveRulesSubject.value.map(i=>i.id===e?{...i,...t}:i);this.incentiveRulesSubject.next(n),console.log("[DummyDataService] Rule updated successfully")}deleteIncentiveRule(e){console.log("[DummyDataService] deleteIncentiveRule() called for rule:",e);const o=this.incentiveRulesSubject.value.filter(n=>n.id!==e);this.incentiveRulesSubject.next(o),console.log("[DummyDataService] Rule deleted successfully, remaining rules:",this.incentiveRulesSubject.value.length)}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var B=g(1913);let V=(()=>{class r{constructor(){this.mfeConfigs=[],this.loadedMfesSubject=new h.BehaviorSubject(new Set),this.loadedMfes$=this.loadedMfesSubject.asObservable(),this.loadingMfesSubject=new h.BehaviorSubject(new Set),this.loadingMfes$=this.loadingMfesSubject.asObservable(),console.log("[MfeLoaderService] Service initialized")}setConfigs(e){console.log("[MfeLoaderService] setConfigs() called with",e.length,"configurations"),this.mfeConfigs=e.sort((t,o)=>o.priority-t.priority),console.log("[MfeLoaderService] Configurations sorted by priority:",this.mfeConfigs.map(t=>({name:t.name,priority:t.priority})))}getConfigs(){return console.log("[MfeLoaderService] getConfigs() called, returning",this.mfeConfigs.length,"configurations"),this.mfeConfigs}getConfigsForRole(e){console.log("[MfeLoaderService] getConfigsForRole() called for role:",e);const t=this.mfeConfigs.filter(o=>o.allowedRoles.includes(e));return console.log("[MfeLoaderService] Found",t.length,"configurations for role:",e,t.map(o=>o.name)),t}getConfigByName(e){console.log("[MfeLoaderService] getConfigByName() called for:",e);const t=this.mfeConfigs.find(o=>o.name===e);return t?console.log("[MfeLoaderService] Found configuration for:",e):console.warn("[MfeLoaderService] Configuration not found for:",e),t}preloadPriorityMfes(e){var t=this;return(0,E.A)(function*(){console.log("[MfeLoaderService] preloadPriorityMfes() called for role:",e);const n=t.getConfigsForRole(e).filter(a=>a.priority>=5);console.log("[MfeLoaderService] Preloading",n.length,"priority MFEs:",n.map(a=>({name:a.name,priority:a.priority})));const i=n.map(a=>t.loadMfe(a));yield Promise.all(i),console.log("[MfeLoaderService] Preloading complete")})()}loadMfe(e){var t=this;return(0,E.A)(function*(){const o=t.loadingMfesSubject.value,n=t.loadedMfesSubject.value;if(n.has(e.name))console.log(`[MfeLoaderService] MFE ${e.name} already loaded`);else if(o.has(e.name))console.log(`[MfeLoaderService] MFE ${e.name} is already loading`);else try{const i=new Set(o);i.add(e.name),t.loadingMfesSubject.next(i),console.log(`[MfeLoaderService] Loading MFE ${e.name} (priority: ${e.priority})`),console.log("[MfeLoaderService] MFE config:",{name:e.name,url:e.url,exposedModule:e.exposedModule,remoteName:e.remoteName});const a=yield(0,B.loadRemoteModule)({type:"module",remoteEntry:e.url,exposedModule:e.exposedModule}),l=new Set(n);l.add(e.name),t.loadedMfesSubject.next(l);const u=new Set(t.loadingMfesSubject.value);return u.delete(e.name),t.loadingMfesSubject.next(u),console.log(`[MfeLoaderService] Successfully loaded MFE ${e.name}`),console.log("[MfeLoaderService] Currently loaded MFEs:",Array.from(t.loadedMfesSubject.value)),a}catch(i){console.error(`[MfeLoaderService] Error loading MFE ${e.name}:`,i),console.error("[MfeLoaderService] Failed config:",{name:e.name,url:e.url,exposedModule:e.exposedModule});const a=new Set(t.loadingMfesSubject.value);throw a.delete(e.name),t.loadingMfesSubject.next(a),i}})()}isMfeLoaded(e){const t=this.loadedMfesSubject.value.has(e);return console.log(`[MfeLoaderService] isMfeLoaded(${e}):`,t),t}isMfeLoading(e){const t=this.loadingMfesSubject.value.has(e);return console.log(`[MfeLoaderService] isMfeLoading(${e}):`,t),t}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var D=g(3989);let K=(()=>{class r{constructor(e){this.zone=e}listen(){const e=new EventSource("https://stream.wikimedia.org/v2/stream/recentchange");return(0,h.fromEvent)(e,"message").pipe((0,D.map)(t=>{let o;return this.zone.run(()=>o=t.data),o}))}static{this.\u0275fac=function(t){return new(t||r)(c.\u0275\u0275inject(c.NgZone))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),H=(()=>{class r{constructor(e){this.zone=e}start(e){this.eventSource=new EventSource(e);const t=this.eventSource;return new h.Observable(o=>{const n=(0,h.fromEvent)(t,"message").subscribe(i=>{this.zone.run(()=>o.next(i.data))});return t.onerror=i=>{this.zone.run(()=>o.error(i))},()=>{n.unsubscribe(),t.close()}})}stop(){this.eventSource&&(this.eventSource.close(),this.eventSource=void 0)}static{this.\u0275fac=function(t){return new(t||r)(c.\u0275\u0275inject(c.NgZone))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();const A={baseUrl:"https://tmzuktmjy7.execute-api.us-east-1.amazonaws.com"};let J=(()=>{class r{constructor(e){this.http=e,this.profileSubject=new h.BehaviorSubject(null),this.profile$=this.profileSubject.asObservable(),console.log("[UserProfileService] Service initialized")}fetchUserProfile(){return console.log("[UserProfileService] Fetching user profile from API"),A&&A.baseUrl?this.http.get(`${A.baseUrl}/auth/me`).pipe((0,D.map)(e=>e.success&&e.data?(console.log("[UserProfileService] Profile loaded successfully"),this.profileSubject.next(e.data),e.data):null),(0,D.catchError)(e=>(console.error("[UserProfileService] Error fetching profile:",e),this.profileSubject.next(null),(0,h.of)(null)))):(console.error("[UserProfileService] API_CONFIG or baseUrl is not defined"),(0,h.of)(null))}getCurrentProfile(){return this.profileSubject.value}getPrimaryOrganization(){return this.profileSubject.value?.organizations?.[0]||null}getPrimaryRole(){return this.profileSubject.value?.roles?.[0]||null}getRoleName(){return this.getPrimaryRole()?.name||null}getOrganizationDisplayName(){return this.getPrimaryOrganization()?.displayName||null}clearProfile(){this.profileSubject.next(null)}static{this.\u0275fac=function(t){return new(t||r)(c.\u0275\u0275inject(_.HttpClient))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();const X=(r,S)=>{const t=(0,c.inject)(L).getTokenSync();return!t||W(r.url)?S(r):S(r.clone({setHeaders:{Authorization:`Bearer ${t}`}}))},W=r=>{try{if(A&&"object"==typeof A&&A.baseUrl&&r.startsWith(A.baseUrl))return!1}catch(e){console.warn("[authInterceptor] API_CONFIG not available, using pattern-based auth endpoint detection",e)}return["/oauth","auth0.com","/authorize","/token"].some(e=>r.includes(e))}}}]);