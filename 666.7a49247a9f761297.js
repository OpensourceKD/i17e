(self.webpackChunkshell=self.webpackChunkshell||[]).push([[666],{8666:(Ti,Rt,N)=>{N.r(Rt),N.d(Rt,{API_CONFIG:()=>Ue,AUTH0_CONFIG:()=>V,AuthService:()=>_i,CoreServicesComponent:()=>Ua,CoreServicesService:()=>It,DummyDataService:()=>La,EventBusService:()=>vi,MfeLoaderService:()=>Ka,ProductCategory:()=>Br,RoleService:()=>ja,STORAGE_CONFIG:()=>ve,STORAGE_KEYS:()=>_e,SalesStatus:()=>Tt,SseControlService:()=>Ya,SseFromEventService:()=>Xa,UserProfileService:()=>$a,UserRole:()=>T,authInterceptor:()=>Qa,getStorage:()=>rn,getStorageItem:()=>it,hasRequiredRole:()=>wi,removeStorageItem:()=>Zr,setStorageItem:()=>Gr});var D=N(4438);let It=(()=>{class n{constructor(){}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=D.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var h=N(467),le=N(4412);function U(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(n);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(e[r[o]]=n[r[o]])}return e}"function"==typeof SuppressedError&&SuppressedError;var G=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},X={},de={};Object.defineProperty(de,"__esModule",{value:!0});var be=function(){function n(){var t=this;this.locked=new Map,this.addToLocked=function(e,r){var o=t.locked.get(e);void 0===o?t.locked.set(e,void 0===r?[]:[r]):void 0!==r&&(o.unshift(r),t.locked.set(e,o))},this.isLocked=function(e){return t.locked.has(e)},this.lock=function(e){return new Promise(function(r,o){t.isLocked(e)?t.addToLocked(e,r):(t.addToLocked(e),r())})},this.unlock=function(e){var r=t.locked.get(e);if(void 0!==r&&0!==r.length){var o=r.pop();t.locked.set(e,r),void 0!==o&&setTimeout(o,0)}else t.locked.delete(e)}}return n.getInstance=function(){return void 0===n.instance&&(n.instance=new n),n.instance},n}();de.default=function(){return be.getInstance()};var W=G&&G.__awaiter||function(n,t,e,r){return new(e||(e=Promise))(function(o,s){function i(l){try{c(r.next(l))}catch(u){s(u)}}function a(l){try{c(r.throw(l))}catch(u){s(u)}}function c(l){l.done?o(l.value):new e(function(u){u(l.value)}).then(i,a)}c((r=r.apply(n,t||[])).next())})},Y=G&&G.__generator||function(n,t){var e,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(l){return function(u){if(e)throw new TypeError("Generator is already executing.");for(;i;)try{if(e=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){i.label=u[1];break}if(6===u[0]&&i.label<o[1]){i.label=o[1],o=u;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(u);break}o[2]&&i.ops.pop(),i.trys.pop();continue}u=t.call(n,i)}catch(d){u=[6,d],r=0}finally{e=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([c,l])}}},he=G;Object.defineProperty(X,"__esModule",{value:!0});var Xe=de,Pt={key:function(n){return W(he,void 0,void 0,function(){return Y(this,function(t){throw new Error("Unsupported")})})},getItem:function(n){return W(he,void 0,void 0,function(){return Y(this,function(t){throw new Error("Unsupported")})})},clear:function(){return W(he,void 0,void 0,function(){return Y(this,function(n){return[2,window.localStorage.clear()]})})},removeItem:function(n){return W(he,void 0,void 0,function(){return Y(this,function(t){throw new Error("Unsupported")})})},setItem:function(n,t){return W(he,void 0,void 0,function(){return Y(this,function(e){throw new Error("Unsupported")})})},keySync:function(n){return window.localStorage.key(n)},getItemSync:function(n){return window.localStorage.getItem(n)},clearSync:function(){return window.localStorage.clear()},removeItemSync:function(n){return window.localStorage.removeItem(n)},setItemSync:function(n,t){return window.localStorage.setItem(n,t)}};function an(n){return new Promise(function(t){return setTimeout(t,n)})}function cn(n){for(var e="",r=0;r<n;r++)e+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz"[Math.floor(61*Math.random())];return e}var Ri=function(){function n(t){this.acquiredIatSet=new Set,this.storageHandler=void 0,this.id=Date.now().toString()+cn(15),this.acquireLock=this.acquireLock.bind(this),this.releaseLock=this.releaseLock.bind(this),this.releaseLock__private__=this.releaseLock__private__.bind(this),this.waitForSomethingToChange=this.waitForSomethingToChange.bind(this),this.refreshLockWhileAcquired=this.refreshLockWhileAcquired.bind(this),this.storageHandler=t,void 0===n.waiters&&(n.waiters=[])}return n.prototype.acquireLock=function(t,e){return void 0===e&&(e=5e3),W(this,void 0,void 0,function(){var r,o,s,i,a,c,l;return Y(this,function(u){switch(u.label){case 0:r=Date.now()+cn(4),o=Date.now()+e,s="browser-tabs-lock-key-"+t,i=void 0===this.storageHandler?Pt:this.storageHandler,u.label=1;case 1:return Date.now()<o?[4,an(30)]:[3,8];case 2:return u.sent(),null!==i.getItemSync(s)?[3,5]:(a=this.id+"-"+t+"-"+r,[4,an(Math.floor(25*Math.random()))]);case 3:return u.sent(),i.setItemSync(s,JSON.stringify({id:this.id,iat:r,timeoutKey:a,timeAcquired:Date.now(),timeRefreshed:Date.now()})),[4,an(30)];case 4:return u.sent(),null!==(c=i.getItemSync(s))&&(l=JSON.parse(c)).id===this.id&&l.iat===r?(this.acquiredIatSet.add(r),this.refreshLockWhileAcquired(s,r),[2,!0]):[3,7];case 5:return n.lockCorrector(void 0===this.storageHandler?Pt:this.storageHandler),[4,this.waitForSomethingToChange(o)];case 6:u.sent(),u.label=7;case 7:return r=Date.now()+cn(4),[3,1];case 8:return[2,!1]}})})},n.prototype.refreshLockWhileAcquired=function(t,e){return W(this,void 0,void 0,function(){var r=this;return Y(this,function(o){return setTimeout(function(){return W(r,void 0,void 0,function(){var s,i,a;return Y(this,function(c){switch(c.label){case 0:return[4,Xe.default().lock(e)];case 1:return c.sent(),this.acquiredIatSet.has(e)?null===(i=(s=void 0===this.storageHandler?Pt:this.storageHandler).getItemSync(t))?(Xe.default().unlock(e),[2]):((a=JSON.parse(i)).timeRefreshed=Date.now(),s.setItemSync(t,JSON.stringify(a)),Xe.default().unlock(e),this.refreshLockWhileAcquired(t,e),[2]):(Xe.default().unlock(e),[2])}})})},1e3),[2]})})},n.prototype.waitForSomethingToChange=function(t){return W(this,void 0,void 0,function(){return Y(this,function(e){switch(e.label){case 0:return[4,new Promise(function(r){var o=!1,s=Date.now(),i=!1;function a(){if(i||(window.removeEventListener("storage",a),n.removeFromWaiting(a),clearTimeout(c),i=!0),!o){o=!0;var l=50-(Date.now()-s);l>0?setTimeout(r,l):r(null)}}window.addEventListener("storage",a),n.addToWaiting(a);var c=setTimeout(a,Math.max(0,t-Date.now()))})];case 1:return e.sent(),[2]}})})},n.addToWaiting=function(t){this.removeFromWaiting(t),void 0!==n.waiters&&n.waiters.push(t)},n.removeFromWaiting=function(t){void 0!==n.waiters&&(n.waiters=n.waiters.filter(function(e){return e!==t}))},n.notifyWaiters=function(){void 0!==n.waiters&&n.waiters.slice().forEach(function(t){return t()})},n.prototype.releaseLock=function(t){return W(this,void 0,void 0,function(){return Y(this,function(e){switch(e.label){case 0:return[4,this.releaseLock__private__(t)];case 1:return[2,e.sent()]}})})},n.prototype.releaseLock__private__=function(t){return W(this,void 0,void 0,function(){var e,r,o,s;return Y(this,function(i){switch(i.label){case 0:return null===(o=(e=void 0===this.storageHandler?Pt:this.storageHandler).getItemSync(r="browser-tabs-lock-key-"+t))?[2]:(s=JSON.parse(o)).id!==this.id?[3,2]:[4,Xe.default().lock(s.iat)];case 1:i.sent(),this.acquiredIatSet.delete(s.iat),e.removeItemSync(r),Xe.default().unlock(s.iat),n.notifyWaiters(),i.label=2;case 2:return[2]}})})},n.lockCorrector=function(t){for(var e=Date.now()-5e3,r=t,o=[],s=0;;){var i=r.keySync(s);if(null===i)break;o.push(i),s++}for(var a=!1,c=0;c<o.length;c++){var l=o[c];if(l.includes("browser-tabs-lock-key")){var u=r.getItemSync(l);if(null!==u){var d=JSON.parse(u);(void 0===d.timeRefreshed&&d.timeAcquired<e||void 0!==d.timeRefreshed&&d.timeRefreshed<e)&&(r.removeItemSync(l),a=!0)}}}a&&n.notifyWaiters()},n.waiters=void 0,n}(),Ii=X.default=Ri;const Pi={timeoutInSeconds:60},Xr={name:"auth0-spa-js",version:"2.12.0"},Yr=()=>Date.now();class L extends Error{constructor(t,e){super(e),this.error=t,this.error_description=e,Object.setPrototypeOf(this,L.prototype)}static fromPayload(t){let{error:e,error_description:r}=t;return new L(e,r)}}class un extends L{constructor(t,e,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(t,e),this.state=r,this.appState=o,Object.setPrototypeOf(this,un.prototype)}}class ln extends L{constructor(t,e,r,o){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;super(t,e),this.connection=r,this.state=o,this.appState=s,Object.setPrototypeOf(this,ln.prototype)}}class Ye extends L{constructor(){super("timeout","Timeout"),Object.setPrototypeOf(this,Ye.prototype)}}class dn extends Ye{constructor(t){super(),this.popup=t,Object.setPrototypeOf(this,dn.prototype)}}class hn extends L{constructor(t){super("cancelled","Popup closed"),this.popup=t,Object.setPrototypeOf(this,hn.prototype)}}class pn extends L{constructor(){super("popup_open","Unable to open a popup for loginWithPopup - window.open returned `null`"),Object.setPrototypeOf(this,pn.prototype)}}class mn extends L{constructor(t,e,r){super(t,e),this.mfa_token=r,Object.setPrototypeOf(this,mn.prototype)}}class Ct extends L{constructor(t,e){super("missing_refresh_token","Missing Refresh Token (audience: '".concat(Dt(t,["default"]),"', scope: '").concat(Dt(e),"')")),this.audience=t,this.scope=e,Object.setPrototypeOf(this,Ct.prototype)}}class fn extends L{constructor(t,e){super("missing_scopes","Missing requested scopes after refresh (audience: '".concat(Dt(t,["default"]),"', missing scope: '").concat(Dt(e),"')")),this.audience=t,this.scope=e,Object.setPrototypeOf(this,fn.prototype)}}class Ot extends L{constructor(t){super("use_dpop_nonce","Server rejected DPoP proof: wrong nonce"),this.newDpopNonce=t,Object.setPrototypeOf(this,Ot.prototype)}}function Dt(n){return n&&!(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).includes(n)?n:""}const Ut=()=>window.crypto,st=()=>{let t="";return Array.from(Ut().getRandomValues(new Uint8Array(43))).forEach(e=>t+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_~."[e%66]),t},gn=n=>btoa(n),Ci=[{key:"name",type:["string"]},{key:"version",type:["string","number"]},{key:"env",type:["object"]}],Oi=n=>Object.keys(n).reduce((t,e)=>{const r=Ci.find(o=>o.key===e);return r&&r.type.includes(typeof n[e])&&(t[e]=n[e]),t},{}),yn=n=>{var r,{clientId:t}=n,e=U(n,["clientId"]);return new URLSearchParams((r=Object.assign({client_id:t},e),Object.keys(r).filter(o=>void 0!==r[o]).reduce((o,s)=>Object.assign(Object.assign({},o),{[s]:r[s]}),{}))).toString()},qr=function(){var n=(0,h.A)(function*(t){return yield Ut().subtle.digest({name:"SHA-256"},(new TextEncoder).encode(t))});return function(e){return n.apply(this,arguments)}}(),$r=n=>{return t=n.replace(/_/g,"/").replace(/-/g,"+"),decodeURIComponent(atob(t).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""));var t},Qr=n=>{const t=new Uint8Array(n);return(e=>{const r={"+":"-","/":"_","=":""};return e.replace(/[+/=]/g,o=>r[o])})(window.btoa(String.fromCharCode(...Array.from(t))))},Di=new TextEncoder,Ui=new TextDecoder;function at(n){return"string"==typeof n?Di.encode(n):Ui.decode(n)}function eo(n){if("number"!=typeof n.modulusLength||n.modulusLength<2048)throw new Li(`${n.name} modulusLength must be at least 2048 bits`)}function vn(){return(vn=(0,h.A)(function*(n,t,e){if(!1===e.usages.includes("sign"))throw new TypeError('private CryptoKey instances used for signing assertions must include "sign" in their "usages"');const r=`${ct(at(JSON.stringify(n)))}.${ct(at(JSON.stringify(t)))}`;return`${r}.${ct(yield crypto.subtle.sign(function(o){switch(o.algorithm.name){case"ECDSA":return{name:o.algorithm.name,hash:"SHA-256"};case"RSA-PSS":return eo(o.algorithm),{name:o.algorithm.name,saltLength:32};case"RSASSA-PKCS1-v1_5":return eo(o.algorithm),{name:o.algorithm.name};case"Ed25519":return{name:o.algorithm.name}}throw new je}(e),e,at(r)))}`})).apply(this,arguments)}let _n;function ct(n){return _n(n)}_n=Uint8Array.prototype.toBase64?n=>(n instanceof ArrayBuffer&&(n=new Uint8Array(n)),n.toBase64({alphabet:"base64url",omitPadding:!0})):t=>{t instanceof ArrayBuffer&&(t=new Uint8Array(t));const e=[];for(let r=0;r<t.byteLength;r+=32768)e.push(String.fromCharCode.apply(null,t.subarray(r,r+32768)));return btoa(e.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")};class je extends Error{constructor(t){var e;super(t??"operation not supported"),this.name=this.constructor.name,null===(e=Error.captureStackTrace)||void 0===e||e.call(Error,this,this.constructor)}}class Li extends Error{constructor(t){var e;super(t),this.name=this.constructor.name,null===(e=Error.captureStackTrace)||void 0===e||e.call(Error,this,this.constructor)}}function Ni(n){switch(n.algorithm.name){case"RSA-PSS":return function(t){if("SHA-256"===t.algorithm.hash.name)return"PS256";throw new je("unsupported RsaHashedKeyAlgorithm hash name")}(n);case"RSASSA-PKCS1-v1_5":return function(t){if("SHA-256"===t.algorithm.hash.name)return"RS256";throw new je("unsupported RsaHashedKeyAlgorithm hash name")}(n);case"ECDSA":return function(t){if("P-256"===t.algorithm.namedCurve)return"ES256";throw new je("unsupported EcKeyAlgorithm namedCurve")}(n);case"Ed25519":return"Ed25519";default:throw new je("unsupported CryptoKey algorithm name")}}function to(n){return n instanceof CryptoKey}function no(n){return to(n)&&"public"===n.type}function wn(){return wn=(0,h.A)(function*(n,t,e,r,o,s){const i=n?.privateKey,a=n?.publicKey;if(!to(c=i)||"private"!==c.type)throw new TypeError('"keypair.privateKey" must be a private CryptoKey');var c;if(!no(a))throw new TypeError('"keypair.publicKey" must be a public CryptoKey');if(!0!==a.extractable)throw new TypeError('"keypair.publicKey.extractable" must be true');if("string"!=typeof t)throw new TypeError('"htu" must be a string');if("string"!=typeof e)throw new TypeError('"htm" must be a string');if(void 0!==r&&"string"!=typeof r)throw new TypeError('"nonce" must be a string or undefined');if(void 0!==o&&"string"!=typeof o)throw new TypeError('"accessToken" must be a string or undefined');if(void 0!==s&&("object"!=typeof s||null===s||Array.isArray(s)))throw new TypeError('"additional" must be an object');return function ji(n,t,e){return vn.apply(this,arguments)}({alg:Ni(i),typ:"dpop+jwt",jwk:yield ro(a)},Object.assign(Object.assign({},s),{iat:Math.floor(Date.now()/1e3),jti:crypto.randomUUID(),htm:e,nonce:r,htu:t,ath:o?ct(yield crypto.subtle.digest("SHA-256",at(o))):void 0}),i)}),wn.apply(this,arguments)}function ro(n){return bn.apply(this,arguments)}function bn(){return(bn=(0,h.A)(function*(n){const{kty:t,e,n:r,x:o,y:s,crv:i}=yield crypto.subtle.exportKey("jwk",n);return{kty:t,crv:i,e,n:r,x:o,y:s}})).apply(this,arguments)}const Mi=["authorization_code","refresh_token","urn:ietf:params:oauth:grant-type:token-exchange"];const Ji=function(){var n=(0,h.A)(function*(t,e){const r=yield fetch(t,e);return{ok:r.ok,json:yield r.json(),headers:(o=r.headers,[...o].reduce((s,i)=>{let[a,c]=i;return s[a]=c,s},{}))};var o});return function(e,r){return n.apply(this,arguments)}}(),Vi=function(){var n=(0,h.A)(function*(t,e,r){const o=new AbortController;let s;return e.signal=o.signal,Promise.race([Ji(t,e),new Promise((i,a)=>{s=setTimeout(()=>{o.abort(),a(new Error("Timeout when executing 'fetch'"))},r)})]).finally(()=>{clearTimeout(s)})});return function(e,r,o){return n.apply(this,arguments)}}(),Fi=function(){var n=(0,h.A)(function*(t,e,r,o,s,i,a,c){return l={auth:{audience:e,scope:r},timeout:s,fetchUrl:t,fetchOptions:o,useFormData:a,useMrrt:c},u=i,new Promise(function(d,m){const p=new MessageChannel;p.port1.onmessage=function(y){y.data.error?m(new Error(y.data.error)):d(y.data),p.port1.close()},u.postMessage(l,[p.port2])});var l,u});return function(e,r,o,s,i,a,c,l){return n.apply(this,arguments)}}(),Gi=function(){var n=(0,h.A)(function*(t,e,r,o,s,i){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1e4;return s?Fi(t,e,r,o,a,s,i,arguments.length>7?arguments[7]:void 0):Vi(t,o,a)});return function(e,r,o,s,i,a){return n.apply(this,arguments)}}();function oo(n,t,e,r,o,s,i,a,c,l){return Sn.apply(this,arguments)}function Sn(){return(Sn=(0,h.A)(function*(n,t,e,r,o,s,i,a,c,l){if(c){const A=yield c.generateProof({url:n,method:o.method||"GET",nonce:yield c.getNonce()});o.headers=Object.assign(Object.assign({},o.headers),{dpop:A})}let u,d=null;for(let A=0;A<3;A++)try{u=yield Gi(n,e,r,o,s,i,t,a),d=null;break}catch(E){d=E}if(d)throw d;const m=u.json,{error:p,error_description:y}=m,g=U(m,["error","error_description"]),{headers:f,ok:v}=u;let _;if(c&&(_=f["dpop-nonce"],_&&(yield c.setNonce(_))),!v){const A=y||"HTTP error. Unable to fetch ".concat(n);if("mfa_required"===p)throw new mn(p,A,g.mfa_token);if("missing_refresh_token"===p)throw new Ct(e,r);if("use_dpop_nonce"===p){if(!c||!_||l)throw new Ot(_);return oo(n,t,e,r,o,s,i,a,c,!0)}throw new L(p||"request_error",A)}return g})).apply(this,arguments)}function An(){return(An=(0,h.A)(function*(n,t){var{baseUrl:e,timeout:r,audience:o,scope:s,auth0Client:i,useFormData:a,useMrrt:c,dpop:l}=n,u=U(n,["baseUrl","timeout","audience","scope","auth0Client","useFormData","useMrrt","dpop"]);const d="urn:ietf:params:oauth:grant-type:token-exchange"===u.grant_type,m="refresh_token"===u.grant_type&&c,p=Object.assign(Object.assign(Object.assign(Object.assign({},u),d&&o&&{audience:o}),d&&s&&{scope:s}),m&&{audience:o,scope:s}),y=a?yn(p):JSON.stringify(p),g=Mi.includes(u.grant_type);return yield oo("".concat(e,"/oauth/token"),r,o||"default",s,{method:"POST",body:y,headers:{"Content-Type":a?"application/x-www-form-urlencoded":"application/json","Auth0-Client":btoa(JSON.stringify(Oi(i||Xr)))}},t,a,c,g?l:void 0)})).apply(this,arguments)}const jt=function(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];return(n=>Array.from(new Set(n)))(t.filter(Boolean).join(" ").trim().split(/\s+/)).join(" ")},Lt=(n,t,e)=>{let r;return e&&(r=n[e]),r||(r=n.default),jt(r,t)};class re{constructor(t){let r=arguments.length>2?arguments[2]:void 0;this.prefix=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"@@auth0spajs@@",this.suffix=r,this.clientId=t.clientId,this.scope=t.scope,this.audience=t.audience}toKey(){return[this.prefix,this.clientId,this.audience,this.scope,this.suffix].filter(Boolean).join("::")}static fromKey(t){const[e,r,o,s]=t.split("::");return new re({clientId:r,scope:s,audience:o},e)}static fromCacheEntry(t){const{scope:e,audience:r,client_id:o}=t;return new re({scope:e,audience:r,clientId:o})}}class Xi{set(t,e){localStorage.setItem(t,JSON.stringify(e))}get(t){const e=window.localStorage.getItem(t);if(e)try{return JSON.parse(e)}catch{return}}remove(t){localStorage.removeItem(t)}allKeys(){return Object.keys(window.localStorage).filter(t=>t.startsWith("@@auth0spajs@@"))}}class io{constructor(){this.enclosedCache=function(){let t={};return{set(e,r){t[e]=r},get(e){const r=t[e];if(r)return r},remove(e){delete t[e]},allKeys:()=>Object.keys(t)}}()}}class Yi{constructor(t,e,r){this.cache=t,this.keyManifest=e,this.nowProvider=r||Yr}setIdToken(t,e,r){var o=this;return(0,h.A)(function*(){var s;const i=o.getIdTokenCacheKey(t);yield o.cache.set(i,{id_token:e,decodedToken:r}),yield null===(s=o.keyManifest)||void 0===s?void 0:s.add(i)})()}getIdToken(t){var e=this;return(0,h.A)(function*(){const r=yield e.cache.get(e.getIdTokenCacheKey(t.clientId));if(!r&&t.scope&&t.audience){const o=yield e.get(t);return o&&o.id_token&&o.decodedToken?{id_token:o.id_token,decodedToken:o.decodedToken}:void 0}if(r)return{id_token:r.id_token,decodedToken:r.decodedToken}})()}get(t){var e=arguments,r=this;return(0,h.A)(function*(){let o=e.length>1&&void 0!==e[1]?e[1]:0,s=e.length>2&&void 0!==e[2]&&e[2],i=e.length>3?e[3]:void 0;var a;let c=yield r.cache.get(t.toKey());if(!c){const d=yield r.getCacheKeys();if(!d)return;const m=r.matchExistingCacheKey(t,d);if(m&&(c=yield r.cache.get(m)),!c&&s&&"cache-only"!==i)return r.getEntryWithRefreshToken(t,d)}if(!c)return;const l=yield r.nowProvider(),u=Math.floor(l/1e3);return c.expiresAt-o<u?c.body.refresh_token?r.modifiedCachedEntry(c,t):(yield r.cache.remove(t.toKey()),void(yield null===(a=r.keyManifest)||void 0===a?void 0:a.remove(t.toKey()))):c.body})()}modifiedCachedEntry(t,e){var r=this;return(0,h.A)(function*(){return t.body={refresh_token:t.body.refresh_token,audience:t.body.audience,scope:t.body.scope},yield r.cache.set(e.toKey(),t),{refresh_token:t.body.refresh_token,audience:t.body.audience,scope:t.body.scope}})()}set(t){var e=this;return(0,h.A)(function*(){var r;const o=new re({clientId:t.client_id,scope:t.scope,audience:t.audience}),s=yield e.wrapCacheEntry(t);yield e.cache.set(o.toKey(),s),yield null===(r=e.keyManifest)||void 0===r?void 0:r.add(o.toKey())})()}remove(t,e,r){var o=this;return(0,h.A)(function*(){const s=new re({clientId:t,scope:r,audience:e});yield o.cache.remove(s.toKey())})()}clear(t){var e=this;return(0,h.A)(function*(){var r;const o=yield e.getCacheKeys();o&&(yield o.filter(s=>!t||s.includes(t)).reduce(function(){var s=(0,h.A)(function*(i,a){yield i,yield e.cache.remove(a)});return function(i,a){return s.apply(this,arguments)}}(),Promise.resolve()),yield null===(r=e.keyManifest)||void 0===r?void 0:r.clear())})()}wrapCacheEntry(t){var e=this;return(0,h.A)(function*(){const r=yield e.nowProvider();return{body:t,expiresAt:Math.floor(r/1e3)+t.expires_in}})()}getCacheKeys(){var t=this;return(0,h.A)(function*(){var e;return t.keyManifest?null===(e=yield t.keyManifest.get())||void 0===e?void 0:e.keys:t.cache.allKeys?t.cache.allKeys():void 0})()}getIdTokenCacheKey(t){return new re({clientId:t},"@@auth0spajs@@","@@user@@").toKey()}matchExistingCacheKey(t,e){return e.filter(r=>{var o;const s=re.fromKey(r),i=new Set(s.scope&&s.scope.split(" ")),a=(null===(o=t.scope)||void 0===o?void 0:o.split(" "))||[],c=s.scope&&a.reduce((l,u)=>l&&i.has(u),!0);return"@@auth0spajs@@"===s.prefix&&s.clientId===t.clientId&&s.audience===t.audience&&c})[0]}getEntryWithRefreshToken(t,e){var r=this;return(0,h.A)(function*(){var o;for(const s of e){const i=re.fromKey(s);if("@@auth0spajs@@"===i.prefix&&i.clientId===t.clientId){const a=yield r.cache.get(s);if(null!==(o=a?.body)&&void 0!==o&&o.refresh_token)return r.modifiedCachedEntry(a,t)}}})()}updateEntry(t,e){var r=this;return(0,h.A)(function*(){var o;const s=yield r.getCacheKeys();if(s)for(const i of s){const a=yield r.cache.get(i);if((null===(o=a?.body)||void 0===o?void 0:o.refresh_token)===t){const c=Object.assign(Object.assign({},a.body),{refresh_token:e});yield r.set(c)}}})()}}class qi{constructor(t,e,r){this.storage=t,this.clientId=e,this.cookieDomain=r,this.storageKey="".concat("a0.spajs.txs",".").concat(this.clientId)}create(t){this.storage.save(this.storageKey,t,{daysUntilExpire:1,cookieDomain:this.cookieDomain})}get(){return this.storage.get(this.storageKey)}remove(){this.storage.remove(this.storageKey,{cookieDomain:this.cookieDomain})}}const ut=n=>"number"==typeof n,$i=["iss","aud","exp","nbf","iat","jti","azp","nonce","auth_time","at_hash","c_hash","acr","amr","sub_jwk","cnf","sip_from_tag","sip_date","sip_callid","sip_cseq_num","sip_via_branch","orig","dest","mky","events","toe","txn","rph","sid","vot","vtm"];var lt=G&&G.__assign||function(){return lt=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n},lt.apply(this,arguments)};function dt(n,t){if(!t)return"";var e="; "+n;return!0===t?e:e+"="+t}function so(n,t,e){document.cookie=function es(n,t,e){return encodeURIComponent(n).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/\(/g,"%28").replace(/\)/g,"%29")+"="+encodeURIComponent(t).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent)+function(r){if("number"==typeof r.expires){var o=new Date;o.setMilliseconds(o.getMilliseconds()+864e5*r.expires),r.expires=o}return dt("Expires",r.expires?r.expires.toUTCString():"")+dt("Domain",r.domain)+dt("Path",r.path)+dt("Secure",r.secure)+dt("SameSite",r.sameSite)}(e)}(n,t,lt({path:"/"},e))}var ao=so,co=function(n,t){so(n,"",lt(lt({},t),{expires:-1}))};const qe={get(n){const t=function(n){return function ts(){return function(n){for(var t={},e=n?n.split("; "):[],r=/(%[\dA-F]{2})+/gi,o=0;o<e.length;o++){var s=e[o].split("="),i=s.slice(1).join("=");'"'===i.charAt(0)&&(i=i.slice(1,-1));try{t[s[0].replace(r,decodeURIComponent)]=i.replace(r,decodeURIComponent)}catch{}}return t}(document.cookie)}()[n]}(n);if(void 0!==t)return JSON.parse(t)},save(n,t,e){let r={};"https:"===window.location.protocol&&(r={secure:!0,sameSite:"none"}),e?.daysUntilExpire&&(r.expires=e.daysUntilExpire),e?.cookieDomain&&(r.domain=e.cookieDomain),ao(n,JSON.stringify(t),r)},remove(n,t){let e={};t?.cookieDomain&&(e.domain=t.cookieDomain),co(n,e)}},rs={get:n=>qe.get(n)||qe.get("".concat("_legacy_").concat(n)),save(n,t,e){let r={};"https:"===window.location.protocol&&(r={secure:!0}),e?.daysUntilExpire&&(r.expires=e.daysUntilExpire),e?.cookieDomain&&(r.domain=e.cookieDomain),ao("".concat("_legacy_").concat(n),JSON.stringify(t),r),qe.save(n,t,e)},remove(n,t){let e={};t?.cookieDomain&&(e.domain=t.cookieDomain),co(n,e),qe.remove(n,t),qe.remove("".concat("_legacy_").concat(n),t)}},os={get(n){if(typeof sessionStorage>"u")return;const t=sessionStorage.getItem(n);return null!=t?JSON.parse(t):void 0},save(n,t){sessionStorage.setItem(n,JSON.stringify(t))},remove(n){sessionStorage.removeItem(n)}};var Le,n;(n=Le||(Le={})).Code="code",n.ConnectCode="connect_code";var kn,ss=function(n){return kn=kn||function is(n,t,e){var r=void 0===t?null:t,o=function(c,l){var u=atob(c);if(l){for(var d=new Uint8Array(u.length),m=0,p=u.length;m<p;++m)d[m]=u.charCodeAt(m);return String.fromCharCode.apply(null,new Uint16Array(d.buffer))}return u}(n,void 0!==e&&e),s=o.indexOf("\n",10)+1,i=o.substring(s)+(r?"//# sourceMappingURL="+r:""),a=new Blob([i],{type:"application/javascript"});return URL.createObjectURL(a)}("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7Y2xhc3MgZSBleHRlbmRzIEVycm9ye2NvbnN0cnVjdG9yKHQscil7c3VwZXIociksdGhpcy5lcnJvcj10LHRoaXMuZXJyb3JfZGVzY3JpcHRpb249cixPYmplY3Quc2V0UHJvdG90eXBlT2YodGhpcyxlLnByb3RvdHlwZSl9c3RhdGljIGZyb21QYXlsb2FkKHQpe2xldHtlcnJvcjpyLGVycm9yX2Rlc2NyaXB0aW9uOnN9PXQ7cmV0dXJuIG5ldyBlKHIscyl9fWNsYXNzIHQgZXh0ZW5kcyBle2NvbnN0cnVjdG9yKGUscyl7c3VwZXIoIm1pc3NpbmdfcmVmcmVzaF90b2tlbiIsIk1pc3NpbmcgUmVmcmVzaCBUb2tlbiAoYXVkaWVuY2U6ICciLmNvbmNhdChyKGUsWyJkZWZhdWx0Il0pLCInLCBzY29wZTogJyIpLmNvbmNhdChyKHMpLCInKSIpKSx0aGlzLmF1ZGllbmNlPWUsdGhpcy5zY29wZT1zLE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLHQucHJvdG90eXBlKX19ZnVuY3Rpb24gcihlKXtsZXQgdD1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06W107cmV0dXJuIGUmJiF0LmluY2x1ZGVzKGUpP2U6IiJ9ImZ1bmN0aW9uIj09dHlwZW9mIFN1cHByZXNzZWRFcnJvciYmU3VwcHJlc3NlZEVycm9yO2NvbnN0IHM9ZT0+e3ZhcntjbGllbnRJZDp0fT1lLHI9ZnVuY3Rpb24oZSx0KXt2YXIgcj17fTtmb3IodmFyIHMgaW4gZSlPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSxzKSYmdC5pbmRleE9mKHMpPDAmJihyW3NdPWVbc10pO2lmKG51bGwhPWUmJiJmdW5jdGlvbiI9PXR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKXt2YXIgbz0wO2ZvcihzPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7bzxzLmxlbmd0aDtvKyspdC5pbmRleE9mKHNbb10pPDAmJk9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChlLHNbb10pJiYocltzW29dXT1lW3Nbb11dKX1yZXR1cm4gcn0oZSxbImNsaWVudElkIl0pO3JldHVybiBuZXcgVVJMU2VhcmNoUGFyYW1zKChlPT5PYmplY3Qua2V5cyhlKS5maWx0ZXIoKHQ9PnZvaWQgMCE9PWVbdF0pKS5yZWR1Y2UoKCh0LHIpPT5PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sdCkse1tyXTplW3JdfSkpLHt9KSkoT2JqZWN0LmFzc2lnbih7Y2xpZW50X2lkOnR9LHIpKSkudG9TdHJpbmcoKX07bGV0IG89e307Y29uc3Qgbj0oZSx0KT0+IiIuY29uY2F0KGUsInwiKS5jb25jYXQodCk7YWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsKGFzeW5jIGU9PntsZXQgcixjLHtkYXRhOnt0aW1lb3V0OmksYXV0aDphLGZldGNoVXJsOmYsZmV0Y2hPcHRpb25zOmwsdXNlRm9ybURhdGE6cCx1c2VNcnJ0Omh9LHBvcnRzOlt1XX09ZSxkPXt9O2NvbnN0e2F1ZGllbmNlOmcsc2NvcGU6eX09YXx8e307dHJ5e2NvbnN0IGU9cD8oZT0+e2NvbnN0IHQ9bmV3IFVSTFNlYXJjaFBhcmFtcyhlKSxyPXt9O3JldHVybiB0LmZvckVhY2goKChlLHQpPT57clt0XT1lfSkpLHJ9KShsLmJvZHkpOkpTT04ucGFyc2UobC5ib2R5KTtpZighZS5yZWZyZXNoX3Rva2VuJiYicmVmcmVzaF90b2tlbiI9PT1lLmdyYW50X3R5cGUpe2lmKGM9KChlLHQpPT5vW24oZSx0KV0pKGcseSksIWMmJmgpe2NvbnN0IGU9by5sYXRlc3RfcmVmcmVzaF90b2tlbix0PSgoZSx0KT0+e2NvbnN0IHI9T2JqZWN0LmtleXMobykuZmluZCgocj0+e2lmKCJsYXRlc3RfcmVmcmVzaF90b2tlbiIhPT1yKXtjb25zdCBzPSgoZSx0KT0+dC5zdGFydHNXaXRoKCIiLmNvbmNhdChlLCJ8IikpKSh0LHIpLG89ci5zcGxpdCgifCIpWzFdLnNwbGl0KCIgIiksbj1lLnNwbGl0KCIgIikuZXZlcnkoKGU9Pm8uaW5jbHVkZXMoZSkpKTtyZXR1cm4gcyYmbn19KSk7cmV0dXJuISFyfSkoeSxnKTtlJiYhdCYmKGM9ZSl9aWYoIWMpdGhyb3cgbmV3IHQoZyx5KTtsLmJvZHk9cD9zKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxlKSx7cmVmcmVzaF90b2tlbjpjfSkpOkpTT04uc3RyaW5naWZ5KE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxlKSx7cmVmcmVzaF90b2tlbjpjfSkpfWxldCBhLGs7ImZ1bmN0aW9uIj09dHlwZW9mIEFib3J0Q29udHJvbGxlciYmKGE9bmV3IEFib3J0Q29udHJvbGxlcixsLnNpZ25hbD1hLnNpZ25hbCk7dHJ5e2s9YXdhaXQgUHJvbWlzZS5yYWNlKFsoaj1pLG5ldyBQcm9taXNlKChlPT5zZXRUaW1lb3V0KGUsaikpKSksZmV0Y2goZixPYmplY3QuYXNzaWduKHt9LGwpKV0pfWNhdGNoKGUpe3JldHVybiB2b2lkIHUucG9zdE1lc3NhZ2Uoe2Vycm9yOmUubWVzc2FnZX0pfWlmKCFrKXJldHVybiBhJiZhLmFib3J0KCksdm9pZCB1LnBvc3RNZXNzYWdlKHtlcnJvcjoiVGltZW91dCB3aGVuIGV4ZWN1dGluZyAnZmV0Y2gnIn0pO189ay5oZWFkZXJzLGQ9Wy4uLl9dLnJlZHVjZSgoKGUsdCk9PntsZXRbcixzXT10O3JldHVybiBlW3JdPXMsZX0pLHt9KSxyPWF3YWl0IGsuanNvbigpLHIucmVmcmVzaF90b2tlbj8oaCYmKG8ubGF0ZXN0X3JlZnJlc2hfdG9rZW49ci5yZWZyZXNoX3Rva2VuLE89YyxiPXIucmVmcmVzaF90b2tlbixPYmplY3QuZW50cmllcyhvKS5mb3JFYWNoKChlPT57bGV0W3Qscl09ZTtyPT09TyYmKG9bdF09Yil9KSkpLCgoZSx0LHIpPT57b1tuKHQscildPWV9KShyLnJlZnJlc2hfdG9rZW4sZyx5KSxkZWxldGUgci5yZWZyZXNoX3Rva2VuKTooKGUsdCk9PntkZWxldGUgb1tuKGUsdCldfSkoZyx5KSx1LnBvc3RNZXNzYWdlKHtvazprLm9rLGpzb246cixoZWFkZXJzOmR9KX1jYXRjaChlKXt1LnBvc3RNZXNzYWdlKHtvazohMSxqc29uOntlcnJvcjplLmVycm9yLGVycm9yX2Rlc2NyaXB0aW9uOmUubWVzc2FnZX0saGVhZGVyczpkfSl9dmFyIE8sYixfLGp9KSl9KCk7Cgo=",null,!1),new Worker(kn,n)};const En={},po=function(){var n=(0,h.A)(function*(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;for(let r=0;r<e;r++)if(yield t())return!0;return!1});return function(e){return n.apply(this,arguments)}}();class as{constructor(t,e){this.cache=t,this.clientId=e,this.manifestKey=this.createManifestKeyFrom(this.clientId)}add(t){var e=this;return(0,h.A)(function*(){var r;const o=new Set((null===(r=yield e.cache.get(e.manifestKey))||void 0===r?void 0:r.keys)||[]);o.add(t),yield e.cache.set(e.manifestKey,{keys:[...o]})})()}remove(t){var e=this;return(0,h.A)(function*(){const r=yield e.cache.get(e.manifestKey);if(r){const o=new Set(r.keys);return o.delete(t),o.size>0?yield e.cache.set(e.manifestKey,{keys:[...o]}):yield e.cache.remove(e.manifestKey)}})()}get(){return this.cache.get(this.manifestKey)}clear(){return this.cache.remove(this.manifestKey)}createManifestKeyFrom(t){return"".concat("@@auth0spajs@@","::").concat(t)}}const cs={memory:()=>(new io).enclosedCache,localstorage:()=>new Xi},mo=n=>cs[n],fo=n=>{const{openUrl:t,onRedirect:e}=n,r=U(n,["openUrl","onRedirect"]);return Object.assign(Object.assign({},r),{openUrl:!1===t||t?t:e})},go=(n,t)=>{const e=t?.split(" ")||[];return(n?.split(" ")||[]).every(r=>e.includes(r))},Ne={NONCE:"nonce",KEYPAIR:"keypair"};class us{constructor(t){this.clientId=t}getVersion(){return 1}createDbHandle(){const t=window.indexedDB.open("auth0-spa-js",this.getVersion());return new Promise((e,r)=>{t.onupgradeneeded=()=>Object.values(Ne).forEach(o=>t.result.createObjectStore(o)),t.onerror=()=>r(t.error),t.onsuccess=()=>e(t.result)})}getDbHandle(){var t=this;return(0,h.A)(function*(){return t.dbHandle||(t.dbHandle=yield t.createDbHandle()),t.dbHandle})()}executeDbRequest(t,e,r){var o=this;return(0,h.A)(function*(){const s=r((yield o.getDbHandle()).transaction(t,e).objectStore(t));return new Promise((i,a)=>{s.onsuccess=()=>i(s.result),s.onerror=()=>a(s.error)})})()}buildKey(t){const e=t?"_".concat(t):"auth0";return"".concat(this.clientId,"::").concat(e)}setNonce(t,e){return this.save(Ne.NONCE,this.buildKey(e),t)}setKeyPair(t){return this.save(Ne.KEYPAIR,this.buildKey(),t)}save(t,e,r){var o=this;return(0,h.A)(function*(){yield o.executeDbRequest(t,"readwrite",s=>s.put(r,e))})()}findNonce(t){return this.find(Ne.NONCE,this.buildKey(t))}findKeyPair(){return this.find(Ne.KEYPAIR,this.buildKey())}find(t,e){return this.executeDbRequest(t,"readonly",r=>r.get(e))}deleteBy(t,e){var r=this;return(0,h.A)(function*(){const o=yield r.executeDbRequest(t,"readonly",s=>s.getAllKeys());o?.filter(e).map(s=>r.executeDbRequest(t,"readwrite",i=>i.delete(s)))})()}deleteByClientId(t,e){return this.deleteBy(t,r=>"string"==typeof r&&r.startsWith("".concat(e,"::")))}clearNonces(){return this.deleteByClientId(Ne.NONCE,this.clientId)}clearKeyPairs(){return this.deleteByClientId(Ne.KEYPAIR,this.clientId)}}class ls{constructor(t){this.storage=new us(t)}getNonce(t){return this.storage.findNonce(t)}setNonce(t,e){return this.storage.setNonce(t,e)}getOrGenerateKeyPair(){var t=this;return(0,h.A)(function*(){let e=yield t.storage.findKeyPair();return e||(e=yield function zi(){return(n=(0,h.A)(function*(t,e){var r;let o;if("string"!=typeof t||0===t.length)throw new TypeError('"alg" must be a non-empty string');switch(t){case"PS256":o={name:"RSA-PSS",hash:"SHA-256",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])};break;case"RS256":o={name:"RSASSA-PKCS1-v1_5",hash:"SHA-256",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])};break;case"ES256":o={name:"ECDSA",namedCurve:"P-256"};break;case"Ed25519":o={name:"Ed25519"};break;default:throw new je}return crypto.subtle.generateKey(o,null!==(r=e?.extractable)&&void 0!==r&&r,["sign","verify"])}),function(t,e){return n.apply(this,arguments)})("ES256",{extractable:!1});var n}(),yield t.storage.setKeyPair(e)),e})()}generateProof(t){var e=this;return(0,h.A)(function*(){const r=yield e.getOrGenerateKeyPair();return function Hi(n){let{keyPair:t,url:e,method:r,nonce:o,accessToken:s}=n;return function Ki(n,t,e,r,o,s){return wn.apply(this,arguments)}(t,function(a){const c=new URL(a);return c.search="",c.hash="",c.href}(e),r,o,s)}(Object.assign({keyPair:r},t))})()}calculateThumbprint(){var t=this;return(0,h.A)(function*(){return function Wi(n){return(t=(0,h.A)(function*(e){if(!no(e))throw new TypeError('"publicKey" must be a public CryptoKey');if(!0!==e.extractable)throw new TypeError('"publicKey.extractable" must be true');const r=yield ro(e);let o;switch(r.kty){case"EC":o={crv:r.crv,kty:r.kty,x:r.x,y:r.y};break;case"OKP":o={crv:r.crv,kty:r.kty,x:r.x};break;case"RSA":o={e:r.e,kty:r.kty,n:r.n};break;default:throw new je("unsupported JWK kty")}return ct(yield crypto.subtle.digest({name:"SHA-256"},at(JSON.stringify(o))))}),function(e){return t.apply(this,arguments)})(n.publicKey);var t}(yield t.getOrGenerateKeyPair())})()}clear(){var t=this;return(0,h.A)(function*(){yield Promise.all([t.storage.clearNonces(),t.storage.clearKeyPairs()])})()}}var $e,Nt,xn;!function(n){n.Bearer="Bearer",n.DPoP="DPoP"}($e||($e={}));class ds{constructor(t,e){this.hooks=e,this.config=Object.assign(Object.assign({},t),{fetch:t.fetch||(typeof window>"u"?fetch:window.fetch.bind(window))})}isAbsoluteUrl(t){return/^(https?:)?\/\//i.test(t)}buildUrl(t,e){if(e){if(this.isAbsoluteUrl(e))return e;if(t)return"".concat(t.replace(/\/?\/$/,""),"/").concat(e.replace(/^\/+/,""))}throw new TypeError("`url` must be absolute or `baseUrl` non-empty.")}getAccessToken(t){return this.config.getAccessToken?this.config.getAccessToken(t):this.hooks.getAccessToken(t)}extractUrl(t){return"string"==typeof t?t:t instanceof URL?t.href:t.url}buildBaseRequest(t,e){if(!this.config.baseUrl)return new Request(t,e);const r=this.buildUrl(this.config.baseUrl,this.extractUrl(t)),o=t instanceof Request?new Request(r,t):r;return new Request(o,e)}setAuthorizationHeader(t,e){t.headers.set("authorization","".concat(arguments.length>2&&void 0!==arguments[2]?arguments[2]:$e.Bearer," ").concat(e))}setDpopProofHeader(t,e){var r=this;return(0,h.A)(function*(){if(!r.config.dpopNonceId)return;const o=yield r.hooks.getDpopNonce(),s=yield r.hooks.generateDpopProof({accessToken:e,method:t.method,nonce:o,url:t.url});t.headers.set("dpop",s)})()}prepareRequest(t,e){var r=this;return(0,h.A)(function*(){const o=yield r.getAccessToken(e);let s,i;"string"==typeof o?(s=r.config.dpopNonceId?$e.DPoP:$e.Bearer,i=o):(s=o.token_type,i=o.access_token),r.setAuthorizationHeader(t,i,s),s===$e.DPoP&&(yield r.setDpopProofHeader(t,i))})()}getHeader(t,e){return Array.isArray(t)?new Headers(t).get(e)||"":"function"==typeof t.get?t.get(e)||"":t[e]||""}hasUseDpopNonceError(t){if(401!==t.status)return!1;const e=this.getHeader(t.headers,"www-authenticate");return e.includes("invalid_dpop_nonce")||e.includes("use_dpop_nonce")}handleResponse(t,e){var r=this;return(0,h.A)(function*(){const o=r.getHeader(t.headers,"dpop-nonce");if(o&&(yield r.hooks.setDpopNonce(o)),!r.hasUseDpopNonceError(t))return t;if(!o||!e.onUseDpopNonceError)throw new Ot(o);return e.onUseDpopNonceError()})()}internalFetchWithAuth(t,e,r,o){var s=this;return(0,h.A)(function*(){const i=s.buildBaseRequest(t,e);yield s.prepareRequest(i,o);const a=yield s.config.fetch(i);return s.handleResponse(a,r)})()}fetchWithAuth(t,e,r){const o={onUseDpopNonceError:()=>this.internalFetchWithAuth(t,e,Object.assign(Object.assign({},o),{onUseDpopNonceError:void 0}),r)};return this.internalFetchWithAuth(t,e,o,r)}}class hs{constructor(t,e){this.myAccountFetcher=t,this.apiBase=e}connectAccount(t){var e=this;return(0,h.A)(function*(){const r=yield e.myAccountFetcher.fetchWithAuth("".concat(e.apiBase,"v1/connected-accounts/connect"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return e._handleResponse(r)})()}completeAccount(t){var e=this;return(0,h.A)(function*(){const r=yield e.myAccountFetcher.fetchWithAuth("".concat(e.apiBase,"v1/connected-accounts/complete"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return e._handleResponse(r)})()}_handleResponse(t){return(0,h.A)(function*(){let e;try{e=yield t.text(),e=JSON.parse(e)}catch(r){throw new Kt({type:"invalid_json",status:t.status,title:"Invalid JSON response",detail:e||String(r)})}if(t.ok)return e;throw new Kt(e)})()}}class Kt extends Error{constructor(t){let{type:e,status:r,title:o,detail:s,validation_errors:i}=t;super(s),this.name="MyAccountApiError",this.type=e,this.status=r,this.title=o,this.detail=s,this.validation_errors=i,Object.setPrototypeOf(this,Kt.prototype)}}function yo(n,t){this.v=n,this.k=t}function K(n,t,e){if("function"==typeof n?n===t:n.has(t))return arguments.length<3?t:e;throw new TypeError("Private element is not present on this object")}function ps(n){return new yo(n,0)}function vo(n,t){if(t.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function b(n,t){return n.get(K(n,t))}function H(n,t,e){vo(n,t),t.set(n,e)}function j(n,t,e){return n.set(K(n,t),e),e}function S(n,t,e){return(t="symbol"==typeof(o=function(s){if("object"!=typeof s||!s)return s;var a=s[Symbol.toPrimitive];if(void 0!==a){var c=a.call(s,"string");if("object"!=typeof c)return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(t))?o:o+"")in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n;var o}function _o(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),e.push.apply(e,r)}return e}function k(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?_o(Object(e),!0).forEach(function(r){S(n,r,e[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):_o(Object(e)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(e,r))})}return n}function wo(n,t){if(null==n)return{};var e,r,o=function(i,a){if(null==i)return{};var c={};for(var l in i)if({}.hasOwnProperty.call(i,l)){if(-1!==a.indexOf(l))continue;c[l]=i[l]}return c}(n,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)-1===t.indexOf(e=s[r])&&{}.propertyIsEnumerable.call(n,e)&&(o[e]=n[e])}return o}function ht(n){var t,e;function r(s,i){try{var a=n[s](i),c=a.value,l=c instanceof yo;Promise.resolve(l?c.v:c).then(function(u){if(l){var d="return"===s?"return":"next";if(!c.k||u.done)return r(d,u);u=n[d](u).value}o(a.done?"return":"normal",u)},function(u){r("throw",u)})}catch(u){o("throw",u)}}function o(s,i){switch(s){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):e=null}this._invoke=function(s,i){return new Promise(function(a,c){var l={key:s,arg:i,resolve:a,reject:c,next:null};e?e=e.next=l:(t=e=l,r(s,i))})},"function"!=typeof n.return&&(this.return=void 0)}let Tn;function Qe(n,t){if(null==n)return!1;try{return n instanceof t||Object.getPrototypeOf(n)[Symbol.toStringTag]===t.prototype[Symbol.toStringTag]}catch{return!1}}function C(n,t,e){const r=new TypeError(n,{cause:e});return Object.assign(r,{code:t}),r}ht.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},ht.prototype.next=function(n){return this._invoke("next",n)},ht.prototype.throw=function(n){return this._invoke("throw",n)},ht.prototype.return=function(n){return this._invoke("return",n)},(typeof navigator>"u"||null===(Nt=navigator.userAgent)||void 0===Nt||null===(xn=Nt.startsWith)||void 0===xn||!xn.call(Nt,"Mozilla/5.0 "))&&(Tn="".concat("oauth4webapi","/").concat("v3.8.3"));const oe=Symbol(),Rn=Symbol(),In=Symbol(),se=Symbol(),fs=Symbol(),pe=Symbol(),gs=new TextEncoder,ys=new TextDecoder;function et(n){return"string"==typeof n?gs.encode(n):ys.decode(n)}let Pn,bo;function Ke(n){return"string"==typeof n?bo(n):Pn(n)}Pn=Uint8Array.prototype.toBase64?n=>(n instanceof ArrayBuffer&&(n=new Uint8Array(n)),n.toBase64({alphabet:"base64url",omitPadding:!0})):t=>{t instanceof ArrayBuffer&&(t=new Uint8Array(t));const e=[];for(let r=0;r<t.byteLength;r+=32768)e.push(String.fromCharCode.apply(null,t.subarray(r,r+32768)));return btoa(e.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},bo=Uint8Array.fromBase64?n=>{try{return Uint8Array.fromBase64(n,{alphabet:"base64url"})}catch(t){throw C("The input to be decoded is not correctly encoded.","ERR_INVALID_ARG_VALUE",t)}}:n=>{try{const t=atob(n.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")),e=new Uint8Array(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}catch(t){throw C("The input to be decoded is not correctly encoded.","ERR_INVALID_ARG_VALUE",t)}};class ee extends Error{constructor(t,e){var r;super(t,e),S(this,"code",void 0),this.name=this.constructor.name,this.code=Zn,null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,this.constructor)}}class Cn extends Error{constructor(t,e){var r;super(t,e),S(this,"code",void 0),this.name=this.constructor.name,null!=e&&e.code&&(this.code=e?.code),null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,this.constructor)}}function x(n,t,e){return new Cn(n,{code:t,cause:e})}function Mt(n){return null!==n&&"object"==typeof n&&!Array.isArray(n)}function zt(n){Qe(n,Headers)&&(n=Object.fromEntries(n.entries()));const t=new Headers(n??{});if(Tn&&!t.has("user-agent")&&t.set("user-agent",Tn),t.has("authorization"))throw C('"options.headers" must not include the "authorization" header name',"ERR_INVALID_ARG_VALUE");return t}function So(n,t){if(void 0!==t){if("function"==typeof t&&(t=t(n.href)),!(t instanceof AbortSignal))throw C('"options.signal" must return or be an instance of AbortSignal',"ERR_INVALID_ARG_TYPE");return t}}function Ao(n){return n.includes("//")?n.replace("//","/"):n}function On(){return On=(0,h.A)(function*(n,t){return(e=(0,h.A)(function*(r,o,s,i){if(!(r instanceof URL))throw C('"'.concat(o,'" must be an instance of URL'),"ERR_INVALID_ARG_TYPE");Un(r,!0!==i?.[oe]);const a=s(new URL(r.href)),c=zt(i?.headers);return c.set("accept","application/json"),(i?.[se]||fetch)(a.href,{body:void 0,headers:Object.fromEntries(c.entries()),method:"GET",redirect:"manual",signal:So(a,i?.signal)})}),function(r,o,s,i){return e.apply(this,arguments)})(n,"issuerIdentifier",e=>{switch(t?.algorithm){case void 0:case"oidc":(r=e).pathname=Ao("".concat(r.pathname,"/").concat(".well-known/openid-configuration"));break;case"oauth2":!function(r,o){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r.pathname="/"===r.pathname?o:Ao("".concat(o,"/").concat(s?r.pathname:r.pathname.replace(/(\/)$/,"")))}(e,".well-known/oauth-authorization-server");break;default:throw C('"options.algorithm" must be "oidc" (default), or "oauth2"',"ERR_INVALID_ARG_VALUE")}var r;return e},t);var e}),On.apply(this,arguments)}function xe(n,t,e,r,o){try{if("number"!=typeof n||!Number.isFinite(n))throw C("".concat(e," must be a number"),"ERR_INVALID_ARG_TYPE",o);if(n>0)return;if(t){if(0!==n)throw C("".concat(e," must be a non-negative number"),"ERR_INVALID_ARG_VALUE",o);return}throw C("".concat(e," must be a positive number"),"ERR_INVALID_ARG_VALUE",o)}catch(s){throw r?x(s.message,r,o):s}}function M(n,t,e,r){try{if("string"!=typeof n)throw C("".concat(t," must be a string"),"ERR_INVALID_ARG_TYPE",r);if(0===n.length)throw C("".concat(t," must not be empty"),"ERR_INVALID_ARG_VALUE",r)}catch(o){throw e?x(o.message,e,r):o}}function ko(n){!function(t,e){if(Po(t)!==e)throw function(r){let o='"response" content-type must be ';for(var s=arguments.length,i=new Array(s>1?s-1:0),a=1;a<s;a++)i[a-1]=arguments[a];if(i.length>2){const c=i.pop();o+="".concat(i.join(", "),", or ").concat(c)}else o+=2===i.length?"".concat(i[0]," or ").concat(i[1]):i[0];return x(o,Do,r)}(t,e)}(n,"application/json")}function Eo(){return Ke(crypto.getRandomValues(new Uint8Array(32)))}function ws(n){switch(n.algorithm.name){case"RSA-PSS":return function(t){switch(t.algorithm.hash.name){case"SHA-256":return"PS256";case"SHA-384":return"PS384";case"SHA-512":return"PS512";default:throw new ee("unsupported RsaHashedKeyAlgorithm hash name",{cause:t})}}(n);case"RSASSA-PKCS1-v1_5":return function(t){switch(t.algorithm.hash.name){case"SHA-256":return"RS256";case"SHA-384":return"RS384";case"SHA-512":return"RS512";default:throw new ee("unsupported RsaHashedKeyAlgorithm hash name",{cause:t})}}(n);case"ECDSA":return function(t){switch(t.algorithm.namedCurve){case"P-256":return"ES256";case"P-384":return"ES384";case"P-521":return"ES512";default:throw new ee("unsupported EcKeyAlgorithm namedCurve",{cause:t})}}(n);case"Ed25519":case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return n.algorithm.name;case"EdDSA":return"Ed25519";default:throw new ee("unsupported CryptoKey algorithm name",{cause:n})}}function Wt(n){const t=n?.[Rn];return"number"==typeof t&&Number.isFinite(t)?t:0}function Dn(n){const t=n?.[In];return"number"==typeof t&&Number.isFinite(t)&&-1!==Math.sign(t)?t:30}function Ht(){return Math.floor(Date.now()/1e3)}function ae(n){if("object"!=typeof n||null===n)throw C('"as" must be an object',"ERR_INVALID_ARG_TYPE");M(n.issuer,'"as.issuer"')}function ce(n){if("object"!=typeof n||null===n)throw C('"client" must be an object',"ERR_INVALID_ARG_TYPE");M(n.client_id,'"client.client_id"')}function xo(n){return M(n,'"clientSecret"'),(t,e,r,o)=>{r.set("client_id",e.client_id),r.set("client_secret",n)}}const Ss=URL.parse?(n,t)=>URL.parse(n,t):(n,t)=>{try{return new URL(n,t)}catch{return null}};function Un(n,t){if(t&&"https:"!==n.protocol)throw x("only requests to HTTPS are allowed",Uo,n);if("https:"!==n.protocol&&"http:"!==n.protocol)throw x("only HTTP and HTTPS requests are allowed",jo,n)}function pt(n,t,e,r){return function To(n,t,e,r){let o;if("string"!=typeof n||!(o=Ss(n)))throw x("authorization server metadata does not contain a valid ".concat(e?'"as.mtls_endpoint_aliases.'.concat(t,'"'):'"as.'.concat(t,'"')),void 0===n?Ns:Ks,{attribute:e?"mtls_endpoint_aliases.".concat(t):t});return Un(o,r),o}(e&&n.mtls_endpoint_aliases&&t in n.mtls_endpoint_aliases?n.mtls_endpoint_aliases[t]:n[t],t,e,r)}class Jt extends Error{constructor(t,e){var r;super(t,e),S(this,"cause",void 0),S(this,"code",void 0),S(this,"error",void 0),S(this,"status",void 0),S(this,"error_description",void 0),S(this,"response",void 0),this.name=this.constructor.name,this.code=js,this.cause=e.cause,this.error=e.cause.error,this.status=e.response.status,this.error_description=e.cause.error_description,Object.defineProperty(this,"response",{enumerable:!1,value:e.response}),null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,this.constructor)}}class Ro extends Error{constructor(t,e){var r,o;super(t,e),S(this,"cause",void 0),S(this,"code",void 0),S(this,"error",void 0),S(this,"error_description",void 0),this.name=this.constructor.name,this.code=Ls,this.cause=e.cause,this.error=e.cause.get("error"),this.error_description=null!==(r=e.cause.get("error_description"))&&void 0!==r?r:void 0,null===(o=Error.captureStackTrace)||void 0===o||o.call(Error,this,this.constructor)}}class jn extends Error{constructor(t,e){var r;super(t,e),S(this,"cause",void 0),S(this,"code",void 0),S(this,"response",void 0),S(this,"status",void 0),this.name=this.constructor.name,this.code=Us,this.cause=e.cause,this.status=e.response.status,this.response=e.response,Object.defineProperty(this,"response",{enumerable:!1}),null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,this.constructor)}}const ks=new RegExp("^[,\\s]*([a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+)"),Es=new RegExp('^[,\\s]*([a-zA-Z0-9!#$%&\\\'\\*\\+\\-\\.\\^_`\\|~]+)\\s*=\\s*"((?:[^"\\\\]|\\\\[\\s\\S])*)"[,\\s]*(.*)'),xs=new RegExp("^[,\\s]*([a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+)\\s*=\\s*([a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+)[,\\s]*(.*)"),Ts=new RegExp("^([a-zA-Z0-9\\-\\._\\~\\+\\/]+={0,2})(?:$|[,\\s])(.*)");function Ln(n,t,e){return Nn.apply(this,arguments)}function Nn(){return Nn=(0,h.A)(function*(n,t,e){if(n.status!==t){let o;var r;throw function(s){let i;if(i=function(a){if(!Qe(a,Response))throw C('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");const c=a.headers.get("www-authenticate");if(null===c)return;const l=[];let u=c;for(;u;){var d;let m=u.match(ks);const p=null===(d=m)||void 0===d?void 0:d[1].toLowerCase();if(!p)return;const y=u.substring(m[0].length);if(y&&!y.match(/^[\s,]/))return;const g=y.match(/^\s+(.*)$/);u=g?g[1]:void 0;const v={};let _;if(g)for(;u;){let E,w;if(m=u.match(Es)){if([,E,w,u]=m,w.includes("\\"))try{w=JSON.parse('"'.concat(w,'"'))}catch{}v[E.toLowerCase()]=w}else{if(!(m=u.match(xs))){if(m=u.match(Ts)){if(Object.keys(v).length)break;[,_,u]=m;break}return}[,E,w,u]=m,v[E.toLowerCase()]=w}}else u=y||void 0;const A={scheme:p,parameters:v};_&&(A.token68=_),l.push(A)}return l.length?l:void 0}(s))throw new jn("server responded with a challenge in the WWW-Authenticate HTTP Header",{cause:i,response:s})}(n),(o=yield(s=(0,h.A)(function*(i){if(i.status>399&&i.status<500){gt(i),ko(i);try{const a=yield i.clone().json();if(Mt(a)&&"string"==typeof a.error&&a.error.length)return a}catch{}}}),function(i){return s.apply(this,arguments)})(n))?(yield null===(r=n.body)||void 0===r?void 0:r.cancel(),new Jt("server responded with an error in the response body",{cause:o,response:n})):x('"response" is not a conform '.concat(e," response (unexpected HTTP status code)"),Bn,n)}var s}),Nn.apply(this,arguments)}function Io(n){if(!Jn.has(n))throw C('"options.DPoP" is not a valid DPoPHandle',"ERR_INVALID_ARG_VALUE")}function Po(n){var t;return null===(t=n.headers.get("content-type"))||void 0===t?void 0:t.split(";")[0]}function Kn(n,t,e,r,o,s,i){return Mn.apply(this,arguments)}function Mn(){return Mn=(0,h.A)(function*(n,t,e,r,o,s,i){return yield e(n,t,o,s),s.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),(i?.[se]||fetch)(r.href,{body:o,headers:Object.fromEntries(s.entries()),method:"POST",redirect:"manual",signal:So(r,i?.signal)})}),Mn.apply(this,arguments)}function mt(n,t,e,r,o,s){return zn.apply(this,arguments)}function zn(){return zn=(0,h.A)(function*(n,t,e,r,o,s){var i;const a=pt(n,"token_endpoint",t.use_mtls_endpoint_aliases,!0!==s?.[oe]);o.set("grant_type",r);const c=zt(s?.headers);c.set("accept","application/json"),void 0!==s?.DPoP&&(Io(s.DPoP),yield s.DPoP.addProof(a,c,"POST"));const l=yield Kn(n,t,e,a,o,c,s);return null==s||null===(i=s.DPoP)||void 0===i||i.cacheNonce(l,a),l}),zn.apply(this,arguments)}const Co=new WeakMap,Rs=new WeakMap;function Wn(n){if(!n.id_token)return;const t=Co.get(n);if(!t)throw C('"ref" was already garbage collected or did not resolve from the proper sources',"ERR_INVALID_ARG_VALUE");return t}function tt(n,t,e,r,o,s){return Hn.apply(this,arguments)}function Hn(){return Hn=(0,h.A)(function*(n,t,e,r,o,s){if(ae(n),ce(t),!Qe(e,Response))throw C('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");yield Ln(e,200,"Token Endpoint"),gt(e);const i=yield Ft(e);if(M(i.access_token,'"response" body "access_token" property',I,{body:i}),M(i.token_type,'"response" body "token_type" property',I,{body:i}),i.token_type=i.token_type.toLowerCase(),void 0!==i.expires_in){let a="number"!=typeof i.expires_in?parseFloat(i.expires_in):i.expires_in;xe(a,!0,'"response" body "expires_in" property',I,{body:i}),i.expires_in=a}if(void 0!==i.refresh_token&&M(i.refresh_token,'"response" body "refresh_token" property',I,{body:i}),void 0!==i.scope&&"string"!=typeof i.scope)throw x('"response" body "scope" property must be a string',I,{body:i});if(void 0!==i.id_token){M(i.id_token,'"response" body "id_token" property',I,{body:i});const a=["aud","exp","iat","iss","sub"];!0===t.require_auth_time&&a.push("auth_time"),void 0!==t.default_max_age&&(xe(t.default_max_age,!0,'"client.default_max_age"'),a.push("auth_time")),null!=r&&r.length&&a.push(...r);const{claims:c,jwt:l}=yield(u=(0,h.A)(function*(d,m,p,y,g){let f,v,{0:_,1:A,length:E}=d.split(".");if(5===E){if(void 0===g)throw new ee("JWE decryption is not configured",{cause:d});d=yield g(d),({0:_,1:A,length:E}=d.split("."))}if(3!==E)throw x("Invalid JWT",I,d);try{f=JSON.parse(et(Ke(_)))}catch(R){throw x("failed to parse JWT Header body as base64url encoded JSON",Vt,R)}if(!Mt(f))throw x("JWT Header must be a top level object",I,d);if(m(f),void 0!==f.crit)throw new ee('no JWT "crit" header parameter extensions are supported',{cause:{header:f}});try{v=JSON.parse(et(Ke(A)))}catch(R){throw x("failed to parse JWT Payload body as base64url encoded JSON",Vt,R)}if(!Mt(v))throw x("JWT Payload must be a top level object",I,d);const w=Ht()+p;if(void 0!==v.exp){if("number"!=typeof v.exp)throw x('unexpected JWT "exp" (expiration time) claim type',I,{claims:v});if(v.exp<=w-y)throw x('unexpected JWT "exp" (expiration time) claim value, expiration is past current timestamp',ft,{claims:v,now:w,tolerance:y,claim:"exp"})}if(void 0!==v.iat&&"number"!=typeof v.iat)throw x('unexpected JWT "iat" (issued at) claim type',I,{claims:v});if(void 0!==v.iss&&"string"!=typeof v.iss)throw x('unexpected JWT "iss" (issuer) claim type',I,{claims:v});if(void 0!==v.nbf){if("number"!=typeof v.nbf)throw x('unexpected JWT "nbf" (not before) claim type',I,{claims:v});if(v.nbf>w+y)throw x('unexpected JWT "nbf" (not before) claim value',ft,{claims:v,now:w,tolerance:y,claim:"nbf"})}if(void 0!==v.aud&&"string"!=typeof v.aud&&!Array.isArray(v.aud))throw x('unexpected JWT "aud" (audience) claim type',I,{claims:v});return{header:f,claims:v,jwt:d}}),function(d,m,p,y,g){return u.apply(this,arguments)})(i.id_token,Ws.bind(void 0,t.id_token_signed_response_alg,n.id_token_signing_alg_values_supported,"RS256"),Wt(t),Dn(t),o).then(Os.bind(void 0,a)).then(Ps.bind(void 0,n)).then(Is.bind(void 0,t.client_id));if(Array.isArray(c.aud)&&1!==c.aud.length){if(void 0===c.azp)throw x('ID Token "aud" (audience) claim includes additional untrusted audiences',Se,{claims:c,claim:"aud"});if(c.azp!==t.client_id)throw x('unexpected ID Token "azp" (authorized party) claim value',Se,{expected:t.client_id,claims:c,claim:"azp"})}void 0!==c.auth_time&&xe(c.auth_time,!0,'ID Token "auth_time" (authentication time)',I,{claims:c}),Rs.set(e,l),Co.set(i,c)}var u;if(void 0!==s?.[i.token_type])s[i.token_type](e,i);else if("dpop"!==i.token_type&&"bearer"!==i.token_type)throw new ee("unsupported `token_type` value",{cause:{body:i}});return i}),Hn.apply(this,arguments)}function Is(n,t){if(Array.isArray(t.claims.aud)){if(!t.claims.aud.includes(n))throw x('unexpected JWT "aud" (audience) claim value',Se,{expected:n,claims:t.claims,claim:"aud"})}else if(t.claims.aud!==n)throw x('unexpected JWT "aud" (audience) claim value',Se,{expected:n,claims:t.claims,claim:"aud"});return t}function Ps(n,t){var e,r;const o=null!==(e=null===(r=n[No])||void 0===r?void 0:r.call(n,t))&&void 0!==e?e:n.issuer;if(t.claims.iss!==o)throw x('unexpected JWT "iss" (issuer) claim value',Se,{expected:o,claims:t.claims,claim:"iss"});return t}const Jn=new WeakSet,Oo=Symbol(),Cs={aud:"audience",c_hash:"code hash",client_id:"client id",exp:"expiration time",iat:"issued at",iss:"issuer",jti:"jwt id",nonce:"nonce",s_hash:"state hash",sub:"subject",ath:"access token hash",htm:"http method",htu:"http uri",cnf:"confirmation",auth_time:"authentication time"};function Os(n,t){for(const e of n)if(void 0===t.claims[e])throw x('JWT "'.concat(e,'" (').concat(Cs[e],") claim missing"),I,{claims:t.claims});return t}const Vn=Symbol(),Fn=Symbol();function Gn(){return Gn=(0,h.A)(function*(n,t,e,r){return"string"==typeof r?.expectedNonce||"number"==typeof r?.maxAge||null!=r&&r.requireIdToken?(o=(0,h.A)(function*(s,i,a,c,l,u,d){const m=[];switch(c){case void 0:c=Vn;break;case Vn:break;default:M(c,'"expectedNonce" argument'),m.push("nonce")}switch(null!=l||(l=i.default_max_age),l){case void 0:l=Fn;break;case Fn:break;default:xe(l,!0,'"maxAge" argument'),m.push("auth_time")}const p=yield tt(s,i,a,m,u,d);M(p.id_token,'"response" body "id_token" property',I,{body:p});const y=Wn(p);if(l!==Fn){const g=Ht()+Wt(i),f=Dn(i);if(y.auth_time+l<g-f)throw x("too much time has elapsed since the last End-User authentication",ft,{claims:y,now:g,tolerance:f,claim:"auth_time"})}if(c===Vn){if(void 0!==y.nonce)throw x('unexpected ID Token "nonce" claim value',Se,{expected:void 0,claims:y,claim:"nonce"})}else if(y.nonce!==c)throw x('unexpected ID Token "nonce" claim value',Se,{expected:c,claims:y,claim:"nonce"});return p}),function(s,i,a,c,l,u,d){return o.apply(this,arguments)})(n,t,e,r.expectedNonce,r.maxAge,r[pe],r.recognizedTokenTypes):function(){var o=(0,h.A)(function*(s,i,a,c,l){const u=yield tt(s,i,a,void 0,c,l),d=Wn(u);if(d){if(void 0!==i.default_max_age){xe(i.default_max_age,!0,'"client.default_max_age"');const m=Ht()+Wt(i),p=Dn(i);if(d.auth_time+i.default_max_age<m-p)throw x("too much time has elapsed since the last End-User authentication",ft,{claims:d,now:m,tolerance:p,claim:"auth_time"})}if(void 0!==d.nonce)throw x('unexpected ID Token "nonce" claim value',Se,{expected:void 0,claims:d,claim:"nonce"})}return u});return function(s,i,a,c,l){return o.apply(this,arguments)}}()(n,t,e,r?.[pe],r?.recognizedTokenTypes);var o}),Gn.apply(this,arguments)}const Us="OAUTH_WWW_AUTHENTICATE_CHALLENGE",js="OAUTH_RESPONSE_BODY_ERROR",Zn="OAUTH_UNSUPPORTED_OPERATION",Ls="OAUTH_AUTHORIZATION_RESPONSE_ERROR",Vt="OAUTH_PARSE_ERROR",I="OAUTH_INVALID_RESPONSE",Do="OAUTH_RESPONSE_IS_NOT_JSON",Bn="OAUTH_RESPONSE_IS_NOT_CONFORM",Uo="OAUTH_HTTP_REQUEST_FORBIDDEN",jo="OAUTH_REQUEST_PROTOCOL_FORBIDDEN",ft="OAUTH_JWT_TIMESTAMP_CHECK_FAILED",Se="OAUTH_JWT_CLAIM_COMPARISON_FAILED",Xn="OAUTH_JSON_ATTRIBUTE_COMPARISON_FAILED",Ns="OAUTH_MISSING_SERVER_METADATA",Ks="OAUTH_INVALID_SERVER_METADATA";function gt(n){if(n.bodyUsed)throw C('"response" body has been used already',"ERR_INVALID_ARG_VALUE")}function Lo(n){const{algorithm:t}=n;if("number"!=typeof t.modulusLength||t.modulusLength<2048)throw new ee("unsupported ".concat(t.name," modulusLength"),{cause:n})}function Ms(n){const{algorithm:t}=n;switch(t.namedCurve){case"P-256":return"SHA-256";case"P-384":return"SHA-384";case"P-521":return"SHA-512";default:throw new ee("unsupported ECDSA namedCurve",{cause:n})}}function Yn(){return Yn=(0,h.A)(function*(n){if("POST"!==n.method)throw C("form_post responses are expected to use the POST method","ERR_INVALID_ARG_VALUE",{cause:n});if("application/x-www-form-urlencoded"!==Po(n))throw C("form_post responses are expected to use the application/x-www-form-urlencoded content-type","ERR_INVALID_ARG_VALUE",{cause:n});return(t=(0,h.A)(function*(e){if(e.bodyUsed)throw C("form_post Request instances must contain a readable body","ERR_INVALID_ARG_VALUE",{cause:e});return e.text()}),function(e){return t.apply(this,arguments)})(n);var t}),Yn.apply(this,arguments)}function Ws(n,t,e,r){if(void 0===n)if(Array.isArray(t)){if(!t.includes(r.alg))throw x('unexpected JWT "alg" header parameter',I,{header:r,expected:t,reason:"authorization server metadata"})}else{if(void 0===e)throw x('missing client or server configuration to verify used JWT "alg" header parameter',void 0,{client:n,issuer:t,fallback:e});if("string"==typeof e?r.alg!==e:"function"==typeof e?!e(r.alg):!e.includes(r.alg))throw x('unexpected JWT "alg" header parameter',I,{header:r,expected:e,reason:"default value"})}else if("string"==typeof n?r.alg!==n:!n.includes(r.alg))throw x('unexpected JWT "alg" header parameter',I,{header:r,expected:n,reason:"client configuration"})}function Me(n,t){const{0:e,length:r}=n.getAll(t);if(r>1)throw x('"'.concat(t,'" parameter must be provided only once'),I);return e}const Hs=Symbol(),Js=Symbol();function Ft(n){return qn.apply(this,arguments)}function qn(){return qn=(0,h.A)(function*(n){let t,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ko;try{t=yield n.json()}catch(r){throw e(n),x('failed to parse "response" body as JSON',Vt,r)}if(!Mt(t))throw x('"response" body must be a top level object',I,{body:t});return t}),qn.apply(this,arguments)}const $n=Symbol(),No=Symbol(),Ko=new TextEncoder,yt=new TextDecoder;function Qn(n){const t=new Uint8Array(n.length);for(let e=0;e<n.length;e++){const r=n.charCodeAt(e);if(r>127)throw new TypeError("non-ASCII string encountered in encode()");t[e]=r}return t}function Mo(n){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(n);const t=atob(n),e=new Uint8Array(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}function vt(n){if(Uint8Array.fromBase64)return Uint8Array.fromBase64("string"==typeof n?n:yt.decode(n),{alphabet:"base64url"});let t=n;t instanceof Uint8Array&&(t=yt.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/");try{return Mo(t)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}}class Z extends Error{constructor(t,e){var r;super(t,e),S(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,this.constructor)}}S(Z,"code","ERR_JOSE_GENERIC");class ue extends Z{constructor(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unspecified",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unspecified";super(t,{cause:{claim:r,reason:o,payload:e}}),S(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),S(this,"claim",void 0),S(this,"reason",void 0),S(this,"payload",void 0),this.claim=r,this.reason=o,this.payload=e}}S(ue,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class er extends Z{constructor(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unspecified",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unspecified";super(t,{cause:{claim:r,reason:o,payload:e}}),S(this,"code","ERR_JWT_EXPIRED"),S(this,"claim",void 0),S(this,"reason",void 0),S(this,"payload",void 0),this.claim=r,this.reason=o,this.payload=e}}S(er,"code","ERR_JWT_EXPIRED");class zo extends Z{constructor(){super(...arguments),S(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}S(zo,"code","ERR_JOSE_ALG_NOT_ALLOWED");class te extends Z{constructor(){super(...arguments),S(this,"code","ERR_JOSE_NOT_SUPPORTED")}}S(te,"code","ERR_JOSE_NOT_SUPPORTED"),S(class extends Z{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"decryption operation failed",arguments.length>1?arguments[1]:void 0),S(this,"code","ERR_JWE_DECRYPTION_FAILED")}},"code","ERR_JWE_DECRYPTION_FAILED"),S(class extends Z{constructor(){super(...arguments),S(this,"code","ERR_JWE_INVALID")}},"code","ERR_JWE_INVALID");class J extends Z{constructor(){super(...arguments),S(this,"code","ERR_JWS_INVALID")}}S(J,"code","ERR_JWS_INVALID");class tr extends Z{constructor(){super(...arguments),S(this,"code","ERR_JWT_INVALID")}}S(tr,"code","ERR_JWT_INVALID"),S(class extends Z{constructor(){super(...arguments),S(this,"code","ERR_JWK_INVALID")}},"code","ERR_JWK_INVALID");class nr extends Z{constructor(){super(...arguments),S(this,"code","ERR_JWKS_INVALID")}}S(nr,"code","ERR_JWKS_INVALID");class rr extends Z{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"no applicable key found in the JSON Web Key Set",arguments.length>1?arguments[1]:void 0),S(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}S(rr,"code","ERR_JWKS_NO_MATCHING_KEY");class Wo extends Z{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"multiple matching keys found in the JSON Web Key Set",arguments.length>1?arguments[1]:void 0),S(this,Symbol.asyncIterator,void 0),S(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}S(Wo,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class Ho extends Z{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"request timed out",arguments.length>1?arguments[1]:void 0),S(this,"code","ERR_JWKS_TIMEOUT")}}S(Ho,"code","ERR_JWKS_TIMEOUT");class Jo extends Z{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"signature verification failed",arguments.length>1?arguments[1]:void 0),S(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}S(Jo,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");const me=function(n){return new TypeError("CryptoKey does not support this operation, its ".concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"algorithm.name"," must be ").concat(n))},nt=(n,t)=>n.name===t;function or(n){return parseInt(n.name.slice(4),10)}function Vo(n,t){for(var e=arguments.length,r=new Array(e>2?e-2:0),o=2;o<e;o++)r[o-2]=arguments[o];if((r=r.filter(Boolean)).length>2){const i=r.pop();n+="one of type ".concat(r.join(", "),", or ").concat(i,".")}else n+=2===r.length?"one of type ".concat(r[0]," or ").concat(r[1],"."):"of type ".concat(r[0],".");if(null==t)n+=" Received ".concat(t);else if("function"==typeof t&&t.name)n+=" Received function ".concat(t.name);else if("object"==typeof t&&null!=t){var s;null!==(s=t.constructor)&&void 0!==s&&s.name&&(n+=" Received an instance of ".concat(t.constructor.name))}return n}const Fo=function(n,t){for(var e=arguments.length,r=new Array(e>2?e-2:0),o=2;o<e;o++)r[o-2]=arguments[o];return Vo("Key for the ".concat(n," algorithm must be "),t,...r)},Go=n=>{if("CryptoKey"===n?.[Symbol.toStringTag])return!0;try{return n instanceof CryptoKey}catch{return!1}},Zo=n=>"KeyObject"===n?.[Symbol.toStringTag],Bo=n=>Go(n)||Zo(n);function Te(n){if("object"!=typeof(t=n)||null===t||"[object Object]"!==Object.prototype.toString.call(n))return!1;var t;if(null===Object.getPrototypeOf(n))return!0;let e=n;for(;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(n)===e}const ir=(n,t)=>{if(n.byteLength!==t.length)return!1;for(let e=0;e<n.byteLength;e++)if(n[e]!==t[e])return!1;return!0},_t=n=>{const t=n.data[n.pos++];if(128&t){const e=127&t;let r=0;for(let o=0;o<e;o++)r=r<<8|n.data[n.pos++];return r}return t},wt=(n,t,e)=>{if(n.data[n.pos++]!==t)throw new Error(e)},Xo=(n,t)=>{const e=n.data.subarray(n.pos,n.pos+t);return n.pos+=t,e},Zs=function(){var n=(0,h.A)(function*(t,e,r,o){var s;let i,a;const c="spki"===t,l=()=>c?["verify"]:["sign"];switch(r){case"PS256":case"PS384":case"PS512":i={name:"RSA-PSS",hash:"SHA-".concat(r.slice(-3))},a=l();break;case"RS256":case"RS384":case"RS512":i={name:"RSASSA-PKCS1-v1_5",hash:"SHA-".concat(r.slice(-3))},a=l();break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":i={name:"RSA-OAEP",hash:"SHA-".concat(parseInt(r.slice(-3),10)||1)},a=c?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":case"ES384":case"ES512":i={name:"ECDSA",namedCurve:{ES256:"P-256",ES384:"P-384",ES512:"P-521"}[r]},a=l();break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":try{const u=o.getNamedCurve(e);i="X25519"===u?{name:"X25519"}:{name:"ECDH",namedCurve:u}}catch{throw new te("Invalid or unsupported key format")}a=c?[]:["deriveBits"];break;case"Ed25519":case"EdDSA":i={name:"Ed25519"},a=l();break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":i={name:r},a=l();break;default:throw new te('Invalid or unsupported "alg" (Algorithm) value')}return crypto.subtle.importKey(t,e,i,null!==(s=o?.extractable)&&void 0!==s?s:!!c,a)});return function(e,r,o,s){return n.apply(this,arguments)}}(),Bs=(n,t,e)=>{var r;const o=Mo(n.replace(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,""));let s=e;return null!=t&&null!==(r=t.startsWith)&&void 0!==r&&r.call(t,"ECDH-ES")&&(s||(s={}),s.getNamedCurve=i=>{const a={data:i,pos:0};return function(c){wt(c,48,"Invalid PKCS#8 structure"),_t(c),wt(c,2,"Expected version field");const l=_t(c);c.pos+=l,wt(c,48,"Expected algorithm identifier"),_t(c)}(a),(n=>{const t=(o=>{wt(o,6,"Expected algorithm OID");const s=_t(o);return Xo(o,s)})(n);if(ir(t,[43,101,110]))return"X25519";if(!ir(t,[42,134,72,206,61,2,1]))throw new Error("Unsupported key algorithm");wt(n,6,"Expected curve OID");const e=_t(n),r=Xo(n,e);for(const{name:o,oid:s}of[{name:"P-256",oid:[42,134,72,206,61,3,1,7]},{name:"P-384",oid:[43,129,4,0,34]},{name:"P-521",oid:[43,129,4,0,35]}])if(ir(r,s))return o;throw new Error("Unsupported named curve")})(a)}),Zs("pkcs8",o,t,s)};function Gt(n){return sr.apply(this,arguments)}function sr(){return sr=(0,h.A)(function*(n){var t,e;if(!n.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:r,keyUsages:o}=function(i){let a,c;switch(i.kty){case"AKP":switch(i.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":a={name:i.alg},c=i.priv?["sign"]:["verify"];break;default:throw new te('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(i.alg){case"PS256":case"PS384":case"PS512":a={name:"RSA-PSS",hash:"SHA-".concat(i.alg.slice(-3))},c=i.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":a={name:"RSASSA-PKCS1-v1_5",hash:"SHA-".concat(i.alg.slice(-3))},c=i.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":a={name:"RSA-OAEP",hash:"SHA-".concat(parseInt(i.alg.slice(-3),10)||1)},c=i.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new te('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(i.alg){case"ES256":a={name:"ECDSA",namedCurve:"P-256"},c=i.d?["sign"]:["verify"];break;case"ES384":a={name:"ECDSA",namedCurve:"P-384"},c=i.d?["sign"]:["verify"];break;case"ES512":a={name:"ECDSA",namedCurve:"P-521"},c=i.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":a={name:"ECDH",namedCurve:i.crv},c=i.d?["deriveBits"]:[];break;default:throw new te('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(i.alg){case"Ed25519":case"EdDSA":a={name:"Ed25519"},c=i.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":a={name:i.crv},c=i.d?["deriveBits"]:[];break;default:throw new te('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new te('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:a,keyUsages:c}}(n),s=k({},n);return"AKP"!==s.kty&&delete s.alg,delete s.use,crypto.subtle.importKey("jwk",s,r,null!==(t=n.ext)&&void 0!==t?t:!n.d&&!n.priv,null!==(e=n.key_ops)&&void 0!==e?e:o)}),sr.apply(this,arguments)}const ar=n=>Te(n)&&"string"==typeof n.kty;let Re;const Yo=function(){var n=(0,h.A)(function*(t,e,r){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Re||(Re=new WeakMap);let s=Re.get(t);if(null!=s&&s[r])return s[r];const i=yield Gt(k(k({},e),{},{alg:r}));return o&&Object.freeze(t),s?s[r]=i:Re.set(t,{[r]:i}),i});return function(e,r,o){return n.apply(this,arguments)}}();function cr(){return cr=(0,h.A)(function*(n,t){if(n instanceof Uint8Array||Go(n))return n;if(Zo(n)){if("secret"===n.type)return n.export();if("toCryptoKey"in n&&"function"==typeof n.toCryptoKey)try{return((r,o)=>{Re||(Re=new WeakMap);let s=Re.get(r);if(null!=s&&s[o])return s[o];const i="public"===r.type,a=!!i;let c;if("x25519"===r.asymmetricKeyType){switch(o){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}c=r.toCryptoKey(r.asymmetricKeyType,a,i?[]:["deriveBits"])}if("ed25519"===r.asymmetricKeyType){if("EdDSA"!==o&&"Ed25519"!==o)throw new TypeError("given KeyObject instance cannot be used for this algorithm");c=r.toCryptoKey(r.asymmetricKeyType,a,[i?"verify":"sign"])}switch(r.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":if(o!==r.asymmetricKeyType.toUpperCase())throw new TypeError("given KeyObject instance cannot be used for this algorithm");c=r.toCryptoKey(r.asymmetricKeyType,a,[i?"verify":"sign"])}if("rsa"===r.asymmetricKeyType){let u;switch(o){case"RSA-OAEP":u="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":u="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":u="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":u="SHA-512";break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}if(o.startsWith("RSA-OAEP"))return r.toCryptoKey({name:"RSA-OAEP",hash:u},a,i?["encrypt"]:["decrypt"]);c=r.toCryptoKey({name:o.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:u},a,[i?"verify":"sign"])}if("ec"===r.asymmetricKeyType){var l;const u=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get(null===(l=r.asymmetricKeyDetails)||void 0===l?void 0:l.namedCurve);if(!u)throw new TypeError("given KeyObject instance cannot be used for this algorithm");"ES256"===o&&"P-256"===u&&(c=r.toCryptoKey({name:"ECDSA",namedCurve:u},a,[i?"verify":"sign"])),"ES384"===o&&"P-384"===u&&(c=r.toCryptoKey({name:"ECDSA",namedCurve:u},a,[i?"verify":"sign"])),"ES512"===o&&"P-521"===u&&(c=r.toCryptoKey({name:"ECDSA",namedCurve:u},a,[i?"verify":"sign"])),o.startsWith("ECDH-ES")&&(c=r.toCryptoKey({name:"ECDH",namedCurve:u},a,i?[]:["deriveBits"]))}if(!c)throw new TypeError("given KeyObject instance cannot be used for this algorithm");return s?s[o]=c:Re.set(r,{[o]:c}),c})(n,t)}catch(r){if(r instanceof TypeError)throw r}let e=n.export({format:"jwk"});return Yo(n,e,t)}if(ar(n))return n.k?vt(n.k):Yo(n,n,t,!0);throw new Error("unreachable")}),cr.apply(this,arguments)}const rt=n=>n?.[Symbol.toStringTag],ur=(n,t,e)=>{if(void 0!==t.use){let s;switch(e){case"sign":case"verify":s="sig";break;case"encrypt":case"decrypt":s="enc"}if(t.use!==s)throw new TypeError('Invalid key for this operation, its "use" must be "'.concat(s,'" when present'))}if(void 0!==t.alg&&t.alg!==n)throw new TypeError('Invalid key for this operation, its "alg" must be "'.concat(n,'" when present'));if(Array.isArray(t.key_ops)){var r,o;let s;switch(!0){case"sign"===e||"verify"===e:case"dir"===n:case n.includes("CBC-HS"):s=e;break;case n.startsWith("PBES2"):s="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(n):s=!n.includes("GCM")&&n.endsWith("KW")?"encrypt"===e?"wrapKey":"unwrapKey":e;break;case"encrypt"===e&&n.startsWith("RSA"):s="wrapKey";break;case"decrypt"===e:s=n.startsWith("RSA")?"unwrapKey":"deriveBits"}if(s&&!1===(null===(r=t.key_ops)||void 0===r||null===(o=r.includes)||void 0===o?void 0:o.call(r,s)))throw new TypeError('Invalid key for this operation, its "key_ops" must include "'.concat(s,'" when present'))}return!0};var Zt,lr;let fe,qo;(typeof navigator>"u"||null===(Zt=navigator.userAgent)||void 0===Zt||null===(lr=Zt.startsWith)||void 0===lr||!lr.call(Zt,"Mozilla/5.0 "))&&(qo="".concat("openid-client","/").concat("v6.8.1"),fe={"user-agent":qo});const B=n=>Bt.get(n);let Bt,Xt;function $o(n){return void 0!==n?xo(n):(Xt||(Xt=new WeakMap),(t,e,r,o)=>{let s;return(s=Xt.get(e))||(function(i,a){if("string"!=typeof i)throw ge("".concat(a," must be a string"),St);if(0===i.length)throw ge("".concat(a," must not be empty"),bt)}(e.client_secret,'"metadata.client_secret"'),s=xo(e.client_secret),Xt.set(e,s)),s(t,e,r,o)})}const Ie=se,bt="ERR_INVALID_ARG_VALUE",St="ERR_INVALID_ARG_TYPE";function ge(n,t,e){const r=new TypeError(n,{cause:e});return Object.assign(r,{code:t}),r}class Yt extends Error{constructor(t,e){var r;super(t,e),S(this,"code",void 0),this.name=this.constructor.name,this.code=e?.code,null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,this.constructor)}}function q(n,t,e){return new Yt(n,{cause:t,code:e})}function $(n){if(n instanceof TypeError||n instanceof Yt||n instanceof Jt||n instanceof Ro||n instanceof jn)throw n;if(n instanceof Cn)switch(n.code){case Uo:throw q("only requests to HTTPS are allowed",n,n.code);case jo:throw q("only requests to HTTP or HTTPS are allowed",n,n.code);case Bn:throw q("unexpected HTTP response status code",n.cause,n.code);case Do:throw q("unexpected response content-type",n.cause,n.code);case Vt:throw q("parsing error occured",n,n.code);case I:throw q("invalid response encountered",n,n.code);case Se:throw q("unexpected JWT claim value encountered",n,n.code);case Xn:throw q("unexpected JSON attribute value encountered",n,n.code);case ft:throw q("JWT timestamp claim value failed validation",n,n.code);default:throw q(n.message,n,n.code)}if(n instanceof ee)throw q("unsupported operation",n,n.code);if(n instanceof DOMException)switch(n.name){case"OperationError":throw q("runtime operation error",n,Zn);case"NotSupportedError":throw q("runtime unsupported operation",n,Zn);case"TimeoutError":throw q("operation timed out",n,"OAUTH_TIMEOUT");case"AbortError":throw q("operation aborted",n,"OAUTH_ABORT")}throw new Yt("something went wrong",{cause:n})}function dr(){return dr=(0,h.A)(function*(n,t,e,r,o){const s=yield(c=(0,h.A)(function*(l,u){var d,m;if(!(l instanceof URL))throw ge('"server" must be an instance of URL',St);const p=!l.href.includes("/.well-known/"),y=null!==(d=u?.timeout)&&void 0!==d?d:30,g=AbortSignal.timeout(1e3*y),f=yield(p?function _s(n,t){return On.apply(this,arguments)}(l,{algorithm:u?.algorithm,[se]:u?.[Ie],[oe]:null==u||null===(m=u.execute)||void 0===m?void 0:m.includes(oi),signal:g,headers:new Headers(fe)}):(u?.[Ie]||fetch)((Un(l,null==u||null===(v=u.execute)||void 0===v||!v.includes(oi)),l.href),{headers:Object.fromEntries(new Headers(k({accept:"application/json"},fe)).entries()),body:void 0,method:"GET",redirect:"manual",signal:g})).then(_=>{return(A=(0,h.A)(function*(E,w){const R=E;if(!(R instanceof URL)&&R!==$n)throw C('"expectedIssuerIdentifier" must be an instance of URL',"ERR_INVALID_ARG_TYPE");if(!Qe(w,Response))throw C('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");if(200!==w.status)throw x('"response" is not a conform Authorization Server Metadata response (unexpected HTTP status code)',Bn,w);gt(w);const P=yield Ft(w);if(M(P.issuer,'"response" body "issuer" property',I,{body:P}),R!==$n&&new URL(P.issuer).href!==R.href)throw x('"response" body "issuer" property does not match the expected value',Xn,{expected:R.href,body:P,attribute:"issuer"});return P}),function(E,w){return A.apply(this,arguments)})($n,_);var A}).catch($);var v,E;return p&&new URL(f.issuer).href!==l.href&&(E=u,!("https://login.microsoftonline.com"!==l.origin||null!=E&&E.algorithm&&"oidc"!==E.algorithm||(f[Qo]=!0,0))||function(_,A){return!(!_.hostname.endsWith(".b2clogin.com")||null!=A&&A.algorithm&&"oidc"!==A.algorithm)}(l,u)||(()=>{throw new Yt("discovered metadata issuer does not match the expected issuer",{code:Xn,cause:{expected:l.href,body:f,attribute:"issuer"}})})()),f}),function(l,u){return c.apply(this,arguments)})(n,o),i=new qt(s,t,e,r);var c;let a=B(i);if(null!=o&&o[Ie]&&(a.fetch=o[Ie]),null!=o&&o.timeout&&(a.timeout=o.timeout),null!=o&&o.execute)for(const c of o.execute)c(i);return i}),dr.apply(this,arguments)}new TextDecoder;const Qo=Symbol();class qt{constructor(t,e,r,o){var s,i,a,c,l;if("string"!=typeof e||!e.length)throw ge('"clientId" must be a non-empty string',St);if("string"==typeof r&&(r={client_secret:r}),void 0!==(null===(s=r)||void 0===s?void 0:s.client_id)&&e!==r.client_id)throw ge('"clientId" and "metadata.client_id" must be the same',bt);const u=k(k({},structuredClone(r)),{},{client_id:e});let d;u[Rn]=null!==(i=null===(a=r)||void 0===a?void 0:a[Rn])&&void 0!==i?i:0,u[In]=null!==(c=null===(l=r)||void 0===l?void 0:l[In])&&void 0!==c?c:30,d=o||("string"==typeof u.client_secret&&u.client_secret.length?$o(u.client_secret):(g,f,v,_)=>{v.set("client_id",f.client_id)});let m=Object.freeze(u);const p=structuredClone(t);Qo in t&&(p[No]=g=>{let{claims:{tid:f}}=g;return t.issuer.replace("{tenantid}",f)});let y=Object.freeze(p);Bt||(Bt=new WeakMap),Bt.set(this,{__proto__:null,as:y,c:m,auth:d,tlsOnly:!0,jwksCache:{}})}serverMetadata(){const t=structuredClone(B(this).as);return e=t,Object.defineProperties(e,function(r){return{supportsPKCE:{__proto__:null,value(){var o;return!0===(null===(o=r.code_challenge_methods_supported)||void 0===o?void 0:o.includes(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"S256"))}}}}(e)),t;var e}clientMetadata(){return structuredClone(B(this).c)}get timeout(){return B(this).timeout}set timeout(t){B(this).timeout=t}get[Ie](){return B(this).fetch}set[Ie](t){B(this).fetch=t}}function At(n){Object.defineProperties(n,function(t){let e;if(void 0!==t.expires_in){const r=new Date;r.setSeconds(r.getSeconds()+t.expires_in),e=r.getTime()}return{expiresIn:{__proto__:null,value(){if(e){const r=Date.now();return e>r?Math.floor((e-r)/1e3):0}}},claims:{__proto__:null,value(){try{return Wn(this)}catch{return}}}}}(n))}function ei(n,t,e){return hr.apply(this,arguments)}function hr(){return hr=(0,h.A)(function*(n,t,e){var r;let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=null===(r=n.headers.get("retry-after"))||void 0===r?void 0:r.trim();if(void 0===s)return;let i;if(/^\d+$/.test(s))i=parseInt(s,10);else{const a=new Date(s);if(Number.isFinite(a.getTime())){const c=new Date,l=a.getTime()-c.getTime();l>0&&(i=Math.ceil(l/1e3))}}if(o&&!Number.isFinite(i))throw new Cn("invalid Retry-After header value",{cause:n});i>t&&(yield ti(i-t,e))}),hr.apply(this,arguments)}function ti(n,t){return new Promise((e,r)=>{const o=s=>{try{t.throwIfAborted()}catch(a){return void r(a)}if(s<=0)return void e();const i=Math.min(s,5);setTimeout(()=>o(s-i),1e3*i)};o(n)})}function ni(n,t){return pr.apply(this,arguments)}function pr(){return pr=(0,h.A)(function*(n,t){Ae(n);const{as:e,c:r,auth:o,fetch:s,tlsOnly:i,timeout:a}=B(n);return(c=(0,h.A)(function*(l,u,d,m,p){ae(l),ce(u);const y=pt(l,"backchannel_authentication_endpoint",u.use_mtls_endpoint_aliases,!0!==p?.[oe]),g=new URLSearchParams(m);g.set("client_id",u.client_id);const f=zt(p?.headers);return f.set("accept","application/json"),Kn(l,u,d,y,g,f,p)}),function(l,u,d,m,p){return c.apply(this,arguments)})(e,r,o,t,{[se]:s,[oe]:!i,headers:new Headers(fe),signal:ze(a)}).then(c=>{return(l=(0,h.A)(function*(u,d,m){if(ae(u),ce(d),!Qe(m,Response))throw C('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");yield Ln(m,200,"Backchannel Authentication Endpoint"),gt(m);const p=yield Ft(m);M(p.auth_req_id,'"response" body "auth_req_id" property',I,{body:p});let y="number"!=typeof p.expires_in?parseFloat(p.expires_in):p.expires_in;return xe(y,!0,'"response" body "expires_in" property',I,{body:p}),p.expires_in=y,void 0!==p.interval&&xe(p.interval,!1,'"response" body "interval" property',I,{body:p}),p}),function(u,d,m){return l.apply(this,arguments)})(e,r,c);var l}).catch($);var c}),pr.apply(this,arguments)}function ri(n,t,e,r){return mr.apply(this,arguments)}function mr(){return mr=(0,h.A)(function*(n,t,e,r){var o,s;Ae(n),e=new URLSearchParams(e);let i=null!==(o=t.interval)&&void 0!==o?o:5;const a=null!==(s=r?.signal)&&void 0!==s?s:AbortSignal.timeout(1e3*t.expires_in);try{yield ti(i,a)}catch(w){$(w)}const{as:c,c:l,auth:u,fetch:d,tlsOnly:m,nonRepudiation:p,timeout:y,decrypt:g}=B(n),f=(w,R)=>ri(n,k(k({},t),{},{interval:w}),e,k(k({},r),{},{signal:a,flag:R})),v=yield(w=(0,h.A)(function*(R,P,ne,F,we){ae(R),ce(P),M(F,'"authReqId"');const Q=new URLSearchParams(we?.additionalParameters);return Q.set("auth_req_id",F),mt(R,P,ne,"urn:openid:params:grant-type:ciba",Q,we)}),function(R,P,ne,F,we){return w.apply(this,arguments)})(c,l,u,t.auth_req_id,{[se]:d,[oe]:!m,additionalParameters:e,DPoP:r?.DPoP,headers:new Headers(fe),signal:a.aborted?a:ze(y)}).catch($);var w,_;if(503===v.status&&v.headers.has("retry-after"))return yield ei(v,i,a,!0),yield null===(_=v.body)||void 0===_?void 0:_.cancel(),f(i);const A=function(){var w=(0,h.A)(function*(R,P,ne,F){return tt(R,P,ne,void 0,F?.[pe],F?.recognizedTokenTypes)});return function(R,P,ne,F){return w.apply(this,arguments)}}()(c,l,v,{[pe]:g});let E;try{E=yield A}catch(w){if(kt(w,r))return f(i,Pe);if(w instanceof Jt)switch(w.error){case"slow_down":i+=5;case"authorization_pending":return yield ei(w.response,i,a),f(i)}$(w)}return E.id_token&&(yield p?.(v)),At(E),E}),mr.apply(this,arguments)}function oi(n){B(n).tlsOnly=!1}function ii(n,t,e,r,o){return fr.apply(this,arguments)}function fr(){return fr=(0,h.A)(function*(n,t,e,r,o){if(Ae(n),!(o?.flag===Pe||t instanceof URL||function(w){try{return"Request"===Object.getPrototypeOf(w)[Symbol.toStringTag]}catch{return!1}}(t)))throw ge('"currentUrl" must be an instance of URL, or Request',St);let s,i;const{as:a,c,auth:l,fetch:u,tlsOnly:d,jarm:m,hybrid:p,nonRepudiation:y,timeout:g,decrypt:f,implicit:v}=B(n);if(o?.flag===Pe)s=o.authResponse,i=o.redirectUri;else{if(!(t instanceof URL)){const w=t;switch(t=new URL(t.url),w.method){case"GET":break;case"POST":const R=new URLSearchParams(yield function zs(n){return Yn.apply(this,arguments)}(w));if(p)t.hash=R.toString();else for(const[P,ne]of R.entries())t.searchParams.append(P,ne);break;default:throw ge("unexpected Request HTTP method",bt)}}switch(w=t,(w=new URL(w)).search="",w.hash="",i=w.href,!0){case!!m:s=yield m(t,e?.expectedState);break;case!!p:s=yield p(t,e?.expectedNonce,e?.expectedState,e?.maxAge);break;case!!v:throw new TypeError("authorizationCodeGrant() cannot be used by response_type=id_token clients");default:try{s=function Vs(n,t,e,r){if(ae(n),ce(t),e instanceof URL&&(e=e.searchParams),!(e instanceof URLSearchParams))throw C('"parameters" must be an instance of URLSearchParams, or URL',"ERR_INVALID_ARG_TYPE");if(Me(e,"response"))throw x('"parameters" contains a JARM response, use validateJwtAuthResponse() instead of validateAuthResponse()',I,{parameters:e});const o=Me(e,"iss"),s=Me(e,"state");if(!o&&n.authorization_response_iss_parameter_supported)throw x('response parameter "iss" (issuer) missing',I,{parameters:e});if(o&&o!==n.issuer)throw x('unexpected "iss" (issuer) response parameter value',I,{expected:n.issuer,parameters:e});switch(r){case void 0:case Js:if(void 0!==s)throw x('unexpected "state" response parameter encountered',I,{expected:void 0,parameters:e});break;case Hs:break;default:if(M(r,'"expectedState" argument'),s!==r)throw x(void 0===s?'response parameter "state" missing':'unexpected "state" response parameter value',I,{expected:r,parameters:e})}if(Me(e,"error"))throw new Ro("authorization response from the server is an error",{cause:e});const i=Me(e,"id_token"),a=Me(e,"token");if(void 0!==i||void 0!==a)throw new ee("implicit and hybrid flows are not supported");return c=new URLSearchParams(e),Jn.add(c),c;var c}(a,c,t.searchParams,e?.expectedState)}catch(w){$(w)}}}var w;const _=yield function(){var w=(0,h.A)(function*(R,P,ne,F,we,Q,Be){if(ae(R),ce(P),!Jn.has(F))throw C('"callbackParameters" must be an instance of URLSearchParams obtained from "validateAuthResponse()", or "validateJwtAuthResponse()',"ERR_INVALID_ARG_VALUE");M(we,'"redirectUri"');const Ei=Me(F,"code");if(!Ei)throw x('no authorization code in "callbackParameters"',I);const sn=new URLSearchParams(Be?.additionalParameters);return sn.set("redirect_uri",we),sn.set("code",Ei),Q!==Oo&&(M(Q,'"codeVerifier"'),sn.set("code_verifier",Q)),mt(R,P,ne,"authorization_code",sn,Be)});return function(R,P,ne,F,we,Q,Be){return w.apply(this,arguments)}}()(a,c,l,s,i,e?.pkceCodeVerifier||Oo,{additionalParameters:r,[se]:u,[oe]:!d,DPoP:o?.DPoP,headers:new Headers(fe),signal:ze(g)}).catch($);"string"!=typeof e?.expectedNonce&&"number"!=typeof e?.maxAge||(e.idTokenExpected=!0);const A=function Ds(n,t,e,r){return Gn.apply(this,arguments)}(a,c,_,{expectedNonce:e?.expectedNonce,maxAge:e?.maxAge,requireIdToken:e?.idTokenExpected,[pe]:f});let E;try{E=yield A}catch(w){if(kt(w,o))return ii(n,void 0,e,r,k(k({},o),{},{flag:Pe,authResponse:s,redirectUri:i}));$(w)}return E.id_token&&(yield y?.(_)),At(E),E}),fr.apply(this,arguments)}function si(n,t,e,r){return gr.apply(this,arguments)}function gr(){return gr=(0,h.A)(function*(n,t,e,r){Ae(n),e=new URLSearchParams(e);const{as:o,c:s,auth:i,fetch:a,tlsOnly:c,nonRepudiation:l,timeout:u,decrypt:d}=B(n),m=yield(g=(0,h.A)(function*(f,v,_,A,E){ae(f),ce(v),M(A,'"refreshToken"');const w=new URLSearchParams(E?.additionalParameters);return w.set("refresh_token",A),mt(f,v,_,"refresh_token",w,E)}),function(f,v,_,A,E){return g.apply(this,arguments)})(o,s,i,t,{[se]:a,[oe]:!c,additionalParameters:e,DPoP:r?.DPoP,headers:new Headers(fe),signal:ze(u)}).catch($),p=function(){var g=(0,h.A)(function*(f,v,_,A){return tt(f,v,_,void 0,A?.[pe],A?.recognizedTokenTypes)});return function(f,v,_,A){return g.apply(this,arguments)}}()(o,s,m,{[pe]:d});var g;let y;try{y=yield p}catch(g){if(kt(g,r))return si(n,t,e,k(k({},r),{},{flag:Pe}));$(g)}return y.id_token&&(yield l?.(m)),At(y),y}),gr.apply(this,arguments)}function ai(n,t,e){return yr.apply(this,arguments)}function yr(){return yr=(0,h.A)(function*(n,t,e){Ae(n),t=new URLSearchParams(t);const{as:r,c:o,auth:s,fetch:i,tlsOnly:a,timeout:c}=B(n),l=yield(m=(0,h.A)(function*(p,y,g,f,v){return ae(p),ce(y),mt(p,y,g,"client_credentials",new URLSearchParams(f),v)}),function(p,y,g,f,v){return m.apply(this,arguments)})(r,o,s,t,{[se]:i,[oe]:!a,DPoP:e?.DPoP,headers:new Headers(fe),signal:ze(c)}).catch($),u=function(){var m=(0,h.A)(function*(p,y,g,f){return tt(p,y,g,void 0,f?.[pe],f?.recognizedTokenTypes)});return function(p,y,g,f){return m.apply(this,arguments)}}()(r,o,l);var m;let d;try{d=yield u}catch(m){if(kt(m,e))return ai(n,t,k(k({},e),{},{flag:Pe}));$(m)}return At(d),d}),yr.apply(this,arguments)}function vr(n,t){Ae(n);const{as:e,c:r,tlsOnly:o,hybrid:s,jarm:i,implicit:a}=B(n),c=pt(e,"authorization_endpoint",!1,o);if((t=new URLSearchParams(t)).has("client_id")||t.set("client_id",r.client_id),!t.has("request_uri")&&!t.has("request")){if(t.has("response_type")||t.set("response_type",s?"code id_token":a?"id_token":"code"),a&&!t.has("nonce"))throw ge("response_type=id_token clients must provide a nonce parameter in their authorization request parameters",bt);i&&t.set("response_mode","jwt")}for(const[l,u]of t.entries())c.searchParams.append(l,u);return c}function ci(n,t,e){return _r.apply(this,arguments)}function _r(){return _r=(0,h.A)(function*(n,t,e){Ae(n);const r=vr(n,t),{as:o,c:s,auth:i,fetch:a,tlsOnly:c,timeout:l}=B(n),u=yield(p=(0,h.A)(function*(y,g,f,v,_){var A;ae(y),ce(g);const E=pt(y,"pushed_authorization_request_endpoint",g.use_mtls_endpoint_aliases,!0!==_?.[oe]),w=new URLSearchParams(v);w.set("client_id",g.client_id);const R=zt(_?.headers);R.set("accept","application/json"),void 0!==_?.DPoP&&(Io(_.DPoP),yield _.DPoP.addProof(E,R,"POST"));const P=yield Kn(y,g,f,E,w,R,_);return null==_||null===(A=_.DPoP)||void 0===A||A.cacheNonce(P,E),P}),function(y,g,f,v,_){return p.apply(this,arguments)})(o,s,i,r.searchParams,{[se]:a,[oe]:!c,DPoP:e?.DPoP,headers:new Headers(fe),signal:ze(l)}).catch($),d=function(){var p=(0,h.A)(function*(y,g,f){if(ae(y),ce(g),!Qe(f,Response))throw C('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");yield Ln(f,201,"Pushed Authorization Request Endpoint"),gt(f);const v=yield Ft(f);M(v.request_uri,'"response" body "request_uri" property',I,{body:v});let _="number"!=typeof v.expires_in?parseFloat(v.expires_in):v.expires_in;return xe(_,!0,'"response" body "expires_in" property',I,{body:v}),v.expires_in=_,v});return function(y,g,f){return p.apply(this,arguments)}}()(o,s,u);var p;let m;try{m=yield d}catch(p){if(kt(p,e))return ci(n,t,k(k({},e),{},{flag:Pe}));$(p)}return vr(n,{request_uri:m.request_uri})}),_r.apply(this,arguments)}function Ae(n){if(!(n instanceof qt))throw ge('"config" must be an instance of Configuration',St);if(Object.getPrototypeOf(n)!==qt.prototype)throw ge("subclassing Configuration is not allowed",bt)}function ze(n){return n?AbortSignal.timeout(1e3*n):void 0}function kt(n,t){return!(null==t||!t.DPoP||t.flag===Pe)&&function(e){if(e instanceof jn){const{0:r,length:o}=e.cause;return 1===o&&"dpop"===r.scheme&&"use_dpop_nonce"===r.parameters.error}return e instanceof Jt&&"use_dpop_nonce"===e.error}(n)}Object.freeze(qt.prototype);const Pe=Symbol();function wr(n,t,e,r){return br.apply(this,arguments)}function br(){return br=(0,h.A)(function*(n,t,e,r){Ae(n);const{as:o,c:s,auth:i,fetch:a,tlsOnly:c,timeout:l,decrypt:u}=B(n),d=yield(m=(0,h.A)(function*(p,y,g,f,v,_){return ae(p),ce(y),M(f,'"grantType"'),mt(p,y,g,f,new URLSearchParams(v),_)}),function(p,y,g,f,v,_){return m.apply(this,arguments)})(o,s,i,t,new URLSearchParams(e),{[se]:a,[oe]:!c,DPoP:r?.DPoP,headers:new Headers(fe),signal:ze(l)}).then(m=>{let p;return"urn:ietf:params:oauth:grant-type:token-exchange"===t&&(p={n_a:()=>{}}),(y=(0,h.A)(function*(g,f,v,_){return tt(g,f,v,void 0,_?.[pe],_?.recognizedTokenTypes)}),function(g,f,v,_){return y.apply(this,arguments)})(o,s,m,{[pe]:u,recognizedTokenTypes:p});var y}).catch($);var m;return At(d),d}),br.apply(this,arguments)}function Sr(){return Sr=(0,h.A)(function*(n,t,e){if(t instanceof Uint8Array){if(!n.startsWith("HS"))throw new TypeError(function(r){for(var o=arguments.length,s=new Array(o>1?o-1:0),i=1;i<o;i++)s[i-1]=arguments[i];return Vo("Key must be ",r,...s)}(t,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",t,{hash:"SHA-".concat(n.slice(-3)),name:"HMAC"},!1,[e])}return function Fs(n,t,e){switch(t){case"HS256":case"HS384":case"HS512":{if(!nt(n.algorithm,"HMAC"))throw me("HMAC");const r=parseInt(t.slice(2),10);if(or(n.algorithm.hash)!==r)throw me("SHA-".concat(r),"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!nt(n.algorithm,"RSASSA-PKCS1-v1_5"))throw me("RSASSA-PKCS1-v1_5");const r=parseInt(t.slice(2),10);if(or(n.algorithm.hash)!==r)throw me("SHA-".concat(r),"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!nt(n.algorithm,"RSA-PSS"))throw me("RSA-PSS");const r=parseInt(t.slice(2),10);if(or(n.algorithm.hash)!==r)throw me("SHA-".concat(r),"algorithm.hash");break}case"Ed25519":case"EdDSA":if(!nt(n.algorithm,"Ed25519"))throw me("Ed25519");break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":if(!nt(n.algorithm,t))throw me(t);break;case"ES256":case"ES384":case"ES512":{if(!nt(n.algorithm,"ECDSA"))throw me("ECDSA");const r=function(o){switch(o){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}(t);if(n.algorithm.namedCurve!==r)throw me(r,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}!function(r,o){if(o&&!r.usages.includes(o))throw new TypeError("CryptoKey does not support this operation, its usages must include ".concat(o,"."))}(n,e)}(t,n,e),t}),Sr.apply(this,arguments)}function Ar(){return Ar=(0,h.A)(function*(n,t,e,r){const o=yield function ea(n,t,e){return Sr.apply(this,arguments)}(n,t,"verify");!function(i,a){if(i.startsWith("RS")||i.startsWith("PS")){const{modulusLength:c}=a.algorithm;if("number"!=typeof c||c<2048)throw new TypeError("".concat(i," requires key modulusLength to be 2048 bits or larger"))}}(n,o);const s=function(i,a){const c="SHA-".concat(i.slice(-3));switch(i){case"HS256":case"HS384":case"HS512":return{hash:c,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:c,name:"RSA-PSS",saltLength:parseInt(i.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:c,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:c,name:"ECDSA",namedCurve:a.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return{name:i};default:throw new te("alg ".concat(i," is not supported either by JOSE or your javascript runtime"))}}(n,o.algorithm);try{return yield crypto.subtle.verify(s,o,e,r)}catch{return!1}}),Ar.apply(this,arguments)}function kr(){return kr=(0,h.A)(function*(n,t,e){if(!Te(n))throw new J("Flattened JWS must be an object");if(void 0===n.protected&&void 0===n.header)throw new J('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==n.protected&&"string"!=typeof n.protected)throw new J("JWS Protected Header incorrect type");if(void 0===n.payload)throw new J("JWS Payload missing");if("string"!=typeof n.signature)throw new J("JWS Signature missing or incorrect type");if(void 0!==n.header&&!Te(n.header))throw new J("JWS Unprotected Header incorrect type");let r={};if(n.protected)try{const g=vt(n.protected);r=JSON.parse(yt.decode(g))}catch{throw new J("JWS Protected Header is invalid")}if(!function(){for(var g=arguments.length,f=new Array(g),v=0;v<g;v++)f[v]=arguments[v];const _=f.filter(Boolean);if(0===_.length||1===_.length)return!0;let A;for(const E of _){const w=Object.keys(E);if(A&&0!==A.size)for(const R of w){if(A.has(R))return!1;A.add(R)}else A=new Set(w)}return!0}(r,n.header))throw new J("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const o=k(k({},r),n.header);let i=!0;if(function(g,f,v,_,A){if(void 0!==A.crit&&void 0===_?.crit)throw new g('"crit" (Critical) Header Parameter MUST be integrity protected');if(!_||void 0===_.crit)return new Set;if(!Array.isArray(_.crit)||0===_.crit.length||_.crit.some(w=>"string"!=typeof w||0===w.length))throw new g('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let E;E=void 0!==v?new Map([...Object.entries(v),...f.entries()]):f;for(const w of _.crit){if(!E.has(w))throw new te('Extension Header Parameter "'.concat(w,'" is not recognized'));if(void 0===A[w])throw new g('Extension Header Parameter "'.concat(w,'" is missing'));if(E.get(w)&&void 0===_[w])throw new g('Extension Header Parameter "'.concat(w,'" MUST be integrity protected'))}return new Set(_.crit)}(J,new Map([["b64",!0]]),e?.crit,r,o).has("b64")&&(i=r.b64,"boolean"!=typeof i))throw new J('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:a}=o;if("string"!=typeof a||!a)throw new J('JWS "alg" (Algorithm) Header Parameter missing or invalid');const c=e&&function(g,f){if(void 0!==f&&(!Array.isArray(f)||f.some(v=>"string"!=typeof v)))throw new TypeError('"'.concat("algorithms",'" option must be an array of strings'));if(f)return new Set(f)}(0,e.algorithms);if(c&&!c.has(a))throw new zo('"alg" (Algorithm) Header Parameter value not allowed');if(i){if("string"!=typeof n.payload)throw new J("JWS Payload must be a string")}else if("string"!=typeof n.payload&&!(n.payload instanceof Uint8Array))throw new J("JWS Payload must be a string or an Uint8Array instance");let l=!1;"function"==typeof t&&(t=yield t(r,n),l=!0),function Ys(n,t,e){switch(n.substring(0,2)){case"A1":case"A2":case"di":case"HS":case"PB":((r,o,s)=>{if(!(o instanceof Uint8Array)){if(ar(o)){if("oct"===(i=o).kty&&"string"==typeof i.k&&ur(r,o,s))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Bo(o))throw new TypeError(Fo(r,o,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if("secret"!==o.type)throw new TypeError("".concat(rt(o),' instances for symmetric algorithms must be of type "secret"'))}var i})(n,t,e);break;default:((r,o,s)=>{if(ar(o))switch(s){case"decrypt":case"sign":if("oct"!==(i=o).kty&&("AKP"===i.kty&&"string"==typeof i.priv||"string"==typeof i.d)&&ur(r,o,s))return;throw new TypeError("JSON Web Key for this operation must be a private JWK");case"encrypt":case"verify":if((i=>"oct"!==i.kty&&void 0===i.d&&void 0===i.priv)(o)&&ur(r,o,s))return;throw new TypeError("JSON Web Key for this operation must be a public JWK")}var i;if(!Bo(o))throw new TypeError(Fo(r,o,"CryptoKey","KeyObject","JSON Web Key"));if("secret"===o.type)throw new TypeError("".concat(rt(o),' instances for asymmetric algorithms must not be of type "secret"'));if("public"===o.type)switch(s){case"sign":throw new TypeError("".concat(rt(o),' instances for asymmetric algorithm signing must be of type "private"'));case"decrypt":throw new TypeError("".concat(rt(o),' instances for asymmetric algorithm decryption must be of type "private"'))}if("private"===o.type)switch(s){case"verify":throw new TypeError("".concat(rt(o),' instances for asymmetric algorithm verifying must be of type "public"'));case"encrypt":throw new TypeError("".concat(rt(o),' instances for asymmetric algorithm encryption must be of type "public"'))}})(n,t,e)}}(a,t,"verify");const u=function(){for(var g=arguments.length,f=new Array(g),v=0;v<g;v++)f[v]=arguments[v];const _=f.reduce((w,R)=>{let{length:P}=R;return w+P},0),A=new Uint8Array(_);let E=0;for(const w of f)A.set(w,E),E+=w.length;return A}(void 0!==n.protected?Qn(n.protected):new Uint8Array,Qn("."),"string"==typeof n.payload?i?Qn(n.payload):Ko.encode(n.payload):n.payload);let d;try{d=vt(n.signature)}catch{throw new J("Failed to base64url decode the signature")}const m=yield function Xs(n,t){return cr.apply(this,arguments)}(t,a);if(!(yield function ta(n,t,e,r){return Ar.apply(this,arguments)}(a,m,d,u)))throw new Jo;let p;if(i)try{p=vt(n.payload)}catch{throw new J("Failed to base64url decode the payload")}else p="string"==typeof n.payload?Ko.encode(n.payload):n.payload;const y={payload:p};return void 0!==n.protected&&(y.protectedHeader=r),void 0!==n.header&&(y.unprotectedHeader=n.header),l?k(k({},y),{},{key:m}):y}),kr.apply(this,arguments)}const oa=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;function ui(n){const t=oa.exec(n);if(!t||t[4]&&t[1])throw new TypeError("Invalid time period format");const e=parseFloat(t[2]);let r;switch(t[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":r=Math.round(e);break;case"minute":case"minutes":case"min":case"mins":case"m":r=Math.round(60*e);break;case"hour":case"hours":case"hr":case"hrs":case"h":r=Math.round(3600*e);break;case"day":case"days":case"d":r=Math.round(86400*e);break;case"week":case"weeks":case"w":r=Math.round(604800*e);break;default:r=Math.round(31557600*e)}return"-"===t[1]||"ago"===t[4]?-r:r}const li=n=>n.includes("/")?n.toLowerCase():"application/".concat(n.toLowerCase());function Er(){return Er=(0,h.A)(function*(n,t,e){var r;const o=yield(a=(0,h.A)(function*(c,l,u){if(c instanceof Uint8Array&&(c=yt.decode(c)),"string"!=typeof c)throw new J("Compact JWS must be a string or Uint8Array");const{0:d,1:m,2:p,length:y}=c.split(".");if(3!==y)throw new J("Invalid Compact JWS");const g=yield function na(n,t,e){return kr.apply(this,arguments)}({payload:m,protected:d,signature:p},l,u),f={payload:g.payload,protectedHeader:g.protectedHeader};return"function"==typeof l?k(k({},f),{},{key:g.key}):f}),function(c,l,u){return a.apply(this,arguments)})(n,t,e);var a;if(null!==(r=o.protectedHeader.crit)&&void 0!==r&&r.includes("b64")&&!1===o.protectedHeader.b64)throw new tr("JWTs MUST NOT use unencoded payload");const s=function(a,c){let l,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{l=JSON.parse(yt.decode(c))}catch{}if(!Te(l))throw new tr("JWT Claims Set must be a top-level JSON object");const{typ:d}=u;if(d&&("string"!=typeof a.typ||li(a.typ)!==li(d)))throw new ue('unexpected "typ" JWT header value',l,"typ","check_failed");const{requiredClaims:m=[],issuer:p,subject:y,audience:g,maxTokenAge:f}=u,v=[...m];void 0!==f&&v.push("iat"),void 0!==g&&v.push("aud"),void 0!==y&&v.push("sub"),void 0!==p&&v.push("iss");for(const w of new Set(v.reverse()))if(!(w in l))throw new ue('missing required "'.concat(w,'" claim'),l,w,"missing");if(p&&!(Array.isArray(p)?p:[p]).includes(l.iss))throw new ue('unexpected "iss" claim value',l,"iss","check_failed");if(y&&l.sub!==y)throw new ue('unexpected "sub" claim value',l,"sub","check_failed");if(g&&!((n,t)=>"string"==typeof n?t.includes(n):!!Array.isArray(n)&&t.some(Set.prototype.has.bind(new Set(n))))(l.aud,"string"==typeof g?[g]:g))throw new ue('unexpected "aud" claim value',l,"aud","check_failed");let _;switch(typeof u.clockTolerance){case"string":_=ui(u.clockTolerance);break;case"number":_=u.clockTolerance;break;case"undefined":_=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:A}=u,E=(n=>Math.floor(n.getTime()/1e3))(A||new Date);if((void 0!==l.iat||f)&&"number"!=typeof l.iat)throw new ue('"iat" claim must be a number',l,"iat","invalid");if(void 0!==l.nbf){if("number"!=typeof l.nbf)throw new ue('"nbf" claim must be a number',l,"nbf","invalid");if(l.nbf>E+_)throw new ue('"nbf" claim timestamp check failed',l,"nbf","check_failed")}if(void 0!==l.exp){if("number"!=typeof l.exp)throw new ue('"exp" claim must be a number',l,"exp","invalid");if(l.exp<=E-_)throw new er('"exp" claim timestamp check failed',l,"exp","check_failed")}if(f){const w=E-l.iat;if(w-_>("number"==typeof f?f:ui(f)))throw new er('"iat" claim timestamp check failed (too far in the past)',l,"iat","check_failed");if(w<0-_)throw new ue('"iat" claim timestamp check failed (it should be in the past)',l,"iat","check_failed")}return l}(o.protectedHeader,o.payload,e),i={payload:s,protectedHeader:o.protectedHeader};return"function"==typeof t?k(k({},i),{},{key:o.key}):i}),Er.apply(this,arguments)}function aa(n){return Te(n)}var $t,xr,Qt=new WeakMap,Tr=new WeakMap;class ca{constructor(t){if(H(this,Qt,void 0),H(this,Tr,new WeakMap),!((e=t)&&"object"==typeof e&&Array.isArray(e.keys)&&e.keys.every(aa)))throw new nr("JSON Web Key Set malformed");var e;j(Qt,this,structuredClone(t))}jwks(){return b(Qt,this)}getKey(t,e){var r=this;return(0,h.A)(function*(){const{alg:o,kid:s}=k(k({},t),e?.header),i=function(u){switch("string"==typeof u&&u.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";case"ML":return"AKP";default:throw new te('Unsupported "alg" value for a JSON Web Key Set')}}(o),a=b(Qt,r).keys.filter(u=>{let d=i===u.kty;if(d&&"string"==typeof s&&(d=s===u.kid),!d||"string"!=typeof u.alg&&"AKP"!==i||(d=o===u.alg),d&&"string"==typeof u.use&&(d="sig"===u.use),d&&Array.isArray(u.key_ops)&&(d=u.key_ops.includes("verify")),d)switch(o){case"ES256":d="P-256"===u.crv;break;case"ES384":d="P-384"===u.crv;break;case"ES512":d="P-521"===u.crv;break;case"Ed25519":case"EdDSA":d="Ed25519"===u.crv}return d}),{0:c,length:l}=a;if(0===l)throw new rr;if(1!==l){const u=new Wo,d=b(Tr,r);throw u[Symbol.asyncIterator]=function ms(n){return function(){return new ht(n.apply(this,arguments))}}(function*(){for(const m of a)try{yield yield ps(di(d,m,o))}catch{}}),u}return di(b(Tr,r),c,o)})()}}function di(n,t,e){return Rr.apply(this,arguments)}function Rr(){return Rr=(0,h.A)(function*(n,t,e){const r=n.get(t)||n.set(t,{}).get(t);if(void 0===r[e]){const o=yield(s=(0,h.A)(function*(i,a,c){var l;if(!Te(i))throw new TypeError("JWK must be an object");let u;switch(null!=a||(a=i.alg),null!=u||(u=null!==(l=c?.extractable)&&void 0!==l?l:i.ext),i.kty){case"oct":if("string"!=typeof i.k||!i.k)throw new TypeError('missing "k" (Key Value) Parameter value');return vt(i.k);case"RSA":if("oth"in i&&void 0!==i.oth)throw new te('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');return Gt(k(k({},i),{},{alg:a,ext:u}));case"AKP":if("string"!=typeof i.alg||!i.alg)throw new TypeError('missing "alg" (Algorithm) Parameter value');if(void 0!==a&&a!==i.alg)throw new TypeError("JWK alg and alg option value mismatch");return Gt(k(k({},i),{},{ext:u}));case"EC":case"OKP":return Gt(k(k({},i),{},{alg:a,ext:u}));default:throw new te('Unsupported "kty" (Key Type) Parameter value')}}),function(i,a,c){return s.apply(this,arguments)})(k(k({},t),{},{ext:!0}),e);if(o instanceof Uint8Array||"public"!==o.type)throw new nr("JSON Web Key Set members must be public keys");r[e]=o}var s;return r[e]}),Rr.apply(this,arguments)}function hi(n){const t=new ca(n),e=function(){var r=(0,h.A)(function*(o,s){return t.getKey(o,s)});return function(s,i){return r.apply(this,arguments)}}();return Object.defineProperties(e,{jwks:{value:()=>structuredClone(t.jwks()),enumerable:!1,configurable:!1,writable:!1}}),e}let Ir;(typeof navigator>"u"||null===($t=navigator.userAgent)||void 0===$t||null===(xr=$t.startsWith)||void 0===xr||!xr.call($t,"Mozilla/5.0 "))&&(Ir="".concat("jose","/").concat("v6.1.3"));const pi=Symbol(),Pr=Symbol();var Cr=new WeakMap,Or=new WeakMap,Dr=new WeakMap,en=new WeakMap,We=new WeakMap,ke=new WeakMap,Ce=new WeakMap,Ur=new WeakMap,He=new WeakMap,Je=new WeakMap;class ua{constructor(t,e){if(H(this,Cr,void 0),H(this,Or,void 0),H(this,Dr,void 0),H(this,en,void 0),H(this,We,void 0),H(this,ke,void 0),H(this,Ce,void 0),H(this,Ur,void 0),H(this,He,void 0),H(this,Je,void 0),!(t instanceof URL))throw new TypeError("url must be an instance of URL");var r,o;j(Cr,this,new URL(t.href)),j(Or,this,"number"==typeof e?.timeoutDuration?e?.timeoutDuration:5e3),j(Dr,this,"number"==typeof e?.cooldownDuration?e?.cooldownDuration:3e4),j(en,this,"number"==typeof e?.cacheMaxAge?e?.cacheMaxAge:6e5),j(Ce,this,new Headers(e?.headers)),Ir&&!b(Ce,this).has("User-Agent")&&b(Ce,this).set("User-Agent",Ir),b(Ce,this).has("accept")||(b(Ce,this).set("accept","application/json"),b(Ce,this).append("accept","application/jwk-set+json")),j(Ur,this,e?.[pi]),void 0!==e?.[Pr]&&(j(Je,this,e?.[Pr]),r=e?.[Pr],o=b(en,this),"object"==typeof r&&null!==r&&"uat"in r&&"number"==typeof r.uat&&!(Date.now()-r.uat>=o)&&"jwks"in r&&Te(r.jwks)&&Array.isArray(r.jwks.keys)&&Array.prototype.every.call(r.jwks.keys,Te)&&(j(We,this,b(Je,this).uat),j(He,this,hi(b(Je,this).jwks))))}pendingFetch(){return!!b(ke,this)}coolingDown(){return"number"==typeof b(We,this)&&Date.now()<b(We,this)+b(Dr,this)}fresh(){return"number"==typeof b(We,this)&&Date.now()<b(We,this)+b(en,this)}jwks(){var t;return null===(t=b(He,this))||void 0===t?void 0:t.jwks()}getKey(t,e){var r=this;return(0,h.A)(function*(){b(He,r)&&r.fresh()||(yield r.reload());try{return yield b(He,r).call(r,t,e)}catch(o){if(o instanceof rr&&!1===r.coolingDown())return yield r.reload(),b(He,r).call(r,t,e);throw o}})()}reload(){var t=this;return(0,h.A)(function*(){var e;b(ke,t)&&(typeof WebSocketPair<"u"||typeof navigator<"u"&&"Cloudflare-Workers"===navigator.userAgent||typeof EdgeRuntime<"u"&&"vercel"===EdgeRuntime)&&j(ke,t,void 0),b(ke,t)||j(ke,t,(e=(0,h.A)(function*(r,o,s){const a=yield(arguments.length>3&&void 0!==arguments[3]?arguments[3]:fetch)(r,{method:"GET",signal:s,redirect:"manual",headers:o}).catch(c=>{throw"TimeoutError"===c.name?new Ho:c});if(200!==a.status)throw new Z("Expected 200 OK from the JSON Web Key Set HTTP response");try{return yield a.json()}catch{throw new Z("Failed to parse the JSON Web Key Set HTTP response as JSON")}}),function(r,o,s){return e.apply(this,arguments)})(b(Cr,t).href,b(Ce,t),AbortSignal.timeout(b(Or,t)),b(Ur,t)).then(e=>{j(He,t,hi(e)),b(Je,t)&&(b(Je,t).uat=Date.now(),b(Je,t).jwks=e),j(We,t,Date.now()),j(ke,t,void 0)}).catch(e=>{throw j(ke,t,void 0),e})),yield b(ke,t)})()}}const la=["mfaToken"],da=["mfaToken"];var Ve,tn,Fe,Oe,ot,O,Et,z,mi=class extends Error{constructor(n,t){super(t),S(this,"code",void 0),this.name="NotSupportedError",this.code=n}},Ee=class extends Error{constructor(n,t,e){super(t),S(this,"cause",void 0),S(this,"code",void 0),this.code=n,this.cause=e&&{error:e.error,error_description:e.error_description,message:e.message}}},ha=class extends Ee{constructor(n,t){super("token_by_code_error",n,t),this.name="TokenByCodeError"}},pa=class extends Ee{constructor(n,t){super("token_by_client_credentials_error",n,t),this.name="TokenByClientCredentialsError"}},ma=class extends Ee{constructor(n,t){super("token_by_refresh_token_error",n,t),this.name="TokenByRefreshTokenError"}},jr=class extends Ee{constructor(n,t){super("token_for_connection_error",n,t),this.name="TokenForConnectionErrorCode"}},ye=class extends Ee{constructor(n,t){super("token_exchange_error",n,t),this.name="TokenExchangeError"}},De=class extends Error{constructor(n){super(n),S(this,"code","verify_logout_token_error"),this.name="VerifyLogoutTokenError"}},Lr=class extends Ee{constructor(n){super("backchannel_authentication_error","There was an error when trying to use Client-Initiated Backchannel Authentication.",n),S(this,"code","backchannel_authentication_error"),this.name="BackchannelAuthenticationError"}},fa=class extends Ee{constructor(n){super("build_authorization_url_error","There was an error when trying to build the authorization URL.",n),this.name="BuildAuthorizationUrlError"}},ga=class extends Ee{constructor(n){super("build_link_user_url_error","There was an error when trying to build the Link User URL.",n),this.name="BuildLinkUserUrlError"}},ya=class extends Ee{constructor(n){super("build_unlink_user_url_error","There was an error when trying to build the Unlink User URL.",n),this.name="BuildUnlinkUserUrlError"}},va=class extends Error{constructor(){super("The client secret or client assertion signing key must be provided."),S(this,"code","missing_client_auth_error"),this.name="MissingClientAuthError"}};function Nr(n){return Object.entries(n).filter(t=>{let[,e]=t;return void 0!==e}).reduce((t,e)=>k(k({},t),{},{[e[0]]:e[1]}),{})}var nn=class extends Error{constructor(n,t,e){super(t),S(this,"cause",void 0),S(this,"code",void 0),this.code=n,this.cause=e&&{error:e.error,error_description:e.error_description,message:e.message}}},_a=class extends nn{constructor(n,t){super("mfa_list_authenticators_error",n,t),this.name="MfaListAuthenticatorsError"}},wa=class extends nn{constructor(n,t){super("mfa_enrollment_error",n,t),this.name="MfaEnrollmentError"}},ba=class extends nn{constructor(n,t){super("mfa_delete_authenticator_error",n,t),this.name="MfaDeleteAuthenticatorError"}},Sa=class extends nn{constructor(n,t){super("mfa_challenge_error",n,t),this.name="MfaChallengeError"}};function Aa(n){return{id:n.id,authenticatorType:n.authenticator_type,active:n.active,name:n.name,oobChannels:n.oob_channels,type:n.type}}var ka=(Ve=new WeakMap,tn=new WeakMap,Fe=new WeakMap,class{constructor(n){var t;H(this,Ve,void 0),H(this,tn,void 0),H(this,Fe,void 0),j(Ve,this,"https://".concat(n.domain)),j(tn,this,n.clientId),j(Fe,this,null!==(t=n.customFetch)&&void 0!==t?t:function(){return fetch(...arguments)})}listAuthenticators(n){var t=this;return(0,h.A)(function*(){const e="".concat(b(Ve,t),"/mfa/authenticators"),{mfaToken:r}=n,o=yield b(Fe,t).call(t,e,{method:"GET",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}});if(!o.ok){const s=yield o.json();throw new _a(s.error_description||"Failed to list authenticators",s)}return(yield o.json()).map(Aa)})()}enrollAuthenticator(n){var t=this;return(0,h.A)(function*(){const e="".concat(b(Ve,t),"/mfa/associate"),{mfaToken:r}=n,o=wo(n,la),s={authenticator_types:o.authenticatorTypes};"oobChannels"in o&&(s.oob_channels=o.oobChannels),"phoneNumber"in o&&o.phoneNumber&&(s.phone_number=o.phoneNumber),"email"in o&&o.email&&(s.email=o.email);const i=yield b(Fe,t).call(t,e,{method:"POST",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"},body:JSON.stringify(s)});if(!i.ok){const a=yield i.json();throw new wa(a.error_description||"Failed to enroll authenticator",a)}return function(a){if("otp"===a.authenticator_type)return{authenticatorType:"otp",secret:a.secret,barcodeUri:a.barcode_uri,recoveryCodes:a.recovery_codes,id:a.id};if("oob"===a.authenticator_type)return{authenticatorType:"oob",oobChannel:a.oob_channel,oobCode:a.oob_code,bindingMethod:a.binding_method,id:a.id};throw new Error("Unexpected authenticator type: ".concat(a.authenticator_type))}(yield i.json())})()}deleteAuthenticator(n){var t=this;return(0,h.A)(function*(){const{authenticatorId:e,mfaToken:r}=n,o="".concat(b(Ve,t),"/mfa/authenticators/").concat(encodeURIComponent(e)),s=yield b(Fe,t).call(t,o,{method:"DELETE",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}});if(!s.ok){const i=yield s.json();throw new ba(i.error_description||"Failed to delete authenticator",i)}})()}challengeAuthenticator(n){var t=this;return(0,h.A)(function*(){const e="".concat(b(Ve,t),"/mfa/challenge"),{mfaToken:r}=n,o=wo(n,da),s={mfa_token:r,client_id:b(tn,t),challenge_type:o.challengeType};o.authenticatorId&&(s.authenticator_id=o.authenticatorId);const i=yield b(Fe,t).call(t,e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!i.ok){const a=yield i.json();throw new Sa(a.error_description||"Failed to challenge authenticator",a)}return function(a){const c={challengeType:a.challenge_type};return void 0!==a.oob_code&&(c.oobCode=a.oob_code),void 0!==a.binding_method&&(c.bindingMethod=a.binding_method),c}(yield i.json())})()}}),Ge=class xi{constructor(t,e,r,o,s,i,a){S(this,"accessToken",void 0),S(this,"idToken",void 0),S(this,"refreshToken",void 0),S(this,"expiresAt",void 0),S(this,"scope",void 0),S(this,"claims",void 0),S(this,"authorizationDetails",void 0),S(this,"tokenType",void 0),S(this,"issuedTokenType",void 0),this.accessToken=t,this.idToken=r,this.refreshToken=o,this.expiresAt=e,this.scope=s,this.claims=i,this.authorizationDetails=a}static fromTokenEndpointResponse(t){const e=t.id_token?t.claims():void 0,r=new xi(t.access_token,Math.floor(Date.now()/1e3)+Number(t.expires_in),t.id_token,t.refresh_token,t.scope,e,t.authorization_details);return r.tokenType=t.token_type,r.issuedTokenType=t.issued_token_type,r}},Kr="openid profile email offline_access",Ea=Object.freeze(new Set(["grant_type","client_id","client_secret","client_assertion","client_assertion_type","subject_token","subject_token_type","requested_token_type","actor_token","actor_token_type","audience","aud","resource","resources","resource_indicator","scope","connection","login_hint","organization","assertion"]));function fi(n){if(null==n)throw new ye("subject_token is required");if("string"!=typeof n)throw new ye("subject_token must be a string");if(0===n.trim().length)throw new ye("subject_token cannot be blank or whitespace");if(n!==n.trim())throw new ye("subject_token must not include leading or trailing whitespace");if(/^bearer\s+/i.test(n))throw new ye("subject_token must not include the 'Bearer ' prefix")}function gi(n,t){if(t)for(const[e,r]of Object.entries(t))if(!Ea.has(e))if(Array.isArray(r)){if(r.length>20)throw new ye("Parameter '".concat(e,"' exceeds maximum array size of ").concat(20));r.forEach(o=>{n.append(e,o)})}else n.append(e,r)}var xa=(Oe=new WeakMap,ot=new WeakMap,O=new WeakMap,Et=new WeakMap,z=new WeakSet,class{constructor(n){if(vo(this,e=z),e.add(this),H(this,Oe,void 0),H(this,ot,void 0),H(this,O,void 0),H(this,Et,void 0),S(this,"mfa",void 0),j(O,this,n),n.useMtls&&!n.customFetch)throw new mi("mtls_without_custom_fetch_not_supported","Using mTLS without a custom fetch implementation is not supported");var e;this.mfa=new ka({domain:b(O,this).domain,clientId:b(O,this).clientId,customFetch:b(O,this).customFetch})}buildAuthorizationUrl(n){var t=this;return(0,h.A)(function*(){const{serverMetadata:e}=yield K(z,t,ie).call(t);if(null!=n&&n.pushedAuthorizationRequests&&!e.pushed_authorization_request_endpoint)throw new mi("par_not_supported_error","The Auth0 tenant does not have pushed authorization requests enabled. Learn how to enable it here: https://auth0.com/docs/get-started/applications/configure-par");try{return yield K(z,t,Jr).call(t,n)}catch(r){throw new fa(r)}})()}buildLinkUserUrl(n){var t=this;return(0,h.A)(function*(){try{const e=yield K(z,t,Jr).call(t,{authorizationParams:k(k({},n.authorizationParams),{},{requested_connection:n.connection,requested_connection_scope:n.connectionScope,scope:"openid link_account offline_access",id_token_hint:n.idToken})});return{linkUserUrl:e.authorizationUrl,codeVerifier:e.codeVerifier}}catch(e){throw new ga(e)}})()}buildUnlinkUserUrl(n){var t=this;return(0,h.A)(function*(){try{const e=yield K(z,t,Jr).call(t,{authorizationParams:k(k({},n.authorizationParams),{},{requested_connection:n.connection,scope:"openid unlink_account",id_token_hint:n.idToken})});return{unlinkUserUrl:e.authorizationUrl,codeVerifier:e.codeVerifier}}catch(e){throw new ya(e)}})()}backchannelAuthentication(n){var t=this;return(0,h.A)(function*(){const{configuration:e,serverMetadata:r}=yield K(z,t,ie).call(t),o=Nr(k(k({},b(O,t).authorizationParams),n?.authorizationParams)),s=new URLSearchParams(k(k({scope:Kr},o),{},{client_id:b(O,t).clientId,binding_message:n.bindingMessage,login_hint:JSON.stringify({format:"iss_sub",iss:r.issuer,sub:n.loginHint.sub})}));n.requestedExpiry&&s.append("requested_expiry",n.requestedExpiry.toString()),n.authorizationDetails&&s.append("authorization_details",JSON.stringify(n.authorizationDetails));try{const i=yield ni(e,s),a=yield ri(e,i);return Ge.fromTokenEndpointResponse(a)}catch(i){throw new Lr(i)}})()}initiateBackchannelAuthentication(n){var t=this;return(0,h.A)(function*(){const{configuration:e,serverMetadata:r}=yield K(z,t,ie).call(t),o=Nr(k(k({},b(O,t).authorizationParams),n?.authorizationParams)),s=new URLSearchParams(k(k({scope:Kr},o),{},{client_id:b(O,t).clientId,binding_message:n.bindingMessage,login_hint:JSON.stringify({format:"iss_sub",iss:r.issuer,sub:n.loginHint.sub})}));n.requestedExpiry&&s.append("requested_expiry",n.requestedExpiry.toString()),n.authorizationDetails&&s.append("authorization_details",JSON.stringify(n.authorizationDetails));try{const i=yield ni(e,s);return{authReqId:i.auth_req_id,expiresIn:i.expires_in,interval:i.interval}}catch(i){throw new Lr(i)}})()}backchannelAuthenticationGrant(n){var t=this;return(0,h.A)(function*(){let{authReqId:e}=n;const{configuration:r}=yield K(z,t,ie).call(t),o=new URLSearchParams({auth_req_id:e});try{const s=yield wr(r,"urn:openid:params:grant-type:ciba",o);return Ge.fromTokenEndpointResponse(s)}catch(s){throw new Lr(s)}})()}getTokenForConnection(n){var t=this;return(0,h.A)(function*(){var e;if(n.refreshToken&&n.accessToken)throw new jr("Either a refresh or access token should be specified, but not both.");const r=null!==(e=n.accessToken)&&void 0!==e?e:n.refreshToken;if(!r)throw new jr("Either a refresh or access token must be specified.");try{return yield t.exchangeToken({connection:n.connection,subjectToken:r,subjectTokenType:n.accessToken?"urn:ietf:params:oauth:token-type:access_token":"urn:ietf:params:oauth:token-type:refresh_token",loginHint:n.loginHint})}catch(o){throw o instanceof ye?new jr(o.message,o.cause):o}})()}exchangeToken(n){var t=this;return(0,h.A)(function*(){return"connection"in n?K(z,t,Ta).call(t,n):K(z,t,Ra).call(t,n)})()}getTokenByCode(n,t){var e=this;return(0,h.A)(function*(){const{configuration:r}=yield K(z,e,ie).call(e);try{const o=yield ii(r,n,{pkceCodeVerifier:t.codeVerifier});return Ge.fromTokenEndpointResponse(o)}catch(o){throw new ha("There was an error while trying to request a token.",o)}})()}getTokenByRefreshToken(n){var t=this;return(0,h.A)(function*(){const{configuration:e}=yield K(z,t,ie).call(t);try{const r=yield si(e,n.refreshToken);return Ge.fromTokenEndpointResponse(r)}catch(r){throw new ma("The access token has expired and there was an error while trying to refresh it.",r)}})()}getTokenByClientCredentials(n){var t=this;return(0,h.A)(function*(){const{configuration:e}=yield K(z,t,ie).call(t);try{const r=new URLSearchParams({audience:n.audience});n.organization&&r.append("organization",n.organization);const o=yield ai(e,r);return Ge.fromTokenEndpointResponse(o)}catch(r){throw new pa("There was an error while trying to request a token.",r)}})()}buildLogoutUrl(n){var t=this;return(0,h.A)(function*(){const{configuration:e,serverMetadata:r}=yield K(z,t,ie).call(t);if(!r.end_session_endpoint){const o=new URL("https://".concat(b(O,t).domain,"/v2/logout"));return o.searchParams.set("returnTo",n.returnTo),o.searchParams.set("client_id",b(O,t).clientId),o}return function(o,s){Ae(o);const{as:i,c:a,tlsOnly:c}=B(o),l=pt(i,"end_session_endpoint",!1,c);(s=new URLSearchParams(s)).has("client_id")||s.set("client_id",a.client_id);for(const[u,d]of s.entries())l.searchParams.append(u,d);return l}(e,{post_logout_redirect_uri:n.returnTo})})()}verifyLogoutToken(n){var t=this;return(0,h.A)(function*(){const{serverMetadata:e}=yield K(z,t,ie).call(t);b(Et,t)||j(Et,t,function(o,s){const i=new ua(o,s),a=function(){var c=(0,h.A)(function*(l,u){return i.getKey(l,u)});return function(u,d){return c.apply(this,arguments)}}();return Object.defineProperties(a,{coolingDown:{get:()=>i.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>i.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>i.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>i.pendingFetch(),enumerable:!0,configurable:!1},jwks:{value:()=>i.jwks(),enumerable:!0,configurable:!1,writable:!1}}),a}(new URL(e.jwks_uri),{[pi]:b(O,t).customFetch}));const{payload:r}=yield function sa(n,t,e){return Er.apply(this,arguments)}(n.logoutToken,b(Et,t),{issuer:e.issuer,audience:b(O,t).clientId,algorithms:["RS256"],requiredClaims:["iat"]});if(!("sid"in r)&&!("sub"in r))throw new De('either "sid" or "sub" (or both) claims must be present');if("sid"in r&&"string"!=typeof r.sid)throw new De('"sid" claim must be a string');if("sub"in r&&"string"!=typeof r.sub)throw new De('"sub" claim must be a string');if("nonce"in r)throw new De('"nonce" claim is prohibited');if(!("events"in r))throw new De('"events" claim is missing');if("object"!=typeof r.events||null===r.events)throw new De('"events" claim must be an object');if(!("http://schemas.openid.net/event/backchannel-logout"in r.events))throw new De('"http://schemas.openid.net/event/backchannel-logout" member is missing in the "events" claim');if("object"!=typeof r.events["http://schemas.openid.net/event/backchannel-logout"])throw new De('"http://schemas.openid.net/event/backchannel-logout" member in the "events" claim must be an object');return{sid:r.sid,sub:r.sub}})()}});function ie(){return Mr.apply(this,arguments)}function Mr(){return Mr=(0,h.A)(function*(){if(b(Oe,this)&&b(ot,this))return{configuration:b(Oe,this),serverMetadata:b(ot,this)};const n=yield K(z,this,Ia).call(this);return j(Oe,this,yield function Qs(n,t,e,r,o){return dr.apply(this,arguments)}(new URL("https://".concat(b(O,this).domain)),b(O,this).clientId,{use_mtls_endpoint_aliases:b(O,this).useMtls},n,{[Ie]:b(O,this).customFetch})),j(ot,this,b(Oe,this).serverMetadata()),b(Oe,this)[Ie]=b(O,this).customFetch||fetch,{configuration:b(Oe,this),serverMetadata:b(ot,this)}}),Mr.apply(this,arguments)}function Ta(n){return zr.apply(this,arguments)}function zr(){return zr=(0,h.A)(function*(n){var t,e;const{configuration:r}=yield K(z,this,ie).call(this);if("audience"in n||"resource"in n)throw new ye("audience and resource parameters are not supported for Token Vault exchanges");fi(n.subjectToken);const o=new URLSearchParams({connection:n.connection,subject_token:n.subjectToken,subject_token_type:null!==(t=n.subjectTokenType)&&void 0!==t?t:"urn:ietf:params:oauth:token-type:access_token",requested_token_type:null!==(e=n.requestedTokenType)&&void 0!==e?e:"http://auth0.com/oauth/token-type/federated-connection-access-token"});n.loginHint&&o.append("login_hint",n.loginHint),n.scope&&o.append("scope",n.scope),gi(o,n.extra);try{const s=yield wr(r,"urn:auth0:params:oauth:grant-type:token-exchange:federated-connection-access-token",o);return Ge.fromTokenEndpointResponse(s)}catch(s){throw new ye("Failed to exchange token for connection '".concat(n.connection,"'."),s)}}),zr.apply(this,arguments)}function Ra(n){return Wr.apply(this,arguments)}function Wr(){return Wr=(0,h.A)(function*(n){const{configuration:t}=yield K(z,this,ie).call(this);fi(n.subjectToken);const e=new URLSearchParams({subject_token_type:n.subjectTokenType,subject_token:n.subjectToken});n.audience&&e.append("audience",n.audience),n.scope&&e.append("scope",n.scope),n.requestedTokenType&&e.append("requested_token_type",n.requestedTokenType),n.organization&&e.append("organization",n.organization),gi(e,n.extra);try{const r=yield wr(t,"urn:ietf:params:oauth:grant-type:token-exchange",e);return Ge.fromTokenEndpointResponse(r)}catch(r){throw new ye("Failed to exchange token of type '".concat(n.subjectTokenType,"'").concat(n.audience?" for audience '".concat(n.audience,"'"):"","."),r)}}),Wr.apply(this,arguments)}function Ia(){return Hr.apply(this,arguments)}function Hr(){return Hr=(0,h.A)(function*(){if(!b(O,this).clientSecret&&!b(O,this).clientAssertionSigningKey&&!b(O,this).useMtls)throw new va;if(b(O,this).useMtls)return(t,e,r,o)=>{r.set("client_id",e.client_id)};let n=b(O,this).clientAssertionSigningKey;return!n||n instanceof CryptoKey||(n=yield(t=(0,h.A)(function*(e,r,o){if("string"!=typeof e||0!==e.indexOf("-----BEGIN PRIVATE KEY-----"))throw new TypeError('"pkcs8" must be PKCS#8 formatted string');return Bs(e,r,o)}),function(e,r,o){return t.apply(this,arguments)})(n,b(O,this).clientAssertionSigningAlg||"RS256")),n?function(t){return function bs(n,t){const{key:e,kid:r}=(o=n)instanceof CryptoKey?{key:o}:o?.key instanceof CryptoKey?(void 0!==o.kid&&M(o.kid,'"kid"'),{key:o.key,kid:o.kid}):{};var o;return function vs(n,t){if(function(e,r){if(!(e instanceof CryptoKey))throw C("".concat(r," must be a CryptoKey"),"ERR_INVALID_ARG_TYPE")}(n,t),"private"!==n.type)throw C("".concat(t," must be a private CryptoKey"),"ERR_INVALID_ARG_VALUE")}(e,'"clientPrivateKey.key"'),function(){var s=(0,h.A)(function*(i,a,c,l){var u;const d={alg:ws(e),kid:r},m=function(p,y){const g=Ht()+Wt(y);return{jti:Eo(),aud:p.issuer,exp:g+60,iat:g,nbf:g,iss:y.client_id,sub:y.client_id}}(i,a);var p;null==t||null===(u=t[fs])||void 0===u||u.call(t,d,m),c.set("client_id",a.client_id),c.set("client_assertion_type","urn:ietf:params:oauth:client-assertion-type:jwt-bearer"),c.set("client_assertion",yield(p=(0,h.A)(function*(y,g,f){if(!f.usages.includes("sign"))throw C('CryptoKey instances used for signing assertions must include "sign" in their "usages"',"ERR_INVALID_ARG_VALUE");const v="".concat(Ke(et(JSON.stringify(y))),".").concat(Ke(et(JSON.stringify(g)))),_=Ke(yield crypto.subtle.sign(function(A){switch(A.algorithm.name){case"ECDSA":return{name:A.algorithm.name,hash:Ms(A)};case"RSA-PSS":switch(Lo(A),A.algorithm.hash.name){case"SHA-256":case"SHA-384":case"SHA-512":return{name:A.algorithm.name,saltLength:parseInt(A.algorithm.hash.name.slice(-3),10)>>3};default:throw new ee("unsupported RSA-PSS hash name",{cause:A})}case"RSASSA-PKCS1-v1_5":return Lo(A),A.algorithm.name;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":case"Ed25519":return A.algorithm.name}throw new ee("unsupported CryptoKey algorithm name",{cause:A})}(f),f,et(v)));return"".concat(v,".").concat(_)}),function(y,g,f){return p.apply(this,arguments)})(d,m,e))});return function(i,a,c,l){return s.apply(this,arguments)}}()}(t,void 0)}(n):$o(b(O,this).clientSecret);var t}),Hr.apply(this,arguments)}function Jr(n){return Vr.apply(this,arguments)}function Vr(){return Vr=(0,h.A)(function*(n){const{configuration:t}=yield K(z,this,ie).call(this),e=function $s(){return Eo()}(),r=yield function qs(n){return(t=(0,h.A)(function*(e){return M(e,"codeVerifier"),Ke(yield crypto.subtle.digest("SHA-256",et(e)))}),function(e){return t.apply(this,arguments)})(n);var t}(e),o=Nr(k(k({},b(O,this).authorizationParams),n?.authorizationParams)),s=new URLSearchParams(k(k({scope:Kr},o),{},{client_id:b(O,this).clientId,code_challenge:r,code_challenge_method:"S256"}));return{authorizationUrl:null!=n&&n.pushedAuthorizationRequests?yield ci(t,s):yield vr(t,s),codeVerifier:e}}),Vr.apply(this,arguments)}const xt=new Ii;class Pa{constructor(t){var e=this;let r,o;if(this.userCache=(new io).enclosedCache,this.activeLockKeys=new Set,this.defaultOptions={authorizationParams:{scope:"openid profile email"},useRefreshTokensFallback:!1,useFormData:!0},this._releaseLockOnPageHide=(0,h.A)(function*(){const u=Array.from(e.activeLockKeys);for(const d of u)yield xt.releaseLock(d);e.activeLockKeys.clear(),window.removeEventListener("pagehide",e._releaseLockOnPageHide)}),this.options=Object.assign(Object.assign(Object.assign({},this.defaultOptions),t),{authorizationParams:Object.assign(Object.assign({},this.defaultOptions.authorizationParams),t.authorizationParams)}),typeof window<"u"&&(()=>{if(!Ut())throw new Error("For security reasons, `window.crypto` is required to run `auth0-spa-js`.");if(void 0===Ut().subtle)throw new Error("\n      auth0-spa-js must run on a secure origin. See https://github.com/auth0/auth0-spa-js/blob/main/FAQ.md#why-do-i-get-auth0-spa-js-must-run-on-a-secure-origin for more information.\n    ")})(),t.cache&&t.cacheLocation&&console.warn("Both `cache` and `cacheLocation` options have been specified in the Auth0Client configuration; ignoring `cacheLocation` and using `cache`."),t.cache)o=t.cache;else{if(r=t.cacheLocation||"memory",!mo(r))throw new Error('Invalid cache location "'.concat(r,'"'));o=mo(r)()}this.httpTimeoutMs=t.httpTimeoutInSeconds?1e3*t.httpTimeoutInSeconds:1e4,this.cookieStorage=!1===t.legacySameSiteCookie?qe:rs,this.orgHintCookieName="auth0.".concat(this.options.clientId,".organization_hint"),this.isAuthenticatedCookieName=(()=>"auth0.".concat(this.options.clientId,".is.authenticated"))(),this.sessionCheckExpiryDays=t.sessionCheckExpiryDays||1;const i=t.useCookiesForTransactions?this.cookieStorage:os;var a,u,d;this.scope=function(u,d){for(var m=arguments.length,p=new Array(m>2?m-2:0),y=2;y<m;y++)p[y-2]=arguments[y];if("object"!=typeof u)return{default:jt(d,u,...p)};let g={default:jt(d,...p)};return Object.keys(u).forEach(f=>{g[f]=jt(d,u[f],...p)}),g}(this.options.authorizationParams.scope,"openid",this.options.useRefreshTokens?"offline_access":""),this.transactionManager=new qi(i,this.options.clientId,this.options.cookieDomain),this.nowProvider=this.options.nowProvider||Yr,this.cacheManager=new Yi(o,o.allKeys?void 0:new as(o,this.options.clientId),this.nowProvider),this.dpop=this.options.useDpop?new ls(this.options.clientId):void 0,this.domainUrl=/^https?:\/\//.test(a=this.options.domain)?a:"https://".concat(a),this.tokenIssuer=(d=this.domainUrl,(u=this.options.issuer)?u.startsWith("https://")?u:"https://".concat(u,"/"):"".concat(d,"/"));const c="".concat(this.domainUrl,"/me/"),l=this.createFetcher(Object.assign(Object.assign({},this.options.useDpop&&{dpopNonceId:"__auth0_my_account_api__"}),{getAccessToken:()=>this.getTokenSilently({authorizationParams:{scope:"create:me:connected_accounts",audience:c},detailedResponse:!0})}));this.myAccountApi=new hs(l,c),this.authJsClient=new xa({domain:this.options.domain,clientId:this.options.clientId}),typeof window<"u"&&window.Worker&&this.options.useRefreshTokens&&"memory"===r&&(this.worker=this.options.workerUrl?new Worker(this.options.workerUrl):new ss)}getConfiguration(){return Object.freeze({domain:this.options.domain,clientId:this.options.clientId})}_url(t){const e=encodeURIComponent(btoa(JSON.stringify(this.options.auth0Client||Xr)));return"".concat(this.domainUrl).concat(t,"&auth0Client=").concat(e)}_authorizeUrl(t){return this._url("/authorize?".concat(yn(t)))}_verifyIdToken(t,e,r){var o=this;return(0,h.A)(function*(){const s=yield o.nowProvider();return(n=>{if(!n.id_token)throw new Error("ID token is required but missing");const t=(s=>{const i=s.split("."),[a,c,l]=i;if(3!==i.length||!a||!c||!l)throw new Error("ID token could not be decoded");const u=JSON.parse($r(c)),d={__raw:s},m={};return Object.keys(u).forEach(p=>{d[p]=u[p],$i.includes(p)||(m[p]=u[p])}),{encoded:{header:a,payload:c,signature:l},header:JSON.parse($r(a)),claims:d,user:m}})(n.id_token);if(!t.claims.iss)throw new Error("Issuer (iss) claim must be a string present in the ID token");if(t.claims.iss!==n.iss)throw new Error('Issuer (iss) claim mismatch in the ID token; expected "'.concat(n.iss,'", found "').concat(t.claims.iss,'"'));if(!t.user.sub)throw new Error("Subject (sub) claim must be a string present in the ID token");if("RS256"!==t.header.alg)throw new Error('Signature algorithm of "'.concat(t.header.alg,'" is not supported. Expected the ID token to be signed with "RS256".'));if(!t.claims.aud||"string"!=typeof t.claims.aud&&!Array.isArray(t.claims.aud))throw new Error("Audience (aud) claim must be a string or array of strings present in the ID token");if(Array.isArray(t.claims.aud)){if(!t.claims.aud.includes(n.aud))throw new Error('Audience (aud) claim mismatch in the ID token; expected "'.concat(n.aud,'" but was not one of "').concat(t.claims.aud.join(", "),'"'));if(t.claims.aud.length>1){if(!t.claims.azp)throw new Error("Authorized Party (azp) claim must be a string present in the ID token when Audience (aud) claim has multiple values");if(t.claims.azp!==n.aud)throw new Error('Authorized Party (azp) claim mismatch in the ID token; expected "'.concat(n.aud,'", found "').concat(t.claims.azp,'"'))}}else if(t.claims.aud!==n.aud)throw new Error('Audience (aud) claim mismatch in the ID token; expected "'.concat(n.aud,'" but found "').concat(t.claims.aud,'"'));if(n.nonce){if(!t.claims.nonce)throw new Error("Nonce (nonce) claim must be a string present in the ID token");if(t.claims.nonce!==n.nonce)throw new Error('Nonce (nonce) claim mismatch in the ID token; expected "'.concat(n.nonce,'", found "').concat(t.claims.nonce,'"'))}if(n.max_age&&!ut(t.claims.auth_time))throw new Error("Authentication Time (auth_time) claim must be a number present in the ID token when Max Age (max_age) is specified");if(null==t.claims.exp||!ut(t.claims.exp))throw new Error("Expiration Time (exp) claim must be a number present in the ID token");if(!ut(t.claims.iat))throw new Error("Issued At (iat) claim must be a number present in the ID token");const e=n.leeway||60,r=new Date(n.now||Date.now()),o=new Date(0);if(o.setUTCSeconds(t.claims.exp+e),r>o)throw new Error("Expiration Time (exp) claim error in the ID token; current time (".concat(r,") is after expiration time (").concat(o,")"));if(null!=t.claims.nbf&&ut(t.claims.nbf)){const s=new Date(0);if(s.setUTCSeconds(t.claims.nbf-e),r<s)throw new Error("Not Before time (nbf) claim in the ID token indicates that this token can't be used just yet. Current time (".concat(r,") is before ").concat(s))}if(null!=t.claims.auth_time&&ut(t.claims.auth_time)){const s=new Date(0);if(s.setUTCSeconds(parseInt(t.claims.auth_time)+n.max_age+e),r>s)throw new Error("Authentication Time (auth_time) claim in the ID token indicates that too much time has passed since the last end-user authentication. Current time (".concat(r,") is after last auth at ").concat(s))}if(n.organization){const s=n.organization.trim();if(s.startsWith("org_")){const i=s;if(!t.claims.org_id)throw new Error("Organization ID (org_id) claim must be a string present in the ID token");if(i!==t.claims.org_id)throw new Error('Organization ID (org_id) claim mismatch in the ID token; expected "'.concat(i,'", found "').concat(t.claims.org_id,'"'))}else{const i=s.toLowerCase();if(!t.claims.org_name)throw new Error("Organization Name (org_name) claim must be a string present in the ID token");if(i!==t.claims.org_name)throw new Error('Organization Name (org_name) claim mismatch in the ID token; expected "'.concat(i,'", found "').concat(t.claims.org_name,'"'))}}return t})({iss:o.tokenIssuer,aud:o.options.clientId,id_token:t,nonce:e,organization:r,leeway:o.options.leeway,max_age:(i=o.options.authorizationParams.max_age,"string"!=typeof i?i:parseInt(i,10)||void 0),now:s});var i})()}_processOrgHint(t){t?this.cookieStorage.save(this.orgHintCookieName,t,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}):this.cookieStorage.remove(this.orgHintCookieName,{cookieDomain:this.options.cookieDomain})}_prepareAuthorizeUrl(t,e,r){var o=this;return(0,h.A)(function*(){var s;const i=gn(st()),a=gn(st()),c=st(),l=yield qr(c),u=Qr(l),d=yield null===(s=o.dpop)||void 0===s?void 0:s.calculateThumbprint(),m=(y=o.options,g=o.scope,f=t,v=i,_=a,A=u,E=t.redirect_uri||o.options.authorizationParams.redirect_uri||r,w=e?.response_mode,R=d,Object.assign(Object.assign(Object.assign({client_id:y.clientId},y.authorizationParams),f),{scope:Lt(g,f.scope,f.audience),response_type:"code",response_mode:w||"query",state:v,nonce:_,redirect_uri:E||y.authorizationParams.redirect_uri,code_challenge:A,code_challenge_method:"S256",dpop_jkt:R})),p=o._authorizeUrl(m);var y,g,f,v,_,A,E,w,R;return{nonce:a,code_verifier:c,scope:m.scope,audience:m.audience||"default",redirect_uri:m.redirect_uri,state:i,url:p}})()}loginWithPopup(t,e){var r=this;return(0,h.A)(function*(){var o;if(t=t||{},!(e=e||{}).popup&&(e.popup=(()=>{const l=window.screenX+(window.innerWidth-400)/2,u=window.screenY+(window.innerHeight-600)/2;return window.open("","auth0:authorize:popup","left=".concat(l,",top=").concat(u,",width=").concat(400,",height=").concat(600,",resizable,scrollbars=yes,status=1"))})(),!e.popup))throw new pn;const s=yield r._prepareAuthorizeUrl(t.authorizationParams||{},{response_mode:"web_message"},window.location.origin);e.popup.location.href=s.url;const i=yield(c=Object.assign(Object.assign({},e),{timeoutInSeconds:e.timeoutInSeconds||r.options.authorizeTimeoutInSeconds||60}),new Promise((l,u)=>{let d;const m=setInterval(()=>{c.popup&&c.popup.closed&&(clearInterval(m),clearTimeout(p),window.removeEventListener("message",d,!1),u(new hn(c.popup)))},1e3),p=setTimeout(()=>{clearInterval(m),u(new dn(c.popup)),window.removeEventListener("message",d,!1)},1e3*(c.timeoutInSeconds||60));d=function(y){if(y.data&&"authorization_response"===y.data.type){if(clearTimeout(p),clearInterval(m),window.removeEventListener("message",d,!1),!1!==c.closePopup&&c.popup.close(),y.data.response.error)return u(L.fromPayload(y.data.response));l(y.data.response)}},window.addEventListener("message",d)}));var c;if(s.state!==i.state)throw new L("state_mismatch","Invalid state");const a=(null===(o=t.authorizationParams)||void 0===o?void 0:o.organization)||r.options.authorizationParams.organization;yield r._requestToken({audience:s.audience,scope:s.scope,code_verifier:s.code_verifier,grant_type:"authorization_code",code:i.code,redirect_uri:s.redirect_uri},{nonceIn:s.nonce,organization:a})})()}getUser(){var t=this;return(0,h.A)(function*(){var e;const r=yield t._getIdTokenFromCache();return null===(e=r?.decodedToken)||void 0===e?void 0:e.user})()}getIdTokenClaims(){var t=this;return(0,h.A)(function*(){var e;const r=yield t._getIdTokenFromCache();return null===(e=r?.decodedToken)||void 0===e?void 0:e.claims})()}loginWithRedirect(){var t=arguments,e=this;return(0,h.A)(function*(){var r;const o=fo(t.length>0&&void 0!==t[0]?t[0]:{}),{openUrl:s,fragment:i,appState:a}=o,c=U(o,["openUrl","fragment","appState"]),l=(null===(r=c.authorizationParams)||void 0===r?void 0:r.organization)||e.options.authorizationParams.organization,u=yield e._prepareAuthorizeUrl(c.authorizationParams||{}),{url:d}=u,m=U(u,["url"]);e.transactionManager.create(Object.assign(Object.assign(Object.assign({},m),{appState:a,response_type:Le.Code}),l&&{organization:l}));const p=i?"".concat(d,"#").concat(i):d;s?yield s(p):window.location.assign(p)})()}handleRedirectCallback(){var t=arguments,e=this;return(0,h.A)(function*(){const r=(t.length>0&&void 0!==t[0]?t[0]:window.location.href).split("?").slice(1);if(0===r.length)throw new Error("There are no query params available for parsing.");const o=e.transactionManager.get();if(!o)throw new L("missing_transaction","Invalid state");e.transactionManager.remove();const s=(i=>{i.indexOf("#")>-1&&(i=i.substring(0,i.indexOf("#")));const a=new URLSearchParams(i);return{state:a.get("state"),code:a.get("code")||void 0,connect_code:a.get("connect_code")||void 0,error:a.get("error")||void 0,error_description:a.get("error_description")||void 0}})(r.join(""));return o.response_type===Le.ConnectCode?e._handleConnectAccountRedirectCallback(s,o):e._handleLoginRedirectCallback(s,o)})()}_handleLoginRedirectCallback(t,e){var r=this;return(0,h.A)(function*(){const{code:o,state:s,error:i,error_description:a}=t;if(i)throw new un(i,a||i,s,e.appState);if(!e.code_verifier||e.state&&e.state!==s)throw new L("state_mismatch","Invalid state");const c=e.organization,l=e.nonce,u=e.redirect_uri;return yield r._requestToken(Object.assign({audience:e.audience,scope:e.scope,code_verifier:e.code_verifier,grant_type:"authorization_code",code:o},u?{redirect_uri:u}:{}),{nonceIn:l,organization:c}),{appState:e.appState,response_type:Le.Code}})()}_handleConnectAccountRedirectCallback(t,e){var r=this;return(0,h.A)(function*(){const{connect_code:o,state:s,error:i,error_description:a}=t;if(i)throw new ln(i,a||i,e.connection,s,e.appState);if(!o)throw new L("missing_connect_code","Missing connect code");if(!(e.code_verifier&&e.state&&e.auth_session&&e.redirect_uri&&e.state===s))throw new L("state_mismatch","Invalid state");const c=yield r.myAccountApi.completeAccount({auth_session:e.auth_session,connect_code:o,redirect_uri:e.redirect_uri,code_verifier:e.code_verifier});return Object.assign(Object.assign({},c),{appState:e.appState,response_type:Le.ConnectCode})})()}checkSession(t){var e=this;return(0,h.A)(function*(){if(!e.cookieStorage.get(e.isAuthenticatedCookieName)){if(!e.cookieStorage.get("auth0.is.authenticated"))return;e.cookieStorage.save(e.isAuthenticatedCookieName,!0,{daysUntilExpire:e.sessionCheckExpiryDays,cookieDomain:e.options.cookieDomain}),e.cookieStorage.remove("auth0.is.authenticated")}try{yield e.getTokenSilently(t)}catch{}})()}getTokenSilently(){var t=arguments,e=this;return(0,h.A)(function*(){let r=t.length>0&&void 0!==t[0]?t[0]:{};var o,s;const i=Object.assign(Object.assign({cacheMode:"on"},r),{authorizationParams:Object.assign(Object.assign(Object.assign({},e.options.authorizationParams),r.authorizationParams),{scope:Lt(e.scope,null===(o=r.authorizationParams)||void 0===o?void 0:o.scope,(null===(s=r.authorizationParams)||void 0===s?void 0:s.audience)||e.options.authorizationParams.audience)})}),a=yield((c,l)=>{let u=En[l];return u||(u=e._getTokenSilently(i).finally(()=>{delete En[l],u=null}),En[l]=u),u})(0,"".concat(e.options.clientId,"::").concat(i.authorizationParams.audience,"::").concat(i.authorizationParams.scope));return r.detailedResponse?a:a?.access_token})()}_getTokenSilently(t){var e=this;return(0,h.A)(function*(){const{cacheMode:r}=t,o=U(t,["cacheMode"]);if("off"!==r){const c=yield e._getEntryFromCache({scope:o.authorizationParams.scope,audience:o.authorizationParams.audience||"default",clientId:e.options.clientId,cacheMode:r});if(c)return c}if("cache-only"===r)return;const s=(i=e.options.clientId,a=o.authorizationParams.audience||"default","".concat("auth0.lock.getTokenSilently",".").concat(i,".").concat(a));var i,a;if(!(yield po(()=>xt.acquireLock(s,5e3),10)))throw new Ye;e.activeLockKeys.add(s),1===e.activeLockKeys.size&&window.addEventListener("pagehide",e._releaseLockOnPageHide);try{if("off"!==r){const y=yield e._getEntryFromCache({scope:o.authorizationParams.scope,audience:o.authorizationParams.audience||"default",clientId:e.options.clientId});if(y)return y}const c=e.options.useRefreshTokens?yield e._getTokenUsingRefreshToken(o):yield e._getTokenFromIFrame(o),{id_token:l,token_type:u,access_token:d,oauthTokenScope:m,expires_in:p}=c;return Object.assign(Object.assign({id_token:l,token_type:u,access_token:d},m?{scope:m}:null),{expires_in:p})}finally{yield xt.releaseLock(s),e.activeLockKeys.delete(s),0===e.activeLockKeys.size&&window.removeEventListener("pagehide",e._releaseLockOnPageHide)}})()}getTokenWithPopup(){var t=arguments,e=this;return(0,h.A)(function*(){let r=t.length>0&&void 0!==t[0]?t[0]:{},o=t.length>1&&void 0!==t[1]?t[1]:{};var s,i;const a=Object.assign(Object.assign({},r),{authorizationParams:Object.assign(Object.assign(Object.assign({},e.options.authorizationParams),r.authorizationParams),{scope:Lt(e.scope,null===(s=r.authorizationParams)||void 0===s?void 0:s.scope,(null===(i=r.authorizationParams)||void 0===i?void 0:i.audience)||e.options.authorizationParams.audience)})});return o=Object.assign(Object.assign({},Pi),o),yield e.loginWithPopup(a,o),(yield e.cacheManager.get(new re({scope:a.authorizationParams.scope,audience:a.authorizationParams.audience||"default",clientId:e.options.clientId}),void 0,e.options.useMrrt)).access_token})()}isAuthenticated(){var t=this;return(0,h.A)(function*(){return!!(yield t.getUser())})()}_buildLogoutUrl(t){null!==t.clientId?t.clientId=t.clientId||this.options.clientId:delete t.clientId;const e=t.logoutParams||{},{federated:r}=e,o=U(e,["federated"]),s=r?"&federated":"";return this._url("/v2/logout?".concat(yn(Object.assign({clientId:t.clientId},o))))+s}logout(){var t=arguments,e=this;return(0,h.A)(function*(){let r=t.length>0&&void 0!==t[0]?t[0]:{};var o;const s=fo(r),{openUrl:i}=s,a=U(s,["openUrl"]);null===r.clientId?yield e.cacheManager.clear():yield e.cacheManager.clear(r.clientId||e.options.clientId),e.cookieStorage.remove(e.orgHintCookieName,{cookieDomain:e.options.cookieDomain}),e.cookieStorage.remove(e.isAuthenticatedCookieName,{cookieDomain:e.options.cookieDomain}),e.userCache.remove("@@user@@"),yield null===(o=e.dpop)||void 0===o?void 0:o.clear();const c=e._buildLogoutUrl(a);i?yield i(c):!1!==i&&window.location.assign(c)})()}_getTokenFromIFrame(t){var e=this;return(0,h.A)(function*(){const r=(o=e.options.clientId,"".concat("auth0.lock.getTokenFromIFrame",".").concat(o));var o;if(!(yield po(()=>xt.acquireLock(r,5e3),10)))throw new Ye;try{const s=Object.assign(Object.assign({},t.authorizationParams),{prompt:"none"}),i=e.cookieStorage.get(e.orgHintCookieName);i&&!s.organization&&(s.organization=i);const{url:a,state:c,nonce:l,code_verifier:u,redirect_uri:d,scope:m,audience:p}=yield e._prepareAuthorizeUrl(s,{response_mode:"web_message"},window.location.origin);if(window.crossOriginIsolated)throw new L("login_required","The application is running in a Cross-Origin Isolated context, silently retrieving a token without refresh token is not possible.");const y=t.timeoutInSeconds||e.options.authorizeTimeoutInSeconds;let g;try{g=new URL(e.domainUrl).origin}catch{g=e.domainUrl}const f=yield function(_,A){let E=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;return new Promise((w,R)=>{const P=window.document.createElement("iframe");P.setAttribute("width","0"),P.setAttribute("height","0"),P.style.display="none";const ne=()=>{window.document.body.contains(P)&&(window.document.body.removeChild(P),window.removeEventListener("message",F,!1))};let F;const we=setTimeout(()=>{R(new Ye),ne()},1e3*E);F=function(Q){if(Q.origin!=A||!Q.data||"authorization_response"!==Q.data.type)return;const Be=Q.source;Be&&Be.close(),Q.data.response.error?R(L.fromPayload(Q.data.response)):w(Q.data.response),clearTimeout(we),window.removeEventListener("message",F,!1),setTimeout(ne,2e3)},window.addEventListener("message",F,!1),window.document.body.appendChild(P),P.setAttribute("src",_)})}(a,g,y);if(c!==f.state)throw new L("state_mismatch","Invalid state");const v=yield e._requestToken(Object.assign(Object.assign({},t.authorizationParams),{code_verifier:u,code:f.code,grant_type:"authorization_code",redirect_uri:d,timeout:t.authorizationParams.timeout||e.httpTimeoutMs}),{nonceIn:l,organization:s.organization});return Object.assign(Object.assign({},v),{scope:m,oauthTokenScope:v.scope,audience:p})}catch(s){throw"login_required"===s.error&&e.logout({openUrl:!1}),s}finally{yield xt.releaseLock(r)}})()}_getTokenUsingRefreshToken(t){var e=this;return(0,h.A)(function*(){const r=yield e.cacheManager.get(new re({scope:t.authorizationParams.scope,audience:t.authorizationParams.audience||"default",clientId:e.options.clientId}),void 0,e.options.useMrrt);if(!(r&&r.refresh_token||e.worker)){if(e.options.useRefreshTokensFallback)return yield e._getTokenFromIFrame(t);throw new Ct(t.authorizationParams.audience||"default",t.authorizationParams.scope)}const o=t.authorizationParams.redirect_uri||e.options.authorizationParams.redirect_uri||window.location.origin,s="number"==typeof t.timeoutInSeconds?1e3*t.timeoutInSeconds:null,i=((d,m,p,y)=>{var g;if(d&&p&&y){if(m.audience!==p)return m.scope;const f=y.split(" "),v=(null===(g=m.scope)||void 0===g?void 0:g.split(" "))||[],_=v.every(A=>f.includes(A));return f.length>=v.length&&_?y:m.scope}return m.scope})(e.options.useMrrt,t.authorizationParams,r?.audience,r?.scope);try{const d=yield e._requestToken(Object.assign(Object.assign(Object.assign({},t.authorizationParams),{grant_type:"refresh_token",refresh_token:r&&r.refresh_token,redirect_uri:o}),s&&{timeout:s}),{scopesToRequest:i});if(d.refresh_token&&r?.refresh_token&&(yield e.cacheManager.updateEntry(r.refresh_token,d.refresh_token)),e.options.useMrrt&&(a=r?.audience,c=r?.scope,!(a===t.authorizationParams.audience&&go(t.authorizationParams.scope,c)||go(i,d.scope)))){if(e.options.useRefreshTokensFallback)return yield e._getTokenFromIFrame(t);yield e.cacheManager.remove(e.options.clientId,t.authorizationParams.audience,t.authorizationParams.scope);const m=((p,y)=>{const g=p?.split(" ")||[],f=y?.split(" ")||[];return g.filter(v=>-1==f.indexOf(v)).join(",")})(i,d.scope);throw new fn(t.authorizationParams.audience||"default",m)}return Object.assign(Object.assign({},d),{scope:t.authorizationParams.scope,oauthTokenScope:d.scope,audience:t.authorizationParams.audience||"default"})}catch(d){if((d.message.indexOf("Missing Refresh Token")>-1||d.message&&d.message.indexOf("invalid refresh token")>-1)&&e.options.useRefreshTokensFallback)return yield e._getTokenFromIFrame(t);throw d}var a,c})()}_saveEntryInCache(t){var e=this;return(0,h.A)(function*(){const{id_token:r,decodedToken:o}=t,s=U(t,["id_token","decodedToken"]);e.userCache.set("@@user@@",{id_token:r,decodedToken:o}),yield e.cacheManager.setIdToken(e.options.clientId,t.id_token,t.decodedToken),yield e.cacheManager.set(s)})()}_getIdTokenFromCache(){var t=this;return(0,h.A)(function*(){const e=t.options.authorizationParams.audience||"default",r=t.scope[e],o=yield t.cacheManager.getIdToken(new re({clientId:t.options.clientId,audience:e,scope:r})),s=t.userCache.get("@@user@@");return o&&o.id_token===s?.id_token?s:(t.userCache.set("@@user@@",o),o)})()}_getEntryFromCache(t){var e=this;return(0,h.A)(function*(){let{scope:r,audience:o,clientId:s,cacheMode:i}=t;const a=yield e.cacheManager.get(new re({scope:r,audience:o,clientId:s}),60,e.options.useMrrt,i);if(a&&a.access_token){const{token_type:c,access_token:l,oauthTokenScope:u,expires_in:d}=a,m=yield e._getIdTokenFromCache();return m&&Object.assign(Object.assign({id_token:m.id_token,token_type:c||"Bearer",access_token:l},u?{scope:u}:null),{expires_in:d})}})()}_requestToken(t,e){var r=this;return(0,h.A)(function*(){var o,s;const{nonceIn:i,organization:a,scopesToRequest:c}=e||{},l=yield function Zi(n,t){return An.apply(this,arguments)}(Object.assign(Object.assign({baseUrl:r.domainUrl,client_id:r.options.clientId,auth0Client:r.options.auth0Client,useFormData:r.options.useFormData,timeout:r.httpTimeoutMs,useMrrt:r.options.useMrrt,dpop:r.dpop},t),{scope:c||t.scope}),r.worker),u=yield r._verifyIdToken(l.id_token,i,a);if("authorization_code"===t.grant_type){const d=yield r._getIdTokenFromCache();null!==(s=null===(o=d?.decodedToken)||void 0===o?void 0:o.claims)&&void 0!==s&&s.sub&&d.decodedToken.claims.sub!==u.claims.sub&&(yield r.cacheManager.clear(r.options.clientId),r.userCache.remove("@@user@@"))}return yield r._saveEntryInCache(Object.assign(Object.assign(Object.assign(Object.assign({},l),{decodedToken:u,scope:t.scope,audience:t.audience||"default"}),l.scope?{oauthTokenScope:l.scope}:null),{client_id:r.options.clientId})),r.cookieStorage.save(r.isAuthenticatedCookieName,!0,{daysUntilExpire:r.sessionCheckExpiryDays,cookieDomain:r.options.cookieDomain}),r._processOrgHint(a||u.claims.org_id),Object.assign(Object.assign({},l),{decodedToken:u})})()}exchangeToken(t){var e=this;return(0,h.A)(function*(){return e._requestToken({grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:t.subject_token,subject_token_type:t.subject_token_type,scope:Lt(e.scope,t.scope,t.audience||e.options.authorizationParams.audience),audience:t.audience||e.options.authorizationParams.audience,organization:t.organization||e.options.authorizationParams.organization})})()}_assertDpop(t){if(!t)throw new Error("`useDpop` option must be enabled before using DPoP.")}getDpopNonce(t){return this._assertDpop(this.dpop),this.dpop.getNonce(t)}setDpopNonce(t,e){return this._assertDpop(this.dpop),this.dpop.setNonce(t,e)}generateDpopProof(t){return this._assertDpop(this.dpop),this.dpop.generateProof(t)}createFetcher(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new ds(t,{isDpopEnabled:()=>!!this.options.useDpop,getAccessToken:e=>{var r;return this.getTokenSilently({authorizationParams:{scope:null===(r=e?.scope)||void 0===r?void 0:r.join(" "),audience:e?.audience},detailedResponse:!0})},getDpopNonce:()=>this.getDpopNonce(t.dpopNonceId),setDpopNonce:e=>this.setDpopNonce(e,t.dpopNonceId),generateDpopProof:e=>this.generateDpopProof(e)})}connectAccountWithRedirect(t){var e=this;return(0,h.A)(function*(){const{openUrl:r,appState:o,connection:s,scopes:i,authorization_params:a,redirectUri:c=e.options.authorizationParams.redirect_uri||window.location.origin}=t;if(!s)throw new Error("connection is required");const l=gn(st()),u=st(),d=yield qr(u),m=Qr(d),{connect_uri:p,connect_params:y,auth_session:g}=yield e.myAccountApi.connectAccount({connection:s,scopes:i,redirect_uri:c,state:l,code_challenge:m,code_challenge_method:"S256",authorization_params:a});e.transactionManager.create({state:l,code_verifier:u,auth_session:g,redirect_uri:c,appState:o,connection:s,response_type:Le.ConnectCode});const f=new URL(p);f.searchParams.set("ticket",y.ticket),r?yield r(f.toString()):window.location.assign(f)})()}}function Fr(){return Fr=(0,h.A)(function*(n){const t=new Pa(n);return yield t.checkSession(),t}),Fr.apply(this,arguments)}const V={domain:"dev-26sow24tone5na8a.us.auth0.com",clientId:"EdkPy5co65jESIAT8T9SBy5X4cmeolhl",redirectUri:"https://opensourcekd.github.io/i17e/auth-callback",logoutUri:"https://opensourcekd.github.io/i17e",scope:"openid profile email",audience:"https://something"},ve={TOKEN_STORAGE:"sessionStorage",USER_INFO_STORAGE:"sessionStorage",AUTH_STATE_STORAGE:"sessionStorage",PREFERENCES_STORAGE:"localStorage"},_e={ACCESS_TOKEN:"auth0_access_token",ID_TOKEN:"auth0_id_token",REFRESH_TOKEN:"auth0_refresh_token",USER_INFO:"auth0_user_info",OAUTH_STATE:"oauth_state",CODE_VERIFIER:"code_verifier",CURRENT_USER:"current_user",DEV_MIMIC_USER:"dev_mimic_user"};function rn(n){return"sessionStorage"===n?sessionStorage:localStorage}function Gr(n,t,e="sessionStorage"){rn(e).setItem(n,t)}function it(n,t="sessionStorage"){return rn(t).getItem(n)}function Zr(n,t="sessionStorage"){rn(t).removeItem(n)}var yi=N(1626),Da=N(7175);let vi=(()=>{class n{constructor(){this.emitter=function Oa(n){return{all:n=n||new Map,on:function(t,e){var r=n.get(t);r?r.push(e):n.set(t,[e])},off:function(t,e){var r=n.get(t);r&&(e?r.splice(r.indexOf(e)>>>0,1):n.set(t,[]))},emit:function(t,e){var r=n.get(t);r&&r.slice().map(function(o){o(e)}),(r=n.get("*"))&&r.slice().map(function(o){o(t,e)})}}}(),console.log("[EventBusService] Service initialized");const e=new Event("EventBusServiceCreated");this.onePlusNEvents=new Da.m(100),this.onePlusNEvents.next(e.type),this.emitter.on("*",r=>{console.log("[EventBusService] Event received and forwarded to ReplaySubject:",r),this.onePlusNEvents.next(r)}),console.log("[EventBusService] Event listener registered for all events")}sendEvent(e){console.log("[EventBusService] sendEvent() called with:",e),this.emitter.emit(e),console.log("[EventBusService] Event emitted successfully")}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=D.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),_i=(()=>{class n{constructor(e,r){this.http=e,this.eventBus=r,this.id="auth of pokemon",this.STANDARD_JWT_CLAIMS=["sub","name","email","email_verified","preferred_username","given_name","family_name","nickname","locale","picture","phone","phone_verified","updated_at","iss","aud","exp","iat","auth_time","nonce","acr","amr","azp","at_hash","c_hash"],this.auth0Client=null,this.userSubject=new le.t(this.getUserInfoFromStorage()),this.user$=this.userSubject.asObservable(),console.log("[AuthService] Initializing Auth0 authentication service from the SHELL"),this.initializationPromise=this.initializeAuth0()}initializeAuth0(){var e=this;return(0,h.A)(function*(){try{if(console.log("[AuthService] Starting Auth0 client initialization..."),!V||"object"!=typeof V)throw new Error("[AuthService] AUTH0_CONFIG is not defined or invalid");if(!V.domain||!V.clientId)throw new Error("[AuthService] AUTH0_CONFIG is missing required fields (domain, clientId)");e.auth0Client=yield function Ca(n){return Fr.apply(this,arguments)}({domain:V.domain,clientId:V.clientId,authorizationParams:{redirect_uri:V.redirectUri,scope:V.scope,...V.audience&&{audience:V.audience}},cacheLocation:"memory",useRefreshTokens:!0}),console.log("[AuthService] Auth0 client initialized successfully from SHELL")}catch(r){throw console.error("[AuthService] Failed to initialize Auth0 client:",r),r}})()}ensureInitialized(){var e=this;return(0,h.A)(function*(){if(yield e.initializationPromise,!e.auth0Client)throw new Error("[AuthService] Auth0 client failed to initialize")})()}login(e,r){var o=this;return(0,h.A)(function*(){e&&console.log(`[AuthService] Logging in: ${e}`);try{let a;if(yield o.ensureInitialized(),!window.location.pathname.includes("auth-callback")&&window.location.search){const l=window.location.search;a={returnTo:l},console.log("[AuthService] Preserving URL parameters through auth flow:",l)}const c={redirect_uri:V.redirectUri,scope:V.scope,...V.audience&&{audience:V.audience},...V.connection&&{connection:V.connection}};r?.invitation&&(c.invitation=r.invitation,console.log("[AuthService] Including invitation parameter:",r.invitation)),r?.organization&&(c.organization=r.organization,console.log("[AuthService] Including organization parameter:",r.organization)),console.log("[AuthService] Starting Auth0 login redirect..."),yield o.auth0Client.loginWithRedirect({authorizationParams:c,...a&&{appState:a}})}catch(s){throw console.error("[AuthService] Login failed:",s),s}})()}handleCallback(){var e=this;return(0,h.A)(function*(){try{console.log("[AuthService] Processing Auth0 callback..."),yield e.ensureInitialized();const r=yield e.auth0Client.handleRedirectCallback();console.log("[AuthService] Callback processed successfully"),r.appState?console.log("[AuthService] Restored appState from auth flow:",JSON.stringify(r.appState)):console.log("[AuthService] No appState restored (user may not have started from invitation link)");const o=yield e.auth0Client.getUser();if(!o)return console.warn("[AuthService] No user info returned from Auth0"),{success:!1};e.logUserClaims(o),e.setUserInfo(o);const s=yield e.auth0Client.getTokenSilently();return e.setToken(s),console.log("[AuthService] Authentication successful"),{success:!0,appState:r.appState}}catch(r){return console.error("[AuthService] Error processing callback:",r),console.error("[AuthService] Error details:",JSON.stringify(r,null,2)),{success:!1}}})()}logUserClaims(e){console.log("=".repeat(80)),console.log("[AuthService] \u{1f50d} AUTH0 ID TOKEN - ALL CLAIMS:"),console.log("=".repeat(80)),this.logStandardClaims(e);const r=this.getCustomClaims(e);this.logClaims("\n\u{1f511} Custom Claims (Auth0):",r,e);const o=this.getAdditionalClaims(e);this.logClaims("\n\u{1f527} Additional Claims:",o,e),console.log("\n\u{1f4e6} Complete User Object (JSON):"),console.log(JSON.stringify(e,null,2)),console.log("=".repeat(80))}logStandardClaims(e){console.log("\n\u{1f4cb} Standard OIDC Claims:"),["sub","name","email","email_verified","preferred_username","given_name","family_name","nickname","locale","picture","phone","phone_verified","updated_at"].forEach(o=>{console.log(`  \u2022 ${"sub"===o?`${o} (Subject/User ID)`:o}:`,e[o])})}logClaims(e,r,o){console.log(e),0!==r.length?r.forEach(s=>{const i=o[s],a="object"==typeof i?JSON.stringify(i,null,2):i;console.log(`  \u2022 ${s}:`,a)}):console.log("  No custom claims found")}getCustomClaims(e){return Object.keys(e).filter(r=>!this.STANDARD_JWT_CLAIMS.includes(r)&&this.isNamespacedClaim(r))}getAdditionalClaims(e){return Object.keys(e).filter(r=>!this.STANDARD_JWT_CLAIMS.includes(r)&&!this.isNamespacedClaim(r))}isNamespacedClaim(e){return e.startsWith("http://")||e.startsWith("https://")}logout(){var e=this;return(0,h.A)(function*(){Zr(_e.ACCESS_TOKEN,ve.TOKEN_STORAGE),Zr(_e.USER_INFO,ve.USER_INFO_STORAGE),e.userSubject.next(null),e.emitAuthEvent("logout",null),console.log("[AuthService] User logged out, clearing Auth0 session");try{yield e.ensureInitialized(),yield e.auth0Client.logout({logoutParams:{returnTo:V.logoutUri}})}catch(r){console.error("[AuthService] Error during Auth0 logout:",r)}})()}getToken(){var e=this;return(0,h.A)(function*(){const r=it(_e.ACCESS_TOKEN,ve.TOKEN_STORAGE);if(r)return r;try{yield e.ensureInitialized();const o=yield e.auth0Client.getTokenSilently();return e.setToken(o),o}catch(o){return console.error("[AuthService] Error getting token from Auth0:",o),null}})()}getTokenSync(){return it(_e.ACCESS_TOKEN,ve.TOKEN_STORAGE)}setToken(e){Gr(_e.ACCESS_TOKEN,e,ve.TOKEN_STORAGE),this.emitAuthEvent("token_updated",{token:e})}isAuthenticated(){var e=this;return(0,h.A)(function*(){try{return yield e.ensureInitialized(),yield e.auth0Client.isAuthenticated()}catch(r){return console.error("[AuthService] Error checking authentication status:",r),!!it(_e.ACCESS_TOKEN,ve.TOKEN_STORAGE)}})()}isAuthenticatedSync(){return!!it(_e.ACCESS_TOKEN,ve.TOKEN_STORAGE)}getUser(){return this.userSubject.value}getUserData(){const e=this.getUser();if(!e)return null;const r=this.extractClaimValue(e,"role","user"),o=this.extractClaimValue(e,["org","organization"],"default");return{id:e.sub,name:e.name||e.email||"User",email:e.email||"",role:r,org:o}}extractClaimValue(e,r,o){const s=Array.isArray(r)?r:[r];for(const a of s){const c=e[a];if(c)return c}const i=this.getCustomClaims(e);for(const a of s){const c=i.find(l=>l.toLowerCase().includes(a.toLowerCase()));if(c&&e[c]){const l=e[c];return Array.isArray(l)?l[0]:l}}return o}getUserInfoFromStorage(){const e=it(_e.USER_INFO,ve.USER_INFO_STORAGE);return e?JSON.parse(e):null}setUserInfo(e){Gr(_e.USER_INFO,JSON.stringify(e),ve.USER_INFO_STORAGE),this.userSubject.next(e),console.log("[AuthService] \u{1f4be} User info stored in sessionStorage:"),console.log("  Standard claims:",{sub:e.sub,name:e.name,email:e.email,email_verified:e.email_verified});const r=this.getCustomClaims(e);r.length>0&&(console.log("  Custom claims stored:"),r.forEach(o=>{console.log(`    \u2022 ${o}:`,e[o])})),this.emitAuthEvent("user_info_updated",e)}emitAuthEvent(e,r){const o={type:`auth:${e}`,payload:r,timestamp:(new Date).toISOString()};this.eventBus.sendEvent(JSON.stringify(o)),console.log("[AuthService] Auth event emitted:",o.type)}static{this.\u0275fac=function(r){return new(r||n)(D.KVO(yi.Qq),D.KVO(vi))}}static{this.\u0275prov=D.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Ua=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=D.VBU({type:n,selectors:[["org-core-services"]],standalone:!0,features:[D.aNF],decls:2,vars:0,template:function(r,o){1&r&&(D.j41(0,"p"),D.EFF(1," core-services works! "),D.k0s())}})}}return n})();var T=function(n){return n.SUPER_ADMIN="super-admin",n.ORG_ADMIN="org-admin",n.TEAM_LEAD="team-lead",n.SALES_EXECUTIVE="sales-executive",n}(T||{});function wi(n,t){const e={[T.SUPER_ADMIN]:4,[T.ORG_ADMIN]:3,[T.TEAM_LEAD]:2,[T.SALES_EXECUTIVE]:1};return e[n]>=e[t]}let ja=(()=>{class n{constructor(){this.currentUserSubject=new le.t(null),this.currentUser$=this.currentUserSubject.asObservable(),console.log("[RoleService] Service initialized"),this.loadInitialUser()}setUserFromProfile(e){console.log("[RoleService] Setting user from API profile:",e);const r=this.mapApiRoleToUserRole(e.roles),o={id:e.userId,name:e.name||e.email||"User",email:e.email||"",role:r};console.log("[RoleService] Mapped user with role from API:",o),this.setCurrentUser(o)}mapApiRoleToUserRole(e){return e&&0!==e.length?this.mapStringToUserRole(e[0].name):(console.warn("[RoleService] No roles found in API response, defaulting to SALES_EXECUTIVE"),T.SALES_EXECUTIVE)}setUserFromAuth(e){console.log("[RoleService] Setting user from Auth0 auth:",e);const r=this.mapUserInfoToUser(e);console.log("[RoleService] Mapped user with role:",r),this.setCurrentUser(r)}mapUserInfoToUser(e){const r=this.extractRoleFromToken(e);return{id:e.sub,name:e.name||e.email||"User",email:e.email||"",role:r}}extractRoleFromToken(e){if(e.role)return this.mapStringToUserRole(e.role);if(e.org_and_roles){const s=this.extractRoleFromOrgAndRoles(e.org_and_roles);if(s)return console.log("[RoleService] Extracted role from org_and_roles:",s),s}const o=Object.keys(e).filter(s=>s.startsWith("http://")||s.startsWith("https://")).find(s=>s.toLowerCase().includes("role"));if(o&&e[o]){const s=e[o],i=Array.isArray(s)?s[0]:s;return this.mapStringToUserRole(i)}return console.warn("[RoleService] No role found in token, falling back to email pattern"),this.determineRoleFromEmail(e.email||"")}extractRoleFromOrgAndRoles(e){if(!e||"object"!=typeof e)return null;const r=[];for(const s in e){const i=e[s];Array.isArray(i)&&i.forEach(a=>{const c=this.mapStringToUserRole(a);r.push(c)})}if(0===r.length)return null;const o=[T.SUPER_ADMIN,T.ORG_ADMIN,T.TEAM_LEAD,T.SALES_EXECUTIVE];for(const s of o)if(r.includes(s))return console.log("[RoleService] Selected highest privilege role:",s),s;return r[0]}mapStringToUserRole(e){const r=e.toLowerCase().replace(/[-_\s]/g,"");return{superadmin:T.SUPER_ADMIN,super:T.SUPER_ADMIN,admin:T.SUPER_ADMIN,orgadmin:T.ORG_ADMIN,organizationadmin:T.ORG_ADMIN,manager:T.ORG_ADMIN,teamlead:T.TEAM_LEAD,lead:T.TEAM_LEAD,salesexecutive:T.SALES_EXECUTIVE,sales:T.SALES_EXECUTIVE,executive:T.SALES_EXECUTIVE}[r]||T.SALES_EXECUTIVE}determineRoleFromEmail(e){const r=e.toLowerCase();return[{patterns:["admin","super"],role:T.SUPER_ADMIN},{patterns:["manager","org"],role:T.ORG_ADMIN},{patterns:["lead","team"],role:T.TEAM_LEAD}].find(({patterns:i})=>i.some(a=>r.includes(a)))?.role??T.SALES_EXECUTIVE}loadInitialUser(){const e=this.getDevMimicUser();if(e)return console.log("[RoleService] Using dev mimic user:",e),void this.currentUserSubject.next(e)}getDevMimicUser(){try{const e=localStorage.getItem("dev_mimic_user");if(e){const r=JSON.parse(e);if(r.id&&r.name&&r.role)return r}}catch(e){console.error("[RoleService] Error parsing dev mimic user:",e)}return null}setDevMimicUser(e){e?(localStorage.setItem("dev_mimic_user",JSON.stringify(e)),this.currentUserSubject.next(e),console.log("[RoleService] Dev mimic user set:",e)):(localStorage.removeItem("dev_mimic_user"),this.loadDummyUser(),console.log("[RoleService] Dev mimic user cleared"))}loadDummyUser(){console.log("[RoleService] Loading user from session storage");const e=sessionStorage.getItem("current_user");if(e){const r=JSON.parse(e);console.log("[RoleService] User loaded from session:",r),this.currentUserSubject.next(r)}else{const r={id:"user-1",name:"John Admin",email:"john.admin@company.com",role:T.ORG_ADMIN};console.log("[RoleService] No saved user found, using default:",r),this.setCurrentUser(r)}}setCurrentUser(e){console.log("[RoleService] Setting current user:",e),this.currentUserSubject.next(e),e?(sessionStorage.setItem("current_user",JSON.stringify(e)),console.log("[RoleService] User saved to session storage")):(sessionStorage.removeItem("current_user"),console.log("[RoleService] User removed from session storage"))}getCurrentUser(){const e=this.currentUserSubject.value;return console.log("[RoleService] getCurrentUser() called, returning:",e),e}getCurrentUserRole(){const e=this.currentUserSubject.value?.role||null;return console.log("[RoleService] getCurrentUserRole() called, returning:",e),e}hasRole(e){const r=this.getCurrentUserRole();if(!r)return console.log("[RoleService] hasRole() - No current role, access denied"),!1;const o=wi(r,e);return console.log(`[RoleService] hasRole() - Checking if ${r} has ${e}:`,o),o}canViewOthersData(){const e=this.getCurrentUserRole(),r=e===T.SUPER_ADMIN||e===T.ORG_ADMIN||e===T.TEAM_LEAD;return console.log(`[RoleService] canViewOthersData() - Role: ${e}, Can view:`,r),r}getViewableUsers(){const e=this.getCurrentUser();if(!e)return[];const r=this.getAllUsers();return this.isTeamLeadOrHigher()?r.filter(o=>o.role===T.SALES_EXECUTIVE||o.id===e.id):r.filter(o=>o.id===e.id)}hasAnyRole(e){const r=this.getCurrentUser();return!!r&&e.includes(r.role)}isAdmin(){return this.hasAnyRole([T.SUPER_ADMIN,T.ORG_ADMIN])}isTeamLeadOrHigher(){return this.hasAnyRole([T.SUPER_ADMIN,T.ORG_ADMIN,T.TEAM_LEAD])}getAllUsers(){return[{id:"user-1",name:"John Admin",email:"john.admin@company.com",role:T.SUPER_ADMIN},{id:"user-2",name:"Sarah Manager",email:"sarah.manager@company.com",role:T.ORG_ADMIN},{id:"user-3",name:"Mike Lead",email:"mike.lead@company.com",role:T.TEAM_LEAD,teamId:"team-1"},{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",role:T.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-5",name:"Bob Sales",email:"bob.sales@company.com",role:T.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-6",name:"Carol Sales",email:"carol.sales@company.com",role:T.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"}]}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=D.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Tt=function(n){return n.COMPLETED="completed",n.PENDING="pending",n.CANCELLED="cancelled",n}(Tt||{}),Br=function(n){return n.ELECTRONICS="Electronics",n.SOFTWARE="Software",n.SERVICES="Services",n.HARDWARE="Hardware",n}(Br||{});let La=(()=>{class n{constructor(){this.salesExecutivesSubject=new le.t(this.generateSalesExecutives()),this.salesExecutives$=this.salesExecutivesSubject.asObservable(),this.salesRecordsSubject=new le.t(this.generateSalesRecords()),this.salesRecords$=this.salesRecordsSubject.asObservable(),this.incentiveRulesSubject=new le.t(this.generateIncentiveRules()),this.incentiveRules$=this.incentiveRulesSubject.asObservable(),this.incentivesEarnedSubject=new le.t(this.generateIncentivesEarned()),this.incentivesEarned$=this.incentivesEarnedSubject.asObservable(),console.log("[DummyDataService] Service initialized"),console.log("[DummyDataService] Generated data:",{salesExecutives:this.salesExecutivesSubject.value.length,salesRecords:this.salesRecordsSubject.value.length,incentiveRules:this.incentiveRulesSubject.value.length,incentivesEarned:this.incentivesEarnedSubject.value.length})}generateSalesExecutives(){return console.log("[DummyDataService] Generating sales executives"),[{id:"user-1",name:"John Admin",email:"john.admin@company.com",teamId:"team-1"},{id:"user-2",name:"Sarah Manager",email:"sarah.manager@company.com",teamId:"team-1"},{id:"user-3",name:"Mike Lead",email:"mike.lead@company.com",teamId:"team-1"},{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",teamId:"team-1"},{id:"user-5",name:"Bob Sales",email:"bob.sales@company.com",teamId:"team-1"},{id:"user-6",name:"Carol Sales",email:"carol.sales@company.com",teamId:"team-1"}]}generateSalesRecords(){console.log("[DummyDataService] Generating sales records");const e=[],r=this.generateSalesExecutives(),o=["Product A","Product B","Product C","Product D"],s=[Tt.COMPLETED,Tt.PENDING,Tt.CANCELLED];for(let i=0;i<50;i++){const a=r[i%r.length],c=Math.floor(i/10),l=new Date;l.setMonth(l.getMonth()-c),e.push({id:`sale-${i+1}`,salesExecutiveId:a.id,salesExecutiveName:a.name,date:l,productName:o[i%o.length],productCategory:Br.SOFTWARE,amount:Math.floor(5e4*Math.random())+1e4,commission:Math.floor(5e3*Math.random()),quantity:Math.floor(10*Math.random())+1,status:s[i%s.length],clientName:`Client ${i+1}`,region:["North","South","East","West"][i%4]})}return e}generateIncentiveRules(){return console.log("[DummyDataService] Generating incentive rules"),[{id:"rule-1",name:"Basic Sales Incentive",description:"5% incentive on all sales",type:"percentage",value:5,isActive:!0,createdBy:"admin",createdAt:new Date("2024-01-01")},{id:"rule-2",name:"High Value Sales Bonus",description:"10% incentive on sales above $50,000",type:"percentage",value:10,minSalesAmount:5e4,isActive:!0,createdBy:"admin",createdAt:new Date("2024-02-01")},{id:"rule-3",name:"Product A Special",description:"Fixed $500 bonus for Product A sales",type:"fixed",value:500,productCategory:"Product A",isActive:!0,createdBy:"team-lead-1",createdAt:new Date("2024-03-01")},{id:"rule-4",name:"Tiered Volume Incentive",description:"15% incentive on sales above $100,000",type:"tiered",value:15,minSalesAmount:1e5,isActive:!1,createdBy:"admin",createdAt:new Date("2024-04-01")}]}generateIncentivesEarned(){console.log("[DummyDataService] Generating incentives earned");const e=[],r=this.generateSalesExecutives(),o=this.generateIncentiveRules(),s=["pending","approved","paid"];for(let i=0;i<30;i++){const a=r[i%r.length],c=o[i%o.length],l=Math.floor(i/10),u=new Date;u.setMonth(u.getMonth()-l),e.push({id:`incentive-${i+1}`,salesExecutiveId:a.id,salesExecutiveName:a.name,ruleId:c.id,ruleName:c.name,salesRecordId:`sale-${i+1}`,amount:Math.floor(5e3*Math.random())+500,earnedDate:u,status:s[i%3]})}return e}getSalesRecordsForExecutive(e){console.log("[DummyDataService] getSalesRecordsForExecutive() called for:",e);const r=this.salesRecordsSubject.value.filter(o=>o.salesExecutiveId===e);return console.log("[DummyDataService] Found",r.length,"sales records for executive:",e),r}getIncentivesForExecutive(e){console.log("[DummyDataService] getIncentivesForExecutive() called for:",e);const r=this.incentivesEarnedSubject.value.filter(o=>o.salesExecutiveId===e);return console.log("[DummyDataService] Found",r.length,"incentives for executive:",e),r}getReportDataForExecutive(e){console.log("[DummyDataService] getReportDataForExecutive() called for:",e);const r=this.salesExecutivesSubject.value.find(u=>u.id===e),o=this.getSalesRecordsForExecutive(e),s=this.getIncentivesForExecutive(e),i=o.filter(u=>"completed"===u.status).reduce((u,d)=>u+d.amount,0),a=s.filter(u=>"pending"!==u.status).reduce((u,d)=>u+d.amount,0),c=[];for(let u=5;u>=0;u--){const d=new Date;d.setMonth(d.getMonth()-u);const m=d.toISOString().substring(0,7),p=o.filter(g=>g.date.toISOString().substring(0,7)===m&&"completed"===g.status).reduce((g,f)=>g+f.amount,0),y=s.filter(g=>g.earnedDate.toISOString().substring(0,7)===m&&"pending"!==g.status).reduce((g,f)=>g+f.amount,0);c.push({month:m,sales:p,incentives:y})}const l={salesExecutiveId:e,salesExecutiveName:r?.name||"Unknown",totalSales:i,totalIncentives:a,period:"Last 6 months",breakdown:c};return console.log("[DummyDataService] Report data generated:",l),l}getSalesExecutives(){const e=this.salesExecutivesSubject.value;return console.log("[DummyDataService] getSalesExecutives() called, returning",e.length,"executives"),e}getIncentiveRules(){const e=this.incentiveRulesSubject.value;return console.log("[DummyDataService] getIncentiveRules() called, returning",e.length,"rules"),e}addIncentiveRule(e){console.log("[DummyDataService] addIncentiveRule() called with:",e),this.incentiveRulesSubject.next([...this.incentiveRulesSubject.value,e]),console.log("[DummyDataService] Rule added successfully, total rules:",this.incentiveRulesSubject.value.length)}updateIncentiveRule(e,r){console.log("[DummyDataService] updateIncentiveRule() called for rule:",e,"with updates:",r);const s=this.incentiveRulesSubject.value.map(i=>i.id===e?{...i,...r}:i);this.incentiveRulesSubject.next(s),console.log("[DummyDataService] Rule updated successfully")}deleteIncentiveRule(e){console.log("[DummyDataService] deleteIncentiveRule() called for rule:",e);const o=this.incentiveRulesSubject.value.filter(s=>s.id!==e);this.incentiveRulesSubject.next(o),console.log("[DummyDataService] Rule deleted successfully, remaining rules:",this.incentiveRulesSubject.value.length)}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=D.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Na=N(1913);let Ka=(()=>{class n{constructor(){this.mfeConfigs=[],this.loadedMfesSubject=new le.t(new Set),this.loadedMfes$=this.loadedMfesSubject.asObservable(),this.loadingMfesSubject=new le.t(new Set),this.loadingMfes$=this.loadingMfesSubject.asObservable(),console.log("[MfeLoaderService] Service initialized")}setConfigs(e){console.log("[MfeLoaderService] setConfigs() called with",e.length,"configurations"),this.mfeConfigs=e.sort((r,o)=>o.priority-r.priority),console.log("[MfeLoaderService] Configurations sorted by priority:",this.mfeConfigs.map(r=>({name:r.name,priority:r.priority})))}getConfigs(){return console.log("[MfeLoaderService] getConfigs() called, returning",this.mfeConfigs.length,"configurations"),this.mfeConfigs}getConfigsForRole(e){console.log("[MfeLoaderService] getConfigsForRole() called for role:",e);const r=this.mfeConfigs.filter(o=>o.allowedRoles.includes(e));return console.log("[MfeLoaderService] Found",r.length,"configurations for role:",e,r.map(o=>o.name)),r}getConfigByName(e){console.log("[MfeLoaderService] getConfigByName() called for:",e);const r=this.mfeConfigs.find(o=>o.name===e);return r?console.log("[MfeLoaderService] Found configuration for:",e):console.warn("[MfeLoaderService] Configuration not found for:",e),r}preloadPriorityMfes(e){var r=this;return(0,h.A)(function*(){console.log("[MfeLoaderService] preloadPriorityMfes() called for role:",e);const s=r.getConfigsForRole(e).filter(a=>a.priority>=5);console.log("[MfeLoaderService] Preloading",s.length,"priority MFEs:",s.map(a=>({name:a.name,priority:a.priority})));const i=s.map(a=>r.loadMfe(a));yield Promise.all(i),console.log("[MfeLoaderService] Preloading complete")})()}loadMfe(e){var r=this;return(0,h.A)(function*(){const o=r.loadingMfesSubject.value,s=r.loadedMfesSubject.value;if(s.has(e.name))console.log(`[MfeLoaderService] MFE ${e.name} already loaded`);else if(o.has(e.name))console.log(`[MfeLoaderService] MFE ${e.name} is already loading`);else try{const i=new Set(o);i.add(e.name),r.loadingMfesSubject.next(i),console.log(`[MfeLoaderService] Loading MFE ${e.name} (priority: ${e.priority})`),console.log("[MfeLoaderService] MFE config:",{name:e.name,url:e.url,exposedModule:e.exposedModule,remoteName:e.remoteName});const a=yield(0,Na.loadRemoteModule)({type:"module",remoteEntry:e.url,exposedModule:e.exposedModule}),c=new Set(s);c.add(e.name),r.loadedMfesSubject.next(c);const l=new Set(r.loadingMfesSubject.value);return l.delete(e.name),r.loadingMfesSubject.next(l),console.log(`[MfeLoaderService] Successfully loaded MFE ${e.name}`),console.log("[MfeLoaderService] Currently loaded MFEs:",Array.from(r.loadedMfesSubject.value)),a}catch(i){console.error(`[MfeLoaderService] Error loading MFE ${e.name}:`,i),console.error("[MfeLoaderService] Failed config:",{name:e.name,url:e.url,exposedModule:e.exposedModule});const a=new Set(r.loadingMfesSubject.value);throw a.delete(e.name),r.loadingMfesSubject.next(a),i}})()}isMfeLoaded(e){const r=this.loadedMfesSubject.value.has(e);return console.log(`[MfeLoaderService] isMfeLoaded(${e}):`,r),r}isMfeLoading(e){const r=this.loadingMfesSubject.value.has(e);return console.log(`[MfeLoaderService] isMfeLoading(${e}):`,r),r}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=D.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Ma=N(8750),bi=N(1985),za=N(1397),Wa=N(7441),Ze=N(8071),Ha=N(6450);const Ja=["addListener","removeListener"],Va=["addEventListener","removeEventListener"],Fa=["on","off"];function on(n,t,e,r){if((0,Ze.T)(e)&&(r=e,e=void 0),r)return on(n,t,e).pipe((0,Ha.I)(r));const[o,s]=function Ba(n){return(0,Ze.T)(n.addEventListener)&&(0,Ze.T)(n.removeEventListener)}(n)?Va.map(i=>a=>n[i](t,a,e)):function Ga(n){return(0,Ze.T)(n.addListener)&&(0,Ze.T)(n.removeListener)}(n)?Ja.map(Si(n,t)):function Za(n){return(0,Ze.T)(n.on)&&(0,Ze.T)(n.off)}(n)?Fa.map(Si(n,t)):[];if(!o&&(0,Wa.X)(n))return(0,za.Z)(i=>on(i,t,e))((0,Ma.Tg)(n));if(!o)throw new TypeError("Invalid event target");return new bi.c(i=>{const a=(...c)=>i.next(1<c.length?c:c[0]);return o(a),()=>s(a)})}function Si(n,t){return e=>r=>n[e](t,r)}var Ai=N(6354);let Xa=(()=>{class n{constructor(e){this.zone=e}listen(){return on(new EventSource("https://stream.wikimedia.org/v2/stream/recentchange"),"message").pipe((0,Ai.T)(r=>{let o;return this.zone.run(()=>o=r.data),o}))}static{this.\u0275fac=function(r){return new(r||n)(D.KVO(D.SKi))}}static{this.\u0275prov=D.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Ya=(()=>{class n{constructor(e){this.zone=e}start(e){this.eventSource=new EventSource(e);const r=this.eventSource;return new bi.c(o=>{const s=on(r,"message").subscribe(i=>{this.zone.run(()=>o.next(i.data))});return r.onerror=i=>{this.zone.run(()=>o.error(i))},()=>{s.unsubscribe(),r.close()}})}stop(){this.eventSource&&(this.eventSource.close(),this.eventSource=void 0)}static{this.\u0275fac=function(r){return new(r||n)(D.KVO(D.SKi))}}static{this.\u0275prov=D.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var ki=N(7673),qa=N(9437);const Ue={baseUrl:"https://tmzuktmjy7.execute-api.us-east-1.amazonaws.com"};let $a=(()=>{class n{constructor(e){this.http=e,this.profileSubject=new le.t(null),this.profile$=this.profileSubject.asObservable(),console.log("[UserProfileService] Service initialized")}fetchUserProfile(){return console.log("[UserProfileService] Fetching user profile from API"),Ue&&Ue.baseUrl?this.http.get(`${Ue.baseUrl}/auth/me`).pipe((0,Ai.T)(e=>e.success&&e.data?(console.log("[UserProfileService] Profile loaded successfully"),this.profileSubject.next(e.data),e.data):null),(0,qa.W)(e=>(console.error("[UserProfileService] Error fetching profile:",e),this.profileSubject.next(null),(0,ki.of)(null)))):(console.error("[UserProfileService] API_CONFIG or baseUrl is not defined"),(0,ki.of)(null))}getCurrentProfile(){return this.profileSubject.value}getPrimaryOrganization(){return this.profileSubject.value?.organizations?.[0]||null}getPrimaryRole(){return this.profileSubject.value?.roles?.[0]||null}getRoleName(){return this.getPrimaryRole()?.name||null}getOrganizationDisplayName(){return this.getPrimaryOrganization()?.displayName||null}clearProfile(){this.profileSubject.next(null)}static{this.\u0275fac=function(r){return new(r||n)(D.KVO(yi.Qq))}}static{this.\u0275prov=D.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();const Qa=(n,t)=>{const r=(0,D.WQX)(_i).getTokenSync();return!r||ec(n.url)?t(n):t(n.clone({setHeaders:{Authorization:`Bearer ${r}`}}))},ec=n=>{try{if(Ue&&"object"==typeof Ue&&Ue.baseUrl&&n.startsWith(Ue.baseUrl))return!1}catch(e){console.warn("[authInterceptor] API_CONFIG not available, using pattern-based auth endpoint detection",e)}return["/oauth","auth0.com","/authorize","/token"].some(e=>n.includes(e))}},7175:(Ti,Rt,N)=>{N.d(Rt,{m:()=>h});var D=N(1413);const It={now:()=>(It.delegate||Date).now(),delegate:void 0};class h extends D.B{constructor(U=1/0,G=1/0,X=It){super(),this._bufferSize=U,this._windowTime=G,this._timestampProvider=X,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=G===1/0,this._bufferSize=Math.max(1,U),this._windowTime=Math.max(1,G)}next(U){const{isStopped:G,_buffer:X,_infiniteTimeWindow:de,_timestampProvider:be,_windowTime:W}=this;G||(X.push(U),!de&&X.push(be.now()+W)),this._trimBuffer(),super.next(U)}_subscribe(U){this._throwIfClosed(),this._trimBuffer();const G=this._innerSubscribe(U),{_infiniteTimeWindow:X,_buffer:de}=this,be=de.slice();for(let W=0;W<be.length&&!U.closed;W+=X?1:2)U.next(be[W]);return this._checkFinalizedStatuses(U),G}_trimBuffer(){const{_bufferSize:U,_timestampProvider:G,_buffer:X,_infiniteTimeWindow:de}=this,be=(de?1:2)*U;if(U<1/0&&be<X.length&&X.splice(0,X.length-be),!de){const W=G.now();let Y=0;for(let he=1;he<X.length&&X[he]<=W;he+=2)Y=he;Y&&X.splice(0,Y+1)}}}}}]);