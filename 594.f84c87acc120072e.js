(self.webpackChunkshell=self.webpackChunkshell||[]).push([[594,213],{1213:(p,S,s)=>{s.r(S),s.d(S,{AuthService:()=>c,CoreServicesComponent:()=>u,CoreServicesService:()=>m});var n=s(5565);let m=(()=>{class r{constructor(){}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var i=s(467),h=s(4866),l=s(1663);let c=(()=>{class r{constructor(e){this.http=e,this.id="auth of pokemon",this.ISSUER_BASE_URL="https://topfix-wrczmn.us1.zitadel.cloud",this.CLIENT_ID="336777344075263315",this.REDIRECT_URI="https://opensourcekd.github.io/i17e/auth-callback",this.SCOPE="openid profile email",this.TOKEN_KEY="zitadel_token",this.USER_INFO_KEY="zitadel_user_info",this.userSubject=new h.BehaviorSubject(this.getUserInfoFromStorage()),this.user$=this.userSubject.asObservable(),console.log("In constructor of auth service in i17e")}login(e){e&&console.log(`[AuthService] Logged in: ${e}`),this.redirectToZitadelLogin()}redirectToZitadelLogin(){const e=new URL(`${this.ISSUER_BASE_URL}/oauth/v2/authorize`),t=this.generateRandomState(),o=this.generateCodeVerifier();sessionStorage.setItem("oauth_state",t),sessionStorage.setItem("code_verifier",o),e.searchParams.append("client_id",this.CLIENT_ID),e.searchParams.append("redirect_uri",this.REDIRECT_URI),e.searchParams.append("response_type","code"),e.searchParams.append("scope",this.SCOPE),e.searchParams.append("state",t),window.location.href=e.toString()}handleCallback(e,t){var o=this;return(0,i.A)(function*(){const f=sessionStorage.getItem("oauth_state");if(t!==f)return console.error("State mismatch - possible CSRF attack"),!1;try{const a=yield o.exchangeCodeForToken(e);o.setToken(a.access_token);const g=o.decodeIdToken(a.id_token);return o.setUserInfo(g),sessionStorage.removeItem("oauth_state"),sessionStorage.removeItem("code_verifier"),!0}catch(a){return console.error("Error exchanging code for token:",a),!1}})()}exchangeCodeForToken(e){var t=this;return(0,i.A)(function*(){const o=`${t.ISSUER_BASE_URL}/oauth/v2/token`,f=new URLSearchParams({grant_type:"authorization_code",code:e,redirect_uri:t.REDIRECT_URI,client_id:t.CLIENT_ID}),a=yield fetch(o,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:f.toString()});if(!a.ok)throw new Error(`Token exchange failed: ${a.statusText}`);return a.json()})()}decodeIdToken(e){try{const t=e.split(".")[1],o=JSON.parse(atob(t));return{sub:o.sub,name:o.name,email:o.email}}catch(t){return console.error("Error decoding ID token:",t),{sub:""}}}logout(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.USER_INFO_KEY),this.userSubject.next(null)}getToken(){return localStorage.getItem(this.TOKEN_KEY)}setToken(e){localStorage.setItem(this.TOKEN_KEY,e)}isAuthenticated(){return!!this.getToken()}getUser(){return this.userSubject.value}getUserInfoFromStorage(){const e=localStorage.getItem(this.USER_INFO_KEY);return e?JSON.parse(e):null}setUserInfo(e){localStorage.setItem(this.USER_INFO_KEY,JSON.stringify(e)),this.userSubject.next(e)}generateRandomState(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,t=>t.toString(16).padStart(2,"0")).join("")}generateCodeVerifier(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,t=>t.toString(16).padStart(2,"0")).join("")}static{this.\u0275fac=function(t){return new(t||r)(n.\u0275\u0275inject(l.HttpClient))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),u=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275cmp=n.\u0275\u0275defineComponent({type:r,selectors:[["org-core-services"]],standalone:!0,features:[n.\u0275\u0275StandaloneFeature],decls:2,vars:0,template:function(t,o){1&t&&(n.\u0275\u0275elementStart(0,"p"),n.\u0275\u0275text(1," core-services works! "),n.\u0275\u0275elementEnd())}})}}return r})()},467:(p,S,s)=>{function n(i,h,l,c,u,r,d){try{var e=i[r](d),t=e.value}catch(o){return void l(o)}e.done?h(t):Promise.resolve(t).then(c,u)}function m(i){return function(){var h=this,l=arguments;return new Promise(function(c,u){var r=i.apply(h,l);function d(t){n(r,c,u,d,e,"next",t)}function e(t){n(r,c,u,d,e,"throw",t)}d(void 0)})}}s.d(S,{A:()=>m})}}]);