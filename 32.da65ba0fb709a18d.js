(self.webpackChunkshell=self.webpackChunkshell||[]).push([[32],{2032:(lc,Zr,Z)=>{Z.r(Zr),Z.d(Zr,{bootstrap:()=>uc});var Pi=Z(4077),h=Z(467),he=Z(2130),_e=Z(5070),Ce=Z(2176),et=Z(5883),d=Z(4304);function Ii(n,e){if(1&n&&(d.\u0275\u0275elementStart(0,"span",10),d.\u0275\u0275text(1),d.\u0275\u0275elementEnd()),2&n){const t=d.\u0275\u0275nextContext();d.\u0275\u0275advance(),d.\u0275\u0275textInterpolate1(" ",t.getOrganizationName()," ")}}function Ri(n,e){if(1&n&&(d.\u0275\u0275elementStart(0,"option",16),d.\u0275\u0275text(1),d.\u0275\u0275elementEnd()),2&n){const t=e.$implicit;d.\u0275\u0275property("value",t.id),d.\u0275\u0275advance(),d.\u0275\u0275textInterpolate(t.name)}}function Oi(n,e){if(1&n){const t=d.\u0275\u0275getCurrentView();d.\u0275\u0275elementStart(0,"div",11)(1,"div",12)(2,"label",13),d.\u0275\u0275text(3,"View data for:"),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementStart(4,"span",14),d.\u0275\u0275text(5," Selecting a user will display their incentive data. "),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementStart(6,"select",15),d.\u0275\u0275twoWayListener("ngModelChange",function(o){d.\u0275\u0275restoreView(t);const i=d.\u0275\u0275nextContext();return d.\u0275\u0275twoWayBindingSet(i.selectedSalesExecutiveId,o)||(i.selectedSalesExecutiveId=o),d.\u0275\u0275resetView(o)}),d.\u0275\u0275listener("change",function(){d.\u0275\u0275restoreView(t);const o=d.\u0275\u0275nextContext();return d.\u0275\u0275resetView(o.onSalesExecutiveChange())}),d.\u0275\u0275elementStart(7,"option",16),d.\u0275\u0275text(8,"My Data"),d.\u0275\u0275elementEnd(),d.\u0275\u0275template(9,Ri,2,2,"option",17),d.\u0275\u0275elementEnd()()()}if(2&n){const t=d.\u0275\u0275nextContext();d.\u0275\u0275advance(6),d.\u0275\u0275twoWayProperty("ngModel",t.selectedSalesExecutiveId),d.\u0275\u0275advance(),d.\u0275\u0275property("value",t.currentUser.id),d.\u0275\u0275advance(2),d.\u0275\u0275property("ngForOf",t.salesExecutives)}}function ji(n,e){if(1&n&&(d.\u0275\u0275elementStart(0,"span",18),d.\u0275\u0275text(1),d.\u0275\u0275elementEnd()),2&n){const t=d.\u0275\u0275nextContext();d.\u0275\u0275advance(),d.\u0275\u0275textInterpolate2(" ",t.currentUser.name," (",t.currentUser.role,") ")}}function Di(n,e){if(1&n){const t=d.\u0275\u0275getCurrentView();d.\u0275\u0275elementStart(0,"button",19),d.\u0275\u0275listener("click",function(){d.\u0275\u0275restoreView(t);const o=d.\u0275\u0275nextContext();return d.\u0275\u0275resetView(o.logout())}),d.\u0275\u0275text(1,"Logout"),d.\u0275\u0275elementEnd()}}function Ui(n,e){if(1&n){const t=d.\u0275\u0275getCurrentView();d.\u0275\u0275elementStart(0,"button",20),d.\u0275\u0275listener("click",function(){d.\u0275\u0275restoreView(t);const o=d.\u0275\u0275nextContext();return d.\u0275\u0275resetView(o.login())}),d.\u0275\u0275text(1,"Login"),d.\u0275\u0275elementEnd()}}function Ni(n,e){if(1&n&&(d.\u0275\u0275elementStart(0,"a",23),d.\u0275\u0275text(1),d.\u0275\u0275elementEnd()),2&n){const t=e.$implicit;d.\u0275\u0275property("routerLink","/"+t.route),d.\u0275\u0275advance(),d.\u0275\u0275textInterpolate1(" ",t.displayName," ")}}function Ki(n,e){if(1&n&&(d.\u0275\u0275elementStart(0,"nav",21),d.\u0275\u0275template(1,Ni,2,2,"a",22),d.\u0275\u0275elementEnd()),2&n){const t=d.\u0275\u0275nextContext();d.\u0275\u0275advance(),d.\u0275\u0275property("ngForOf",t.availableMfes)}}let Li=(()=>{class n{constructor(t){this.router=t,this.currentUser=null,this.userProfile=null,this.availableMfes=[],this.salesExecutives=[],this.selectedSalesExecutiveId="",this.canViewOthers=!1,this.subscriptions=new et.Subscription,console.warn("[HeaderComponent] Services disabled - migrate to @opensourcekd/ng-common-libs")}ngOnInit(){}ngOnDestroy(){this.subscriptions.unsubscribe()}login(){console.warn("[HeaderComponent] Login disabled")}logout(){console.warn("[HeaderComponent] Logout disabled")}onSalesExecutiveChange(){console.warn("[HeaderComponent] User selection disabled")}getOrganizationName(){return""}static{this.\u0275fac=function(r){return new(r||n)(d.\u0275\u0275directiveInject(he.Router))}}static{this.\u0275cmp=d.\u0275\u0275defineComponent({type:n,selectors:[["app-header"]],standalone:!0,features:[d.\u0275\u0275StandaloneFeature],decls:11,vars:6,consts:[[1,"app-header"],[1,"header-left"],[1,"app-title"],["class","org-display",4,"ngIf"],["class","header-center",4,"ngIf"],[1,"header-right"],["class","user-info",4,"ngIf"],["class","btn-logout",3,"click",4,"ngIf"],["class","btn-login",3,"click",4,"ngIf"],["class","app-nav",4,"ngIf"],[1,"org-display"],[1,"header-center"],[1,"user-selector"],["for","salesExecSelect"],["id","salesExecSelectDesc",1,"visually-hidden"],["id","salesExecSelect","aria-describedby","salesExecSelectDesc",3,"ngModelChange","change","ngModel"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"user-info"],[1,"btn-logout",3,"click"],[1,"btn-login",3,"click"],[1,"app-nav"],["routerLinkActive","active","class","nav-link",3,"routerLink",4,"ngFor","ngForOf"],["routerLinkActive","active",1,"nav-link",3,"routerLink"]],template:function(r,o){1&r&&(d.\u0275\u0275elementStart(0,"header",0)(1,"div",1)(2,"h1",2),d.\u0275\u0275text(3,"Incentive Management System"),d.\u0275\u0275elementEnd(),d.\u0275\u0275template(4,Ii,2,1,"span",3),d.\u0275\u0275elementEnd(),d.\u0275\u0275template(5,Oi,10,3,"div",4),d.\u0275\u0275elementStart(6,"div",5),d.\u0275\u0275template(7,ji,2,2,"span",6)(8,Di,2,0,"button",7)(9,Ui,2,0,"button",8),d.\u0275\u0275elementEnd()(),d.\u0275\u0275template(10,Ki,2,1,"nav",9)),2&r&&(d.\u0275\u0275advance(4),d.\u0275\u0275property("ngIf",o.currentUser&&o.getOrganizationName()),d.\u0275\u0275advance(),d.\u0275\u0275property("ngIf",o.currentUser&&o.canViewOthers),d.\u0275\u0275advance(2),d.\u0275\u0275property("ngIf",o.currentUser),d.\u0275\u0275advance(),d.\u0275\u0275property("ngIf",o.currentUser),d.\u0275\u0275advance(),d.\u0275\u0275property("ngIf",!o.currentUser),d.\u0275\u0275advance(),d.\u0275\u0275property("ngIf",o.currentUser))},dependencies:[_e.CommonModule,_e.NgForOf,_e.NgIf,Ce.FormsModule,Ce.NgSelectOption,Ce.\u0275NgSelectMultipleOption,Ce.SelectControlValueAccessor,Ce.NgControlStatus,Ce.NgModel,he.RouterLink,he.RouterLinkActive],styles:[".app-header[_ngcontent-%COMP%]{background:#fff;padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 8px #0000001a}.header-left[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:.25rem}.app-title[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;color:var(--gray-900);font-weight:600}.org-display[_ngcontent-%COMP%]{font-size:.875rem;color:var(--bright-blue);font-weight:600;text-transform:uppercase}.header-center[_ngcontent-%COMP%]{flex:2;display:flex;justify-content:center}.user-selector[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.user-selector[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;color:var(--gray-700);font-weight:500}.user-selector[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:.5rem 1rem;border:1px solid var(--gray-400);border-radius:.375rem;font-size:.875rem;background:#fff;cursor:pointer;min-width:200px}.visually-hidden[_ngcontent-%COMP%]{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.header-right[_ngcontent-%COMP%]{flex:1;display:flex;justify-content:flex-end;align-items:center;gap:1rem}.user-info[_ngcontent-%COMP%]{color:var(--gray-700);font-size:.875rem;font-weight:500}.btn-logout[_ngcontent-%COMP%], .btn-login[_ngcontent-%COMP%]{background:var(--hot-red);color:#fff;border:none;padding:.5rem 1.5rem;border-radius:.375rem;font-size:.875rem;font-weight:500;cursor:pointer;transition:background .2s ease}.btn-logout[_ngcontent-%COMP%]:hover, .btn-login[_ngcontent-%COMP%]:hover{background:var(--orange-red)}.btn-login[_ngcontent-%COMP%]{background:var(--bright-blue)}.btn-login[_ngcontent-%COMP%]:hover{background:var(--electric-violet)}.app-nav[_ngcontent-%COMP%]{background:var(--gray-900);padding:0;display:flex;gap:0}.nav-link[_ngcontent-%COMP%]{color:#fff;text-decoration:none;padding:1rem 1.5rem;font-size:.875rem;font-weight:500;transition:background .2s ease;border-bottom:3px solid transparent}.nav-link[_ngcontent-%COMP%]:hover{background:var(--gray-700)}.nav-link.active[_ngcontent-%COMP%]{background:var(--bright-blue);border-bottom-color:var(--electric-violet)}"]})}}return n})(),Mi=(()=>{class n{constructor(){this.currentYear=(new Date).getFullYear()}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=d.\u0275\u0275defineComponent({type:n,selectors:[["app-footer"]],standalone:!0,features:[d.\u0275\u0275StandaloneFeature],decls:3,vars:1,consts:[[1,"app-footer"],[1,"copyright"]],template:function(r,o){1&r&&(d.\u0275\u0275elementStart(0,"footer",0)(1,"p",1),d.\u0275\u0275text(2),d.\u0275\u0275elementEnd()()),2&r&&(d.\u0275\u0275advance(2),d.\u0275\u0275textInterpolate1("\xa9 ",o.currentYear," Incentive Management System. All rights reserved."))},styles:[".app-footer[_ngcontent-%COMP%]{background:var(--gray-900);color:#fff;padding:1rem 2rem;margin-top:auto;text-align:center}.app-footer[_ngcontent-%COMP%]   .copyright[_ngcontent-%COMP%]{margin:0;font-size:.875rem}"]})}}return n})(),Wi=(()=>{class n{constructor(t,r){this.router=t,this.route=r,this.title="Incentive Management System",this.subscriptions=new et.Subscription,console.log("[AppComponent] Initialized (auth/role/mfe services disabled)")}ngOnInit(){return(0,h.A)(function*(){console.log("[AppComponent] ngOnInit (minimal functionality)")})()}ngOnDestroy(){this.subscriptions.unsubscribe()}static{this.\u0275fac=function(r){return new(r||n)(d.\u0275\u0275directiveInject(he.Router),d.\u0275\u0275directiveInject(he.ActivatedRoute))}}static{this.\u0275cmp=d.\u0275\u0275defineComponent({type:n,selectors:[["app-root"]],standalone:!0,features:[d.\u0275\u0275StandaloneFeature],decls:5,vars:0,consts:[[1,"app-container"],[1,"app-content"]],template:function(r,o){1&r&&(d.\u0275\u0275elementStart(0,"div",0),d.\u0275\u0275element(1,"app-header"),d.\u0275\u0275elementStart(2,"main",1),d.\u0275\u0275element(3,"router-outlet"),d.\u0275\u0275elementEnd(),d.\u0275\u0275element(4,"app-footer"),d.\u0275\u0275elementEnd())},dependencies:[he.RouterOutlet,_e.CommonModule,Ce.FormsModule,Li,Mi],styles:['[_nghost-%COMP%]{--bright-blue: oklch(51.01% .274 263.83);--electric-violet: oklch(53.18% .28 296.97);--french-violet: oklch(47.66% .246 305.88);--vivid-pink: oklch(69.02% .277 332.77);--hot-red: oklch(61.42% .238 15.34);--orange-red: oklch(63.32% .24 31.68);--gray-900: oklch(19.37% .006 300.98);--gray-700: oklch(36.98% .014 302.71);--gray-400: oklch(70.9% .015 304.04);--red-to-pink-to-purple-vertical-gradient: linear-gradient( 180deg, var(--orange-red) 0%, var(--vivid-pink) 50%, var(--electric-violet) 100% );--red-to-pink-to-purple-horizontal-gradient: linear-gradient( 90deg, var(--orange-red) 0%, var(--vivid-pink) 50%, var(--electric-violet) 100% );--pill-accent: var(--bright-blue);font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol;box-sizing:border-box;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.app-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100vh}.app-content[_ngcontent-%COMP%]{flex:1;padding:2rem;background:#f5f5f5}']})}}return n})();var qr=Z(8072);const Br=()=>(console.warn("[adminGuard] DEPRECATED: Allowing all access"),!0),Yr=()=>(console.warn("[allRolesGuard] DEPRECATED: Allowing all access"),!0);var zi=Z(7412),Hi=Z(1913);const Ji=["container"];let tt=(()=>{class n{constructor(){this.name=""}ngAfterViewInit(){var t=this;return(0,h.A)(function*(){const r=zi.Ay.find(({remoteName:o})=>o===t.name);if(r)try{console.log(`[MfeWrapperComponent] Loading MFE: ${t.name}`,r);const o=yield(0,Hi.loadRemoteModule)(r);if(!o||!o.AppComponent)return void console.error(`[MfeWrapperComponent] MFE module or AppComponent not found for: ${t.name}`);console.log(`[MfeWrapperComponent] Creating component for MFE: ${t.name}`),t.remoteContainer.createComponent(o.AppComponent),console.log(`[MfeWrapperComponent] MFE loaded successfully: ${t.name}`)}catch(o){console.error(`[MfeWrapperComponent] Error loading MFE ${t.name}:`,o)}else console.error(`[MfeWrapperComponent] MFE configuration not found for: ${t.name}`)})()}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=d.\u0275\u0275defineComponent({type:n,selectors:[["app-mfe-wrapper"]],viewQuery:function(r,o){if(1&r&&d.\u0275\u0275viewQuery(Ji,7,d.ViewContainerRef),2&r){let i;d.\u0275\u0275queryRefresh(i=d.\u0275\u0275loadQuery())&&(o.remoteContainer=i.first)}},inputs:{name:"name"},standalone:!0,features:[d.\u0275\u0275StandaloneFeature],decls:4,vars:0,consts:[["container",""]],template:function(r,o){1&r&&(d.\u0275\u0275elementStart(0,"p"),d.\u0275\u0275text(1,"mfe-wrapper works!"),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementContainer(2,null,0))},dependencies:[_e.CommonModule],changeDetection:0})}}return n})(),Fi=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=d.\u0275\u0275defineComponent({type:n,selectors:[["app-home-page"]],standalone:!0,features:[d.\u0275\u0275StandaloneFeature],decls:6,vars:1,consts:[[1,"home-container"],[1,"welcome-text"],[3,"name"]],template:function(r,o){1&r&&(d.\u0275\u0275elementStart(0,"div",0)(1,"h1"),d.\u0275\u0275text(2,"Incentive Management System"),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementStart(3,"p",1),d.\u0275\u0275text(4,"Welcome to the Incentive Management System. Use the navigation menu to access the available modules based on your role."),d.\u0275\u0275elementEnd(),d.\u0275\u0275element(5,"app-mfe-wrapper",2),d.\u0275\u0275elementEnd()),2&r&&(d.\u0275\u0275advance(5),d.\u0275\u0275property("name","usersCrud"))},dependencies:[_e.CommonModule,tt],styles:[".home-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:2rem}.home-container[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#333;margin-bottom:.5rem;font-size:2rem}.home-container[_ngcontent-%COMP%]   .welcome-text[_ngcontent-%COMP%]{color:#666;font-size:1.1rem;margin-bottom:2rem}"]})}}return n})(),Vi=(()=>{class n{constructor(){this.mfeName="crudRules"}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=d.\u0275\u0275defineComponent({type:n,selectors:[["app-rules-page"]],standalone:!0,features:[d.\u0275\u0275StandaloneFeature],decls:2,vars:1,consts:[[1,"page-container"],[3,"name"]],template:function(r,o){1&r&&(d.\u0275\u0275elementStart(0,"div",0),d.\u0275\u0275element(1,"app-mfe-wrapper",1),d.\u0275\u0275elementEnd()),2&r&&(d.\u0275\u0275advance(),d.\u0275\u0275property("name",o.mfeName))},dependencies:[tt],styles:[".page-container[_ngcontent-%COMP%]{padding:2rem}"]})}}return n})(),Gi=(()=>{class n{constructor(){this.mfeName="mySales"}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=d.\u0275\u0275defineComponent({type:n,selectors:[["app-sales-page"]],standalone:!0,features:[d.\u0275\u0275StandaloneFeature],decls:2,vars:1,consts:[[1,"page-container"],[3,"name"]],template:function(r,o){1&r&&(d.\u0275\u0275elementStart(0,"div",0),d.\u0275\u0275element(1,"app-mfe-wrapper",1),d.\u0275\u0275elementEnd()),2&r&&(d.\u0275\u0275advance(),d.\u0275\u0275property("name",o.mfeName))},dependencies:[tt],styles:[".page-container[_ngcontent-%COMP%]{padding:2rem}"]})}}return n})(),Zi=(()=>{class n{constructor(){this.mfeName="myReport"}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=d.\u0275\u0275defineComponent({type:n,selectors:[["app-reports-page"]],standalone:!0,features:[d.\u0275\u0275StandaloneFeature],decls:2,vars:1,consts:[[1,"page-container"],[3,"name"]],template:function(r,o){1&r&&(d.\u0275\u0275elementStart(0,"div",0),d.\u0275\u0275element(1,"app-mfe-wrapper",1),d.\u0275\u0275elementEnd()),2&r&&(d.\u0275\u0275advance(),d.\u0275\u0275property("name",o.mfeName))},dependencies:[tt],styles:[".page-container[_ngcontent-%COMP%]{padding:2rem}"]})}}return n})(),qi=(()=>{class n{constructor(){this.mfeName="usersCrud"}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=d.\u0275\u0275defineComponent({type:n,selectors:[["app-users-page"]],standalone:!0,features:[d.\u0275\u0275StandaloneFeature],decls:2,vars:1,consts:[[1,"page-container"],[3,"name"]],template:function(r,o){1&r&&(d.\u0275\u0275elementStart(0,"div",0),d.\u0275\u0275element(1,"app-mfe-wrapper",1),d.\u0275\u0275elementEnd()),2&r&&(d.\u0275\u0275advance(),d.\u0275\u0275property("name",o.mfeName))},dependencies:[tt],styles:[".page-container[_ngcontent-%COMP%]{padding:2rem}"]})}}return n})();function Bi(n,e){1&n&&(d.\u0275\u0275elementStart(0,"p"),d.\u0275\u0275text(1,"Processing authentication..."),d.\u0275\u0275elementEnd())}const Yi=[{path:"",component:Fi},{path:"auth-callback",component:(()=>{class n{constructor(t,r){this.route=t,this.router=r,this.message="Authentication disabled - redirecting...",this.isProcessing=!1,this.destroy$=new et.Subject,console.warn("[AuthCallbackComponent] Auth services disabled")}ngOnInit(){var t=this;return(0,h.A)(function*(){setTimeout(()=>{t.router.navigate(["/"])},1500)})()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(r){return new(r||n)(d.\u0275\u0275directiveInject(he.ActivatedRoute),d.\u0275\u0275directiveInject(he.Router))}}static{this.\u0275cmp=d.\u0275\u0275defineComponent({type:n,selectors:[["app-auth-callback"]],standalone:!0,features:[d.\u0275\u0275StandaloneFeature],decls:5,vars:2,consts:[[2,"display","flex","justify-content","center","align-items","center","height","100vh"],[2,"text-align","center"],[4,"ngIf"]],template:function(r,o){1&r&&(d.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"h2"),d.\u0275\u0275text(3),d.\u0275\u0275elementEnd(),d.\u0275\u0275template(4,Bi,2,0,"p",2),d.\u0275\u0275elementEnd()()),2&r&&(d.\u0275\u0275advance(3),d.\u0275\u0275textInterpolate(o.message),d.\u0275\u0275advance(),d.\u0275\u0275property("ngIf",o.isProcessing))},dependencies:[_e.CommonModule,_e.NgIf],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100vh}"]})}}return n})()},{path:"rules",component:Vi,canActivate:[Br]},{path:"sales",component:Gi,canActivate:[Yr]},{path:"reports",component:Zi,canActivate:[Yr]},{path:"users",component:qi,canActivate:[Br]},{path:"**",redirectTo:""}];var en=Z(6883);class Xr{eventSubject=new et.Subject;emit(e,t){this.eventSubject.next({type:e,data:t,timestamp:Date.now()})}on(e){return this.eventSubject.asObservable().pipe((0,en.filter)(t=>t.type===e),(0,en.map)(t=>t.data))}onMultiple(e){return this.eventSubject.asObservable().pipe((0,en.filter)(t=>e.includes(t.type)))}onAll(){return this.eventSubject.asObservable()}}const tn={auth0Domain:"dev-26sow24tone5na8a.us.auth0.com",auth0ClientId:"EdkPy5co65jESIAT8T9SBy5X4cmeolhl",apiUrl:"https://noq8dav0ac.execute-api.us-east-1.amazonaws.com"};function ee(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(n);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(t[r[o]]=n[r[o]])}return t}typeof window<"u"&&window,typeof window<"u"&&window,"function"==typeof SuppressedError&&SuppressedError;const $i={timeoutInSeconds:60},Qr={name:"auth0-spa-js",version:"2.15.0"},$r=()=>Date.now();class j extends Error{constructor(e,t){super(t),this.error=e,this.error_description=t,Object.setPrototypeOf(this,j.prototype)}static fromPayload(e){let{error:t,error_description:r}=e;return new j(t,r)}}class nn extends j{constructor(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(e,t),this.state=r,this.appState=o,Object.setPrototypeOf(this,nn.prototype)}}class rn extends j{constructor(e,t,r,o){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;super(e,t),this.connection=r,this.state=o,this.appState=i,Object.setPrototypeOf(this,rn.prototype)}}class Je extends j{constructor(){super("timeout","Timeout"),Object.setPrototypeOf(this,Je.prototype)}}class on extends Je{constructor(e){super(),this.popup=e,Object.setPrototypeOf(this,on.prototype)}}class an extends j{constructor(e){super("cancelled","Popup closed"),this.popup=e,Object.setPrototypeOf(this,an.prototype)}}class sn extends j{constructor(){super("popup_open","Unable to open a popup for loginWithPopup - window.open returned `null`"),Object.setPrototypeOf(this,sn.prototype)}}class nt extends j{constructor(e,t,r,o){super(e,t),this.mfa_token=r,this.mfa_requirements=o,Object.setPrototypeOf(this,nt.prototype)}}class xt extends j{constructor(e,t){super("missing_refresh_token","Missing Refresh Token (audience: '".concat(Tt(e,["default"]),"', scope: '").concat(Tt(t),"')")),this.audience=e,this.scope=t,Object.setPrototypeOf(this,xt.prototype)}}class cn extends j{constructor(e,t){super("missing_scopes","Missing requested scopes after refresh (audience: '".concat(Tt(e,["default"]),"', missing scope: '").concat(Tt(t),"')")),this.audience=e,this.scope=t,Object.setPrototypeOf(this,cn.prototype)}}class Et extends j{constructor(e){super("use_dpop_nonce","Server rejected DPoP proof: wrong nonce"),this.newDpopNonce=e,Object.setPrototypeOf(this,Et.prototype)}}function Tt(n){return n&&!(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).includes(n)?n:""}const Ct=()=>window.crypto,rt=()=>{let e="";return Array.from(Ct().getRandomValues(new Uint8Array(43))).forEach(t=>e+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_~."[t%66]),e},un=n=>btoa(n),ea=[{key:"name",type:["string"]},{key:"version",type:["string","number"]},{key:"env",type:["object"]}],eo=function(n){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object.keys(n).reduce((t,r)=>{if(e&&"env"===r)return t;const o=ea.find(i=>i.key===r);return o&&o.type.includes(typeof n[r])&&(t[r]=n[r]),t},{})},ln=n=>{var r,{clientId:e}=n,t=ee(n,["clientId"]);return new URLSearchParams((r=Object.assign({client_id:e},t),Object.keys(r).filter(o=>void 0!==r[o]).reduce((o,i)=>Object.assign(Object.assign({},o),{[i]:r[i]}),{}))).toString()},to=function(){var n=(0,h.A)(function*(e){return yield Ct().subtle.digest({name:"SHA-256"},(new TextEncoder).encode(e))});return function(t){return n.apply(this,arguments)}}(),no=n=>{return e=n.replace(/_/g,"/").replace(/-/g,"+"),decodeURIComponent(atob(e).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""));var e},ro=n=>{const e=new Uint8Array(n);return(t=>{const r={"+":"-","/":"_","=":""};return t.replace(/[+/=]/g,o=>r[o])})(window.btoa(String.fromCharCode(...Array.from(e))))};var Pe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},oo={},dn={};Object.defineProperty(dn,"__esModule",{value:!0});var ta=function(){function n(){var e=this;this.locked=new Map,this.addToLocked=function(t,r){var o=e.locked.get(t);void 0===o?e.locked.set(t,void 0===r?[]:[r]):void 0!==r&&(o.unshift(r),e.locked.set(t,o))},this.isLocked=function(t){return e.locked.has(t)},this.lock=function(t){return new Promise(function(r,o){e.isLocked(t)?e.addToLocked(t,r):(e.addToLocked(t),r())})},this.unlock=function(t){var r=e.locked.get(t);if(void 0!==r&&0!==r.length){var o=r.pop();e.locked.set(t,r),void 0!==o&&setTimeout(o,0)}else e.locked.delete(t)}}return n.getInstance=function(){return void 0===n.instance&&(n.instance=new n),n.instance},n}();dn.default=function(){return ta.getInstance()};var te=Pe&&Pe.__awaiter||function(n,e,t,r){return new(t||(t=Promise))(function(o,i){function a(l){try{c(r.next(l))}catch(u){i(u)}}function s(l){try{c(r.throw(l))}catch(u){i(u)}}function c(l){l.done?o(l.value):new t(function(u){u(l.value)}).then(a,s)}c((r=r.apply(n,e||[])).next())})},ne=Pe&&Pe.__generator||function(n,e){var t,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(c){return function(l){return function(u){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(n,a)}catch(f){u=[6,f],r=0}finally{t=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([c,l])}}},ot=Pe;Object.defineProperty(oo,"__esModule",{value:!0});var Fe=dn,Pt={key:function(n){return te(ot,void 0,void 0,function(){return ne(this,function(e){throw new Error("Unsupported")})})},getItem:function(n){return te(ot,void 0,void 0,function(){return ne(this,function(e){throw new Error("Unsupported")})})},clear:function(){return te(ot,void 0,void 0,function(){return ne(this,function(n){return[2,window.localStorage.clear()]})})},removeItem:function(n){return te(ot,void 0,void 0,function(){return ne(this,function(e){throw new Error("Unsupported")})})},setItem:function(n,e){return te(ot,void 0,void 0,function(){return ne(this,function(t){throw new Error("Unsupported")})})},keySync:function(n){return window.localStorage.key(n)},getItemSync:function(n){return window.localStorage.getItem(n)},clearSync:function(){return window.localStorage.clear()},removeItemSync:function(n){return window.localStorage.removeItem(n)},setItemSync:function(n,e){return window.localStorage.setItem(n,e)}};function hn(n){return new Promise(function(e){return setTimeout(e,n)})}function pn(n){for(var t="",r=0;r<n;r++)t+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz"[Math.floor(61*Math.random())];return t}var na=function(){function n(e){this.acquiredIatSet=new Set,this.storageHandler=void 0,this.id=Date.now().toString()+pn(15),this.acquireLock=this.acquireLock.bind(this),this.releaseLock=this.releaseLock.bind(this),this.releaseLock__private__=this.releaseLock__private__.bind(this),this.waitForSomethingToChange=this.waitForSomethingToChange.bind(this),this.refreshLockWhileAcquired=this.refreshLockWhileAcquired.bind(this),this.storageHandler=e,void 0===n.waiters&&(n.waiters=[])}return n.prototype.acquireLock=function(e,t){return void 0===t&&(t=5e3),te(this,void 0,void 0,function(){var r,o,i,a,s,c,l;return ne(this,function(u){switch(u.label){case 0:r=Date.now()+pn(4),o=Date.now()+t,i="browser-tabs-lock-key-"+e,a=void 0===this.storageHandler?Pt:this.storageHandler,u.label=1;case 1:return Date.now()<o?[4,hn(30)]:[3,8];case 2:return u.sent(),null!==a.getItemSync(i)?[3,5]:(s=this.id+"-"+e+"-"+r,[4,hn(Math.floor(25*Math.random()))]);case 3:return u.sent(),a.setItemSync(i,JSON.stringify({id:this.id,iat:r,timeoutKey:s,timeAcquired:Date.now(),timeRefreshed:Date.now()})),[4,hn(30)];case 4:return u.sent(),null!==(c=a.getItemSync(i))&&(l=JSON.parse(c)).id===this.id&&l.iat===r?(this.acquiredIatSet.add(r),this.refreshLockWhileAcquired(i,r),[2,!0]):[3,7];case 5:return n.lockCorrector(void 0===this.storageHandler?Pt:this.storageHandler),[4,this.waitForSomethingToChange(o)];case 6:u.sent(),u.label=7;case 7:return r=Date.now()+pn(4),[3,1];case 8:return[2,!1]}})})},n.prototype.refreshLockWhileAcquired=function(e,t){return te(this,void 0,void 0,function(){var r=this;return ne(this,function(o){return setTimeout(function(){return te(r,void 0,void 0,function(){var i,a,s;return ne(this,function(c){switch(c.label){case 0:return[4,Fe.default().lock(t)];case 1:return c.sent(),this.acquiredIatSet.has(t)?null===(a=(i=void 0===this.storageHandler?Pt:this.storageHandler).getItemSync(e))?(Fe.default().unlock(t),[2]):((s=JSON.parse(a)).timeRefreshed=Date.now(),i.setItemSync(e,JSON.stringify(s)),Fe.default().unlock(t),this.refreshLockWhileAcquired(e,t),[2]):(Fe.default().unlock(t),[2])}})})},1e3),[2]})})},n.prototype.waitForSomethingToChange=function(e){return te(this,void 0,void 0,function(){return ne(this,function(t){switch(t.label){case 0:return[4,new Promise(function(r){var o=!1,i=Date.now(),a=!1;function s(){if(a||(window.removeEventListener("storage",s),n.removeFromWaiting(s),clearTimeout(c),a=!0),!o){o=!0;var l=50-(Date.now()-i);l>0?setTimeout(r,l):r(null)}}window.addEventListener("storage",s),n.addToWaiting(s);var c=setTimeout(s,Math.max(0,e-Date.now()))})];case 1:return t.sent(),[2]}})})},n.addToWaiting=function(e){this.removeFromWaiting(e),void 0!==n.waiters&&n.waiters.push(e)},n.removeFromWaiting=function(e){void 0!==n.waiters&&(n.waiters=n.waiters.filter(function(t){return t!==e}))},n.notifyWaiters=function(){void 0!==n.waiters&&n.waiters.slice().forEach(function(e){return e()})},n.prototype.releaseLock=function(e){return te(this,void 0,void 0,function(){return ne(this,function(t){switch(t.label){case 0:return[4,this.releaseLock__private__(e)];case 1:return[2,t.sent()]}})})},n.prototype.releaseLock__private__=function(e){return te(this,void 0,void 0,function(){var t,r,o,i;return ne(this,function(a){switch(a.label){case 0:return null===(o=(t=void 0===this.storageHandler?Pt:this.storageHandler).getItemSync(r="browser-tabs-lock-key-"+e))?[2]:(i=JSON.parse(o)).id!==this.id?[3,2]:[4,Fe.default().lock(i.iat)];case 1:a.sent(),this.acquiredIatSet.delete(i.iat),t.removeItemSync(r),Fe.default().unlock(i.iat),n.notifyWaiters(),a.label=2;case 2:return[2]}})})},n.lockCorrector=function(e){for(var t=Date.now()-5e3,r=e,o=[],i=0;;){var a=r.keySync(i);if(null===a)break;o.push(a),i++}for(var s=!1,c=0;c<o.length;c++){var l=o[c];if(l.includes("browser-tabs-lock-key")){var u=r.getItemSync(l);if(null!==u){var f=JSON.parse(u);(void 0===f.timeRefreshed&&f.timeAcquired<t||void 0!==f.timeRefreshed&&f.timeRefreshed<t)&&(r.removeItemSync(l),s=!0)}}}s&&n.notifyWaiters()},n.waiters=void 0,n}(),ra=oo.default=na;class oa{runWithLock(e,t,r){return(0,h.A)(function*(){const o=new AbortController,i=setTimeout(()=>o.abort(),t);try{return yield navigator.locks.request(e,{mode:"exclusive",signal:o.signal},function(){var a=(0,h.A)(function*(s){if(clearTimeout(i),!s)throw new Error("Lock not available");return yield r()});return function(s){return a.apply(this,arguments)}}())}catch(a){throw clearTimeout(i),"AbortError"===a?.name?new Je:a}})()}}class ia{constructor(){this.activeLocks=new Set,this.lock=new ra,this.pagehideHandler=()=>{this.activeLocks.forEach(e=>this.lock.releaseLock(e)),this.activeLocks.clear()}}runWithLock(e,t,r){var o=this;return(0,h.A)(function*(){let i=!1;for(let a=0;a<10&&!i;a++)i=yield o.lock.acquireLock(e,t);if(!i)throw new Je;o.activeLocks.add(e),1===o.activeLocks.size&&typeof window<"u"&&window.addEventListener("pagehide",o.pagehideHandler);try{return yield r()}finally{o.activeLocks.delete(e),yield o.lock.releaseLock(e),0===o.activeLocks.size&&typeof window<"u"&&window.removeEventListener("pagehide",o.pagehideHandler)}})()}}let fn=null;const sa=new TextEncoder,ca=new TextDecoder;function it(n){return"string"==typeof n?sa.encode(n):ca.decode(n)}function io(n){if("number"!=typeof n.modulusLength||n.modulusLength<2048)throw new la(`${n.name} modulusLength must be at least 2048 bits`)}function mn(){return(mn=(0,h.A)(function*(n,e,t){if(!1===t.usages.includes("sign"))throw new TypeError('private CryptoKey instances used for signing assertions must include "sign" in their "usages"');const r=`${at(it(JSON.stringify(n)))}.${at(it(JSON.stringify(e)))}`;return`${r}.${at(yield crypto.subtle.sign(function(o){switch(o.algorithm.name){case"ECDSA":return{name:o.algorithm.name,hash:"SHA-256"};case"RSA-PSS":return io(o.algorithm),{name:o.algorithm.name,saltLength:32};case"RSASSA-PKCS1-v1_5":return io(o.algorithm),{name:o.algorithm.name};case"Ed25519":return{name:o.algorithm.name}}throw new Ie}(t),t,it(r)))}`})).apply(this,arguments)}let gn;function at(n){return gn(n)}gn=Uint8Array.prototype.toBase64?n=>(n instanceof ArrayBuffer&&(n=new Uint8Array(n)),n.toBase64({alphabet:"base64url",omitPadding:!0})):e=>{e instanceof ArrayBuffer&&(e=new Uint8Array(e));const t=[];for(let r=0;r<e.byteLength;r+=32768)t.push(String.fromCharCode.apply(null,e.subarray(r,r+32768)));return btoa(t.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")};class Ie extends Error{constructor(e){var t;super(e??"operation not supported"),this.name=this.constructor.name,null===(t=Error.captureStackTrace)||void 0===t||t.call(Error,this,this.constructor)}}class la extends Error{constructor(e){var t;super(e),this.name=this.constructor.name,null===(t=Error.captureStackTrace)||void 0===t||t.call(Error,this,this.constructor)}}function da(n){switch(n.algorithm.name){case"RSA-PSS":return function(e){if("SHA-256"===e.algorithm.hash.name)return"PS256";throw new Ie("unsupported RsaHashedKeyAlgorithm hash name")}(n);case"RSASSA-PKCS1-v1_5":return function(e){if("SHA-256"===e.algorithm.hash.name)return"RS256";throw new Ie("unsupported RsaHashedKeyAlgorithm hash name")}(n);case"ECDSA":return function(e){if("P-256"===e.algorithm.namedCurve)return"ES256";throw new Ie("unsupported EcKeyAlgorithm namedCurve")}(n);case"Ed25519":return"Ed25519";default:throw new Ie("unsupported CryptoKey algorithm name")}}function ao(n){return n instanceof CryptoKey}function so(n){return ao(n)&&"public"===n.type}function yn(){return yn=(0,h.A)(function*(n,e,t,r,o,i){const a=n?.privateKey,s=n?.publicKey;if(!ao(c=a)||"private"!==c.type)throw new TypeError('"keypair.privateKey" must be a private CryptoKey');var c;if(!so(s))throw new TypeError('"keypair.publicKey" must be a public CryptoKey');if(!0!==s.extractable)throw new TypeError('"keypair.publicKey.extractable" must be true');if("string"!=typeof e)throw new TypeError('"htu" must be a string');if("string"!=typeof t)throw new TypeError('"htm" must be a string');if(void 0!==r&&"string"!=typeof r)throw new TypeError('"nonce" must be a string or undefined');if(void 0!==o&&"string"!=typeof o)throw new TypeError('"accessToken" must be a string or undefined');return function ua(n,e,t){return mn.apply(this,arguments)}({alg:da(a),typ:"dpop+jwt",jwk:yield co(s)},Object.assign(Object.assign({},i),{iat:Math.floor(Date.now()/1e3),jti:crypto.randomUUID(),htm:t,nonce:r,htu:e,ath:o?at(yield crypto.subtle.digest("SHA-256",it(o))):void 0}),a)}),yn.apply(this,arguments)}function co(n){return _n.apply(this,arguments)}function _n(){return(_n=(0,h.A)(function*(n){const{kty:e,e:t,n:r,x:o,y:i,crv:a}=yield crypto.subtle.exportKey("jwk",n);return{kty:e,crv:a,e:t,n:r,x:o,y:i}})).apply(this,arguments)}const pa=["authorization_code","refresh_token","urn:ietf:params:oauth:grant-type:token-exchange","http://auth0.com/oauth/grant-type/mfa-oob","http://auth0.com/oauth/grant-type/mfa-otp","http://auth0.com/oauth/grant-type/mfa-recovery-code"];const ya=function(){var n=(0,h.A)(function*(e,t){const r=yield fetch(e,t);return{ok:r.ok,json:yield r.json(),headers:(o=r.headers,[...o].reduce((i,a)=>{let[s,c]=a;return i[s]=c,i},{}))};var o});return function(t,r){return n.apply(this,arguments)}}(),_a=function(){var n=(0,h.A)(function*(e,t,r){const o=new AbortController;let i;return t.signal=o.signal,Promise.race([ya(e,t),new Promise((a,s)=>{i=setTimeout(()=>{o.abort(),s(new Error("Timeout when executing 'fetch'"))},r)})]).finally(()=>{clearTimeout(i)})});return function(t,r,o){return n.apply(this,arguments)}}(),va=function(){var n=(0,h.A)(function*(e,t,r,o,i,a,s,c){return l={auth:{audience:t,scope:r},timeout:i,fetchUrl:e,fetchOptions:o,useFormData:s,useMrrt:c},u=a,new Promise(function(f,m){const p=new MessageChannel;p.port1.onmessage=function(g){g.data.error?m(new Error(g.data.error)):f(g.data),p.port1.close()},u.postMessage(l,[p.port2])});var l,u});return function(t,r,o,i,a,s,c,l){return n.apply(this,arguments)}}(),wa=function(){var n=(0,h.A)(function*(e,t,r,o,i,a){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1e4;return i?va(e,t,r,o,s,i,a,arguments.length>7?arguments[7]:void 0):_a(e,o,s)});return function(t,r,o,i,a,s){return n.apply(this,arguments)}}();function uo(n,e,t,r,o,i,a,s,c,l){return vn.apply(this,arguments)}function vn(){return(vn=(0,h.A)(function*(n,e,t,r,o,i,a,s,c,l){if(c){const A=yield c.generateProof({url:n,method:o.method||"GET",nonce:yield c.getNonce()});o.headers=Object.assign(Object.assign({},o.headers),{dpop:A})}let u,f=null;for(let A=0;A<3;A++)try{u=yield wa(n,t,r,o,i,a,e,s),f=null;break}catch(x){f=x}if(f)throw f;const m=u.json,{error:p,error_description:g}=m,_=ee(m,["error","error_description"]),{headers:y,ok:v}=u;let w;if(c&&(w=y["dpop-nonce"],w&&(yield c.setNonce(w))),!v){const A=g||"HTTP error. Unable to fetch ".concat(n);if("mfa_required"===p)throw new nt(p,A,_.mfa_token,_.mfa_requirements);if("missing_refresh_token"===p)throw new xt(t,r);if("use_dpop_nonce"===p){if(!c||!w||l)throw new Et(w);return uo(n,e,t,r,o,i,a,s,c,!0)}throw new j(p||"request_error",A)}return _})).apply(this,arguments)}function wn(){return(wn=(0,h.A)(function*(n,e){var{baseUrl:t,timeout:r,audience:o,scope:i,auth0Client:a,useFormData:s,useMrrt:c,dpop:l}=n,u=ee(n,["baseUrl","timeout","audience","scope","auth0Client","useFormData","useMrrt","dpop"]);const f="urn:ietf:params:oauth:grant-type:token-exchange"===u.grant_type,m="refresh_token"===u.grant_type&&c,p=Object.assign(Object.assign(Object.assign(Object.assign({},u),f&&o&&{audience:o}),f&&i&&{scope:i}),m&&{audience:o,scope:i}),g=s?ln(p):JSON.stringify(p),_=pa.includes(u.grant_type);return yield uo("".concat(t,"/oauth/token"),r,o||"default",i,{method:"POST",body:g,headers:{"Content-Type":s?"application/x-www-form-urlencoded":"application/json","Auth0-Client":btoa(JSON.stringify(eo(a||Qr)))}},e,s,c,_?l:void 0)})).apply(this,arguments)}const It=function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return(n=>Array.from(new Set(n)))(e.filter(Boolean).join(" ").trim().split(/\s+/)).join(" ")},Rt=(n,e,t)=>{let r;return t&&(r=n[t]),r||(r=n.default),It(r,e)};class X{constructor(e){let r=arguments.length>2?arguments[2]:void 0;this.prefix=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"@@auth0spajs@@",this.suffix=r,this.clientId=e.clientId,this.scope=e.scope,this.audience=e.audience}toKey(){return[this.prefix,this.clientId,this.audience,this.scope,this.suffix].filter(Boolean).join("::")}static fromKey(e){const[t,r,o,i]=e.split("::");return new X({clientId:r,scope:i,audience:o},t)}static fromCacheEntry(e){const{scope:t,audience:r,client_id:o}=e;return new X({scope:t,audience:r,clientId:o})}}class ka{set(e,t){localStorage.setItem(e,JSON.stringify(t))}get(e){const t=window.localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch{return}}remove(e){localStorage.removeItem(e)}allKeys(){return Object.keys(window.localStorage).filter(e=>e.startsWith("@@auth0spajs@@"))}}class lo{constructor(){this.enclosedCache=function(){let e={};return{set(t,r){e[t]=r},get(t){const r=e[t];if(r)return r},remove(t){delete e[t]},allKeys:()=>Object.keys(e)}}()}}class Aa{constructor(e,t,r){this.cache=e,this.keyManifest=t,this.nowProvider=r||$r}setIdToken(e,t,r){var o=this;return(0,h.A)(function*(){var i;const a=o.getIdTokenCacheKey(e);yield o.cache.set(a,{id_token:t,decodedToken:r}),yield null===(i=o.keyManifest)||void 0===i?void 0:i.add(a)})()}getIdToken(e){var t=this;return(0,h.A)(function*(){const r=yield t.cache.get(t.getIdTokenCacheKey(e.clientId));if(!r&&e.scope&&e.audience){const o=yield t.get(e);return o&&o.id_token&&o.decodedToken?{id_token:o.id_token,decodedToken:o.decodedToken}:void 0}if(r)return{id_token:r.id_token,decodedToken:r.decodedToken}})()}get(e){var t=arguments,r=this;return(0,h.A)(function*(){let o=t.length>1&&void 0!==t[1]?t[1]:0,i=t.length>2&&void 0!==t[2]&&t[2],a=t.length>3?t[3]:void 0;var s;let c=yield r.cache.get(e.toKey());if(!c){const f=yield r.getCacheKeys();if(!f)return;const m=r.matchExistingCacheKey(e,f);if(m&&(c=yield r.cache.get(m)),!c&&i&&"cache-only"!==a)return r.getEntryWithRefreshToken(e,f)}if(!c)return;const l=yield r.nowProvider(),u=Math.floor(l/1e3);return c.expiresAt-o<u?c.body.refresh_token?r.modifiedCachedEntry(c,e):(yield r.cache.remove(e.toKey()),void(yield null===(s=r.keyManifest)||void 0===s?void 0:s.remove(e.toKey()))):c.body})()}modifiedCachedEntry(e,t){var r=this;return(0,h.A)(function*(){return e.body={refresh_token:e.body.refresh_token,audience:e.body.audience,scope:e.body.scope},yield r.cache.set(t.toKey(),e),{refresh_token:e.body.refresh_token,audience:e.body.audience,scope:e.body.scope}})()}set(e){var t=this;return(0,h.A)(function*(){var r;const o=new X({clientId:e.client_id,scope:e.scope,audience:e.audience}),i=yield t.wrapCacheEntry(e);yield t.cache.set(o.toKey(),i),yield null===(r=t.keyManifest)||void 0===r?void 0:r.add(o.toKey())})()}remove(e,t,r){var o=this;return(0,h.A)(function*(){const i=new X({clientId:e,scope:r,audience:t});yield o.cache.remove(i.toKey())})()}clear(e){var t=this;return(0,h.A)(function*(){var r;const o=yield t.getCacheKeys();o&&(yield o.filter(i=>!e||i.includes(e)).reduce(function(){var i=(0,h.A)(function*(a,s){yield a,yield t.cache.remove(s)});return function(a,s){return i.apply(this,arguments)}}(),Promise.resolve()),yield null===(r=t.keyManifest)||void 0===r?void 0:r.clear())})()}wrapCacheEntry(e){var t=this;return(0,h.A)(function*(){const r=yield t.nowProvider();return{body:e,expiresAt:Math.floor(r/1e3)+e.expires_in}})()}getCacheKeys(){var e=this;return(0,h.A)(function*(){var t;return e.keyManifest?null===(t=yield e.keyManifest.get())||void 0===t?void 0:t.keys:e.cache.allKeys?e.cache.allKeys():void 0})()}getIdTokenCacheKey(e){return new X({clientId:e},"@@auth0spajs@@","@@user@@").toKey()}matchExistingCacheKey(e,t){return t.filter(r=>{var o;const i=X.fromKey(r),a=new Set(i.scope&&i.scope.split(" ")),s=(null===(o=e.scope)||void 0===o?void 0:o.split(" "))||[],c=i.scope&&s.reduce((l,u)=>l&&a.has(u),!0);return"@@auth0spajs@@"===i.prefix&&i.clientId===e.clientId&&i.audience===e.audience&&c})[0]}getEntryWithRefreshToken(e,t){var r=this;return(0,h.A)(function*(){var o;for(const i of t){const a=X.fromKey(i);if("@@auth0spajs@@"===a.prefix&&a.clientId===e.clientId){const s=yield r.cache.get(i);if(null!==(o=s?.body)&&void 0!==o&&o.refresh_token)return r.modifiedCachedEntry(s,e)}}})()}updateEntry(e,t){var r=this;return(0,h.A)(function*(){var o;const i=yield r.getCacheKeys();if(i)for(const a of i){const s=yield r.cache.get(a);(null===(o=s?.body)||void 0===o?void 0:o.refresh_token)===e&&(s.body.refresh_token=t,yield r.cache.set(a,s))}})()}}class xa{constructor(e,t,r){this.storage=e,this.clientId=t,this.cookieDomain=r,this.storageKey="".concat("a0.spajs.txs",".").concat(this.clientId)}create(e){this.storage.save(this.storageKey,e,{daysUntilExpire:1,cookieDomain:this.cookieDomain})}get(){return this.storage.get(this.storageKey)}remove(){this.storage.remove(this.storageKey,{cookieDomain:this.cookieDomain})}}const st=n=>"number"==typeof n,Ea=["iss","aud","exp","nbf","iat","jti","azp","nonce","auth_time","at_hash","c_hash","acr","amr","sub_jwk","cnf","sip_from_tag","sip_date","sip_callid","sip_cseq_num","sip_via_branch","orig","dest","mky","events","toe","txn","rph","sid","vot","vtm"];var ct=Pe&&Pe.__assign||function(){return ct=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},ct.apply(this,arguments)};function ut(n,e){if(!e)return"";var t="; "+n;return!0===e?t:t+"="+e}function ho(n,e,t){document.cookie=function Ca(n,e,t){return encodeURIComponent(n).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/\(/g,"%28").replace(/\)/g,"%29")+"="+encodeURIComponent(e).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent)+function(r){if("number"==typeof r.expires){var o=new Date;o.setMilliseconds(o.getMilliseconds()+864e5*r.expires),r.expires=o}return ut("Expires",r.expires?r.expires.toUTCString():"")+ut("Domain",r.domain)+ut("Path",r.path)+ut("Secure",r.secure)+ut("SameSite",r.sameSite)}(t)}(n,e,ct({path:"/"},t))}var po=ho,fo=function(n,e){ho(n,"",ct(ct({},e),{expires:-1}))};const Ve={get(n){const e=function(n){return function Pa(){return function(n){for(var e={},t=n?n.split("; "):[],r=/(%[\dA-F]{2})+/gi,o=0;o<t.length;o++){var i=t[o].split("="),a=i.slice(1).join("=");'"'===a.charAt(0)&&(a=a.slice(1,-1));try{e[i[0].replace(r,decodeURIComponent)]=a.replace(r,decodeURIComponent)}catch{}}return e}(document.cookie)}()[n]}(n);if(void 0!==e)return JSON.parse(e)},save(n,e,t){let r={};"https:"===window.location.protocol&&(r={secure:!0,sameSite:"none"}),t?.daysUntilExpire&&(r.expires=t.daysUntilExpire),t?.cookieDomain&&(r.domain=t.cookieDomain),po(n,JSON.stringify(e),r)},remove(n,e){let t={};e?.cookieDomain&&(t.domain=e.cookieDomain),fo(n,t)}},Ra={get:n=>Ve.get(n)||Ve.get("".concat("_legacy_").concat(n)),save(n,e,t){let r={};"https:"===window.location.protocol&&(r={secure:!0}),t?.daysUntilExpire&&(r.expires=t.daysUntilExpire),t?.cookieDomain&&(r.domain=t.cookieDomain),po("".concat("_legacy_").concat(n),JSON.stringify(e),r),Ve.save(n,e,t)},remove(n,e){let t={};e?.cookieDomain&&(t.domain=e.cookieDomain),fo(n,t),Ve.remove(n,e),Ve.remove("".concat("_legacy_").concat(n),e)}},Oa={get(n){if(typeof sessionStorage>"u")return;const e=sessionStorage.getItem(n);return null!=e?JSON.parse(e):void 0},save(n,e){sessionStorage.setItem(n,JSON.stringify(e))},remove(n){sessionStorage.removeItem(n)}};var Re,n;(n=Re||(Re={})).Code="code",n.ConnectCode="connect_code";var bn,Da=function(n){return bn=bn||function ja(n,e,t){var r=void 0===e?null:e,o=function(c,l){var u=atob(c);if(l){for(var f=new Uint8Array(u.length),m=0,p=u.length;m<p;++m)f[m]=u.charCodeAt(m);return String.fromCharCode.apply(null,new Uint16Array(f.buffer))}return u}(n,void 0!==t&&t),i=o.indexOf("\n",10)+1,a=o.substring(i)+(r?"//# sourceMappingURL="+r:""),s=new Blob([a],{type:"application/javascript"});return URL.createObjectURL(s)}("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7Y2xhc3MgZSBleHRlbmRzIEVycm9ye2NvbnN0cnVjdG9yKHQscil7c3VwZXIociksdGhpcy5lcnJvcj10LHRoaXMuZXJyb3JfZGVzY3JpcHRpb249cixPYmplY3Quc2V0UHJvdG90eXBlT2YodGhpcyxlLnByb3RvdHlwZSl9c3RhdGljIGZyb21QYXlsb2FkKHQpe2xldHtlcnJvcjpyLGVycm9yX2Rlc2NyaXB0aW9uOnN9PXQ7cmV0dXJuIG5ldyBlKHIscyl9fWNsYXNzIHQgZXh0ZW5kcyBle2NvbnN0cnVjdG9yKGUscyl7c3VwZXIoIm1pc3NpbmdfcmVmcmVzaF90b2tlbiIsIk1pc3NpbmcgUmVmcmVzaCBUb2tlbiAoYXVkaWVuY2U6ICciLmNvbmNhdChyKGUsWyJkZWZhdWx0Il0pLCInLCBzY29wZTogJyIpLmNvbmNhdChyKHMpLCInKSIpKSx0aGlzLmF1ZGllbmNlPWUsdGhpcy5zY29wZT1zLE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLHQucHJvdG90eXBlKX19ZnVuY3Rpb24gcihlKXtsZXQgdD1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06W107cmV0dXJuIGUmJiF0LmluY2x1ZGVzKGUpP2U6IiJ9ImZ1bmN0aW9uIj09dHlwZW9mIFN1cHByZXNzZWRFcnJvciYmU3VwcHJlc3NlZEVycm9yO2NvbnN0IHM9ZT0+e3ZhcntjbGllbnRJZDp0fT1lLHI9ZnVuY3Rpb24oZSx0KXt2YXIgcj17fTtmb3IodmFyIHMgaW4gZSlPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSxzKSYmdC5pbmRleE9mKHMpPDAmJihyW3NdPWVbc10pO2lmKG51bGwhPWUmJiJmdW5jdGlvbiI9PXR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKXt2YXIgbz0wO2ZvcihzPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7bzxzLmxlbmd0aDtvKyspdC5pbmRleE9mKHNbb10pPDAmJk9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChlLHNbb10pJiYocltzW29dXT1lW3Nbb11dKX1yZXR1cm4gcn0oZSxbImNsaWVudElkIl0pO3JldHVybiBuZXcgVVJMU2VhcmNoUGFyYW1zKChlPT5PYmplY3Qua2V5cyhlKS5maWx0ZXIoKHQ9PnZvaWQgMCE9PWVbdF0pKS5yZWR1Y2UoKCh0LHIpPT5PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sdCkse1tyXTplW3JdfSkpLHt9KSkoT2JqZWN0LmFzc2lnbih7Y2xpZW50X2lkOnR9LHIpKSkudG9TdHJpbmcoKX07bGV0IG89e307Y29uc3Qgbj0oZSx0KT0+IiIuY29uY2F0KGUsInwiKS5jb25jYXQodCk7YWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsKGFzeW5jIGU9PntsZXQgcixjLHtkYXRhOnt0aW1lb3V0OmksYXV0aDphLGZldGNoVXJsOmYsZmV0Y2hPcHRpb25zOmwsdXNlRm9ybURhdGE6cCx1c2VNcnJ0Omh9LHBvcnRzOlt1XX09ZSxkPXt9O2NvbnN0e2F1ZGllbmNlOmcsc2NvcGU6eX09YXx8e307dHJ5e2NvbnN0IGU9cD8oZT0+e2NvbnN0IHQ9bmV3IFVSTFNlYXJjaFBhcmFtcyhlKSxyPXt9O3JldHVybiB0LmZvckVhY2goKChlLHQpPT57clt0XT1lfSkpLHJ9KShsLmJvZHkpOkpTT04ucGFyc2UobC5ib2R5KTtpZighZS5yZWZyZXNoX3Rva2VuJiYicmVmcmVzaF90b2tlbiI9PT1lLmdyYW50X3R5cGUpe2lmKGM9KChlLHQpPT5vW24oZSx0KV0pKGcseSksIWMmJmgpe2NvbnN0IGU9by5sYXRlc3RfcmVmcmVzaF90b2tlbix0PSgoZSx0KT0+e2NvbnN0IHI9T2JqZWN0LmtleXMobykuZmluZCgocj0+e2lmKCJsYXRlc3RfcmVmcmVzaF90b2tlbiIhPT1yKXtjb25zdCBzPSgoZSx0KT0+dC5zdGFydHNXaXRoKCIiLmNvbmNhdChlLCJ8IikpKSh0LHIpLG89ci5zcGxpdCgifCIpWzFdLnNwbGl0KCIgIiksbj1lLnNwbGl0KCIgIikuZXZlcnkoKGU9Pm8uaW5jbHVkZXMoZSkpKTtyZXR1cm4gcyYmbn19KSk7cmV0dXJuISFyfSkoeSxnKTtlJiYhdCYmKGM9ZSl9aWYoIWMpdGhyb3cgbmV3IHQoZyx5KTtsLmJvZHk9cD9zKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxlKSx7cmVmcmVzaF90b2tlbjpjfSkpOkpTT04uc3RyaW5naWZ5KE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxlKSx7cmVmcmVzaF90b2tlbjpjfSkpfWxldCBhLGs7ImZ1bmN0aW9uIj09dHlwZW9mIEFib3J0Q29udHJvbGxlciYmKGE9bmV3IEFib3J0Q29udHJvbGxlcixsLnNpZ25hbD1hLnNpZ25hbCk7dHJ5e2s9YXdhaXQgUHJvbWlzZS5yYWNlKFsoaj1pLG5ldyBQcm9taXNlKChlPT5zZXRUaW1lb3V0KGUsaikpKSksZmV0Y2goZixPYmplY3QuYXNzaWduKHt9LGwpKV0pfWNhdGNoKGUpe3JldHVybiB2b2lkIHUucG9zdE1lc3NhZ2Uoe2Vycm9yOmUubWVzc2FnZX0pfWlmKCFrKXJldHVybiBhJiZhLmFib3J0KCksdm9pZCB1LnBvc3RNZXNzYWdlKHtlcnJvcjoiVGltZW91dCB3aGVuIGV4ZWN1dGluZyAnZmV0Y2gnIn0pO189ay5oZWFkZXJzLGQ9Wy4uLl9dLnJlZHVjZSgoKGUsdCk9PntsZXRbcixzXT10O3JldHVybiBlW3JdPXMsZX0pLHt9KSxyPWF3YWl0IGsuanNvbigpLHIucmVmcmVzaF90b2tlbj8oaCYmKG8ubGF0ZXN0X3JlZnJlc2hfdG9rZW49ci5yZWZyZXNoX3Rva2VuLE89YyxiPXIucmVmcmVzaF90b2tlbixPYmplY3QuZW50cmllcyhvKS5mb3JFYWNoKChlPT57bGV0W3Qscl09ZTtyPT09TyYmKG9bdF09Yil9KSkpLCgoZSx0LHIpPT57b1tuKHQscildPWV9KShyLnJlZnJlc2hfdG9rZW4sZyx5KSxkZWxldGUgci5yZWZyZXNoX3Rva2VuKTooKGUsdCk9PntkZWxldGUgb1tuKGUsdCldfSkoZyx5KSx1LnBvc3RNZXNzYWdlKHtvazprLm9rLGpzb246cixoZWFkZXJzOmR9KX1jYXRjaChlKXt1LnBvc3RNZXNzYWdlKHtvazohMSxqc29uOntlcnJvcjplLmVycm9yLGVycm9yX2Rlc2NyaXB0aW9uOmUubWVzc2FnZX0saGVhZGVyczpkfSl9dmFyIE8sYixfLGp9KSl9KCk7Cgo=",null,!1),new Worker(bn,n)};const Sn={};class Ua{constructor(e,t){this.cache=e,this.clientId=t,this.manifestKey=this.createManifestKeyFrom(this.clientId)}add(e){var t=this;return(0,h.A)(function*(){var r;const o=new Set((null===(r=yield t.cache.get(t.manifestKey))||void 0===r?void 0:r.keys)||[]);o.add(e),yield t.cache.set(t.manifestKey,{keys:[...o]})})()}remove(e){var t=this;return(0,h.A)(function*(){const r=yield t.cache.get(t.manifestKey);if(r){const o=new Set(r.keys);return o.delete(e),o.size>0?yield t.cache.set(t.manifestKey,{keys:[...o]}):yield t.cache.remove(t.manifestKey)}})()}get(){return this.cache.get(this.manifestKey)}clear(){return this.cache.remove(this.manifestKey)}createManifestKeyFrom(e){return"".concat("@@auth0spajs@@","::").concat(e)}}const Na={memory:()=>(new lo).enclosedCache,localstorage:()=>new ka},_o=n=>Na[n],vo=n=>{const{openUrl:e,onRedirect:t}=n,r=ee(n,["openUrl","onRedirect"]);return Object.assign(Object.assign({},r),{openUrl:!1===e||e?e:t})},wo=(n,e)=>{const t=e?.split(" ")||[];return(n?.split(" ")||[]).every(r=>t.includes(r))},Oe={NONCE:"nonce",KEYPAIR:"keypair"};class Ka{constructor(e){this.clientId=e}getVersion(){return 1}createDbHandle(){const e=window.indexedDB.open("auth0-spa-js",this.getVersion());return new Promise((t,r)=>{e.onupgradeneeded=()=>Object.values(Oe).forEach(o=>e.result.createObjectStore(o)),e.onerror=()=>r(e.error),e.onsuccess=()=>t(e.result)})}getDbHandle(){var e=this;return(0,h.A)(function*(){return e.dbHandle||(e.dbHandle=yield e.createDbHandle()),e.dbHandle})()}executeDbRequest(e,t,r){var o=this;return(0,h.A)(function*(){const i=r((yield o.getDbHandle()).transaction(e,t).objectStore(e));return new Promise((a,s)=>{i.onsuccess=()=>a(i.result),i.onerror=()=>s(i.error)})})()}buildKey(e){const t=e?"_".concat(e):"auth0";return"".concat(this.clientId,"::").concat(t)}setNonce(e,t){return this.save(Oe.NONCE,this.buildKey(t),e)}setKeyPair(e){return this.save(Oe.KEYPAIR,this.buildKey(),e)}save(e,t,r){var o=this;return(0,h.A)(function*(){yield o.executeDbRequest(e,"readwrite",i=>i.put(r,t))})()}findNonce(e){return this.find(Oe.NONCE,this.buildKey(e))}findKeyPair(){return this.find(Oe.KEYPAIR,this.buildKey())}find(e,t){return this.executeDbRequest(e,"readonly",r=>r.get(t))}deleteBy(e,t){var r=this;return(0,h.A)(function*(){const o=yield r.executeDbRequest(e,"readonly",i=>i.getAllKeys());o?.filter(t).map(i=>r.executeDbRequest(e,"readwrite",a=>a.delete(i)))})()}deleteByClientId(e,t){return this.deleteBy(e,r=>"string"==typeof r&&r.startsWith("".concat(t,"::")))}clearNonces(){return this.deleteByClientId(Oe.NONCE,this.clientId)}clearKeyPairs(){return this.deleteByClientId(Oe.KEYPAIR,this.clientId)}}class La{constructor(e){this.storage=new Ka(e)}getNonce(e){return this.storage.findNonce(e)}setNonce(e,t){return this.storage.setNonce(e,t)}getOrGenerateKeyPair(){var e=this;return(0,h.A)(function*(){let t=yield e.storage.findKeyPair();return t||(t=yield function fa(){return(n=(0,h.A)(function*(e,t){var r;let o;if(0===e.length)throw new TypeError('"alg" must be a non-empty string');switch(e){case"PS256":o={name:"RSA-PSS",hash:"SHA-256",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])};break;case"RS256":o={name:"RSASSA-PKCS1-v1_5",hash:"SHA-256",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])};break;case"ES256":o={name:"ECDSA",namedCurve:"P-256"};break;case"Ed25519":o={name:"Ed25519"};break;default:throw new Ie}return crypto.subtle.generateKey(o,null!==(r=t?.extractable)&&void 0!==r&&r,["sign","verify"])}),function(e,t){return n.apply(this,arguments)})("ES256",{extractable:!1});var n}(),yield e.storage.setKeyPair(t)),t})()}generateProof(e){var t=this;return(0,h.A)(function*(){const r=yield t.getOrGenerateKeyPair();return function ga(n){let{keyPair:e,url:t,method:r,nonce:o,accessToken:i}=n;return function ha(n,e,t,r,o,i){return yn.apply(this,arguments)}(e,function(s){const c=new URL(s);return c.search="",c.hash="",c.href}(t),r,o,i)}(Object.assign({keyPair:r},e))})()}calculateThumbprint(){var e=this;return(0,h.A)(function*(){return function ma(n){return(e=(0,h.A)(function*(t){if(!so(t))throw new TypeError('"publicKey" must be a public CryptoKey');if(!0!==t.extractable)throw new TypeError('"publicKey.extractable" must be true');const r=yield co(t);let o;switch(r.kty){case"EC":o={crv:r.crv,kty:r.kty,x:r.x,y:r.y};break;case"OKP":o={crv:r.crv,kty:r.kty,x:r.x};break;case"RSA":o={e:r.e,kty:r.kty,n:r.n};break;default:throw new Ie("unsupported JWK kty")}return at(yield crypto.subtle.digest({name:"SHA-256"},it(JSON.stringify(o))))}),function(t){return e.apply(this,arguments)})(n.publicKey);var e}(yield e.getOrGenerateKeyPair())})()}clear(){var e=this;return(0,h.A)(function*(){yield Promise.all([e.storage.clearNonces(),e.storage.clearKeyPairs()])})()}}var Ge;!function(n){n.Bearer="Bearer",n.DPoP="DPoP"}(Ge||(Ge={}));class Ma{constructor(e,t){this.hooks=t,this.config=Object.assign(Object.assign({},e),{fetch:e.fetch||(typeof window>"u"?fetch:window.fetch.bind(window))})}isAbsoluteUrl(e){return/^(https?:)?\/\//i.test(e)}buildUrl(e,t){if(t){if(this.isAbsoluteUrl(t))return t;if(e)return"".concat(e.replace(/\/?\/$/,""),"/").concat(t.replace(/^\/+/,""))}throw new TypeError("`url` must be absolute or `baseUrl` non-empty.")}getAccessToken(e){return this.config.getAccessToken?this.config.getAccessToken(e):this.hooks.getAccessToken(e)}extractUrl(e){return"string"==typeof e?e:e instanceof URL?e.href:e.url}buildBaseRequest(e,t){if(!this.config.baseUrl)return new Request(e,t);const r=this.buildUrl(this.config.baseUrl,this.extractUrl(e)),o=e instanceof Request?new Request(r,e):r;return new Request(o,t)}setAuthorizationHeader(e,t){e.headers.set("authorization","".concat(arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ge.Bearer," ").concat(t))}setDpopProofHeader(e,t){var r=this;return(0,h.A)(function*(){if(!r.config.dpopNonceId)return;const o=yield r.hooks.getDpopNonce(),i=yield r.hooks.generateDpopProof({accessToken:t,method:e.method,nonce:o,url:e.url});e.headers.set("dpop",i)})()}prepareRequest(e,t){var r=this;return(0,h.A)(function*(){const o=yield r.getAccessToken(t);let i,a;"string"==typeof o?(i=r.config.dpopNonceId?Ge.DPoP:Ge.Bearer,a=o):(i=o.token_type,a=o.access_token),r.setAuthorizationHeader(e,a,i),i===Ge.DPoP&&(yield r.setDpopProofHeader(e,a))})()}getHeader(e,t){return Array.isArray(e)?new Headers(e).get(t)||"":"function"==typeof e.get?e.get(t)||"":e[t]||""}hasUseDpopNonceError(e){if(401!==e.status)return!1;const t=this.getHeader(e.headers,"www-authenticate");return t.includes("invalid_dpop_nonce")||t.includes("use_dpop_nonce")}handleResponse(e,t){var r=this;return(0,h.A)(function*(){const o=r.getHeader(e.headers,"dpop-nonce");if(o&&(yield r.hooks.setDpopNonce(o)),!r.hasUseDpopNonceError(e))return e;if(!o||!t.onUseDpopNonceError)throw new Et(o);return t.onUseDpopNonceError()})()}internalFetchWithAuth(e,t,r,o){var i=this;return(0,h.A)(function*(){const a=i.buildBaseRequest(e,t);yield i.prepareRequest(a,o);const s=yield i.config.fetch(a);return i.handleResponse(s,r)})()}fetchWithAuth(e,t,r){const o={onUseDpopNonceError:()=>this.internalFetchWithAuth(e,t,Object.assign(Object.assign({},o),{onUseDpopNonceError:void 0}),r)};return this.internalFetchWithAuth(e,t,o,r)}}class Wa{constructor(e,t){this.myAccountFetcher=e,this.apiBase=t}connectAccount(e){var t=this;return(0,h.A)(function*(){const r=yield t.myAccountFetcher.fetchWithAuth("".concat(t.apiBase,"v1/connected-accounts/connect"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return t._handleResponse(r)})()}completeAccount(e){var t=this;return(0,h.A)(function*(){const r=yield t.myAccountFetcher.fetchWithAuth("".concat(t.apiBase,"v1/connected-accounts/complete"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return t._handleResponse(r)})()}_handleResponse(e){return(0,h.A)(function*(){let t;try{t=yield e.text(),t=JSON.parse(t)}catch(r){throw new Ot({type:"invalid_json",status:e.status,title:"Invalid JSON response",detail:t||String(r)})}if(e.ok)return t;throw new Ot(t)})()}}class Ot extends Error{constructor(e){let{type:t,status:r,title:o,detail:i,validation_errors:a}=e;super(i),this.name="MyAccountApiError",this.type=t,this.status=r,this.title=o,this.detail=i,this.validation_errors=a,Object.setPrototypeOf(this,Ot.prototype)}}const za={otp:{authenticatorTypes:["otp"]},sms:{authenticatorTypes:["oob"],oobChannels:["sms"]},email:{authenticatorTypes:["oob"],oobChannels:["email"]},push:{authenticatorTypes:["oob"],oobChannels:["auth0"]},voice:{authenticatorTypes:["oob"],oobChannels:["voice"]}};function bo(n,e){this.v=n,this.k=e}function U(n,e,t){if("function"==typeof n?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function Va(n){return new bo(n,0)}function So(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function S(n,e){return n.get(U(n,e))}function L(n,e,t){So(n,e),e.set(n,t)}function D(n,e,t){return n.set(U(n,e),t),t}function k(n,e,t){return(e="symbol"==typeof(o=function(i){if("object"!=typeof i||!i)return i;var s=i[Symbol.toPrimitive];if(void 0!==s){var c=s.call(i,"string");if("object"!=typeof c)return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}(e))?o:o+"")in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n;var o}function ko(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,r)}return t}function E(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ko(Object(t),!0).forEach(function(r){k(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ko(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Ao(n,e){if(null==n)return{};var t,r,o=function(a,s){if(null==a)return{};var c={};for(var l in a)if({}.hasOwnProperty.call(a,l)){if(-1!==s.indexOf(l))continue;c[l]=a[l]}return c}(n,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(r=0;r<i.length;r++)-1===e.indexOf(t=i[r])&&{}.propertyIsEnumerable.call(n,t)&&(o[t]=n[t])}return o}function lt(n){var e,t;function r(i,a){try{var s=n[i](a),c=s.value,l=c instanceof bo;Promise.resolve(l?c.v:c).then(function(u){if(l){var f="return"===i?"return":"next";if(!c.k||u.done)return r(f,u);u=n[f](u).value}o(s.done?"return":"normal",u)},function(u){r("throw",u)})}catch(u){o("throw",u)}}function o(i,a){switch(i){case"return":e.resolve({value:a,done:!0});break;case"throw":e.reject(a);break;default:e.resolve({value:a,done:!1})}(e=e.next)?r(e.key,e.arg):t=null}this._invoke=function(i,a){return new Promise(function(s,c){var l={key:i,arg:a,resolve:s,reject:c,next:null};t?t=t.next=l:(e=t=l,r(i,a))})},"function"!=typeof n.return&&(this.return=void 0)}var jt,kn;let An;function Ze(n,e){if(null==n)return!1;try{return n instanceof e||Object.getPrototypeOf(n)[Symbol.toStringTag]===e.prototype[Symbol.toStringTag]}catch{return!1}}function R(n,e,t){const r=new TypeError(n,{cause:t});return Object.assign(r,{code:e}),r}lt.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},lt.prototype.next=function(n){return this._invoke("next",n)},lt.prototype.throw=function(n){return this._invoke("throw",n)},lt.prototype.return=function(n){return this._invoke("return",n)},(typeof navigator>"u"||null===(jt=navigator.userAgent)||void 0===jt||null===(kn=jt.startsWith)||void 0===kn||!kn.call(jt,"Mozilla/5.0 "))&&(An="".concat("oauth4webapi","/").concat("v3.8.3"));const Q=Symbol(),xn=Symbol(),En=Symbol(),re=Symbol(),pe=Symbol(),Za=new TextEncoder,qa=new TextDecoder;function qe(n){return"string"==typeof n?Za.encode(n):qa.decode(n)}let Tn,xo;function je(n){return"string"==typeof n?xo(n):Tn(n)}Tn=Uint8Array.prototype.toBase64?n=>(n instanceof ArrayBuffer&&(n=new Uint8Array(n)),n.toBase64({alphabet:"base64url",omitPadding:!0})):e=>{e instanceof ArrayBuffer&&(e=new Uint8Array(e));const t=[];for(let r=0;r<e.byteLength;r+=32768)t.push(String.fromCharCode.apply(null,e.subarray(r,r+32768)));return btoa(t.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},xo=Uint8Array.fromBase64?n=>{try{return Uint8Array.fromBase64(n,{alphabet:"base64url"})}catch(e){throw R("The input to be decoded is not correctly encoded.","ERR_INVALID_ARG_VALUE",e)}}:n=>{try{const e=atob(n.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}catch(e){throw R("The input to be decoded is not correctly encoded.","ERR_INVALID_ARG_VALUE",e)}};class q extends Error{constructor(e,t){var r;super(e,t),k(this,"code",void 0),this.name=this.constructor.name,this.code=Fn,null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,this.constructor)}}class Cn extends Error{constructor(e,t){var r;super(e,t),k(this,"code",void 0),this.name=this.constructor.name,null!=t&&t.code&&(this.code=t?.code),null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,this.constructor)}}function T(n,e,t){return new Cn(n,{code:e,cause:t})}function Dt(n){return null!==n&&"object"==typeof n&&!Array.isArray(n)}function Ut(n){Ze(n,Headers)&&(n=Object.fromEntries(n.entries()));const e=new Headers(n??{});if(An&&!e.has("user-agent")&&e.set("user-agent",An),e.has("authorization"))throw R('"options.headers" must not include the "authorization" header name',"ERR_INVALID_ARG_VALUE");return e}function Eo(n,e){if(void 0!==e){if("function"==typeof e&&(e=e(n.href)),!(e instanceof AbortSignal))throw R('"options.signal" must return or be an instance of AbortSignal',"ERR_INVALID_ARG_TYPE");return e}}function To(n){return n.includes("//")?n.replace("//","/"):n}function Pn(){return Pn=(0,h.A)(function*(n,e){return(t=(0,h.A)(function*(r,o,i,a){if(!(r instanceof URL))throw R('"'.concat(o,'" must be an instance of URL'),"ERR_INVALID_ARG_TYPE");Rn(r,!0!==a?.[Q]);const s=i(new URL(r.href)),c=Ut(a?.headers);return c.set("accept","application/json"),(a?.[re]||fetch)(s.href,{body:void 0,headers:Object.fromEntries(c.entries()),method:"GET",redirect:"manual",signal:Eo(s,a?.signal)})}),function(r,o,i,a){return t.apply(this,arguments)})(n,"issuerIdentifier",t=>{switch(e?.algorithm){case void 0:case"oidc":(r=t).pathname=To("".concat(r.pathname,"/").concat(".well-known/openid-configuration"));break;case"oauth2":!function(r,o){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r.pathname="/"===r.pathname?o:To("".concat(o,"/").concat(i?r.pathname:r.pathname.replace(/(\/)$/,"")))}(t,".well-known/oauth-authorization-server");break;default:throw R('"options.algorithm" must be "oidc" (default), or "oauth2"',"ERR_INVALID_ARG_VALUE")}var r;return t},e);var t}),Pn.apply(this,arguments)}function ve(n,e,t,r,o){try{if("number"!=typeof n||!Number.isFinite(n))throw R("".concat(t," must be a number"),"ERR_INVALID_ARG_TYPE",o);if(n>0)return;if(e){if(0!==n)throw R("".concat(t," must be a non-negative number"),"ERR_INVALID_ARG_VALUE",o);return}throw R("".concat(t," must be a positive number"),"ERR_INVALID_ARG_VALUE",o)}catch(i){throw r?T(i.message,r,o):i}}function N(n,e,t,r){try{if("string"!=typeof n)throw R("".concat(e," must be a string"),"ERR_INVALID_ARG_TYPE",r);if(0===n.length)throw R("".concat(e," must not be empty"),"ERR_INVALID_ARG_VALUE",r)}catch(o){throw t?T(o.message,t,r):o}}function Co(n){!function(e,t){if(Do(e)!==t)throw function(r){let o='"response" content-type must be ';for(var i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];if(a.length>2){const c=a.pop();o+="".concat(a.join(", "),", or ").concat(c)}else o+=2===a.length?"".concat(a[0]," or ").concat(a[1]):a[0];return T(o,Ko,r)}(e,t)}(n,"application/json")}function Po(){return je(crypto.getRandomValues(new Uint8Array(32)))}function Xa(n){switch(n.algorithm.name){case"RSA-PSS":return function(e){switch(e.algorithm.hash.name){case"SHA-256":return"PS256";case"SHA-384":return"PS384";case"SHA-512":return"PS512";default:throw new q("unsupported RsaHashedKeyAlgorithm hash name",{cause:e})}}(n);case"RSASSA-PKCS1-v1_5":return function(e){switch(e.algorithm.hash.name){case"SHA-256":return"RS256";case"SHA-384":return"RS384";case"SHA-512":return"RS512";default:throw new q("unsupported RsaHashedKeyAlgorithm hash name",{cause:e})}}(n);case"ECDSA":return function(e){switch(e.algorithm.namedCurve){case"P-256":return"ES256";case"P-384":return"ES384";case"P-521":return"ES512";default:throw new q("unsupported EcKeyAlgorithm namedCurve",{cause:e})}}(n);case"Ed25519":case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return n.algorithm.name;case"EdDSA":return"Ed25519";default:throw new q("unsupported CryptoKey algorithm name",{cause:n})}}function Nt(n){const e=n?.[xn];return"number"==typeof e&&Number.isFinite(e)?e:0}function In(n){const e=n?.[En];return"number"==typeof e&&Number.isFinite(e)&&-1!==Math.sign(e)?e:30}function Kt(){return Math.floor(Date.now()/1e3)}function oe(n){if("object"!=typeof n||null===n)throw R('"as" must be an object',"ERR_INVALID_ARG_TYPE");N(n.issuer,'"as.issuer"')}function ie(n){if("object"!=typeof n||null===n)throw R('"client" must be an object',"ERR_INVALID_ARG_TYPE");N(n.client_id,'"client.client_id"')}function Io(n){return N(n,'"clientSecret"'),(e,t,r,o)=>{r.set("client_id",t.client_id),r.set("client_secret",n)}}const $a=URL.parse?(n,e)=>URL.parse(n,e):(n,e)=>{try{return new URL(n,e)}catch{return null}};function Rn(n,e){if(e&&"https:"!==n.protocol)throw T("only requests to HTTPS are allowed",Lo,n);if("https:"!==n.protocol&&"http:"!==n.protocol)throw T("only HTTP and HTTPS requests are allowed",Mo,n)}function dt(n,e,t,r){return function Ro(n,e,t,r){let o;if("string"!=typeof n||!(o=$a(n)))throw T("authorization server metadata does not contain a valid ".concat(t?'"as.mtls_endpoint_aliases.'.concat(e,'"'):'"as.'.concat(e,'"')),void 0===n?fs:ms,{attribute:t?"mtls_endpoint_aliases.".concat(e):e});return Rn(o,r),o}(t&&n.mtls_endpoint_aliases&&e in n.mtls_endpoint_aliases?n.mtls_endpoint_aliases[e]:n[e],e,t,r)}class Lt extends Error{constructor(e,t){var r;super(e,t),k(this,"cause",void 0),k(this,"code",void 0),k(this,"error",void 0),k(this,"status",void 0),k(this,"error_description",void 0),k(this,"response",void 0),this.name=this.constructor.name,this.code=hs,this.cause=t.cause,this.error=t.cause.error,this.status=t.response.status,this.error_description=t.cause.error_description,Object.defineProperty(this,"response",{enumerable:!1,value:t.response}),null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,this.constructor)}}class Oo extends Error{constructor(e,t){var r,o;super(e,t),k(this,"cause",void 0),k(this,"code",void 0),k(this,"error",void 0),k(this,"error_description",void 0),this.name=this.constructor.name,this.code=ps,this.cause=t.cause,this.error=t.cause.get("error"),this.error_description=null!==(r=t.cause.get("error_description"))&&void 0!==r?r:void 0,null===(o=Error.captureStackTrace)||void 0===o||o.call(Error,this,this.constructor)}}class On extends Error{constructor(e,t){var r;super(e,t),k(this,"cause",void 0),k(this,"code",void 0),k(this,"response",void 0),k(this,"status",void 0),this.name=this.constructor.name,this.code=ds,this.cause=t.cause,this.status=t.response.status,this.response=t.response,Object.defineProperty(this,"response",{enumerable:!1}),null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,this.constructor)}}const ts=new RegExp("^[,\\s]*([a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+)"),ns=new RegExp('^[,\\s]*([a-zA-Z0-9!#$%&\\\'\\*\\+\\-\\.\\^_`\\|~]+)\\s*=\\s*"((?:[^"\\\\]|\\\\[\\s\\S])*)"[,\\s]*(.*)'),rs=new RegExp("^[,\\s]*([a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+)\\s*=\\s*([a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+)[,\\s]*(.*)"),os=new RegExp("^([a-zA-Z0-9\\-\\._\\~\\+\\/]+={0,2})(?:$|[,\\s])(.*)");function jn(n,e,t){return Dn.apply(this,arguments)}function Dn(){return Dn=(0,h.A)(function*(n,e,t){if(n.status!==e){let o;var r;throw function(i){let a;if(a=function(s){if(!Ze(s,Response))throw R('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");const c=s.headers.get("www-authenticate");if(null===c)return;const l=[];let u=c;for(;u;){var f;let m=u.match(ts);const p=null===(f=m)||void 0===f?void 0:f[1].toLowerCase();if(!p)return;const g=u.substring(m[0].length);if(g&&!g.match(/^[\s,]/))return;const _=g.match(/^\s+(.*)$/);u=_?_[1]:void 0;const v={};let w;if(_)for(;u;){let x,b;if(m=u.match(ns)){if([,x,b,u]=m,b.includes("\\"))try{b=JSON.parse('"'.concat(b,'"'))}catch{}v[x.toLowerCase()]=b}else{if(!(m=u.match(rs))){if(m=u.match(os)){if(Object.keys(v).length)break;[,w,u]=m;break}return}[,x,b,u]=m,v[x.toLowerCase()]=b}}else u=g||void 0;const A={scheme:p,parameters:v};w&&(A.token68=w),l.push(A)}return l.length?l:void 0}(i))throw new On("server responded with a challenge in the WWW-Authenticate HTTP Header",{cause:a,response:i})}(n),(o=yield(i=(0,h.A)(function*(a){if(a.status>399&&a.status<500){ft(a),Co(a);try{const s=yield a.clone().json();if(Dt(s)&&"string"==typeof s.error&&s.error.length)return s}catch{}}}),function(a){return i.apply(this,arguments)})(n))?(yield null===(r=n.body)||void 0===r?void 0:r.cancel(),new Lt("server responded with an error in the response body",{cause:o,response:n})):T('"response" is not a conform '.concat(t," response (unexpected HTTP status code)"),Vn,n)}var i}),Dn.apply(this,arguments)}function jo(n){if(!Wn.has(n))throw R('"options.DPoP" is not a valid DPoPHandle',"ERR_INVALID_ARG_VALUE")}function Do(n){var e;return null===(e=n.headers.get("content-type"))||void 0===e?void 0:e.split(";")[0]}function Un(n,e,t,r,o,i,a){return Nn.apply(this,arguments)}function Nn(){return Nn=(0,h.A)(function*(n,e,t,r,o,i,a){return yield t(n,e,o,i),i.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),(a?.[re]||fetch)(r.href,{body:o,headers:Object.fromEntries(i.entries()),method:"POST",redirect:"manual",signal:Eo(r,a?.signal)})}),Nn.apply(this,arguments)}function ht(n,e,t,r,o,i){return Kn.apply(this,arguments)}function Kn(){return Kn=(0,h.A)(function*(n,e,t,r,o,i){var a;const s=dt(n,"token_endpoint",e.use_mtls_endpoint_aliases,!0!==i?.[Q]);o.set("grant_type",r);const c=Ut(i?.headers);c.set("accept","application/json"),void 0!==i?.DPoP&&(jo(i.DPoP),yield i.DPoP.addProof(s,c,"POST"));const l=yield Un(n,e,t,s,o,c,i);return null==i||null===(a=i.DPoP)||void 0===a||a.cacheNonce(l,s),l}),Kn.apply(this,arguments)}const Uo=new WeakMap,is=new WeakMap;function Ln(n){if(!n.id_token)return;const e=Uo.get(n);if(!e)throw R('"ref" was already garbage collected or did not resolve from the proper sources',"ERR_INVALID_ARG_VALUE");return e}function Be(n,e,t,r,o,i){return Mn.apply(this,arguments)}function Mn(){return Mn=(0,h.A)(function*(n,e,t,r,o,i){if(oe(n),ie(e),!Ze(t,Response))throw R('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");yield jn(t,200,"Token Endpoint"),ft(t);const a=yield Wt(t);if(N(a.access_token,'"response" body "access_token" property',P,{body:a}),N(a.token_type,'"response" body "token_type" property',P,{body:a}),a.token_type=a.token_type.toLowerCase(),void 0!==a.expires_in){let s="number"!=typeof a.expires_in?parseFloat(a.expires_in):a.expires_in;ve(s,!0,'"response" body "expires_in" property',P,{body:a}),a.expires_in=s}if(void 0!==a.refresh_token&&N(a.refresh_token,'"response" body "refresh_token" property',P,{body:a}),void 0!==a.scope&&"string"!=typeof a.scope)throw T('"response" body "scope" property must be a string',P,{body:a});if(void 0!==a.id_token){N(a.id_token,'"response" body "id_token" property',P,{body:a});const s=["aud","exp","iat","iss","sub"];!0===e.require_auth_time&&s.push("auth_time"),void 0!==e.default_max_age&&(ve(e.default_max_age,!0,'"client.default_max_age"'),s.push("auth_time")),null!=r&&r.length&&s.push(...r);const{claims:c,jwt:l}=yield(u=(0,h.A)(function*(f,m,p,g,_){let y,v,{0:w,1:A,length:x}=f.split(".");if(5===x){if(void 0===_)throw new q("JWE decryption is not configured",{cause:f});f=yield _(f),({0:w,1:A,length:x}=f.split("."))}if(3!==x)throw T("Invalid JWT",P,f);try{y=JSON.parse(qe(je(w)))}catch(C){throw T("failed to parse JWT Header body as base64url encoded JSON",Mt,C)}if(!Dt(y))throw T("JWT Header must be a top level object",P,f);if(m(y),void 0!==y.crit)throw new q('no JWT "crit" header parameter extensions are supported',{cause:{header:y}});try{v=JSON.parse(qe(je(A)))}catch(C){throw T("failed to parse JWT Payload body as base64url encoded JSON",Mt,C)}if(!Dt(v))throw T("JWT Payload must be a top level object",P,f);const b=Kt()+p;if(void 0!==v.exp){if("number"!=typeof v.exp)throw T('unexpected JWT "exp" (expiration time) claim type',P,{claims:v});if(v.exp<=b-g)throw T('unexpected JWT "exp" (expiration time) claim value, expiration is past current timestamp',pt,{claims:v,now:b,tolerance:g,claim:"exp"})}if(void 0!==v.iat&&"number"!=typeof v.iat)throw T('unexpected JWT "iat" (issued at) claim type',P,{claims:v});if(void 0!==v.iss&&"string"!=typeof v.iss)throw T('unexpected JWT "iss" (issuer) claim type',P,{claims:v});if(void 0!==v.nbf){if("number"!=typeof v.nbf)throw T('unexpected JWT "nbf" (not before) claim type',P,{claims:v});if(v.nbf>b+g)throw T('unexpected JWT "nbf" (not before) claim value',pt,{claims:v,now:b,tolerance:g,claim:"nbf"})}if(void 0!==v.aud&&"string"!=typeof v.aud&&!Array.isArray(v.aud))throw T('unexpected JWT "aud" (audience) claim type',P,{claims:v});return{header:y,claims:v,jwt:f}}),function(f,m,p,g,_){return u.apply(this,arguments)})(a.id_token,_s.bind(void 0,e.id_token_signed_response_alg,n.id_token_signing_alg_values_supported,"RS256"),Nt(e),In(e),o).then(us.bind(void 0,s)).then(ss.bind(void 0,n)).then(as.bind(void 0,e.client_id));if(Array.isArray(c.aud)&&1!==c.aud.length){if(void 0===c.azp)throw T('ID Token "aud" (audience) claim includes additional untrusted audiences',fe,{claims:c,claim:"aud"});if(c.azp!==e.client_id)throw T('unexpected ID Token "azp" (authorized party) claim value',fe,{expected:e.client_id,claims:c,claim:"azp"})}void 0!==c.auth_time&&ve(c.auth_time,!0,'ID Token "auth_time" (authentication time)',P,{claims:c}),is.set(t,l),Uo.set(a,c)}var u;if(void 0!==i?.[a.token_type])i[a.token_type](t,a);else if("dpop"!==a.token_type&&"bearer"!==a.token_type)throw new q("unsupported `token_type` value",{cause:{body:a}});return a}),Mn.apply(this,arguments)}function as(n,e){if(Array.isArray(e.claims.aud)){if(!e.claims.aud.includes(n))throw T('unexpected JWT "aud" (audience) claim value',fe,{expected:n,claims:e.claims,claim:"aud"})}else if(e.claims.aud!==n)throw T('unexpected JWT "aud" (audience) claim value',fe,{expected:n,claims:e.claims,claim:"aud"});return e}function ss(n,e){var t,r;const o=null!==(t=null===(r=n[zo])||void 0===r?void 0:r.call(n,e))&&void 0!==t?t:n.issuer;if(e.claims.iss!==o)throw T('unexpected JWT "iss" (issuer) claim value',fe,{expected:o,claims:e.claims,claim:"iss"});return e}const Wn=new WeakSet,No=Symbol(),cs={aud:"audience",c_hash:"code hash",client_id:"client id",exp:"expiration time",iat:"issued at",iss:"issuer",jti:"jwt id",nonce:"nonce",s_hash:"state hash",sub:"subject",ath:"access token hash",htm:"http method",htu:"http uri",cnf:"confirmation",auth_time:"authentication time"};function us(n,e){for(const t of n)if(void 0===e.claims[t])throw T('JWT "'.concat(t,'" (').concat(cs[t],") claim missing"),P,{claims:e.claims});return e}const zn=Symbol(),Hn=Symbol();function Jn(){return Jn=(0,h.A)(function*(n,e,t,r){return"string"==typeof r?.expectedNonce||"number"==typeof r?.maxAge||null!=r&&r.requireIdToken?(o=(0,h.A)(function*(i,a,s,c,l,u,f){const m=[];switch(c){case void 0:c=zn;break;case zn:break;default:N(c,'"expectedNonce" argument'),m.push("nonce")}switch(null!=l||(l=a.default_max_age),l){case void 0:l=Hn;break;case Hn:break;default:ve(l,!0,'"maxAge" argument'),m.push("auth_time")}const p=yield Be(i,a,s,m,u,f);N(p.id_token,'"response" body "id_token" property',P,{body:p});const g=Ln(p);if(l!==Hn){const _=Kt()+Nt(a),y=In(a);if(g.auth_time+l<_-y)throw T("too much time has elapsed since the last End-User authentication",pt,{claims:g,now:_,tolerance:y,claim:"auth_time"})}if(c===zn){if(void 0!==g.nonce)throw T('unexpected ID Token "nonce" claim value',fe,{expected:void 0,claims:g,claim:"nonce"})}else if(g.nonce!==c)throw T('unexpected ID Token "nonce" claim value',fe,{expected:c,claims:g,claim:"nonce"});return p}),function(i,a,s,c,l,u,f){return o.apply(this,arguments)})(n,e,t,r.expectedNonce,r.maxAge,r[pe],r.recognizedTokenTypes):function(){var o=(0,h.A)(function*(i,a,s,c,l){const u=yield Be(i,a,s,void 0,c,l),f=Ln(u);if(f){if(void 0!==a.default_max_age){ve(a.default_max_age,!0,'"client.default_max_age"');const m=Kt()+Nt(a),p=In(a);if(f.auth_time+a.default_max_age<m-p)throw T("too much time has elapsed since the last End-User authentication",pt,{claims:f,now:m,tolerance:p,claim:"auth_time"})}if(void 0!==f.nonce)throw T('unexpected ID Token "nonce" claim value',fe,{expected:void 0,claims:f,claim:"nonce"})}return u});return function(i,a,s,c,l){return o.apply(this,arguments)}}()(n,e,t,r?.[pe],r?.recognizedTokenTypes);var o}),Jn.apply(this,arguments)}const ds="OAUTH_WWW_AUTHENTICATE_CHALLENGE",hs="OAUTH_RESPONSE_BODY_ERROR",Fn="OAUTH_UNSUPPORTED_OPERATION",ps="OAUTH_AUTHORIZATION_RESPONSE_ERROR",Mt="OAUTH_PARSE_ERROR",P="OAUTH_INVALID_RESPONSE",Ko="OAUTH_RESPONSE_IS_NOT_JSON",Vn="OAUTH_RESPONSE_IS_NOT_CONFORM",Lo="OAUTH_HTTP_REQUEST_FORBIDDEN",Mo="OAUTH_REQUEST_PROTOCOL_FORBIDDEN",pt="OAUTH_JWT_TIMESTAMP_CHECK_FAILED",fe="OAUTH_JWT_CLAIM_COMPARISON_FAILED",Gn="OAUTH_JSON_ATTRIBUTE_COMPARISON_FAILED",fs="OAUTH_MISSING_SERVER_METADATA",ms="OAUTH_INVALID_SERVER_METADATA";function ft(n){if(n.bodyUsed)throw R('"response" body has been used already',"ERR_INVALID_ARG_VALUE")}function Wo(n){const{algorithm:e}=n;if("number"!=typeof e.modulusLength||e.modulusLength<2048)throw new q("unsupported ".concat(e.name," modulusLength"),{cause:n})}function gs(n){const{algorithm:e}=n;switch(e.namedCurve){case"P-256":return"SHA-256";case"P-384":return"SHA-384";case"P-521":return"SHA-512";default:throw new q("unsupported ECDSA namedCurve",{cause:n})}}function Zn(){return Zn=(0,h.A)(function*(n){if("POST"!==n.method)throw R("form_post responses are expected to use the POST method","ERR_INVALID_ARG_VALUE",{cause:n});if("application/x-www-form-urlencoded"!==Do(n))throw R("form_post responses are expected to use the application/x-www-form-urlencoded content-type","ERR_INVALID_ARG_VALUE",{cause:n});return(e=(0,h.A)(function*(t){if(t.bodyUsed)throw R("form_post Request instances must contain a readable body","ERR_INVALID_ARG_VALUE",{cause:t});return t.text()}),function(t){return e.apply(this,arguments)})(n);var e}),Zn.apply(this,arguments)}function _s(n,e,t,r){if(void 0===n)if(Array.isArray(e)){if(!e.includes(r.alg))throw T('unexpected JWT "alg" header parameter',P,{header:r,expected:e,reason:"authorization server metadata"})}else{if(void 0===t)throw T('missing client or server configuration to verify used JWT "alg" header parameter',void 0,{client:n,issuer:e,fallback:t});if("string"==typeof t?r.alg!==t:"function"==typeof t?!t(r.alg):!t.includes(r.alg))throw T('unexpected JWT "alg" header parameter',P,{header:r,expected:t,reason:"default value"})}else if("string"==typeof n?r.alg!==n:!n.includes(r.alg))throw T('unexpected JWT "alg" header parameter',P,{header:r,expected:n,reason:"client configuration"})}function De(n,e){const{0:t,length:r}=n.getAll(e);if(r>1)throw T('"'.concat(e,'" parameter must be provided only once'),P);return t}const vs=Symbol(),ws=Symbol();function Wt(n){return qn.apply(this,arguments)}function qn(){return qn=(0,h.A)(function*(n){let e,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Co;try{e=yield n.json()}catch(r){throw t(n),T('failed to parse "response" body as JSON',Mt,r)}if(!Dt(e))throw T('"response" body must be a top level object',P,{body:e});return e}),qn.apply(this,arguments)}const Bn=Symbol(),zo=Symbol(),Ho=new TextEncoder,mt=new TextDecoder;function Yn(n){const e=new Uint8Array(n.length);for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);if(r>127)throw new TypeError("non-ASCII string encountered in encode()");e[t]=r}return e}function Jo(n){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(n);const e=atob(n),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}function gt(n){if(Uint8Array.fromBase64)return Uint8Array.fromBase64("string"==typeof n?n:mt.decode(n),{alphabet:"base64url"});let e=n;e instanceof Uint8Array&&(e=mt.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/");try{return Jo(e)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}}class z extends Error{constructor(e,t){var r;super(e,t),k(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,this.constructor)}}k(z,"code","ERR_JOSE_GENERIC");class ae extends z{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unspecified",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unspecified";super(e,{cause:{claim:r,reason:o,payload:t}}),k(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),k(this,"claim",void 0),k(this,"reason",void 0),k(this,"payload",void 0),this.claim=r,this.reason=o,this.payload=t}}k(ae,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class Xn extends z{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unspecified",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unspecified";super(e,{cause:{claim:r,reason:o,payload:t}}),k(this,"code","ERR_JWT_EXPIRED"),k(this,"claim",void 0),k(this,"reason",void 0),k(this,"payload",void 0),this.claim=r,this.reason=o,this.payload=t}}k(Xn,"code","ERR_JWT_EXPIRED");class Fo extends z{constructor(){super(...arguments),k(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}k(Fo,"code","ERR_JOSE_ALG_NOT_ALLOWED");class B extends z{constructor(){super(...arguments),k(this,"code","ERR_JOSE_NOT_SUPPORTED")}}k(B,"code","ERR_JOSE_NOT_SUPPORTED"),k(class extends z{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"decryption operation failed",arguments.length>1?arguments[1]:void 0),k(this,"code","ERR_JWE_DECRYPTION_FAILED")}},"code","ERR_JWE_DECRYPTION_FAILED"),k(class extends z{constructor(){super(...arguments),k(this,"code","ERR_JWE_INVALID")}},"code","ERR_JWE_INVALID");class M extends z{constructor(){super(...arguments),k(this,"code","ERR_JWS_INVALID")}}k(M,"code","ERR_JWS_INVALID");class Qn extends z{constructor(){super(...arguments),k(this,"code","ERR_JWT_INVALID")}}k(Qn,"code","ERR_JWT_INVALID"),k(class extends z{constructor(){super(...arguments),k(this,"code","ERR_JWK_INVALID")}},"code","ERR_JWK_INVALID");class $n extends z{constructor(){super(...arguments),k(this,"code","ERR_JWKS_INVALID")}}k($n,"code","ERR_JWKS_INVALID");class er extends z{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"no applicable key found in the JSON Web Key Set",arguments.length>1?arguments[1]:void 0),k(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}k(er,"code","ERR_JWKS_NO_MATCHING_KEY");class Vo extends z{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"multiple matching keys found in the JSON Web Key Set",arguments.length>1?arguments[1]:void 0),k(this,Symbol.asyncIterator,void 0),k(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}k(Vo,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class Go extends z{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"request timed out",arguments.length>1?arguments[1]:void 0),k(this,"code","ERR_JWKS_TIMEOUT")}}k(Go,"code","ERR_JWKS_TIMEOUT");class Zo extends z{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"signature verification failed",arguments.length>1?arguments[1]:void 0),k(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}k(Zo,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");const se=function(n){return new TypeError("CryptoKey does not support this operation, its ".concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"algorithm.name"," must be ").concat(n))},Ye=(n,e)=>n.name===e;function tr(n){return parseInt(n.name.slice(4),10)}function qo(n,e){for(var t=arguments.length,r=new Array(t>2?t-2:0),o=2;o<t;o++)r[o-2]=arguments[o];if((r=r.filter(Boolean)).length>2){const a=r.pop();n+="one of type ".concat(r.join(", "),", or ").concat(a,".")}else n+=2===r.length?"one of type ".concat(r[0]," or ").concat(r[1],"."):"of type ".concat(r[0],".");if(null==e)n+=" Received ".concat(e);else if("function"==typeof e&&e.name)n+=" Received function ".concat(e.name);else if("object"==typeof e&&null!=e){var i;null!==(i=e.constructor)&&void 0!==i&&i.name&&(n+=" Received an instance of ".concat(e.constructor.name))}return n}const Bo=function(n,e){for(var t=arguments.length,r=new Array(t>2?t-2:0),o=2;o<t;o++)r[o-2]=arguments[o];return qo("Key for the ".concat(n," algorithm must be "),e,...r)},Yo=n=>{if("CryptoKey"===n?.[Symbol.toStringTag])return!0;try{return n instanceof CryptoKey}catch{return!1}},Xo=n=>"KeyObject"===n?.[Symbol.toStringTag],Qo=n=>Yo(n)||Xo(n);function we(n){if("object"!=typeof(e=n)||null===e||"[object Object]"!==Object.prototype.toString.call(n))return!1;var e;if(null===Object.getPrototypeOf(n))return!0;let t=n;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(n)===t}const nr=(n,e)=>{if(n.byteLength!==e.length)return!1;for(let t=0;t<n.byteLength;t++)if(n[t]!==e[t])return!1;return!0},yt=n=>{const e=n.data[n.pos++];if(128&e){const t=127&e;let r=0;for(let o=0;o<t;o++)r=r<<8|n.data[n.pos++];return r}return e},_t=(n,e,t)=>{if(n.data[n.pos++]!==e)throw new Error(t)},$o=(n,e)=>{const t=n.data.subarray(n.pos,n.pos+e);return n.pos+=e,t},As=function(){var n=(0,h.A)(function*(e,t,r,o){var i;let a,s;switch(r){case"PS256":case"PS384":case"PS512":a={name:"RSA-PSS",hash:"SHA-".concat(r.slice(-3))},s=["sign"];break;case"RS256":case"RS384":case"RS512":a={name:"RSASSA-PKCS1-v1_5",hash:"SHA-".concat(r.slice(-3))},s=["sign"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":a={name:"RSA-OAEP",hash:"SHA-".concat(parseInt(r.slice(-3),10)||1)},s=["decrypt","unwrapKey"];break;case"ES256":case"ES384":case"ES512":a={name:"ECDSA",namedCurve:{ES256:"P-256",ES384:"P-384",ES512:"P-521"}[r]},s=["sign"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":try{const l=o.getNamedCurve(t);a="X25519"===l?{name:"X25519"}:{name:"ECDH",namedCurve:l}}catch{throw new B("Invalid or unsupported key format")}s=["deriveBits"];break;case"Ed25519":case"EdDSA":a={name:"Ed25519"},s=["sign"];break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":a={name:r},s=["sign"];break;default:throw new B('Invalid or unsupported "alg" (Algorithm) value')}return crypto.subtle.importKey(e,t,a,null!==(i=o?.extractable)&&void 0!==i&&i,s)});return function(t,r,o,i){return n.apply(this,arguments)}}(),xs=(n,e,t)=>{var r;const o=Jo(n.replace(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,""));let i=t;return null!=e&&null!==(r=e.startsWith)&&void 0!==r&&r.call(e,"ECDH-ES")&&(i||(i={}),i.getNamedCurve=a=>{const s={data:a,pos:0};return function(c){_t(c,48,"Invalid PKCS#8 structure"),yt(c),_t(c,2,"Expected version field");const l=yt(c);c.pos+=l,_t(c,48,"Expected algorithm identifier"),yt(c)}(s),(n=>{const e=(o=>{_t(o,6,"Expected algorithm OID");const i=yt(o);return $o(o,i)})(n);if(nr(e,[43,101,110]))return"X25519";if(!nr(e,[42,134,72,206,61,2,1]))throw new Error("Unsupported key algorithm");_t(n,6,"Expected curve OID");const t=yt(n),r=$o(n,t);for(const{name:o,oid:i}of[{name:"P-256",oid:[42,134,72,206,61,3,1,7]},{name:"P-384",oid:[43,129,4,0,34]},{name:"P-521",oid:[43,129,4,0,35]}])if(nr(r,i))return o;throw new Error("Unsupported named curve")})(s)}),As("pkcs8",o,e,i)};function zt(n){return rr.apply(this,arguments)}function rr(){return rr=(0,h.A)(function*(n){var e,t;if(!n.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:r,keyUsages:o}=function(a){let s,c;switch(a.kty){case"AKP":switch(a.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":s={name:a.alg},c=a.priv?["sign"]:["verify"];break;default:throw new B('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(a.alg){case"PS256":case"PS384":case"PS512":s={name:"RSA-PSS",hash:"SHA-".concat(a.alg.slice(-3))},c=a.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":s={name:"RSASSA-PKCS1-v1_5",hash:"SHA-".concat(a.alg.slice(-3))},c=a.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":s={name:"RSA-OAEP",hash:"SHA-".concat(parseInt(a.alg.slice(-3),10)||1)},c=a.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new B('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(a.alg){case"ES256":s={name:"ECDSA",namedCurve:"P-256"},c=a.d?["sign"]:["verify"];break;case"ES384":s={name:"ECDSA",namedCurve:"P-384"},c=a.d?["sign"]:["verify"];break;case"ES512":s={name:"ECDSA",namedCurve:"P-521"},c=a.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":s={name:"ECDH",namedCurve:a.crv},c=a.d?["deriveBits"]:[];break;default:throw new B('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(a.alg){case"Ed25519":case"EdDSA":s={name:"Ed25519"},c=a.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":s={name:a.crv},c=a.d?["deriveBits"]:[];break;default:throw new B('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new B('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:s,keyUsages:c}}(n),i=E({},n);return"AKP"!==i.kty&&delete i.alg,delete i.use,crypto.subtle.importKey("jwk",i,r,null!==(e=n.ext)&&void 0!==e?e:!n.d&&!n.priv,null!==(t=n.key_ops)&&void 0!==t?t:o)}),rr.apply(this,arguments)}const or=n=>we(n)&&"string"==typeof n.kty;let be;const ei=function(){var n=(0,h.A)(function*(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];be||(be=new WeakMap);let i=be.get(e);if(null!=i&&i[r])return i[r];const a=yield zt(E(E({},t),{},{alg:r}));return o&&Object.freeze(e),i?i[r]=a:be.set(e,{[r]:a}),a});return function(t,r,o){return n.apply(this,arguments)}}();function ir(){return ir=(0,h.A)(function*(n,e){if(n instanceof Uint8Array||Yo(n))return n;if(Xo(n)){if("secret"===n.type)return n.export();if("toCryptoKey"in n&&"function"==typeof n.toCryptoKey)try{return((r,o)=>{be||(be=new WeakMap);let i=be.get(r);if(null!=i&&i[o])return i[o];const a="public"===r.type,s=!!a;let c;if("x25519"===r.asymmetricKeyType){switch(o){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}c=r.toCryptoKey(r.asymmetricKeyType,s,a?[]:["deriveBits"])}if("ed25519"===r.asymmetricKeyType){if("EdDSA"!==o&&"Ed25519"!==o)throw new TypeError("given KeyObject instance cannot be used for this algorithm");c=r.toCryptoKey(r.asymmetricKeyType,s,[a?"verify":"sign"])}switch(r.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":if(o!==r.asymmetricKeyType.toUpperCase())throw new TypeError("given KeyObject instance cannot be used for this algorithm");c=r.toCryptoKey(r.asymmetricKeyType,s,[a?"verify":"sign"])}if("rsa"===r.asymmetricKeyType){let u;switch(o){case"RSA-OAEP":u="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":u="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":u="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":u="SHA-512";break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}if(o.startsWith("RSA-OAEP"))return r.toCryptoKey({name:"RSA-OAEP",hash:u},s,a?["encrypt"]:["decrypt"]);c=r.toCryptoKey({name:o.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:u},s,[a?"verify":"sign"])}if("ec"===r.asymmetricKeyType){var l;const u=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get(null===(l=r.asymmetricKeyDetails)||void 0===l?void 0:l.namedCurve);if(!u)throw new TypeError("given KeyObject instance cannot be used for this algorithm");"ES256"===o&&"P-256"===u&&(c=r.toCryptoKey({name:"ECDSA",namedCurve:u},s,[a?"verify":"sign"])),"ES384"===o&&"P-384"===u&&(c=r.toCryptoKey({name:"ECDSA",namedCurve:u},s,[a?"verify":"sign"])),"ES512"===o&&"P-521"===u&&(c=r.toCryptoKey({name:"ECDSA",namedCurve:u},s,[a?"verify":"sign"])),o.startsWith("ECDH-ES")&&(c=r.toCryptoKey({name:"ECDH",namedCurve:u},s,a?[]:["deriveBits"]))}if(!c)throw new TypeError("given KeyObject instance cannot be used for this algorithm");return i?i[o]=c:be.set(r,{[o]:c}),c})(n,e)}catch(r){if(r instanceof TypeError)throw r}let t=n.export({format:"jwk"});return ei(n,t,e)}if(or(n))return n.k?gt(n.k):ei(n,n,e,!0);throw new Error("unreachable")}),ir.apply(this,arguments)}const Xe=n=>n?.[Symbol.toStringTag],ar=(n,e,t)=>{if(void 0!==e.use){let i;switch(t){case"sign":case"verify":i="sig";break;case"encrypt":case"decrypt":i="enc"}if(e.use!==i)throw new TypeError('Invalid key for this operation, its "use" must be "'.concat(i,'" when present'))}if(void 0!==e.alg&&e.alg!==n)throw new TypeError('Invalid key for this operation, its "alg" must be "'.concat(n,'" when present'));if(Array.isArray(e.key_ops)){var r,o;let i;switch(!0){case"verify"===t:case"dir"===n:case n.includes("CBC-HS"):i=t;break;case n.startsWith("PBES2"):i="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(n):i=!n.includes("GCM")&&n.endsWith("KW")?"unwrapKey":t;break;case"encrypt"===t:i="wrapKey";break;case"decrypt"===t:i=n.startsWith("RSA")?"unwrapKey":"deriveBits"}if(i&&!1===(null===(r=e.key_ops)||void 0===r||null===(o=r.includes)||void 0===o?void 0:o.call(r,i)))throw new TypeError('Invalid key for this operation, its "key_ops" must include "'.concat(i,'" when present'))}return!0};var Ht,sr;let ce,ti;(typeof navigator>"u"||null===(Ht=navigator.userAgent)||void 0===Ht||null===(sr=Ht.startsWith)||void 0===sr||!sr.call(Ht,"Mozilla/5.0 "))&&(ti="".concat("openid-client","/").concat("v6.8.1"),ce={"user-agent":ti});const H=n=>Jt.get(n);let Jt,Ft;function ni(n){return void 0!==n?Io(n):(Ft||(Ft=new WeakMap),(e,t,r,o)=>{let i;return(i=Ft.get(t))||(function(a,s){if("string"!=typeof a)throw ue("".concat(s," must be a string"),wt);if(0===a.length)throw ue("".concat(s," must not be empty"),vt)}(t.client_secret,'"metadata.client_secret"'),i=Io(t.client_secret),Ft.set(t,i)),i(e,t,r,o)})}const Se=re,vt="ERR_INVALID_ARG_VALUE",wt="ERR_INVALID_ARG_TYPE";function ue(n,e,t){const r=new TypeError(n,{cause:t});return Object.assign(r,{code:e}),r}class Vt extends Error{constructor(e,t){var r;super(e,t),k(this,"code",void 0),this.name=this.constructor.name,this.code=t?.code,null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,this.constructor)}}function F(n,e,t){return new Vt(n,{cause:e,code:t})}function V(n){if(n instanceof TypeError||n instanceof Vt||n instanceof Lt||n instanceof Oo||n instanceof On)throw n;if(n instanceof Cn)switch(n.code){case Lo:throw F("only requests to HTTPS are allowed",n,n.code);case Mo:throw F("only requests to HTTP or HTTPS are allowed",n,n.code);case Vn:throw F("unexpected HTTP response status code",n.cause,n.code);case Ko:throw F("unexpected response content-type",n.cause,n.code);case Mt:throw F("parsing error occured",n,n.code);case P:throw F("invalid response encountered",n,n.code);case fe:throw F("unexpected JWT claim value encountered",n,n.code);case Gn:throw F("unexpected JSON attribute value encountered",n,n.code);case pt:throw F("JWT timestamp claim value failed validation",n,n.code);default:throw F(n.message,n,n.code)}if(n instanceof q)throw F("unsupported operation",n,n.code);if(n instanceof DOMException)switch(n.name){case"OperationError":throw F("runtime operation error",n,Fn);case"NotSupportedError":throw F("runtime unsupported operation",n,Fn);case"TimeoutError":throw F("operation timed out",n,"OAUTH_TIMEOUT");case"AbortError":throw F("operation aborted",n,"OAUTH_ABORT")}throw new Vt("something went wrong",{cause:n})}function cr(){return cr=(0,h.A)(function*(n,e,t,r,o){const i=yield(c=(0,h.A)(function*(l,u){var f,m;if(!(l instanceof URL))throw ue('"server" must be an instance of URL',wt);const p=!l.href.includes("/.well-known/"),g=null!==(f=u?.timeout)&&void 0!==f?f:30,_=AbortSignal.timeout(1e3*g),y=yield(p?function Ya(n,e){return Pn.apply(this,arguments)}(l,{algorithm:u?.algorithm,[re]:u?.[Se],[Q]:null==u||null===(m=u.execute)||void 0===m?void 0:m.includes(ci),signal:_,headers:new Headers(ce)}):(u?.[Se]||fetch)((Rn(l,null==u||null===(v=u.execute)||void 0===v||!v.includes(ci)),l.href),{headers:Object.fromEntries(new Headers(E({accept:"application/json"},ce)).entries()),body:void 0,method:"GET",redirect:"manual",signal:_})).then(w=>{return(A=(0,h.A)(function*(x,b){const C=x;if(!(C instanceof URL)&&C!==Bn)throw R('"expectedIssuerIdentifier" must be an instance of URL',"ERR_INVALID_ARG_TYPE");if(!Ze(b,Response))throw R('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");if(200!==b.status)throw T('"response" is not a conform Authorization Server Metadata response (unexpected HTTP status code)',Vn,b);ft(b);const I=yield Wt(b);if(N(I.issuer,'"response" body "issuer" property',P,{body:I}),C!==Bn&&new URL(I.issuer).href!==C.href)throw T('"response" body "issuer" property does not match the expected value',Gn,{expected:C.href,body:I,attribute:"issuer"});return I}),function(x,b){return A.apply(this,arguments)})(Bn,w);var A}).catch(V);var v,x;return p&&new URL(y.issuer).href!==l.href&&(x=u,!("https://login.microsoftonline.com"!==l.origin||null!=x&&x.algorithm&&"oidc"!==x.algorithm||(y[ri]=!0,0))||function(w,A){return!(!w.hostname.endsWith(".b2clogin.com")||null!=A&&A.algorithm&&"oidc"!==A.algorithm)}(l,u)||(()=>{throw new Vt("discovered metadata issuer does not match the expected issuer",{code:Gn,cause:{expected:l.href,body:y,attribute:"issuer"}})})()),y}),function(l,u){return c.apply(this,arguments)})(n,o),a=new Gt(i,e,t,r);var c;let s=H(a);if(null!=o&&o[Se]&&(s.fetch=o[Se]),null!=o&&o.timeout&&(s.timeout=o.timeout),null!=o&&o.execute)for(const c of o.execute)c(a);return a}),cr.apply(this,arguments)}new TextDecoder;const ri=Symbol();class Gt{constructor(e,t,r,o){var i,a,s,c,l;if("string"!=typeof t||!t.length)throw ue('"clientId" must be a non-empty string',wt);if("string"==typeof r&&(r={client_secret:r}),void 0!==(null===(i=r)||void 0===i?void 0:i.client_id)&&t!==r.client_id)throw ue('"clientId" and "metadata.client_id" must be the same',vt);const u=E(E({},structuredClone(r)),{},{client_id:t});let f;u[xn]=null!==(a=null===(s=r)||void 0===s?void 0:s[xn])&&void 0!==a?a:0,u[En]=null!==(c=null===(l=r)||void 0===l?void 0:l[En])&&void 0!==c?c:30,f=o||("string"==typeof u.client_secret&&u.client_secret.length?ni(u.client_secret):(_,y,v,w)=>{v.set("client_id",y.client_id)});let m=Object.freeze(u);const p=structuredClone(e);ri in e&&(p[zo]=_=>{let{claims:{tid:y}}=_;return e.issuer.replace("{tenantid}",y)});let g=Object.freeze(p);Jt||(Jt=new WeakMap),Jt.set(this,{__proto__:null,as:g,c:m,auth:f,tlsOnly:!0,jwksCache:{}})}serverMetadata(){const e=structuredClone(H(this).as);return t=e,Object.defineProperties(t,function(r){return{supportsPKCE:{__proto__:null,value(){var o;return!0===(null===(o=r.code_challenge_methods_supported)||void 0===o?void 0:o.includes(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"S256"))}}}}(t)),e;var t}clientMetadata(){return structuredClone(H(this).c)}get timeout(){return H(this).timeout}set timeout(e){H(this).timeout=e}get[Se](){return H(this).fetch}set[Se](e){H(this).fetch=e}}function bt(n){Object.defineProperties(n,function(e){let t;if(void 0!==e.expires_in){const r=new Date;r.setSeconds(r.getSeconds()+e.expires_in),t=r.getTime()}return{expiresIn:{__proto__:null,value(){if(t){const r=Date.now();return t>r?Math.floor((t-r)/1e3):0}}},claims:{__proto__:null,value(){try{return Ln(this)}catch{return}}}}}(n))}function oi(n,e,t){return ur.apply(this,arguments)}function ur(){return ur=(0,h.A)(function*(n,e,t){var r;let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=null===(r=n.headers.get("retry-after"))||void 0===r?void 0:r.trim();if(void 0===i)return;let a;if(/^\d+$/.test(i))a=parseInt(i,10);else{const s=new Date(i);if(Number.isFinite(s.getTime())){const c=new Date,l=s.getTime()-c.getTime();l>0&&(a=Math.ceil(l/1e3))}}if(o&&!Number.isFinite(a))throw new Cn("invalid Retry-After header value",{cause:n});a>e&&(yield ii(a-e,t))}),ur.apply(this,arguments)}function ii(n,e){return new Promise((t,r)=>{const o=i=>{try{e.throwIfAborted()}catch(s){return void r(s)}if(i<=0)return void t();const a=Math.min(i,5);setTimeout(()=>o(i-a),1e3*a)};o(n)})}function ai(n,e){return lr.apply(this,arguments)}function lr(){return lr=(0,h.A)(function*(n,e){me(n);const{as:t,c:r,auth:o,fetch:i,tlsOnly:a,timeout:s}=H(n);return(c=(0,h.A)(function*(l,u,f,m,p){oe(l),ie(u);const g=dt(l,"backchannel_authentication_endpoint",u.use_mtls_endpoint_aliases,!0!==p?.[Q]),_=new URLSearchParams(m);_.set("client_id",u.client_id);const y=Ut(p?.headers);return y.set("accept","application/json"),Un(l,u,f,g,_,y,p)}),function(l,u,f,m,p){return c.apply(this,arguments)})(t,r,o,e,{[re]:i,[Q]:!a,headers:new Headers(ce),signal:Ue(s)}).then(c=>{return(l=(0,h.A)(function*(u,f,m){if(oe(u),ie(f),!Ze(m,Response))throw R('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");yield jn(m,200,"Backchannel Authentication Endpoint"),ft(m);const p=yield Wt(m);N(p.auth_req_id,'"response" body "auth_req_id" property',P,{body:p});let g="number"!=typeof p.expires_in?parseFloat(p.expires_in):p.expires_in;return ve(g,!0,'"response" body "expires_in" property',P,{body:p}),p.expires_in=g,void 0!==p.interval&&ve(p.interval,!1,'"response" body "interval" property',P,{body:p}),p}),function(u,f,m){return l.apply(this,arguments)})(t,r,c);var l}).catch(V);var c}),lr.apply(this,arguments)}function si(n,e,t,r){return dr.apply(this,arguments)}function dr(){return dr=(0,h.A)(function*(n,e,t,r){var o,i;me(n),t=new URLSearchParams(t);let a=null!==(o=e.interval)&&void 0!==o?o:5;const s=null!==(i=r?.signal)&&void 0!==i?i:AbortSignal.timeout(1e3*e.expires_in);try{yield ii(a,s)}catch(b){V(b)}const{as:c,c:l,auth:u,fetch:f,tlsOnly:m,nonRepudiation:p,timeout:g,decrypt:_}=H(n),y=(b,C)=>si(n,E(E({},e),{},{interval:b}),t,E(E({},r),{},{signal:s,flag:C})),v=yield(b=(0,h.A)(function*(C,I,Y,W,de){oe(C),ie(I),N(W,'"authReqId"');const G=new URLSearchParams(de?.additionalParameters);return G.set("auth_req_id",W),ht(C,I,Y,"urn:openid:params:grant-type:ciba",G,de)}),function(C,I,Y,W,de){return b.apply(this,arguments)})(c,l,u,e.auth_req_id,{[re]:f,[Q]:!m,additionalParameters:t,DPoP:r?.DPoP,headers:new Headers(ce),signal:s.aborted?s:Ue(g)}).catch(V);var b,w;if(503===v.status&&v.headers.has("retry-after"))return yield oi(v,a,s,!0),yield null===(w=v.body)||void 0===w?void 0:w.cancel(),y(a);const A=function(){var b=(0,h.A)(function*(C,I,Y,W){return Be(C,I,Y,void 0,W?.[pe],W?.recognizedTokenTypes)});return function(C,I,Y,W){return b.apply(this,arguments)}}()(c,l,v,{[pe]:_});let x;try{x=yield A}catch(b){if(St(b,r))return y(a,ke);if(b instanceof Lt)switch(b.error){case"slow_down":a+=5;case"authorization_pending":return yield oi(b.response,a,s),y(a)}V(b)}return x.id_token&&(yield p?.(v)),bt(x),x}),dr.apply(this,arguments)}function ci(n){H(n).tlsOnly=!1}function ui(n,e,t,r,o){return hr.apply(this,arguments)}function hr(){return hr=(0,h.A)(function*(n,e,t,r,o){if(me(n),!(o?.flag===ke||e instanceof URL||function(b){try{return"Request"===Object.getPrototypeOf(b)[Symbol.toStringTag]}catch{return!1}}(e)))throw ue('"currentUrl" must be an instance of URL, or Request',wt);let i,a;const{as:s,c,auth:l,fetch:u,tlsOnly:f,jarm:m,hybrid:p,nonRepudiation:g,timeout:_,decrypt:y,implicit:v}=H(n);if(o?.flag===ke)i=o.authResponse,a=o.redirectUri;else{if(!(e instanceof URL)){const b=e;switch(e=new URL(e.url),b.method){case"GET":break;case"POST":const C=new URLSearchParams(yield function ys(n){return Zn.apply(this,arguments)}(b));if(p)e.hash=C.toString();else for(const[I,Y]of C.entries())e.searchParams.append(I,Y);break;default:throw ue("unexpected Request HTTP method",vt)}}switch(b=e,(b=new URL(b)).search="",b.hash="",a=b.href,!0){case!!m:i=yield m(e,t?.expectedState);break;case!!p:i=yield p(e,t?.expectedNonce,t?.expectedState,t?.maxAge);break;case!!v:throw new TypeError("authorizationCodeGrant() cannot be used by response_type=id_token clients");default:try{i=function bs(n,e,t,r){if(oe(n),ie(e),t instanceof URL&&(t=t.searchParams),!(t instanceof URLSearchParams))throw R('"parameters" must be an instance of URLSearchParams, or URL',"ERR_INVALID_ARG_TYPE");if(De(t,"response"))throw T('"parameters" contains a JARM response, use validateJwtAuthResponse() instead of validateAuthResponse()',P,{parameters:t});const o=De(t,"iss"),i=De(t,"state");if(!o&&n.authorization_response_iss_parameter_supported)throw T('response parameter "iss" (issuer) missing',P,{parameters:t});if(o&&o!==n.issuer)throw T('unexpected "iss" (issuer) response parameter value',P,{expected:n.issuer,parameters:t});switch(r){case void 0:case ws:if(void 0!==i)throw T('unexpected "state" response parameter encountered',P,{expected:void 0,parameters:t});break;case vs:break;default:if(N(r,'"expectedState" argument'),i!==r)throw T(void 0===i?'response parameter "state" missing':'unexpected "state" response parameter value',P,{expected:r,parameters:t})}if(De(t,"error"))throw new Oo("authorization response from the server is an error",{cause:t});const a=De(t,"id_token"),s=De(t,"token");if(void 0!==a||void 0!==s)throw new q("implicit and hybrid flows are not supported");return c=new URLSearchParams(t),Wn.add(c),c;var c}(s,c,e.searchParams,t?.expectedState)}catch(b){V(b)}}}var b;const w=yield function(){var b=(0,h.A)(function*(C,I,Y,W,de,G,He){if(oe(C),ie(I),!Wn.has(W))throw R('"callbackParameters" must be an instance of URLSearchParams obtained from "validateAuthResponse()", or "validateJwtAuthResponse()',"ERR_INVALID_ARG_VALUE");N(de,'"redirectUri"');const Ti=De(W,"code");if(!Ti)throw T('no authorization code in "callbackParameters"',P);const $t=new URLSearchParams(He?.additionalParameters);return $t.set("redirect_uri",de),$t.set("code",Ti),G!==No&&(N(G,'"codeVerifier"'),$t.set("code_verifier",G)),ht(C,I,Y,"authorization_code",$t,He)});return function(C,I,Y,W,de,G,He){return b.apply(this,arguments)}}()(s,c,l,i,a,t?.pkceCodeVerifier||No,{additionalParameters:r,[re]:u,[Q]:!f,DPoP:o?.DPoP,headers:new Headers(ce),signal:Ue(_)}).catch(V);"string"!=typeof t?.expectedNonce&&"number"!=typeof t?.maxAge||(t.idTokenExpected=!0);const A=function ls(n,e,t,r){return Jn.apply(this,arguments)}(s,c,w,{expectedNonce:t?.expectedNonce,maxAge:t?.maxAge,requireIdToken:t?.idTokenExpected,[pe]:y});let x;try{x=yield A}catch(b){if(St(b,o))return ui(n,void 0,t,r,E(E({},o),{},{flag:ke,authResponse:i,redirectUri:a}));V(b)}return x.id_token&&(yield g?.(w)),bt(x),x}),hr.apply(this,arguments)}function li(n,e,t,r){return pr.apply(this,arguments)}function pr(){return pr=(0,h.A)(function*(n,e,t,r){me(n),t=new URLSearchParams(t);const{as:o,c:i,auth:a,fetch:s,tlsOnly:c,nonRepudiation:l,timeout:u,decrypt:f}=H(n),m=yield(_=(0,h.A)(function*(y,v,w,A,x){oe(y),ie(v),N(A,'"refreshToken"');const b=new URLSearchParams(x?.additionalParameters);return b.set("refresh_token",A),ht(y,v,w,"refresh_token",b,x)}),function(y,v,w,A,x){return _.apply(this,arguments)})(o,i,a,e,{[re]:s,[Q]:!c,additionalParameters:t,DPoP:r?.DPoP,headers:new Headers(ce),signal:Ue(u)}).catch(V),p=function(){var _=(0,h.A)(function*(y,v,w,A){return Be(y,v,w,void 0,A?.[pe],A?.recognizedTokenTypes)});return function(y,v,w,A){return _.apply(this,arguments)}}()(o,i,m,{[pe]:f});var _;let g;try{g=yield p}catch(_){if(St(_,r))return li(n,e,t,E(E({},r),{},{flag:ke}));V(_)}return g.id_token&&(yield l?.(m)),bt(g),g}),pr.apply(this,arguments)}function di(n,e,t){return fr.apply(this,arguments)}function fr(){return fr=(0,h.A)(function*(n,e,t){me(n),e=new URLSearchParams(e);const{as:r,c:o,auth:i,fetch:a,tlsOnly:s,timeout:c}=H(n),l=yield(m=(0,h.A)(function*(p,g,_,y,v){return oe(p),ie(g),ht(p,g,_,"client_credentials",new URLSearchParams(y),v)}),function(p,g,_,y,v){return m.apply(this,arguments)})(r,o,i,e,{[re]:a,[Q]:!s,DPoP:t?.DPoP,headers:new Headers(ce),signal:Ue(c)}).catch(V),u=function(){var m=(0,h.A)(function*(p,g,_,y){return Be(p,g,_,void 0,void 0,void 0)});return function(p,g,_,y){return m.apply(this,arguments)}}()(r,o,l);var m;let f;try{f=yield u}catch(m){if(St(m,t))return di(n,e,E(E({},t),{},{flag:ke}));V(m)}return bt(f),f}),fr.apply(this,arguments)}function mr(n,e){me(n);const{as:t,c:r,tlsOnly:o,hybrid:i,jarm:a,implicit:s}=H(n),c=dt(t,"authorization_endpoint",!1,o);if((e=new URLSearchParams(e)).has("client_id")||e.set("client_id",r.client_id),!e.has("request_uri")&&!e.has("request")){if(e.has("response_type")||e.set("response_type",i?"code id_token":s?"id_token":"code"),s&&!e.has("nonce"))throw ue("response_type=id_token clients must provide a nonce parameter in their authorization request parameters",vt);a&&e.set("response_mode","jwt")}for(const[l,u]of e.entries())c.searchParams.append(l,u);return c}function hi(n,e,t){return gr.apply(this,arguments)}function gr(){return gr=(0,h.A)(function*(n,e,t){me(n);const r=mr(n,e),{as:o,c:i,auth:a,fetch:s,tlsOnly:c,timeout:l}=H(n),u=yield(p=(0,h.A)(function*(g,_,y,v,w){var A;oe(g),ie(_);const x=dt(g,"pushed_authorization_request_endpoint",_.use_mtls_endpoint_aliases,!0!==w?.[Q]),b=new URLSearchParams(v);b.set("client_id",_.client_id);const C=Ut(w?.headers);C.set("accept","application/json"),void 0!==w?.DPoP&&(jo(w.DPoP),yield w.DPoP.addProof(x,C,"POST"));const I=yield Un(g,_,y,x,b,C,w);return null==w||null===(A=w.DPoP)||void 0===A||A.cacheNonce(I,x),I}),function(g,_,y,v,w){return p.apply(this,arguments)})(o,i,a,r.searchParams,{[re]:s,[Q]:!c,DPoP:t?.DPoP,headers:new Headers(ce),signal:Ue(l)}).catch(V),f=function(){var p=(0,h.A)(function*(g,_,y){if(oe(g),ie(_),!Ze(y,Response))throw R('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");yield jn(y,201,"Pushed Authorization Request Endpoint"),ft(y);const v=yield Wt(y);N(v.request_uri,'"response" body "request_uri" property',P,{body:v});let w="number"!=typeof v.expires_in?parseFloat(v.expires_in):v.expires_in;return ve(w,!0,'"response" body "expires_in" property',P,{body:v}),v.expires_in=w,v});return function(g,_,y){return p.apply(this,arguments)}}()(o,i,u);var p;let m;try{m=yield f}catch(p){if(St(p,t))return hi(n,e,E(E({},t),{},{flag:ke}));V(p)}return mr(n,{request_uri:m.request_uri})}),gr.apply(this,arguments)}function me(n){if(!(n instanceof Gt))throw ue('"config" must be an instance of Configuration',wt);if(Object.getPrototypeOf(n)!==Gt.prototype)throw ue("subclassing Configuration is not allowed",vt)}function Ue(n){return n?AbortSignal.timeout(1e3*n):void 0}function St(n,e){return!(null==e||!e.DPoP||e.flag===ke)&&function(t){if(t instanceof On){const{0:r,length:o}=t.cause;return 1===o&&"dpop"===r.scheme&&"use_dpop_nonce"===r.parameters.error}return t instanceof Lt&&"use_dpop_nonce"===t.error}(n)}Object.freeze(Gt.prototype);const ke=Symbol();function yr(n,e,t,r){return _r.apply(this,arguments)}function _r(){return _r=(0,h.A)(function*(n,e,t,r){me(n);const{as:o,c:i,auth:a,fetch:s,tlsOnly:c,timeout:l,decrypt:u}=H(n),f=yield(m=(0,h.A)(function*(p,g,_,y,v,w){return oe(p),ie(g),N(y,'"grantType"'),ht(p,g,_,y,new URLSearchParams(v),w)}),function(p,g,_,y,v,w){return m.apply(this,arguments)})(o,i,a,e,new URLSearchParams(t),{[re]:s,[Q]:!c,DPoP:void 0,headers:new Headers(ce),signal:Ue(l)}).then(m=>{let p;return"urn:ietf:params:oauth:grant-type:token-exchange"===e&&(p={n_a:()=>{}}),(g=(0,h.A)(function*(_,y,v,w){return Be(_,y,v,void 0,w?.[pe],w?.recognizedTokenTypes)}),function(_,y,v,w){return g.apply(this,arguments)})(o,i,m,{[pe]:u,recognizedTokenTypes:p});var g}).catch(V);var m;return bt(f),f}),_r.apply(this,arguments)}function vr(){return vr=(0,h.A)(function*(n,e,t){if(e instanceof Uint8Array){if(!n.startsWith("HS"))throw new TypeError(function(r){for(var o=arguments.length,i=new Array(o>1?o-1:0),a=1;a<o;a++)i[a-1]=arguments[a];return qo("Key must be ",r,...i)}(e,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",e,{hash:"SHA-".concat(n.slice(-3)),name:"HMAC"},!1,[t])}return function Ss(n,e,t){switch(e){case"HS256":case"HS384":case"HS512":{if(!Ye(n.algorithm,"HMAC"))throw se("HMAC");const r=parseInt(e.slice(2),10);if(tr(n.algorithm.hash)!==r)throw se("SHA-".concat(r),"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!Ye(n.algorithm,"RSASSA-PKCS1-v1_5"))throw se("RSASSA-PKCS1-v1_5");const r=parseInt(e.slice(2),10);if(tr(n.algorithm.hash)!==r)throw se("SHA-".concat(r),"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!Ye(n.algorithm,"RSA-PSS"))throw se("RSA-PSS");const r=parseInt(e.slice(2),10);if(tr(n.algorithm.hash)!==r)throw se("SHA-".concat(r),"algorithm.hash");break}case"Ed25519":case"EdDSA":if(!Ye(n.algorithm,"Ed25519"))throw se("Ed25519");break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":if(!Ye(n.algorithm,e))throw se(e);break;case"ES256":case"ES384":case"ES512":{if(!Ye(n.algorithm,"ECDSA"))throw se("ECDSA");const r=function(o){switch(o){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}(e);if(n.algorithm.namedCurve!==r)throw se(r,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}!function(r,o){if(!r.usages.includes(o))throw new TypeError("CryptoKey does not support this operation, its usages must include ".concat(o,"."))}(n,t)}(e,n,t),e}),vr.apply(this,arguments)}function wr(){return wr=(0,h.A)(function*(n,e,t,r){const o=yield function Rs(n,e,t){return vr.apply(this,arguments)}(n,e,"verify");!function(a,s){if(a.startsWith("RS")||a.startsWith("PS")){const{modulusLength:c}=s.algorithm;if("number"!=typeof c||c<2048)throw new TypeError("".concat(a," requires key modulusLength to be 2048 bits or larger"))}}(n,o);const i=function(a,s){const c="SHA-".concat(a.slice(-3));switch(a){case"HS256":case"HS384":case"HS512":return{hash:c,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:c,name:"RSA-PSS",saltLength:parseInt(a.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:c,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:c,name:"ECDSA",namedCurve:s.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return{name:a};default:throw new B("alg ".concat(a," is not supported either by JOSE or your javascript runtime"))}}(n,o.algorithm);try{return yield crypto.subtle.verify(i,o,t,r)}catch{return!1}}),wr.apply(this,arguments)}function br(){return br=(0,h.A)(function*(n,e,t){if(!we(n))throw new M("Flattened JWS must be an object");if(void 0===n.protected&&void 0===n.header)throw new M('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==n.protected&&"string"!=typeof n.protected)throw new M("JWS Protected Header incorrect type");if(void 0===n.payload)throw new M("JWS Payload missing");if("string"!=typeof n.signature)throw new M("JWS Signature missing or incorrect type");if(void 0!==n.header&&!we(n.header))throw new M("JWS Unprotected Header incorrect type");let r={};if(n.protected)try{const _=gt(n.protected);r=JSON.parse(mt.decode(_))}catch{throw new M("JWS Protected Header is invalid")}if(!function(){for(var _=arguments.length,y=new Array(_),v=0;v<_;v++)y[v]=arguments[v];const w=y.filter(Boolean);if(0===w.length||1===w.length)return!0;let A;for(const x of w){const b=Object.keys(x);if(A&&0!==A.size)for(const C of b){if(A.has(C))return!1;A.add(C)}else A=new Set(b)}return!0}(r,n.header))throw new M("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const o=E(E({},r),n.header);let a=!0;if(function(_,y,v,w,A){if(void 0!==A.crit&&void 0===w?.crit)throw new _('"crit" (Critical) Header Parameter MUST be integrity protected');if(!w||void 0===w.crit)return new Set;if(!Array.isArray(w.crit)||0===w.crit.length||w.crit.some(b=>"string"!=typeof b||0===b.length))throw new _('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let x;x=void 0!==v?new Map([...Object.entries(v),...y.entries()]):y;for(const b of w.crit){if(!x.has(b))throw new B('Extension Header Parameter "'.concat(b,'" is not recognized'));if(void 0===A[b])throw new _('Extension Header Parameter "'.concat(b,'" is missing'));if(x.get(b)&&void 0===w[b])throw new _('Extension Header Parameter "'.concat(b,'" MUST be integrity protected'))}return new Set(w.crit)}(M,new Map([["b64",!0]]),t?.crit,r,o).has("b64")&&(a=r.b64,"boolean"!=typeof a))throw new M('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:s}=o;if("string"!=typeof s||!s)throw new M('JWS "alg" (Algorithm) Header Parameter missing or invalid');const c=t&&function(_,y){if(void 0!==y&&(!Array.isArray(y)||y.some(v=>"string"!=typeof v)))throw new TypeError('"'.concat("algorithms",'" option must be an array of strings'));if(y)return new Set(y)}(0,t.algorithms);if(c&&!c.has(s))throw new Fo('"alg" (Algorithm) Header Parameter value not allowed');if(a){if("string"!=typeof n.payload)throw new M("JWS Payload must be a string")}else if("string"!=typeof n.payload&&!(n.payload instanceof Uint8Array))throw new M("JWS Payload must be a string or an Uint8Array instance");let l=!1;"function"==typeof e&&(e=yield e(r,n),l=!0),function Ts(n,e,t){switch(n.substring(0,2)){case"A1":case"A2":case"di":case"HS":case"PB":((r,o,i)=>{if(!(o instanceof Uint8Array)){if(or(o)){if("oct"===(a=o).kty&&"string"==typeof a.k&&ar(r,o,i))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Qo(o))throw new TypeError(Bo(r,o,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if("secret"!==o.type)throw new TypeError("".concat(Xe(o),' instances for symmetric algorithms must be of type "secret"'))}var a})(n,e,t);break;default:((r,o,i)=>{if(or(o))switch(i){case"decrypt":case"sign":if("oct"!==(a=o).kty&&("AKP"===a.kty&&"string"==typeof a.priv||"string"==typeof a.d)&&ar(r,o,i))return;throw new TypeError("JSON Web Key for this operation must be a private JWK");case"encrypt":case"verify":if((a=>"oct"!==a.kty&&void 0===a.d&&void 0===a.priv)(o)&&ar(r,o,i))return;throw new TypeError("JSON Web Key for this operation must be a public JWK")}var a;if(!Qo(o))throw new TypeError(Bo(r,o,"CryptoKey","KeyObject","JSON Web Key"));if("secret"===o.type)throw new TypeError("".concat(Xe(o),' instances for asymmetric algorithms must not be of type "secret"'));if("public"===o.type)switch(i){case"sign":throw new TypeError("".concat(Xe(o),' instances for asymmetric algorithm signing must be of type "private"'));case"decrypt":throw new TypeError("".concat(Xe(o),' instances for asymmetric algorithm decryption must be of type "private"'))}if("private"===o.type)switch(i){case"verify":throw new TypeError("".concat(Xe(o),' instances for asymmetric algorithm verifying must be of type "public"'));case"encrypt":throw new TypeError("".concat(Xe(o),' instances for asymmetric algorithm encryption must be of type "public"'))}})(n,e,t)}}(s,e,"verify");const u=function(){for(var _=arguments.length,y=new Array(_),v=0;v<_;v++)y[v]=arguments[v];const w=y.reduce((b,C)=>{let{length:I}=C;return b+I},0),A=new Uint8Array(w);let x=0;for(const b of y)A.set(b,x),x+=b.length;return A}(void 0!==n.protected?Yn(n.protected):new Uint8Array,Yn("."),"string"==typeof n.payload?a?Yn(n.payload):Ho.encode(n.payload):n.payload);let f;try{f=gt(n.signature)}catch{throw new M("Failed to base64url decode the signature")}const m=yield function Es(n,e){return ir.apply(this,arguments)}(e,s);if(!(yield function Os(n,e,t,r){return wr.apply(this,arguments)}(s,m,f,u)))throw new Zo;let p;if(a)try{p=gt(n.payload)}catch{throw new M("Failed to base64url decode the payload")}else p="string"==typeof n.payload?Ho.encode(n.payload):n.payload;const g={payload:p};return void 0!==n.protected&&(g.protectedHeader=r),void 0!==n.header&&(g.unprotectedHeader=n.header),l?E(E({},g),{},{key:m}):g}),br.apply(this,arguments)}const Us=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;function pi(n){const e=Us.exec(n);if(!e||e[4]&&e[1])throw new TypeError("Invalid time period format");const t=parseFloat(e[2]);let r;switch(e[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":r=Math.round(t);break;case"minute":case"minutes":case"min":case"mins":case"m":r=Math.round(60*t);break;case"hour":case"hours":case"hr":case"hrs":case"h":r=Math.round(3600*t);break;case"day":case"days":case"d":r=Math.round(86400*t);break;case"week":case"weeks":case"w":r=Math.round(604800*t);break;default:r=Math.round(31557600*t)}return"-"===e[1]||"ago"===e[4]?-r:r}const fi=n=>n.includes("/")?n.toLowerCase():"application/".concat(n.toLowerCase());function Sr(){return Sr=(0,h.A)(function*(n,e,t){var r;const o=yield(s=(0,h.A)(function*(c,l,u){if(c instanceof Uint8Array&&(c=mt.decode(c)),"string"!=typeof c)throw new M("Compact JWS must be a string or Uint8Array");const{0:f,1:m,2:p,length:g}=c.split(".");if(3!==g)throw new M("Invalid Compact JWS");const _=yield function js(n,e,t){return br.apply(this,arguments)}({payload:m,protected:f,signature:p},l,u),y={payload:_.payload,protectedHeader:_.protectedHeader};return"function"==typeof l?E(E({},y),{},{key:_.key}):y}),function(c,l,u){return s.apply(this,arguments)})(n,e,t);var s;if(null!==(r=o.protectedHeader.crit)&&void 0!==r&&r.includes("b64")&&!1===o.protectedHeader.b64)throw new Qn("JWTs MUST NOT use unencoded payload");const i=function(s,c){let l,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{l=JSON.parse(mt.decode(c))}catch{}if(!we(l))throw new Qn("JWT Claims Set must be a top-level JSON object");const{typ:f}=u;if(f&&("string"!=typeof s.typ||fi(s.typ)!==fi(f)))throw new ae('unexpected "typ" JWT header value',l,"typ","check_failed");const{requiredClaims:m=[],issuer:p,subject:g,audience:_,maxTokenAge:y}=u,v=[...m];void 0!==y&&v.push("iat"),void 0!==_&&v.push("aud"),void 0!==g&&v.push("sub"),void 0!==p&&v.push("iss");for(const b of new Set(v.reverse()))if(!(b in l))throw new ae('missing required "'.concat(b,'" claim'),l,b,"missing");if(p&&!(Array.isArray(p)?p:[p]).includes(l.iss))throw new ae('unexpected "iss" claim value',l,"iss","check_failed");if(g&&l.sub!==g)throw new ae('unexpected "sub" claim value',l,"sub","check_failed");if(_&&!((n,e)=>"string"==typeof n?e.includes(n):!!Array.isArray(n)&&e.some(Set.prototype.has.bind(new Set(n))))(l.aud,"string"==typeof _?[_]:_))throw new ae('unexpected "aud" claim value',l,"aud","check_failed");let w;switch(typeof u.clockTolerance){case"string":w=pi(u.clockTolerance);break;case"number":w=u.clockTolerance;break;case"undefined":w=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:A}=u,x=(n=>Math.floor(n.getTime()/1e3))(A||new Date);if((void 0!==l.iat||y)&&"number"!=typeof l.iat)throw new ae('"iat" claim must be a number',l,"iat","invalid");if(void 0!==l.nbf){if("number"!=typeof l.nbf)throw new ae('"nbf" claim must be a number',l,"nbf","invalid");if(l.nbf>x+w)throw new ae('"nbf" claim timestamp check failed',l,"nbf","check_failed")}if(void 0!==l.exp){if("number"!=typeof l.exp)throw new ae('"exp" claim must be a number',l,"exp","invalid");if(l.exp<=x-w)throw new Xn('"exp" claim timestamp check failed',l,"exp","check_failed")}if(y){const b=x-l.iat;if(b-w>("number"==typeof y?y:pi(y)))throw new Xn('"iat" claim timestamp check failed (too far in the past)',l,"iat","check_failed");if(b<0-w)throw new ae('"iat" claim timestamp check failed (it should be in the past)',l,"iat","check_failed")}return l}(o.protectedHeader,o.payload,t),a={payload:i,protectedHeader:o.protectedHeader};return"function"==typeof e?E(E({},a),{},{key:o.key}):a}),Sr.apply(this,arguments)}function Ls(n){return we(n)}var Zt,kr,qt=new WeakMap,Ar=new WeakMap;class Ms{constructor(e){if(L(this,qt,void 0),L(this,Ar,new WeakMap),!((t=e)&&"object"==typeof t&&Array.isArray(t.keys)&&t.keys.every(Ls)))throw new $n("JSON Web Key Set malformed");var t;D(qt,this,structuredClone(e))}jwks(){return S(qt,this)}getKey(e,t){var r=this;return(0,h.A)(function*(){const{alg:o,kid:i}=E(E({},e),t?.header),a=function(u){switch("string"==typeof u&&u.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";case"ML":return"AKP";default:throw new B('Unsupported "alg" value for a JSON Web Key Set')}}(o),s=S(qt,r).keys.filter(u=>{let f=a===u.kty;if(f&&"string"==typeof i&&(f=i===u.kid),!f||"string"!=typeof u.alg&&"AKP"!==a||(f=o===u.alg),f&&"string"==typeof u.use&&(f="sig"===u.use),f&&Array.isArray(u.key_ops)&&(f=u.key_ops.includes("verify")),f)switch(o){case"ES256":f="P-256"===u.crv;break;case"ES384":f="P-384"===u.crv;break;case"ES512":f="P-521"===u.crv;break;case"Ed25519":case"EdDSA":f="Ed25519"===u.crv}return f}),{0:c,length:l}=s;if(0===l)throw new er;if(1!==l){const u=new Vo,f=S(Ar,r);throw u[Symbol.asyncIterator]=function Ga(n){return function(){return new lt(n.apply(this,arguments))}}(function*(){for(const m of s)try{yield yield Va(mi(f,m,o))}catch{}}),u}return mi(S(Ar,r),c,o)})()}}function mi(n,e,t){return xr.apply(this,arguments)}function xr(){return xr=(0,h.A)(function*(n,e,t){const r=n.get(e)||n.set(e,{}).get(e);if(void 0===r[t]){const o=yield(i=(0,h.A)(function*(a,s,c){if(!we(a))throw new TypeError("JWK must be an object");let u;switch(null!=s||(s=a.alg),null!=u||(u=a.ext),a.kty){case"oct":if("string"!=typeof a.k||!a.k)throw new TypeError('missing "k" (Key Value) Parameter value');return gt(a.k);case"RSA":if("oth"in a&&void 0!==a.oth)throw new B('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');return zt(E(E({},a),{},{alg:s,ext:u}));case"AKP":if("string"!=typeof a.alg||!a.alg)throw new TypeError('missing "alg" (Algorithm) Parameter value');if(void 0!==s&&s!==a.alg)throw new TypeError("JWK alg and alg option value mismatch");return zt(E(E({},a),{},{ext:u}));case"EC":case"OKP":return zt(E(E({},a),{},{alg:s,ext:u}));default:throw new B('Unsupported "kty" (Key Type) Parameter value')}}),function(a,s,c){return i.apply(this,arguments)})(E(E({},e),{},{ext:!0}),t);if(o instanceof Uint8Array||"public"!==o.type)throw new $n("JSON Web Key Set members must be public keys");r[t]=o}var i;return r[t]}),xr.apply(this,arguments)}function gi(n){const e=new Ms(n),t=function(){var r=(0,h.A)(function*(o,i){return e.getKey(o,i)});return function(i,a){return r.apply(this,arguments)}}();return Object.defineProperties(t,{jwks:{value:()=>structuredClone(e.jwks()),enumerable:!1,configurable:!1,writable:!1}}),t}let Er;(typeof navigator>"u"||null===(Zt=navigator.userAgent)||void 0===Zt||null===(kr=Zt.startsWith)||void 0===kr||!kr.call(Zt,"Mozilla/5.0 "))&&(Er="".concat("jose","/").concat("v6.1.3"));const yi=Symbol(),Tr=Symbol();var Cr=new WeakMap,Pr=new WeakMap,Ir=new WeakMap,Bt=new WeakMap,Ne=new WeakMap,ge=new WeakMap,Ae=new WeakMap,Rr=new WeakMap,Ke=new WeakMap,Le=new WeakMap;class Ws{constructor(e,t){if(L(this,Cr,void 0),L(this,Pr,void 0),L(this,Ir,void 0),L(this,Bt,void 0),L(this,Ne,void 0),L(this,ge,void 0),L(this,Ae,void 0),L(this,Rr,void 0),L(this,Ke,void 0),L(this,Le,void 0),!(e instanceof URL))throw new TypeError("url must be an instance of URL");var r,o;D(Cr,this,new URL(e.href)),D(Pr,this,"number"==typeof t?.timeoutDuration?t?.timeoutDuration:5e3),D(Ir,this,"number"==typeof t?.cooldownDuration?t?.cooldownDuration:3e4),D(Bt,this,"number"==typeof t?.cacheMaxAge?t?.cacheMaxAge:6e5),D(Ae,this,new Headers(t?.headers)),Er&&!S(Ae,this).has("User-Agent")&&S(Ae,this).set("User-Agent",Er),S(Ae,this).has("accept")||(S(Ae,this).set("accept","application/json"),S(Ae,this).append("accept","application/jwk-set+json")),D(Rr,this,t?.[yi]),void 0!==t?.[Tr]&&(D(Le,this,t?.[Tr]),r=t?.[Tr],o=S(Bt,this),"object"==typeof r&&null!==r&&"uat"in r&&"number"==typeof r.uat&&!(Date.now()-r.uat>=o)&&"jwks"in r&&we(r.jwks)&&Array.isArray(r.jwks.keys)&&Array.prototype.every.call(r.jwks.keys,we)&&(D(Ne,this,S(Le,this).uat),D(Ke,this,gi(S(Le,this).jwks))))}pendingFetch(){return!!S(ge,this)}coolingDown(){return"number"==typeof S(Ne,this)&&Date.now()<S(Ne,this)+S(Ir,this)}fresh(){return"number"==typeof S(Ne,this)&&Date.now()<S(Ne,this)+S(Bt,this)}jwks(){var e;return null===(e=S(Ke,this))||void 0===e?void 0:e.jwks()}getKey(e,t){var r=this;return(0,h.A)(function*(){S(Ke,r)&&r.fresh()||(yield r.reload());try{return yield S(Ke,r).call(r,e,t)}catch(o){if(o instanceof er&&!1===r.coolingDown())return yield r.reload(),S(Ke,r).call(r,e,t);throw o}})()}reload(){var e=this;return(0,h.A)(function*(){var t;S(ge,e)&&(typeof WebSocketPair<"u"||typeof navigator<"u"&&"Cloudflare-Workers"===navigator.userAgent||typeof EdgeRuntime<"u"&&"vercel"===EdgeRuntime)&&D(ge,e,void 0),S(ge,e)||D(ge,e,(t=(0,h.A)(function*(r,o,i){const s=yield(arguments.length>3&&void 0!==arguments[3]?arguments[3]:fetch)(r,{method:"GET",signal:i,redirect:"manual",headers:o}).catch(c=>{throw"TimeoutError"===c.name?new Go:c});if(200!==s.status)throw new z("Expected 200 OK from the JSON Web Key Set HTTP response");try{return yield s.json()}catch{throw new z("Failed to parse the JSON Web Key Set HTTP response as JSON")}}),function(r,o,i){return t.apply(this,arguments)})(S(Cr,e).href,S(Ae,e),AbortSignal.timeout(S(Pr,e)),S(Rr,e)).then(t=>{D(Ke,e,gi(t)),S(Le,e)&&(S(Le,e).uat=Date.now(),S(Le,e).jwks=t),D(Ne,e,Date.now()),D(ge,e,void 0)}).catch(t=>{throw D(ge,e,void 0),t})),yield S(ge,e)})()}}const zs=["mfaToken"],Hs=["mfaToken"];var Me,Yt,We,xe,Qe,O,kt,K,_i=class extends Error{constructor(n,e){super(e),k(this,"code",void 0),this.name="NotSupportedError",this.code=n}},ye=class extends Error{constructor(n,e,t){super(e),k(this,"cause",void 0),k(this,"code",void 0),this.code=n,this.cause=t&&{error:t.error,error_description:t.error_description,message:t.message}}},Js=class extends ye{constructor(n,e){super("token_by_code_error",n,e),this.name="TokenByCodeError"}},Fs=class extends ye{constructor(n,e){super("token_by_client_credentials_error",n,e),this.name="TokenByClientCredentialsError"}},Vs=class extends ye{constructor(n,e){super("token_by_refresh_token_error",n,e),this.name="TokenByRefreshTokenError"}},Or=class extends ye{constructor(n,e){super("token_for_connection_error",n,e),this.name="TokenForConnectionErrorCode"}},le=class extends ye{constructor(n,e){super("token_exchange_error",n,e),this.name="TokenExchangeError"}},Ee=class extends Error{constructor(n){super(n),k(this,"code","verify_logout_token_error"),this.name="VerifyLogoutTokenError"}},jr=class extends ye{constructor(n){super("backchannel_authentication_error","There was an error when trying to use Client-Initiated Backchannel Authentication.",n),k(this,"code","backchannel_authentication_error"),this.name="BackchannelAuthenticationError"}},Gs=class extends ye{constructor(n){super("build_authorization_url_error","There was an error when trying to build the authorization URL.",n),this.name="BuildAuthorizationUrlError"}},Zs=class extends ye{constructor(n){super("build_link_user_url_error","There was an error when trying to build the Link User URL.",n),this.name="BuildLinkUserUrlError"}},qs=class extends ye{constructor(n){super("build_unlink_user_url_error","There was an error when trying to build the Unlink User URL.",n),this.name="BuildUnlinkUserUrlError"}},Bs=class extends Error{constructor(){super("The client secret or client assertion signing key must be provided."),k(this,"code","missing_client_auth_error"),this.name="MissingClientAuthError"}};function Dr(n){return Object.entries(n).filter(e=>{let[,t]=e;return void 0!==t}).reduce((e,t)=>E(E({},e),{},{[t[0]]:t[1]}),{})}var Xt=class extends Error{constructor(n,e,t){super(e),k(this,"cause",void 0),k(this,"code",void 0),this.code=n,this.cause=t&&{error:t.error,error_description:t.error_description,message:t.message}}},vi=class extends Xt{constructor(n,e){super("mfa_list_authenticators_error",n,e),this.name="MfaListAuthenticatorsError"}},wi=class extends Xt{constructor(n,e){super("mfa_enrollment_error",n,e),this.name="MfaEnrollmentError"}},Ys=class extends Xt{constructor(n,e){super("mfa_delete_authenticator_error",n,e),this.name="MfaDeleteAuthenticatorError"}},bi=class extends Xt{constructor(n,e){super("mfa_challenge_error",n,e),this.name="MfaChallengeError"}};function Xs(n){return{id:n.id,authenticatorType:n.authenticator_type,active:n.active,name:n.name,oobChannels:n.oob_channels,type:n.type}}var Qs=(Me=new WeakMap,Yt=new WeakMap,We=new WeakMap,class{constructor(n){var e;L(this,Me,void 0),L(this,Yt,void 0),L(this,We,void 0),D(Me,this,"https://".concat(n.domain)),D(Yt,this,n.clientId),D(We,this,null!==(e=n.customFetch)&&void 0!==e?e:function(){return fetch(...arguments)})}listAuthenticators(n){var e=this;return(0,h.A)(function*(){const t="".concat(S(Me,e),"/mfa/authenticators"),{mfaToken:r}=n,o=yield S(We,e).call(e,t,{method:"GET",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}});if(!o.ok){const i=yield o.json();throw new vi(i.error_description||"Failed to list authenticators",i)}return(yield o.json()).map(Xs)})()}enrollAuthenticator(n){var e=this;return(0,h.A)(function*(){const t="".concat(S(Me,e),"/mfa/associate"),{mfaToken:r}=n,o=Ao(n,zs),i={authenticator_types:o.authenticatorTypes};"oobChannels"in o&&(i.oob_channels=o.oobChannels),"phoneNumber"in o&&o.phoneNumber&&(i.phone_number=o.phoneNumber),"email"in o&&o.email&&(i.email=o.email);const a=yield S(We,e).call(e,t,{method:"POST",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"},body:JSON.stringify(i)});if(!a.ok){const s=yield a.json();throw new wi(s.error_description||"Failed to enroll authenticator",s)}return function(s){if("otp"===s.authenticator_type)return{authenticatorType:"otp",secret:s.secret,barcodeUri:s.barcode_uri,recoveryCodes:s.recovery_codes,id:s.id};if("oob"===s.authenticator_type)return{authenticatorType:"oob",oobChannel:s.oob_channel,oobCode:s.oob_code,bindingMethod:s.binding_method,id:s.id};throw new Error("Unexpected authenticator type: ".concat(s.authenticator_type))}(yield a.json())})()}deleteAuthenticator(n){var e=this;return(0,h.A)(function*(){const{authenticatorId:t,mfaToken:r}=n,o="".concat(S(Me,e),"/mfa/authenticators/").concat(encodeURIComponent(t)),i=yield S(We,e).call(e,o,{method:"DELETE",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}});if(!i.ok){const a=yield i.json();throw new Ys(a.error_description||"Failed to delete authenticator",a)}})()}challengeAuthenticator(n){var e=this;return(0,h.A)(function*(){const t="".concat(S(Me,e),"/mfa/challenge"),{mfaToken:r}=n,o=Ao(n,Hs),i={mfa_token:r,client_id:S(Yt,e),challenge_type:o.challengeType};o.authenticatorId&&(i.authenticator_id=o.authenticatorId);const a=yield S(We,e).call(e,t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!a.ok){const s=yield a.json();throw new bi(s.error_description||"Failed to challenge authenticator",s)}return function(s){const c={challengeType:s.challenge_type};return void 0!==s.oob_code&&(c.oobCode=s.oob_code),void 0!==s.binding_method&&(c.bindingMethod=s.binding_method),c}(yield a.json())})()}}),ze=class Ci{constructor(e,t,r,o,i,a,s){k(this,"accessToken",void 0),k(this,"idToken",void 0),k(this,"refreshToken",void 0),k(this,"expiresAt",void 0),k(this,"scope",void 0),k(this,"claims",void 0),k(this,"authorizationDetails",void 0),k(this,"tokenType",void 0),k(this,"issuedTokenType",void 0),this.accessToken=e,this.idToken=r,this.refreshToken=o,this.expiresAt=t,this.scope=i,this.claims=a,this.authorizationDetails=s}static fromTokenEndpointResponse(e){const t=e.id_token?e.claims():void 0,r=new Ci(e.access_token,Math.floor(Date.now()/1e3)+Number(e.expires_in),e.id_token,e.refresh_token,e.scope,t,e.authorization_details);return r.tokenType=e.token_type,r.issuedTokenType=e.issued_token_type,r}},Ur="openid profile email offline_access",$s=Object.freeze(new Set(["grant_type","client_id","client_secret","client_assertion","client_assertion_type","subject_token","subject_token_type","requested_token_type","actor_token","actor_token_type","audience","aud","resource","resources","resource_indicator","scope","connection","login_hint","organization","assertion"]));function Si(n){if(null==n)throw new le("subject_token is required");if("string"!=typeof n)throw new le("subject_token must be a string");if(0===n.trim().length)throw new le("subject_token cannot be blank or whitespace");if(n!==n.trim())throw new le("subject_token must not include leading or trailing whitespace");if(/^bearer\s+/i.test(n))throw new le("subject_token must not include the 'Bearer ' prefix")}function ki(n,e){if(e)for(const[t,r]of Object.entries(e))if(!$s.has(t))if(Array.isArray(r)){if(r.length>20)throw new le("Parameter '".concat(t,"' exceeds maximum array size of ").concat(20));r.forEach(o=>{n.append(t,o)})}else n.append(t,r)}var ec=(xe=new WeakMap,Qe=new WeakMap,O=new WeakMap,kt=new WeakMap,K=new WeakSet,class{constructor(n){if(So(this,t=K),t.add(this),L(this,xe,void 0),L(this,Qe,void 0),L(this,O,void 0),L(this,kt,void 0),k(this,"mfa",void 0),D(O,this,n),n.useMtls&&!n.customFetch)throw new _i("mtls_without_custom_fetch_not_supported","Using mTLS without a custom fetch implementation is not supported");var t;this.mfa=new Qs({domain:S(O,this).domain,clientId:S(O,this).clientId,customFetch:S(O,this).customFetch})}buildAuthorizationUrl(n){var e=this;return(0,h.A)(function*(){const{serverMetadata:t}=yield U(K,e,$).call(e);if(null!=n&&n.pushedAuthorizationRequests&&!t.pushed_authorization_request_endpoint)throw new _i("par_not_supported_error","The Auth0 tenant does not have pushed authorization requests enabled. Learn how to enable it here: https://auth0.com/docs/get-started/applications/configure-par");try{return yield U(K,e,Wr).call(e,n)}catch(r){throw new Gs(r)}})()}buildLinkUserUrl(n){var e=this;return(0,h.A)(function*(){try{const t=yield U(K,e,Wr).call(e,{authorizationParams:E(E({},n.authorizationParams),{},{requested_connection:n.connection,requested_connection_scope:n.connectionScope,scope:"openid link_account offline_access",id_token_hint:n.idToken})});return{linkUserUrl:t.authorizationUrl,codeVerifier:t.codeVerifier}}catch(t){throw new Zs(t)}})()}buildUnlinkUserUrl(n){var e=this;return(0,h.A)(function*(){try{const t=yield U(K,e,Wr).call(e,{authorizationParams:E(E({},n.authorizationParams),{},{requested_connection:n.connection,scope:"openid unlink_account",id_token_hint:n.idToken})});return{unlinkUserUrl:t.authorizationUrl,codeVerifier:t.codeVerifier}}catch(t){throw new qs(t)}})()}backchannelAuthentication(n){var e=this;return(0,h.A)(function*(){const{configuration:t,serverMetadata:r}=yield U(K,e,$).call(e),o=Dr(E(E({},S(O,e).authorizationParams),n?.authorizationParams)),i=new URLSearchParams(E(E({scope:Ur},o),{},{client_id:S(O,e).clientId,binding_message:n.bindingMessage,login_hint:JSON.stringify({format:"iss_sub",iss:r.issuer,sub:n.loginHint.sub})}));n.requestedExpiry&&i.append("requested_expiry",n.requestedExpiry.toString()),n.authorizationDetails&&i.append("authorization_details",JSON.stringify(n.authorizationDetails));try{const a=yield ai(t,i),s=yield si(t,a);return ze.fromTokenEndpointResponse(s)}catch(a){throw new jr(a)}})()}initiateBackchannelAuthentication(n){var e=this;return(0,h.A)(function*(){const{configuration:t,serverMetadata:r}=yield U(K,e,$).call(e),o=Dr(E(E({},S(O,e).authorizationParams),n?.authorizationParams)),i=new URLSearchParams(E(E({scope:Ur},o),{},{client_id:S(O,e).clientId,binding_message:n.bindingMessage,login_hint:JSON.stringify({format:"iss_sub",iss:r.issuer,sub:n.loginHint.sub})}));n.requestedExpiry&&i.append("requested_expiry",n.requestedExpiry.toString()),n.authorizationDetails&&i.append("authorization_details",JSON.stringify(n.authorizationDetails));try{const a=yield ai(t,i);return{authReqId:a.auth_req_id,expiresIn:a.expires_in,interval:a.interval}}catch(a){throw new jr(a)}})()}backchannelAuthenticationGrant(n){var e=this;return(0,h.A)(function*(){let{authReqId:t}=n;const{configuration:r}=yield U(K,e,$).call(e),o=new URLSearchParams({auth_req_id:t});try{const i=yield yr(r,"urn:openid:params:grant-type:ciba",o);return ze.fromTokenEndpointResponse(i)}catch(i){throw new jr(i)}})()}getTokenForConnection(n){var e=this;return(0,h.A)(function*(){var t;if(n.refreshToken&&n.accessToken)throw new Or("Either a refresh or access token should be specified, but not both.");const r=null!==(t=n.accessToken)&&void 0!==t?t:n.refreshToken;if(!r)throw new Or("Either a refresh or access token must be specified.");try{return yield e.exchangeToken({connection:n.connection,subjectToken:r,subjectTokenType:n.accessToken?"urn:ietf:params:oauth:token-type:access_token":"urn:ietf:params:oauth:token-type:refresh_token",loginHint:n.loginHint})}catch(o){throw o instanceof le?new Or(o.message,o.cause):o}})()}exchangeToken(n){var e=this;return(0,h.A)(function*(){return"connection"in n?U(K,e,tc).call(e,n):U(K,e,nc).call(e,n)})()}getTokenByCode(n,e){var t=this;return(0,h.A)(function*(){const{configuration:r}=yield U(K,t,$).call(t);try{const o=yield ui(r,n,{pkceCodeVerifier:e.codeVerifier});return ze.fromTokenEndpointResponse(o)}catch(o){throw new Js("There was an error while trying to request a token.",o)}})()}getTokenByRefreshToken(n){var e=this;return(0,h.A)(function*(){const{configuration:t}=yield U(K,e,$).call(e);try{const r=yield li(t,n.refreshToken);return ze.fromTokenEndpointResponse(r)}catch(r){throw new Vs("The access token has expired and there was an error while trying to refresh it.",r)}})()}getTokenByClientCredentials(n){var e=this;return(0,h.A)(function*(){const{configuration:t}=yield U(K,e,$).call(e);try{const r=new URLSearchParams({audience:n.audience});n.organization&&r.append("organization",n.organization);const o=yield di(t,r);return ze.fromTokenEndpointResponse(o)}catch(r){throw new Fs("There was an error while trying to request a token.",r)}})()}buildLogoutUrl(n){var e=this;return(0,h.A)(function*(){const{configuration:t,serverMetadata:r}=yield U(K,e,$).call(e);if(!r.end_session_endpoint){const o=new URL("https://".concat(S(O,e).domain,"/v2/logout"));return o.searchParams.set("returnTo",n.returnTo),o.searchParams.set("client_id",S(O,e).clientId),o}return function(o,i){me(o);const{as:a,c:s,tlsOnly:c}=H(o),l=dt(a,"end_session_endpoint",!1,c);(i=new URLSearchParams(i)).has("client_id")||i.set("client_id",s.client_id);for(const[u,f]of i.entries())l.searchParams.append(u,f);return l}(t,{post_logout_redirect_uri:n.returnTo})})()}verifyLogoutToken(n){var e=this;return(0,h.A)(function*(){const{serverMetadata:t}=yield U(K,e,$).call(e);S(kt,e)||D(kt,e,function(o,i){const a=new Ws(o,i),s=function(){var c=(0,h.A)(function*(l,u){return a.getKey(l,u)});return function(u,f){return c.apply(this,arguments)}}();return Object.defineProperties(s,{coolingDown:{get:()=>a.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>a.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>a.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>a.pendingFetch(),enumerable:!0,configurable:!1},jwks:{value:()=>a.jwks(),enumerable:!0,configurable:!1,writable:!1}}),s}(new URL(t.jwks_uri),{[yi]:S(O,e).customFetch}));const{payload:r}=yield function Ks(n,e,t){return Sr.apply(this,arguments)}(n.logoutToken,S(kt,e),{issuer:t.issuer,audience:S(O,e).clientId,algorithms:["RS256"],requiredClaims:["iat"]});if(!("sid"in r)&&!("sub"in r))throw new Ee('either "sid" or "sub" (or both) claims must be present');if("sid"in r&&"string"!=typeof r.sid)throw new Ee('"sid" claim must be a string');if("sub"in r&&"string"!=typeof r.sub)throw new Ee('"sub" claim must be a string');if("nonce"in r)throw new Ee('"nonce" claim is prohibited');if(!("events"in r))throw new Ee('"events" claim is missing');if("object"!=typeof r.events||null===r.events)throw new Ee('"events" claim must be an object');if(!("http://schemas.openid.net/event/backchannel-logout"in r.events))throw new Ee('"http://schemas.openid.net/event/backchannel-logout" member is missing in the "events" claim');if("object"!=typeof r.events["http://schemas.openid.net/event/backchannel-logout"])throw new Ee('"http://schemas.openid.net/event/backchannel-logout" member in the "events" claim must be an object');return{sid:r.sid,sub:r.sub}})()}});function $(){return Nr.apply(this,arguments)}function Nr(){return Nr=(0,h.A)(function*(){if(S(xe,this)&&S(Qe,this))return{configuration:S(xe,this),serverMetadata:S(Qe,this)};const n=yield U(K,this,rc).call(this);return D(xe,this,yield function Is(n,e,t,r,o){return cr.apply(this,arguments)}(new URL("https://".concat(S(O,this).domain)),S(O,this).clientId,{use_mtls_endpoint_aliases:S(O,this).useMtls},n,{[Se]:S(O,this).customFetch})),D(Qe,this,S(xe,this).serverMetadata()),S(xe,this)[Se]=S(O,this).customFetch||fetch,{configuration:S(xe,this),serverMetadata:S(Qe,this)}}),Nr.apply(this,arguments)}function tc(n){return Kr.apply(this,arguments)}function Kr(){return Kr=(0,h.A)(function*(n){var e,t;const{configuration:r}=yield U(K,this,$).call(this);if("audience"in n||"resource"in n)throw new le("audience and resource parameters are not supported for Token Vault exchanges");Si(n.subjectToken);const o=new URLSearchParams({connection:n.connection,subject_token:n.subjectToken,subject_token_type:null!==(e=n.subjectTokenType)&&void 0!==e?e:"urn:ietf:params:oauth:token-type:access_token",requested_token_type:null!==(t=n.requestedTokenType)&&void 0!==t?t:"http://auth0.com/oauth/token-type/federated-connection-access-token"});n.loginHint&&o.append("login_hint",n.loginHint),n.scope&&o.append("scope",n.scope),ki(o,n.extra);try{const i=yield yr(r,"urn:auth0:params:oauth:grant-type:token-exchange:federated-connection-access-token",o);return ze.fromTokenEndpointResponse(i)}catch(i){throw new le("Failed to exchange token for connection '".concat(n.connection,"'."),i)}}),Kr.apply(this,arguments)}function nc(n){return Lr.apply(this,arguments)}function Lr(){return Lr=(0,h.A)(function*(n){const{configuration:e}=yield U(K,this,$).call(this);Si(n.subjectToken);const t=new URLSearchParams({subject_token_type:n.subjectTokenType,subject_token:n.subjectToken});n.audience&&t.append("audience",n.audience),n.scope&&t.append("scope",n.scope),n.requestedTokenType&&t.append("requested_token_type",n.requestedTokenType),n.organization&&t.append("organization",n.organization),ki(t,n.extra);try{const r=yield yr(e,"urn:ietf:params:oauth:grant-type:token-exchange",t);return ze.fromTokenEndpointResponse(r)}catch(r){throw new le("Failed to exchange token of type '".concat(n.subjectTokenType,"'").concat(n.audience?" for audience '".concat(n.audience,"'"):"","."),r)}}),Lr.apply(this,arguments)}function rc(){return Mr.apply(this,arguments)}function Mr(){return Mr=(0,h.A)(function*(){if(!S(O,this).clientSecret&&!S(O,this).clientAssertionSigningKey&&!S(O,this).useMtls)throw new Bs;if(S(O,this).useMtls)return(e,t,r,o)=>{r.set("client_id",t.client_id)};let n=S(O,this).clientAssertionSigningKey;return!n||n instanceof CryptoKey||(n=yield(e=(0,h.A)(function*(t,r,o){if("string"!=typeof t||0!==t.indexOf("-----BEGIN PRIVATE KEY-----"))throw new TypeError('"pkcs8" must be PKCS#8 formatted string');return xs(t,r,o)}),function(t,r,o){return e.apply(this,arguments)})(n,S(O,this).clientAssertionSigningAlg||"RS256")),n?function(e){return function Qa(n,e){const{key:t,kid:r}=(o=n)instanceof CryptoKey?{key:o}:o?.key instanceof CryptoKey?(void 0!==o.kid&&N(o.kid,'"kid"'),{key:o.key,kid:o.kid}):{};var o;return function Ba(n,e){if(function(t,r){if(!(t instanceof CryptoKey))throw R("".concat(r," must be a CryptoKey"),"ERR_INVALID_ARG_TYPE")}(n,e),"private"!==n.type)throw R("".concat(e," must be a private CryptoKey"),"ERR_INVALID_ARG_VALUE")}(t,'"clientPrivateKey.key"'),function(){var i=(0,h.A)(function*(a,s,c,l){const u={alg:Xa(t),kid:r},f=function(m,p){const g=Kt()+Nt(p);return{jti:Po(),aud:m.issuer,exp:g+60,iat:g,nbf:g,iss:p.client_id,sub:p.client_id}}(a,s);var m;c.set("client_id",s.client_id),c.set("client_assertion_type","urn:ietf:params:oauth:client-assertion-type:jwt-bearer"),c.set("client_assertion",yield(m=(0,h.A)(function*(p,g,_){if(!_.usages.includes("sign"))throw R('CryptoKey instances used for signing assertions must include "sign" in their "usages"',"ERR_INVALID_ARG_VALUE");const y="".concat(je(qe(JSON.stringify(p))),".").concat(je(qe(JSON.stringify(g)))),v=je(yield crypto.subtle.sign(function(w){switch(w.algorithm.name){case"ECDSA":return{name:w.algorithm.name,hash:gs(w)};case"RSA-PSS":switch(Wo(w),w.algorithm.hash.name){case"SHA-256":case"SHA-384":case"SHA-512":return{name:w.algorithm.name,saltLength:parseInt(w.algorithm.hash.name.slice(-3),10)>>3};default:throw new q("unsupported RSA-PSS hash name",{cause:w})}case"RSASSA-PKCS1-v1_5":return Wo(w),w.algorithm.name;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":case"Ed25519":return w.algorithm.name}throw new q("unsupported CryptoKey algorithm name",{cause:w})}(_),_,qe(y)));return"".concat(y,".").concat(v)}),function(p,g,_){return m.apply(this,arguments)})(u,f,t))});return function(a,s,c,l){return i.apply(this,arguments)}}()}(e)}(n):ni(S(O,this).clientSecret);var e}),Mr.apply(this,arguments)}function Wr(n){return zr.apply(this,arguments)}function zr(){return zr=(0,h.A)(function*(n){const{configuration:e}=yield U(K,this,$).call(this),t=function Ps(){return Po()}(),r=yield function Cs(n){return(e=(0,h.A)(function*(t){return N(t,"codeVerifier"),je(yield crypto.subtle.digest("SHA-256",qe(t)))}),function(t){return e.apply(this,arguments)})(n);var e}(t),o=Dr(E(E({},S(O,this).authorizationParams),n?.authorizationParams)),i=new URLSearchParams(E(E({scope:Ur},o),{},{client_id:S(O,this).clientId,code_challenge:r,code_challenge_method:"S256"}));return{authorizationUrl:null!=n&&n.pushedAuthorizationRequests?yield hi(e,i):yield mr(e,i),codeVerifier:t}}),zr.apply(this,arguments)}class Te extends j{constructor(e,t){super(e,t),Object.setPrototypeOf(this,Te.prototype)}static fromPayload(e){let{error:t,error_description:r}=e;return new Te(t,r)}}class Qt extends Te{constructor(e,t){super(e,t),Object.setPrototypeOf(this,Qt.prototype)}}class Hr extends Te{constructor(e,t){super(e,t),Object.setPrototypeOf(this,Hr.prototype)}}class Jr extends Te{constructor(e,t){super(e,t),Object.setPrototypeOf(this,Jr.prototype)}}class $e extends Te{constructor(e,t){super(e,t),Object.setPrototypeOf(this,$e.prototype)}}class Fr extends Te{constructor(e,t){super(e,t),Object.setPrototypeOf(this,Fr.prototype)}}class oc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6e5;this.contexts=new Map,this.ttlMs=e}set(e,t){this.cleanup(),this.contexts.set(e,Object.assign(Object.assign({},t),{createdAt:Date.now()}))}get(e){const t=this.contexts.get(e);if(t){if(!(Date.now()-t.createdAt>this.ttlMs))return t;this.contexts.delete(e)}}remove(e){this.contexts.delete(e)}cleanup(){const e=Date.now();for(const[t,r]of this.contexts)e-r.createdAt>this.ttlMs&&this.contexts.delete(t)}get size(){return this.contexts.size}}class ic{constructor(e,t){this.authJsMfaClient=e,this.auth0Client=t,this.contextManager=new oc}setMFAAuthDetails(e,t,r,o){this.contextManager.set(e,{scope:t,audience:r,mfaRequirements:o})}getAuthenticators(e){var t=this;return(0,h.A)(function*(){var r,o;const i=t.contextManager.get(e);if(null===(r=i?.mfaRequirements)||void 0===r||!r.challenge||0===i.mfaRequirements.challenge.length)throw new Qt("invalid_request","challengeType is required and must contain at least one challenge type, please check mfa_required error payload");const a=i.mfaRequirements.challenge.map(s=>s.type);try{return(yield t.authJsMfaClient.listAuthenticators({mfaToken:e})).filter(s=>!!s.type&&a.includes(s.type))}catch(s){throw s instanceof vi?new Qt(null===(o=s.cause)||void 0===o?void 0:o.error,s.message):s}})()}enroll(e){var t=this;return(0,h.A)(function*(){var r;const o=function(i){const a=za[i.factorType];return Object.assign(Object.assign(Object.assign({mfaToken:i.mfaToken,authenticatorTypes:a.authenticatorTypes},a.oobChannels&&{oobChannels:a.oobChannels}),"phoneNumber"in i&&{phoneNumber:i.phoneNumber}),"email"in i&&{email:i.email})}(e);try{return yield t.authJsMfaClient.enrollAuthenticator(o)}catch(i){throw i instanceof wi?new Hr(null===(r=i.cause)||void 0===r?void 0:r.error,i.message):i}})()}challenge(e){var t=this;return(0,h.A)(function*(){var r;try{const o={challengeType:e.challengeType,mfaToken:e.mfaToken};return e.authenticatorId&&(o.authenticatorId=e.authenticatorId),yield t.authJsMfaClient.challengeAuthenticator(o)}catch(o){throw o instanceof bi?new Jr(null===(r=o.cause)||void 0===r?void 0:r.error,o.message):o}})()}getEnrollmentFactors(e){var t=this;return(0,h.A)(function*(){const r=t.contextManager.get(e);if(!r||!r.mfaRequirements)throw new Fr("mfa_context_not_found","MFA context not found for this MFA token. Please retry the original request to get a new MFA token.");return r.mfaRequirements.enroll&&0!==r.mfaRequirements.enroll.length?r.mfaRequirements.enroll:[]})()}verify(e){var t=this;return(0,h.A)(function*(){const r=t.contextManager.get(e.mfaToken);if(!r)throw new $e("mfa_context_not_found","MFA context not found for this MFA token. Please retry the original request to get a new MFA token.");const o="otp"in(s=e)&&s.otp?"http://auth0.com/oauth/grant-type/mfa-otp":"oobCode"in s&&s.oobCode?"http://auth0.com/oauth/grant-type/mfa-oob":"recoveryCode"in s&&s.recoveryCode?"http://auth0.com/oauth/grant-type/mfa-recovery-code":void 0;var s;if(!o)throw new $e("invalid_request","Unable to determine grant type. Provide one of: otp, oobCode, or recoveryCode.");const i=r.scope,a=r.audience;try{const s=yield t.auth0Client._requestTokenForMfa({grant_type:o,mfaToken:e.mfaToken,scope:i,audience:a,otp:e.otp,oob_code:e.oobCode,binding_code:e.bindingCode,recovery_code:e.recoveryCode});return t.contextManager.remove(e.mfaToken),s}catch(s){if(s instanceof nt)t.setMFAAuthDetails(s.mfa_token,i,a,s.mfa_requirements);else if(s instanceof $e)throw new $e(s.error,s.error_description);throw s}})()}}class ac{constructor(e){let t,r;if(this.userCache=(new lo).enclosedCache,this.defaultOptions={authorizationParams:{scope:"openid profile email"},useRefreshTokensFallback:!1,useFormData:!0},this.options=Object.assign(Object.assign(Object.assign({},this.defaultOptions),e),{authorizationParams:Object.assign(Object.assign({},this.defaultOptions.authorizationParams),e.authorizationParams)}),typeof window<"u"&&(()=>{if(!Ct())throw new Error("For security reasons, `window.crypto` is required to run `auth0-spa-js`.");if(void 0===Ct().subtle)throw new Error("\n      auth0-spa-js must run on a secure origin. See https://github.com/auth0/auth0-spa-js/blob/main/FAQ.md#why-do-i-get-auth0-spa-js-must-run-on-a-secure-origin for more information.\n    ")})(),this.lockManager=(fn||(fn=function aa(){return typeof navigator<"u"&&"function"==typeof(null===(n=navigator.locks)||void 0===n?void 0:n.request)?new oa:new ia;var n}()),fn),e.cache&&e.cacheLocation&&console.warn("Both `cache` and `cacheLocation` options have been specified in the Auth0Client configuration; ignoring `cacheLocation` and using `cache`."),e.cache)r=e.cache;else{if(t=e.cacheLocation||"memory",!_o(t))throw new Error('Invalid cache location "'.concat(t,'"'));r=_o(t)()}this.httpTimeoutMs=e.httpTimeoutInSeconds?1e3*e.httpTimeoutInSeconds:1e4,this.cookieStorage=!1===e.legacySameSiteCookie?Ve:Ra,this.orgHintCookieName="auth0.".concat(this.options.clientId,".organization_hint"),this.isAuthenticatedCookieName=(()=>"auth0.".concat(this.options.clientId,".is.authenticated"))(),this.sessionCheckExpiryDays=e.sessionCheckExpiryDays||1;const i=e.useCookiesForTransactions?this.cookieStorage:Oa;var a,l,u;this.scope=function(l,u){for(var f=arguments.length,m=new Array(f>2?f-2:0),p=2;p<f;p++)m[p-2]=arguments[p];if("object"!=typeof l)return{default:It(u,l,...m)};let g={default:It(u,...m)};return Object.keys(l).forEach(_=>{g[_]=It(u,l[_],...m)}),g}(this.options.authorizationParams.scope,"openid",this.options.useRefreshTokens?"offline_access":""),this.transactionManager=new xa(i,this.options.clientId,this.options.cookieDomain),this.nowProvider=this.options.nowProvider||$r,this.cacheManager=new Aa(r,r.allKeys?void 0:new Ua(r,this.options.clientId),this.nowProvider),this.dpop=this.options.useDpop?new La(this.options.clientId):void 0,this.domainUrl=/^https?:\/\//.test(a=this.options.domain)?a:"https://".concat(a),this.tokenIssuer=(u=this.domainUrl,(l=this.options.issuer)?l.startsWith("https://")?l:"https://".concat(l,"/"):"".concat(u,"/"));const s="".concat(this.domainUrl,"/me/"),c=this.createFetcher(Object.assign(Object.assign({},this.options.useDpop&&{dpopNonceId:"__auth0_my_account_api__"}),{getAccessToken:()=>this.getTokenSilently({authorizationParams:{scope:"create:me:connected_accounts",audience:s},detailedResponse:!0})}));this.myAccountApi=new Wa(c,s),this.authJsClient=new ec({domain:this.options.domain,clientId:this.options.clientId}),this.mfa=new ic(this.authJsClient.mfa,this),typeof window<"u"&&window.Worker&&this.options.useRefreshTokens&&"memory"===t&&(this.worker=this.options.workerUrl?new Worker(this.options.workerUrl):new Da)}getConfiguration(){return Object.freeze({domain:this.options.domain,clientId:this.options.clientId})}_url(e){const r=eo(this.options.auth0Client||Qr,!0),o=encodeURIComponent(btoa(JSON.stringify(r)));return"".concat(this.domainUrl).concat(e,"&auth0Client=").concat(o)}_authorizeUrl(e){return this._url("/authorize?".concat(ln(e)))}_verifyIdToken(e,t,r){var o=this;return(0,h.A)(function*(){const i=yield o.nowProvider();return(n=>{if(!n.id_token)throw new Error("ID token is required but missing");const e=(i=>{const a=i.split("."),[s,c,l]=a;if(3!==a.length||!s||!c||!l)throw new Error("ID token could not be decoded");const u=JSON.parse(no(c)),f={__raw:i},m={};return Object.keys(u).forEach(p=>{f[p]=u[p],Ea.includes(p)||(m[p]=u[p])}),{encoded:{header:s,payload:c,signature:l},header:JSON.parse(no(s)),claims:f,user:m}})(n.id_token);if(!e.claims.iss)throw new Error("Issuer (iss) claim must be a string present in the ID token");if(e.claims.iss!==n.iss)throw new Error('Issuer (iss) claim mismatch in the ID token; expected "'.concat(n.iss,'", found "').concat(e.claims.iss,'"'));if(!e.user.sub)throw new Error("Subject (sub) claim must be a string present in the ID token");if("RS256"!==e.header.alg)throw new Error('Signature algorithm of "'.concat(e.header.alg,'" is not supported. Expected the ID token to be signed with "RS256".'));if(!e.claims.aud||"string"!=typeof e.claims.aud&&!Array.isArray(e.claims.aud))throw new Error("Audience (aud) claim must be a string or array of strings present in the ID token");if(Array.isArray(e.claims.aud)){if(!e.claims.aud.includes(n.aud))throw new Error('Audience (aud) claim mismatch in the ID token; expected "'.concat(n.aud,'" but was not one of "').concat(e.claims.aud.join(", "),'"'));if(e.claims.aud.length>1){if(!e.claims.azp)throw new Error("Authorized Party (azp) claim must be a string present in the ID token when Audience (aud) claim has multiple values");if(e.claims.azp!==n.aud)throw new Error('Authorized Party (azp) claim mismatch in the ID token; expected "'.concat(n.aud,'", found "').concat(e.claims.azp,'"'))}}else if(e.claims.aud!==n.aud)throw new Error('Audience (aud) claim mismatch in the ID token; expected "'.concat(n.aud,'" but found "').concat(e.claims.aud,'"'));if(n.nonce){if(!e.claims.nonce)throw new Error("Nonce (nonce) claim must be a string present in the ID token");if(e.claims.nonce!==n.nonce)throw new Error('Nonce (nonce) claim mismatch in the ID token; expected "'.concat(n.nonce,'", found "').concat(e.claims.nonce,'"'))}if(n.max_age&&!st(e.claims.auth_time))throw new Error("Authentication Time (auth_time) claim must be a number present in the ID token when Max Age (max_age) is specified");if(null==e.claims.exp||!st(e.claims.exp))throw new Error("Expiration Time (exp) claim must be a number present in the ID token");if(!st(e.claims.iat))throw new Error("Issued At (iat) claim must be a number present in the ID token");const t=n.leeway||60,r=new Date(n.now||Date.now()),o=new Date(0);if(o.setUTCSeconds(e.claims.exp+t),r>o)throw new Error("Expiration Time (exp) claim error in the ID token; current time (".concat(r,") is after expiration time (").concat(o,")"));if(null!=e.claims.nbf&&st(e.claims.nbf)){const i=new Date(0);if(i.setUTCSeconds(e.claims.nbf-t),r<i)throw new Error("Not Before time (nbf) claim in the ID token indicates that this token can't be used just yet. Current time (".concat(r,") is before ").concat(i))}if(null!=e.claims.auth_time&&st(e.claims.auth_time)){const i=new Date(0);if(i.setUTCSeconds(parseInt(e.claims.auth_time)+n.max_age+t),r>i)throw new Error("Authentication Time (auth_time) claim in the ID token indicates that too much time has passed since the last end-user authentication. Current time (".concat(r,") is after last auth at ").concat(i))}if(n.organization){const i=n.organization.trim();if(i.startsWith("org_")){const a=i;if(!e.claims.org_id)throw new Error("Organization ID (org_id) claim must be a string present in the ID token");if(a!==e.claims.org_id)throw new Error('Organization ID (org_id) claim mismatch in the ID token; expected "'.concat(a,'", found "').concat(e.claims.org_id,'"'))}else{const a=i.toLowerCase();if(!e.claims.org_name)throw new Error("Organization Name (org_name) claim must be a string present in the ID token");if(a!==e.claims.org_name)throw new Error('Organization Name (org_name) claim mismatch in the ID token; expected "'.concat(a,'", found "').concat(e.claims.org_name,'"'))}}return e})({iss:o.tokenIssuer,aud:o.options.clientId,id_token:e,nonce:t,organization:r,leeway:o.options.leeway,max_age:(a=o.options.authorizationParams.max_age,"string"!=typeof a?a:parseInt(a,10)||void 0),now:i});var a})()}_processOrgHint(e){e?this.cookieStorage.save(this.orgHintCookieName,e,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}):this.cookieStorage.remove(this.orgHintCookieName,{cookieDomain:this.options.cookieDomain})}_prepareAuthorizeUrl(e,t,r){var o=this;return(0,h.A)(function*(){var i;const a=un(rt()),s=un(rt()),c=rt(),l=yield to(c),u=ro(l),f=yield null===(i=o.dpop)||void 0===i?void 0:i.calculateThumbprint(),m=(g=o.options,_=o.scope,y=e,v=a,w=s,A=u,x=e.redirect_uri||o.options.authorizationParams.redirect_uri||r,b=t?.response_mode,C=f,Object.assign(Object.assign(Object.assign({client_id:g.clientId},g.authorizationParams),y),{scope:Rt(_,y.scope,y.audience),response_type:"code",response_mode:b||"query",state:v,nonce:w,redirect_uri:x||g.authorizationParams.redirect_uri,code_challenge:A,code_challenge_method:"S256",dpop_jkt:C})),p=o._authorizeUrl(m);var g,_,y,v,w,A,x,b,C;return{nonce:s,code_verifier:c,scope:m.scope,audience:m.audience||"default",redirect_uri:m.redirect_uri,state:a,url:p}})()}loginWithPopup(e,t){var r=this;return(0,h.A)(function*(){var o;if(e=e||{},!(t=t||{}).popup&&(t.popup=(()=>{const l=window.screenX+(window.innerWidth-400)/2,u=window.screenY+(window.innerHeight-600)/2;return window.open("","auth0:authorize:popup","left=".concat(l,",top=").concat(u,",width=").concat(400,",height=").concat(600,",resizable,scrollbars=yes,status=1"))})(),!t.popup))throw new sn;const i=yield r._prepareAuthorizeUrl(e.authorizationParams||{},{response_mode:"web_message"},window.location.origin);t.popup.location.href=i.url;const a=yield(c=Object.assign(Object.assign({},t),{timeoutInSeconds:t.timeoutInSeconds||r.options.authorizeTimeoutInSeconds||60}),new Promise((l,u)=>{let f;const m=setInterval(()=>{c.popup&&c.popup.closed&&(clearInterval(m),clearTimeout(p),window.removeEventListener("message",f,!1),u(new an(c.popup)))},1e3),p=setTimeout(()=>{clearInterval(m),u(new on(c.popup)),window.removeEventListener("message",f,!1)},1e3*(c.timeoutInSeconds||60));f=function(g){if(g.data&&"authorization_response"===g.data.type){if(clearTimeout(p),clearInterval(m),window.removeEventListener("message",f,!1),!1!==c.closePopup&&c.popup.close(),g.data.response.error)return u(j.fromPayload(g.data.response));l(g.data.response)}},window.addEventListener("message",f)}));var c;if(i.state!==a.state)throw new j("state_mismatch","Invalid state");const s=(null===(o=e.authorizationParams)||void 0===o?void 0:o.organization)||r.options.authorizationParams.organization;yield r._requestToken({audience:i.audience,scope:i.scope,code_verifier:i.code_verifier,grant_type:"authorization_code",code:a.code,redirect_uri:i.redirect_uri},{nonceIn:i.nonce,organization:s})})()}getUser(){var e=this;return(0,h.A)(function*(){var t;const r=yield e._getIdTokenFromCache();return null===(t=r?.decodedToken)||void 0===t?void 0:t.user})()}getIdTokenClaims(){var e=this;return(0,h.A)(function*(){var t;const r=yield e._getIdTokenFromCache();return null===(t=r?.decodedToken)||void 0===t?void 0:t.claims})()}loginWithRedirect(){var e=arguments,t=this;return(0,h.A)(function*(){var r;const o=vo(e.length>0&&void 0!==e[0]?e[0]:{}),{openUrl:i,fragment:a,appState:s}=o,c=ee(o,["openUrl","fragment","appState"]),l=(null===(r=c.authorizationParams)||void 0===r?void 0:r.organization)||t.options.authorizationParams.organization,u=yield t._prepareAuthorizeUrl(c.authorizationParams||{}),{url:f}=u,m=ee(u,["url"]);t.transactionManager.create(Object.assign(Object.assign(Object.assign({},m),{appState:s,response_type:Re.Code}),l&&{organization:l}));const p=a?"".concat(f,"#").concat(a):f;i?yield i(p):window.location.assign(p)})()}handleRedirectCallback(){var e=arguments,t=this;return(0,h.A)(function*(){const r=(e.length>0&&void 0!==e[0]?e[0]:window.location.href).split("?").slice(1);if(0===r.length)throw new Error("There are no query params available for parsing.");const o=t.transactionManager.get();if(!o)throw new j("missing_transaction","Invalid state");t.transactionManager.remove();const i=(a=>{a.indexOf("#")>-1&&(a=a.substring(0,a.indexOf("#")));const s=new URLSearchParams(a);return{state:s.get("state"),code:s.get("code")||void 0,connect_code:s.get("connect_code")||void 0,error:s.get("error")||void 0,error_description:s.get("error_description")||void 0}})(r.join(""));return o.response_type===Re.ConnectCode?t._handleConnectAccountRedirectCallback(i,o):t._handleLoginRedirectCallback(i,o)})()}_handleLoginRedirectCallback(e,t){var r=this;return(0,h.A)(function*(){const{code:o,state:i,error:a,error_description:s}=e;if(a)throw new nn(a,s||a,i,t.appState);if(!t.code_verifier||t.state&&t.state!==i)throw new j("state_mismatch","Invalid state");const c=t.organization,l=t.nonce,u=t.redirect_uri;return yield r._requestToken(Object.assign({audience:t.audience,scope:t.scope,code_verifier:t.code_verifier,grant_type:"authorization_code",code:o},u?{redirect_uri:u}:{}),{nonceIn:l,organization:c}),{appState:t.appState,response_type:Re.Code}})()}_handleConnectAccountRedirectCallback(e,t){var r=this;return(0,h.A)(function*(){const{connect_code:o,state:i,error:a,error_description:s}=e;if(a)throw new rn(a,s||a,t.connection,i,t.appState);if(!o)throw new j("missing_connect_code","Missing connect code");if(!(t.code_verifier&&t.state&&t.auth_session&&t.redirect_uri&&t.state===i))throw new j("state_mismatch","Invalid state");const c=yield r.myAccountApi.completeAccount({auth_session:t.auth_session,connect_code:o,redirect_uri:t.redirect_uri,code_verifier:t.code_verifier});return Object.assign(Object.assign({},c),{appState:t.appState,response_type:Re.ConnectCode})})()}checkSession(e){var t=this;return(0,h.A)(function*(){if(!t.cookieStorage.get(t.isAuthenticatedCookieName)){if(!t.cookieStorage.get("auth0.is.authenticated"))return;t.cookieStorage.save(t.isAuthenticatedCookieName,!0,{daysUntilExpire:t.sessionCheckExpiryDays,cookieDomain:t.options.cookieDomain}),t.cookieStorage.remove("auth0.is.authenticated")}try{yield t.getTokenSilently(e)}catch{}})()}getTokenSilently(){var e=arguments,t=this;return(0,h.A)(function*(){let r=e.length>0&&void 0!==e[0]?e[0]:{};var o,i;const a=Object.assign(Object.assign({cacheMode:"on"},r),{authorizationParams:Object.assign(Object.assign(Object.assign({},t.options.authorizationParams),r.authorizationParams),{scope:Rt(t.scope,null===(o=r.authorizationParams)||void 0===o?void 0:o.scope,(null===(i=r.authorizationParams)||void 0===i?void 0:i.audience)||t.options.authorizationParams.audience)})}),s=yield((c,l)=>{let u=Sn[l];return u||(u=t._getTokenSilently(a).finally(()=>{delete Sn[l],u=null}),Sn[l]=u),u})(0,"".concat(t.options.clientId,"::").concat(a.authorizationParams.audience,"::").concat(a.authorizationParams.scope));return r.detailedResponse?s:s?.access_token})()}_getTokenSilently(e){var t=this;return(0,h.A)(function*(){const{cacheMode:r}=e,o=ee(e,["cacheMode"]);if("off"!==r){const c=yield t._getEntryFromCache({scope:o.authorizationParams.scope,audience:o.authorizationParams.audience||"default",clientId:t.options.clientId,cacheMode:r});if(c)return c}if("cache-only"===r)return;const i=(a=t.options.clientId,s=o.authorizationParams.audience||"default","".concat("auth0.lock.getTokenSilently",".").concat(a,".").concat(s));var a,s;return yield t.lockManager.runWithLock(i,5e3,(0,h.A)(function*(){if("off"!==r){const g=yield t._getEntryFromCache({scope:o.authorizationParams.scope,audience:o.authorizationParams.audience||"default",clientId:t.options.clientId});if(g)return g}const c=t.options.useRefreshTokens?yield t._getTokenUsingRefreshToken(o):yield t._getTokenFromIFrame(o),{id_token:l,token_type:u,access_token:f,oauthTokenScope:m,expires_in:p}=c;return Object.assign(Object.assign({id_token:l,token_type:u,access_token:f},m?{scope:m}:null),{expires_in:p})}))})()}getTokenWithPopup(){var e=arguments,t=this;return(0,h.A)(function*(){let r=e.length>0&&void 0!==e[0]?e[0]:{},o=e.length>1&&void 0!==e[1]?e[1]:{};var i,a;const s=Object.assign(Object.assign({},r),{authorizationParams:Object.assign(Object.assign(Object.assign({},t.options.authorizationParams),r.authorizationParams),{scope:Rt(t.scope,null===(i=r.authorizationParams)||void 0===i?void 0:i.scope,(null===(a=r.authorizationParams)||void 0===a?void 0:a.audience)||t.options.authorizationParams.audience)})});return o=Object.assign(Object.assign({},$i),o),yield t.loginWithPopup(s,o),(yield t.cacheManager.get(new X({scope:s.authorizationParams.scope,audience:s.authorizationParams.audience||"default",clientId:t.options.clientId}),void 0,t.options.useMrrt)).access_token})()}isAuthenticated(){var e=this;return(0,h.A)(function*(){return!!(yield e.getUser())})()}_buildLogoutUrl(e){null!==e.clientId?e.clientId=e.clientId||this.options.clientId:delete e.clientId;const t=e.logoutParams||{},{federated:r}=t,o=ee(t,["federated"]),i=r?"&federated":"";return this._url("/v2/logout?".concat(ln(Object.assign({clientId:e.clientId},o))))+i}logout(){var e=arguments,t=this;return(0,h.A)(function*(){let r=e.length>0&&void 0!==e[0]?e[0]:{};var o;const i=vo(r),{openUrl:a}=i,s=ee(i,["openUrl"]);null===r.clientId?yield t.cacheManager.clear():yield t.cacheManager.clear(r.clientId||t.options.clientId),t.cookieStorage.remove(t.orgHintCookieName,{cookieDomain:t.options.cookieDomain}),t.cookieStorage.remove(t.isAuthenticatedCookieName,{cookieDomain:t.options.cookieDomain}),t.userCache.remove("@@user@@"),yield null===(o=t.dpop)||void 0===o?void 0:o.clear();const c=t._buildLogoutUrl(s);a?yield a(c):!1!==a&&window.location.assign(c)})()}_getTokenFromIFrame(e){var t=this;return(0,h.A)(function*(){const r=(o=t.options.clientId,"".concat("auth0.lock.getTokenFromIFrame",".").concat(o));var o;try{return yield t.lockManager.runWithLock(r,5e3,(0,h.A)(function*(){const i=Object.assign(Object.assign({},e.authorizationParams),{prompt:"none"}),a=t.cookieStorage.get(t.orgHintCookieName);a&&!i.organization&&(i.organization=a);const{url:s,state:c,nonce:l,code_verifier:u,redirect_uri:f,scope:m,audience:p}=yield t._prepareAuthorizeUrl(i,{response_mode:"web_message"},window.location.origin);if(window.crossOriginIsolated)throw new j("login_required","The application is running in a Cross-Origin Isolated context, silently retrieving a token without refresh token is not possible.");const g=e.timeoutInSeconds||t.options.authorizeTimeoutInSeconds;let _;try{_=new URL(t.domainUrl).origin}catch{_=t.domainUrl}const y=yield function(w,A){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;return new Promise((b,C)=>{const I=window.document.createElement("iframe");I.setAttribute("width","0"),I.setAttribute("height","0"),I.style.display="none";const Y=()=>{window.document.body.contains(I)&&(window.document.body.removeChild(I),window.removeEventListener("message",W,!1))};let W;const de=setTimeout(()=>{C(new Je),Y()},1e3*x);W=function(G){if(G.origin!=A||!G.data||"authorization_response"!==G.data.type)return;const He=G.source;He&&He.close(),G.data.response.error?C(j.fromPayload(G.data.response)):b(G.data.response),clearTimeout(de),window.removeEventListener("message",W,!1),setTimeout(Y,2e3)},window.addEventListener("message",W,!1),window.document.body.appendChild(I),I.setAttribute("src",w)})}(s,_,g);if(c!==y.state)throw new j("state_mismatch","Invalid state");const v=yield t._requestToken(Object.assign(Object.assign({},e.authorizationParams),{code_verifier:u,code:y.code,grant_type:"authorization_code",redirect_uri:f,timeout:e.authorizationParams.timeout||t.httpTimeoutMs}),{nonceIn:l,organization:i.organization});return Object.assign(Object.assign({},v),{scope:m,oauthTokenScope:v.scope,audience:p})}))}catch(i){throw"login_required"===i.error&&t.logout({openUrl:!1}),i}})()}_getTokenUsingRefreshToken(e){var t=this;return(0,h.A)(function*(){var r,o;const i=yield t.cacheManager.get(new X({scope:e.authorizationParams.scope,audience:e.authorizationParams.audience||"default",clientId:t.options.clientId}),void 0,t.options.useMrrt);if(!(i&&i.refresh_token||t.worker)){if(t.options.useRefreshTokensFallback)return yield t._getTokenFromIFrame(e);throw new xt(e.authorizationParams.audience||"default",e.authorizationParams.scope)}const a=e.authorizationParams.redirect_uri||t.options.authorizationParams.redirect_uri||window.location.origin,s="number"==typeof e.timeoutInSeconds?1e3*e.timeoutInSeconds:null,c=((p,g,_,y)=>{var v;if(p&&_&&y){if(g.audience!==_)return g.scope;const w=y.split(" "),A=(null===(v=g.scope)||void 0===v?void 0:v.split(" "))||[],x=A.every(b=>w.includes(b));return w.length>=A.length&&x?y:g.scope}return g.scope})(t.options.useMrrt,e.authorizationParams,i?.audience,i?.scope);try{const p=yield t._requestToken(Object.assign(Object.assign(Object.assign({},e.authorizationParams),{grant_type:"refresh_token",refresh_token:i&&i.refresh_token,redirect_uri:a}),s&&{timeout:s}),{scopesToRequest:c});if(p.refresh_token&&i?.refresh_token&&(yield t.cacheManager.updateEntry(i.refresh_token,p.refresh_token)),t.options.useMrrt&&(l=i?.audience,u=i?.scope,!(l===e.authorizationParams.audience&&wo(e.authorizationParams.scope,u)||wo(c,p.scope)))){if(t.options.useRefreshTokensFallback)return yield t._getTokenFromIFrame(e);yield t.cacheManager.remove(t.options.clientId,e.authorizationParams.audience,e.authorizationParams.scope);const g=((_,y)=>{const v=_?.split(" ")||[],w=y?.split(" ")||[];return v.filter(A=>-1==w.indexOf(A)).join(",")})(c,p.scope);throw new cn(e.authorizationParams.audience||"default",g)}return Object.assign(Object.assign({},p),{scope:e.authorizationParams.scope,oauthTokenScope:p.scope,audience:e.authorizationParams.audience||"default"})}catch(p){if(p.message){if(p.message.includes("user is blocked"))throw yield t.logout({openUrl:!1}),p;if((p.message.includes("Missing Refresh Token")||p.message.includes("invalid refresh token"))&&t.options.useRefreshTokensFallback)return yield t._getTokenFromIFrame(e)}throw p instanceof nt&&t.mfa.setMFAAuthDetails(p.mfa_token,null===(r=e.authorizationParams)||void 0===r?void 0:r.scope,null===(o=e.authorizationParams)||void 0===o?void 0:o.audience,p.mfa_requirements),p}var l,u})()}_saveEntryInCache(e){var t=this;return(0,h.A)(function*(){const{id_token:r,decodedToken:o}=e,i=ee(e,["id_token","decodedToken"]);t.userCache.set("@@user@@",{id_token:r,decodedToken:o}),yield t.cacheManager.setIdToken(t.options.clientId,e.id_token,e.decodedToken),yield t.cacheManager.set(i)})()}_getIdTokenFromCache(){var e=this;return(0,h.A)(function*(){const t=e.options.authorizationParams.audience||"default",r=e.scope[t],o=yield e.cacheManager.getIdToken(new X({clientId:e.options.clientId,audience:t,scope:r})),i=e.userCache.get("@@user@@");return o&&o.id_token===i?.id_token?i:(e.userCache.set("@@user@@",o),o)})()}_getEntryFromCache(e){var t=this;return(0,h.A)(function*(){let{scope:r,audience:o,clientId:i,cacheMode:a}=e;const s=yield t.cacheManager.get(new X({scope:r,audience:o,clientId:i}),60,t.options.useMrrt,a);if(s&&s.access_token){const{token_type:c,access_token:l,oauthTokenScope:u,expires_in:f}=s,m=yield t._getIdTokenFromCache();return m&&Object.assign(Object.assign({id_token:m.id_token,token_type:c||"Bearer",access_token:l},u?{scope:u}:null),{expires_in:f})}})()}_requestToken(e,t){var r=this;return(0,h.A)(function*(){var o,i;const{nonceIn:a,organization:s,scopesToRequest:c}=t||{},l=yield function ba(n,e){return wn.apply(this,arguments)}(Object.assign(Object.assign({baseUrl:r.domainUrl,client_id:r.options.clientId,auth0Client:r.options.auth0Client,useFormData:r.options.useFormData,timeout:r.httpTimeoutMs,useMrrt:r.options.useMrrt,dpop:r.dpop},e),{scope:c||e.scope}),r.worker),u=yield r._verifyIdToken(l.id_token,a,s);if("authorization_code"===e.grant_type){const f=yield r._getIdTokenFromCache();null!==(i=null===(o=f?.decodedToken)||void 0===o?void 0:o.claims)&&void 0!==i&&i.sub&&f.decodedToken.claims.sub!==u.claims.sub&&(yield r.cacheManager.clear(r.options.clientId),r.userCache.remove("@@user@@"))}return yield r._saveEntryInCache(Object.assign(Object.assign(Object.assign(Object.assign({},l),{decodedToken:u,scope:e.scope,audience:e.audience||"default"}),l.scope?{oauthTokenScope:l.scope}:null),{client_id:r.options.clientId})),r.cookieStorage.save(r.isAuthenticatedCookieName,!0,{daysUntilExpire:r.sessionCheckExpiryDays,cookieDomain:r.options.cookieDomain}),r._processOrgHint(s||u.claims.org_id),Object.assign(Object.assign({},l),{decodedToken:u})})()}loginWithCustomTokenExchange(e){var t=this;return(0,h.A)(function*(){return t._requestToken(Object.assign(Object.assign({},e),{grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:e.subject_token,subject_token_type:e.subject_token_type,scope:Rt(t.scope,e.scope,e.audience||t.options.authorizationParams.audience),audience:e.audience||t.options.authorizationParams.audience,organization:e.organization||t.options.authorizationParams.organization}))})()}exchangeToken(e){var t=this;return(0,h.A)(function*(){return t.loginWithCustomTokenExchange(e)})()}_assertDpop(e){if(!e)throw new Error("`useDpop` option must be enabled before using DPoP.")}getDpopNonce(e){return this._assertDpop(this.dpop),this.dpop.getNonce(e)}setDpopNonce(e,t){return this._assertDpop(this.dpop),this.dpop.setNonce(e,t)}generateDpopProof(e){return this._assertDpop(this.dpop),this.dpop.generateProof(e)}createFetcher(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Ma(e,{isDpopEnabled:()=>!!this.options.useDpop,getAccessToken:t=>{var r;return this.getTokenSilently({authorizationParams:{scope:null===(r=t?.scope)||void 0===r?void 0:r.join(" "),audience:t?.audience},detailedResponse:!0})},getDpopNonce:()=>this.getDpopNonce(e.dpopNonceId),setDpopNonce:t=>this.setDpopNonce(t,e.dpopNonceId),generateDpopProof:t=>this.generateDpopProof(t)})}connectAccountWithRedirect(e){var t=this;return(0,h.A)(function*(){const{openUrl:r,appState:o,connection:i,scopes:a,authorization_params:s,redirectUri:c=t.options.authorizationParams.redirect_uri||window.location.origin}=e;if(!i)throw new Error("connection is required");const l=un(rt()),u=rt(),f=yield to(u),m=ro(f),{connect_uri:p,connect_params:g,auth_session:_}=yield t.myAccountApi.connectAccount({connection:i,scopes:a,redirect_uri:c,state:l,code_challenge:m,code_challenge_method:"S256",authorization_params:s});t.transactionManager.create({state:l,code_verifier:u,auth_session:_,redirect_uri:c,appState:o,connection:i,response_type:Re.ConnectCode});const y=new URL(p);y.searchParams.set("ticket",g.ticket),r?yield r(y.toString()):window.location.assign(y)})()}_requestTokenForMfa(e,t){var r=this;return(0,h.A)(function*(){const{mfaToken:o}=e,i=ee(e,["mfaToken"]);return r._requestToken(Object.assign(Object.assign({},i),{mfa_token:o}),t)})()}}function Vr(){return Vr=(0,h.A)(function*(n){const e=new ac(n);return yield e.checkSession(),e}),Vr.apply(this,arguments)}function At(n,e="sessionStorage"){return typeof window>"u"?null:("localStorage"===e?localStorage:sessionStorage).getItem(n)}function Ai(n,e,t="sessionStorage"){typeof window>"u"||("localStorage"===t?localStorage:sessionStorage).setItem(n,e)}function xi(n,e="sessionStorage"){typeof window>"u"||("localStorage"===e?localStorage:sessionStorage).removeItem(n)}class Gr{STANDARD_JWT_CLAIMS=["sub","name","email","email_verified","preferred_username","given_name","family_name","nickname","locale","picture","phone","phone_verified","updated_at","iss","aud","exp","iat","auth_time","nonce","acr","amr","azp","at_hash","c_hash"];auth0Client=null;initializationPromise=null;userSubject;user$;config;storageConfig;storageKeys;eventBus;constructor(e,t,r={TOKEN_STORAGE:"sessionStorage",USER_INFO_STORAGE:"sessionStorage"},o={ACCESS_TOKEN:"auth0_access_token",USER_INFO:"auth0_user_info"}){this.config=e,this.eventBus=t,this.storageConfig=r,this.storageKeys=o,this.userSubject=new et.BehaviorSubject(this.getUserInfoFromStorage()),this.user$=this.userSubject.asObservable(),console.log("[AuthService] AuthService instance created (Auth0 client will be initialized on first use)")}initializeAuth0(){var e=this;return(0,h.A)(function*(){try{if(console.log("[AuthService] Starting Auth0 client initialization..."),!e.config||"object"!=typeof e.config)throw new Error("[AuthService] Auth0 config is not defined or invalid");if(!e.config.domain||!e.config.clientId)throw new Error("[AuthService] Auth0 config is missing required fields (domain, clientId)");e.auth0Client=yield function sc(n){return Vr.apply(this,arguments)}({domain:e.config.domain,clientId:e.config.clientId,authorizationParams:{redirect_uri:e.config.redirectUri,scope:e.config.scope,...e.config.audience&&{audience:e.config.audience}},cacheLocation:"memory",useRefreshTokens:!0}),console.log("[AuthService] Auth0 client initialized successfully")}catch(t){throw console.error("[AuthService] Failed to initialize Auth0 client:",t),t}})()}ensureInitialized(){var e=this;return(0,h.A)(function*(){if(!e.auth0Client){if(e.initializationPromise)return void(yield e.initializationPromise);if(e.initializationPromise=e.initializeAuth0(),yield e.initializationPromise,!e.auth0Client)throw new Error("[AuthService] Auth0 client failed to initialize")}})()}login(e,t){var r=this;return(0,h.A)(function*(){e&&console.log(`[AuthService] Logging in: ${e}`);try{let o;if(yield r.ensureInitialized(),window.location.search){const a=window.location.search;o={returnTo:a},console.log("[AuthService] Preserving URL parameters through auth flow:",a)}const i={redirect_uri:r.config.redirectUri,scope:r.config.scope,...r.config.audience&&{audience:r.config.audience},...r.config.connection&&{connection:r.config.connection}};t?.invitation&&(i.invitation=t.invitation,console.log("[AuthService] Including invitation parameter:",t.invitation)),t?.organization&&(i.organization=t.organization,console.log("[AuthService] Including organization parameter:",t.organization)),console.log("[AuthService] Starting Auth0 login redirect..."),yield r.auth0Client.loginWithRedirect({authorizationParams:i,...o&&{appState:o}})}catch(o){throw console.error("[AuthService] Login failed:",o),r.emitAuthEvent("login_failure",{error:o instanceof Error?o.message:String(o)}),o}})()}handleCallback(){var e=this;return(0,h.A)(function*(){try{console.log("[AuthService] Processing Auth0 callback..."),yield e.ensureInitialized();const t=yield e.auth0Client.handleRedirectCallback();console.log("[AuthService] Callback processed successfully"),t.appState?console.log("[AuthService] Restored appState from auth flow:",JSON.stringify(t.appState)):console.log("[AuthService] No appState restored");const r=yield e.auth0Client.getUser();if(!r||!r.sub)return console.warn("[AuthService] No user info returned from Auth0"),e.emitAuthEvent("login_failure",{error:"No user info returned from Auth0"}),{success:!1};e.logUserClaims(r),e.setUserInfo(r);const o=yield e.auth0Client.getTokenSilently();return e.setToken(o),console.log("[AuthService] Authentication successful"),e.emitAuthEvent("login_success",{user:r,appState:t.appState}),{success:!0,appState:t.appState}}catch(t){return console.error("[AuthService] Error processing callback:",t),e.emitAuthEvent("login_failure",{error:t instanceof Error?t.message:String(t)}),{success:!1}}})()}logUserClaims(e){console.log("=".repeat(80)),console.log("[AuthService] \u{1f50d} AUTH0 ID TOKEN - ALL CLAIMS:"),console.log("=".repeat(80)),this.logStandardClaims(e);const t=this.getCustomClaims(e);this.logClaims("\n\u{1f511} Custom Claims (Auth0):",t,e);const r=this.getAdditionalClaims(e);this.logClaims("\n\u{1f527} Additional Claims:",r,e),console.log("\n\u{1f4e6} Complete User Object (JSON):"),console.log(JSON.stringify(e,null,2)),console.log("=".repeat(80))}logStandardClaims(e){console.log("\n\u{1f4cb} Standard OIDC Claims:"),["sub","name","email","email_verified","preferred_username","given_name","family_name","nickname","locale","picture","phone","phone_verified","updated_at"].forEach(r=>{console.log(`  \u2022 ${"sub"===r?`${r} (Subject/User ID)`:r}:`,e[r])})}logClaims(e,t,r){console.log(e),0!==t.length?t.forEach(o=>{const i=r[o],a="object"==typeof i?JSON.stringify(i,null,2):i;console.log(`  \u2022 ${o}:`,a)}):console.log("  No custom claims found")}getCustomClaims(e){return Object.keys(e).filter(t=>!this.STANDARD_JWT_CLAIMS.includes(t)&&this.isNamespacedClaim(t))}getAdditionalClaims(e){return Object.keys(e).filter(t=>!this.STANDARD_JWT_CLAIMS.includes(t)&&!this.isNamespacedClaim(t))}isNamespacedClaim(e){return e.startsWith("http://")||e.startsWith("https://")}logout(){var e=this;return(0,h.A)(function*(){xi(e.storageKeys.ACCESS_TOKEN,e.storageConfig.TOKEN_STORAGE),xi(e.storageKeys.USER_INFO,e.storageConfig.USER_INFO_STORAGE),e.userSubject.next(null),e.emitAuthEvent("logout",null),console.log("[AuthService] User logged out, clearing Auth0 session");try{yield e.ensureInitialized(),yield e.auth0Client.logout({logoutParams:{returnTo:e.config.logoutUri}})}catch(t){console.error("[AuthService] Error during Auth0 logout:",t)}})()}getToken(){var e=this;return(0,h.A)(function*(){const t=At(e.storageKeys.ACCESS_TOKEN,e.storageConfig.TOKEN_STORAGE);if(t)return t;try{yield e.ensureInitialized();const r=yield e.auth0Client.getTokenSilently();return e.setToken(r),r}catch(r){return console.error("[AuthService] Error getting token from Auth0:",r),null}})()}getTokenSync(){return At(this.storageKeys.ACCESS_TOKEN,this.storageConfig.TOKEN_STORAGE)}setToken(e){Ai(this.storageKeys.ACCESS_TOKEN,e,this.storageConfig.TOKEN_STORAGE),this.emitAuthEvent("token_updated",{token:e})}isAuthenticated(){var e=this;return(0,h.A)(function*(){try{return yield e.ensureInitialized(),yield e.auth0Client.isAuthenticated()}catch(t){return console.error("[AuthService] Error checking authentication status:",t),!!At(e.storageKeys.ACCESS_TOKEN,e.storageConfig.TOKEN_STORAGE)}})()}isAuthenticatedSync(){return!!At(this.storageKeys.ACCESS_TOKEN,this.storageConfig.TOKEN_STORAGE)}getUser(){return this.userSubject.value}getUserData(){const e=this.getUser();if(!e)return null;const t=this.extractClaimValue(e,"role","user"),r=this.extractClaimValue(e,["org","organization"],"default");return{id:e.sub,name:e.name||e.email||"User",email:e.email||"",role:t,org:r}}extractClaimValue(e,t,r){const o=Array.isArray(t)?t:[t];for(const a of o){const s=e[a];if(null!=s&&("string"==typeof s||"number"==typeof s||"boolean"==typeof s))return String(s)}const i=this.getCustomClaims(e);for(const a of o){const s=i.find(c=>c.toLowerCase().includes(a.toLowerCase()));if(s&&e[s]){const c=e[s];if(Array.isArray(c)&&c.length>0){const l=c[0];if("string"==typeof l||"number"==typeof l||"boolean"==typeof l)return String(l)}else if("string"==typeof c||"number"==typeof c||"boolean"==typeof c)return String(c)}}return r}getUserInfoFromStorage(){const e=At(this.storageKeys.USER_INFO,this.storageConfig.USER_INFO_STORAGE);return e?JSON.parse(e):null}setUserInfo(e){Ai(this.storageKeys.USER_INFO,JSON.stringify(e),this.storageConfig.USER_INFO_STORAGE),this.userSubject.next(e),console.log("[AuthService] \u{1f4be} User info stored in storage:"),console.log("  Standard claims:",{sub:e.sub,name:e.name,email:e.email,email_verified:e.email_verified});const t=this.getCustomClaims(e);t.length>0&&(console.log("  Custom claims stored:"),t.forEach(r=>{console.log(`    \u2022 ${r}:`,e[r])})),this.emitAuthEvent("user_info_updated",e)}emitAuthEvent(e,t){const r={type:`auth:${e}`,payload:t,timestamp:(new Date).toISOString()};this.eventBus.emit(r.type,r),console.log("[AuthService] Auth event emitted:",r.type)}}const Ei=new Xr,cc=new Gr({domain:tn.auth0Domain,clientId:tn.auth0ClientId,redirectUri:window.location.origin+"/auth-callback",logoutUri:window.location.origin,scope:"openid profile email"},Ei);function uc(){return(0,Pi.bootstrapApplication)(Wi,{providers:[(0,he.provideRouter)(Yi),(0,qr.provideHttpClient)((0,qr.withFetch)()),{provide:Xr,useValue:Ei},{provide:Gr,useValue:cc},{provide:"APP_CONFIG",useValue:tn}]})}}}]);